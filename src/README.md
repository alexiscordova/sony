# **Introduction**
This is our standard front-end build stack, it incorporates a number of open source tools and applications to help streamline our development. At the core is Grunt.js. It has 2 main targets: 'deploy' and 'debug'. The idea being debug would run as a constant watch target and update files as they are saved. The deploy being a more robust build that concatenates and minifies javascript and css. Below is a list and the required terminal commands to get up and running as well as links to all associated libraries, plugins, and required frameworks (node, java & ruby). 

## **Build Tools**  
Assumes your environment already has a minimum of :  
*Node (v0.10.0) / NPM (1.2.14)   
*Java (1.6.0_37)  - required for yui compressor  
*Ruby (1.8.7) / Ruby Gems (1.8.24) - required for compass  

If you don't here's how to get those:  
* **Node.js** http://nodejs.org/  
* **Ruby** http://www.ruby-lang.org/en/downloads/  
* **Java** http://www.java.com/  

Many of these are installed and checked into the /src/ directory so you will not need to install all of these however the full install directions are here. You skip the plugins installs, but it is recommended to install docpad and grunt using the -g (global) flag. 


**Grunt.js** command line automation tool http://gruntjs.com/  
requires: **Node.js** http://nodejs.org/ 
```
#!terminal

$ sudo npm install -g grunt-cli
```

*grunt plugins* 
(installed in the repo - stored under node_modules by npm)

* "grunt-clear": "~0.1.2", // clears the console output https://github.com/geddesign/grunt-clear
* "grunt-contrib-clean": "~0.4.0", //clears output directories https://github.com/gruntjs/grunt-contrib-clean
* "grunt-contrib-compass": "~0.1.3", //compass scss -> css https://github.com/gruntjs/grunt-contrib-compass
* "grunt-contrib-copy": "~0.4.0", //copies files and directories https://github.com/gruntjs/grunt-contrib-copy
* "grunt-contrib-jade": "~0.4.0", //compiles .jade templates into html https://github.com/gruntjs/grunt-contrib-jade 
* "grunt-contrib-watch": "~0.3.1",  //watches for changes and runs tasks https://github.com/gruntjs/grunt-contrib-watch
* "grunt-doccoh": "~0.1.3", //generates js documentation https://github.com/rozmiarek/grunt-doccoh
* "grunt-contrib-jshint": "~0.2.0", //runs js-hint on js and json https://github.com/gruntjs/grunt-contrib-jshint
* "grunt-yui-compressor": "~0.2.1", //magnification & concatenation of js https://github.com/mathiasbynens/grunt-yui-compressor
* "express": "~3.1.0" //node router for pagebuilder


**Compass converts SASS / SCSS to CSS** http://compass-style.org/
requires: Ruby, Ruby Gems http://rubygems.org/pages/download
```
#!terminal

$ sudo gem install compass
```


## **To Run**

**Debug:** (default task) This rebuilds the debug directory, parses your .scss files into css. Runs JSLint to test for errors in your javascript files. Compiles Html Templates into Pages. 
```
#!terminal

$ grunt 
```
or
```
#!terminal

$ grunt debug
```
or
```
#!terminal

$ grunt build
```

**Deploy:** This does the same things as debug except it concatinates and minifies your css & javascript files and rebuilds the deploy directory.

```
#!terminal

$ grunt deploy
```
or
```
#!terminal

$ grunt build --deploy
```

**Docs: ** This rebuilds the docs directory. [Docco](https://github.com/jashkenas/docco) documentation requires the [Python Pygments](http://pygments.org/) library, which can be installed with 'sudo easy_install pygments'.
```
#!terminal

$ grunt docs
```

**Pages: ** This runs compile on all the pagebuild files that are generated by page builder (or by hand)

```
#!terminal

$ grunt pages
```


**All: ** This runs all 'debug' 'deploy' and 'docs' 'pages' and does clean.
```
#!terminal

$ grunt all
```

### **Advanced:**
*All of the following accept --deploy to target the deploy directory it assumes debug*  
ie:
```
#!terminal

$ grunt task --deploy
```

**Common: ** This compiles all of the global and shared script, css, etc
```
#!terminal

$ grunt common
```

*All of the following accept :module-name to focus the task onto a specific module//*  
ie:
```
#!terminal

$ grunt task:module-name
```

**Watch:**
This watches your source files and performs tasks specific to each filetype for the debug target. For instance if you change a js file it will run lint and copy your js files to debug. If you change a .scss file it runs compass... etc. 
```
#!terminal

$ grunt watch
```

**CSS: ** runs compass to compile .scss into css files (also re-compiles the responsive-modules.scss in common)
```
#!terminal

$ grunt css
```


**JS: ** copies the js files into the defer folder (or minifies them into the --deploy folder)
```
#!terminal

$ grunt js
```

**HTML: ** compiles the files from module/demo/*.jade into html files 
```
#!terminal

$ grunt html
```

**Assets:** copies everything from images
```
#!terminal

$ grunt assets
```

**Light: ** builds css js and demo jade files
```
#!terminal

$ grunt light
```

**Build: ** runs clean, assets, and light (js, css, and demo jade files)
```
#!terminal

$ grunt build
```

### **Even More Advanced!:  
most of these are used internally by the above tasks but many can be called on their \\n:  
**clean** clears build folder  
**jshint** checks all site js and json not in docs or **/libs/  
**lint** legacy alias for jshint  

not going into detail on these:

**copy**   
  :common_debug  
  :common_deploy  
  :module_debug  
  :module_deploy  
  :docs  

**compass**  
  :common_debug  
  :common_deploy  
  :module_debug  // wont work on own use css  
  :module_deploy // wont work on own use css  
  :docs  

**min**   
  :plugins  
  :require  
  :secondary  
  :defer  
  :polyfill  

**jade **  
  :docs  
  :pages  
  :build_debug  
  :build_deploy  


## **Folder Structure**
all the source is located inside src/packages/

src/packages/common/ includes all the global level code and assets

src/packages/modules/** includes all the module code

src/packages/modules/**/css - module specific scss

src/packages/modules/**/html - jade template

src/packages/modules/**/img - image assets

src/packages/modules/**/js - javascript

src/packages/modules/**/demo - example demos and layouts for each module, not used in production

src/packages/modules/**/demo/data example json files to compile the demo and layouts against

## **Page Templates**
For pages we're using Jade templates, see [[Jade%20101|Jade 101]]

## **Module Data**

To include data through the partial include function you can use an external json like so:

```
#!jade

e = {"locals":locals, "data":data('your-module-name/default.json')}
!{ partial('modules/module_test.html.eco', e) }

```

The JSON format for jade is very strict, to help avoid compile errors we're running jshint

Remember that valid JSON object keys and variable names are strings and require double quotes, everywhere. When in doubt check here: http://jsonlint.com/ 

To reference your data using jade variables are found the 'data' class

```
#!jade

!{ data.myvar }

if data.somevar
  h1 something 
else
  h1 something else

ul
for item in data.myarray
  li item

```

more about jade templates: [Jade 101](Jade%20101)

## **Javascript Bundles**

inside packages/common/js we've grouped some of the js together in separate bundles

/libs is intended for third party libraries like jquery and modernizr
/libs/polyfill for scripts that only get used on IE such as selectivizr 

/require for scripts that are required on every page at load time
/secondary / for scripts that are required on every page but not loaded immediately

In debug all the scripts will just get copied over 1:1

In deploy all scripts are minified and scripts within required & secondary will get concatenated into require.min.js and secondary.min.js respectively 

All js files except top level libs will automatically be written into pages with the js_foot includes.

## **Docco JS Documentation**
We're using [Docco](https://github.com/jashkenas/docco) to create javascript docs automatically. Docco parses JS to pull out single-line comments and parse them using the markdown syntax. For example:


```
#!javascript

// Module Title
// ------------
//
// * **Module:** Module Name
// * **Version:** 0.1
// * **Modified:** 01/01/2013
// * **Author:** Joe Developer
// * **Dependencies:** jQuery 1.7+, Modernizr
//
// *Example Usage:*
//
//      $('#foo').moduleName({
//        'sampleOption': 'foo'
//      });

```

Much more about markdown syntax [here](http://daringfireball.net/projects/markdown/basics) and [here](http://greg.vario.us/doc/markdown.txt). 

## ** Migrating from build tools v0.1.0  to v0.2.0 **
delete your current build files

npm uninstall grunt -g
npm uninstall docpad -g

update node to v0.10.0
npm install grunt-cli -g

re-check out master

test your modules
check for images, I re-linked alot of them
update your README.md file
* describe your module
* document the data .json files and what your jade template expects / options / requirements / etc

don't add build back into the repo, it should be in gitignore now


## ** Troubleshooting** 

### **Data not rendering to template** 
make sure your json variables **do not** have dashes in their names. 

//The Good//
```
#!json
{
    "categoryTitle":"Television Home Cinema",
    "tabs": [
        {
            "image": "img/modules/subnav/subnav_tab_tv.png",
            "imageAltTxt": "Televisions Sub Category Image",
            "title": "Two-up Pane",
            "target":"two-up-pane",
            "outlink":false
        }
   ]
}
```

//The Bad//
```
#!json
{
    "category-title":"Television Home Cinema",
    "tabs": [
        {
            "image": "img/modules/subnav/subnav_tab_tv.png",
            "image-alt-text": "Televisions Sub Category Image",
            "title": "Two-up Pane",
            "data-target":"two-up-pane",
            "outlink":false
        }
   ]
}
```

//The Ugly//
```
#!json
{
    "Category-Title":"Television Home Cinema",
    "tabs": [
        {
            "image": "img/modules/subnav/subnav_tab_tv.png",
            "Image-Alt-Text": "Televisions Sub Category Image",
            "title": "Two-up Pane",
            "Data-Target":"two-up-pane",
            "outlink":false
        }
   ]
}
```

### **On build, you get this (or similar) error** 
```
#!terminal
Waiting...
Error: watch EMFILE
```

Most likely it's a OS-level issue and you should update your limit by running this:
```
#!terminal
launchctl limit maxfiles 2048 2048
```

## **Optional Helper Apps**

* **Image Optim** handy image compression tool http://imageoptim.com/
requires: Mac OSX
//NOTE: You should Disable 'Jpegrescan' in ImageOptim preferences, it tends to make jpegs 'progressive download' //

* **Livereload** monitors local file changes and reloads the browser http://livereload.com/
* **Charles web proxy** blocks cache, throttles loading to simulate slow connection speeds, monitors server responses, etc http://www.charlesproxy.com/