include ../../../common/html/jade-helpers.jade
+includeJavascriptModule('subnavigation-n4')

section.subnav-module

  header
    .container
      .slimgrid
        h2 !{data.category}

  nav
    .container
      - for ( i = 0; i < data.subcategories.length; i = i + 6 ) {
        .slimgrid.m-grid-at-479
          - for ( j = i; j < i + 6 && j < data.subcategories.length; j++ ) {
            - item = data.subcategories[j]
            .span2.m-span2
              img(src=item.imageSrc)
              p !{item.title}
          - }
      - }

  .subnav-tray.container

    for subcategory in data.subcategories

      div.slimgrid
        .span6
          h3 !{subcategory.title}
          p !{subcategory.message}
        .span6
          a(href=subcategory.accessoryLink) Accessories
          a(href=subcategory.galleryLink) View All !{subcategory.title}

      - subcategoryLength = subcategory.products.length
      - if ( subcategory.marketingTout ) subcategoryLength++

      - for ( i = 0; i < subcategoryLength; i = i + 4 ) {
        .slimgrid.m-grid-at-767.no-grid-at-479
          - for ( j = i; j < i + 4 && j < subcategoryLength; j++ ) {

            if subcategory.marketingTout && j == subcategoryLength - 1
              - item = subcategory.marketingTout
              .span3.m-span2
                a(href=item.link)
                  img(src=item.imageSrc)
                  p !{item.message + " "}
                    span !{item.linkText}

            else
              - item = subcategory.products[j]
              .span3.m-span2
                img(src=item.imageSrc)
                h4 !{item.label}
                p !{item.count} !{subcategory.title}
                p !{item.message}
                p Starting at
                  strong !{" " + item.startingAtPrice + " "}
                  | MSRP
          - }
      - }