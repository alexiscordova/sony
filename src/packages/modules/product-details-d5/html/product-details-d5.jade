include ../../../common/html/jade-helpers.jade
+includeJavascriptModule('product-details-d5')

mixin inchesString(inches)
  - inches = "(" + inches + "\")"
  p.inches= inches

mixin cmString(cm)
  p.centimeters
    | #{cm}cm

mixin measurementValues(value, dir, isThin)
  - clss = [dir + "-measurement"]
  
  if ((!isThin) && (dir == "vertical"))
    - clss.push('not-thin')
  
  div(class = clss) 
    div.measurements-container
      +cmString(value.cm)

      if (value.inches)
        +inchesString(value.inches)
  
mixin measurementsList(measurements)
  for m in measurements
    - isThin = m.thinImage
    - cm = m.height.cm
    - inches = m.width.inches

    .measurement.p4
      .wrapper
        .img-wrapper
          +iQImage(m.image, "pd-image")

        if (cm)
          +measurementValues(m.height, "vertical", isThin)  

        //- put width in image wrapper for simple centering solution
        if (inches)
          +measurementValues(m.width, "horizontal", isThin)

mixin featureList(list)
  - listClasses = 'feature-list'

  ul(class=listClasses)
    each li in list
      - copyClasses = ["copy", "ghost-center"]
      //- at least copy required
      if (li.copy)
        li
          .ghost-center-wrap
            if (li.icon)
              - iconClasses = ["icon", "ghost-center"]
              - copyClasses.push("with-icon")
              p(class= iconClasses)
                i(class= li.icon)
            
            p(class= copyClasses)
              | #{li.copy}
              
              if (li.link)
                a.no-wrap(href=li.link)= li.linkLabel
            
mixin definitionList( list, isHorizontal )
  - isHorizontal = isHorizontal || false
  - clss = isHorizontal ? 'dl-horizontal' : null
  dl(class=clss)
    each li in list
      dt.l3: strong= li.title
      if li.copy
        dd.p3= li.copy

mixin extras(extras)
  for extra in extras
    if(extra.copy)
      .extra
        p.l3
          strong= extra.title
        p.p3 !{extra.copy}        


mixin textTout(textTout)
  div(class= textToutClasses)
    //- FPO IMAGE FOR NOW, THIS SHOULD BE CHANGED FROM A PATH TO A ICON CLASS AS ALL OTHERS ARE
    if (textTout.icon)
      - btmCopyClasses.push("with-icon")
      .icon
        img(src= textTout.icon)      
    div(class= btmCopyClasses)
      | #{textTout.copy}
      if(textTout.link)
        a.no-wrap(href= textTout.link)= textTout.linkLabel

mixin bottomBtn(btn)
  .bottom-btn(class= bottomSpanClasses)
    a.btn.buttonLabel(href= btn.buttonLink)= btn.buttonLabel


//- CONTAINER
- productDetailsClasses = ["pd-module","container"]

//- TOP DATA
- top = data.top

//- CENTER DATA
- center = data.center
- features = center.features
- isFeatures = features.length > 0

- specs = center.specs
- isSpecs = specs.length > 0

- measurements = center.measurements
- isMeasurements = measurements.length > 0

- extras = center.extras
- isExtras = extras.length > 0

//- Defaults
- centerSpanClasses = []
- lastCoumnClasses = []

- sectionCount = 0 //- features/specs/measurements

//- Check how many columns there are
if(isFeatures) 
  - sectionCount = sectionCount + 100 

if(isSpecs)
  - sectionCount = sectionCount + 10

if(isMeasurements)
  - sectionCount = sectionCount + 1


//- KEY
//- 111 = Features / Specs / Measurements
//- 101 = Features / Measurements (2 col)
//- 011 = Specs / Measurements (2 col)
//- 110 = Features / Specs (2 col)
//- 100 = Features (treat as 2 col)
//- 010 = Specs (treat as 2 col)


//- Set the right grid span based on sectionCount
if(sectionCount == 111)
  //- Three Columns
  - centerSpanClasses.push("span4")
else
  //- Two Columns
  - centerSpanClasses.push("span6")

//- - centerSpanClasses.push("m-grid-at-479")

//- BOTTOM DATA VARS
- bottom = data.bottom
- bottomBtn = bottom.bottomBtn
- textTout = bottom.textTout
- isBottomBtn = bottomBtn.buttonLink != ""
- isTextTout = textTout.copy != ""
- bottomSpanClasses = ["m-span6"]
- textToutClasses = ["text-tout","span6","m-span6"]

//- Add necessary class
if((isTextTout) && (isBottomBtn))
  - bottomSpanClasses.push("span6")

//- START PRODUCT DETAILS
section(class= productDetailsClasses)
  .top.grid.no-grid-at-479.m-grid-at-767
    .title.l1= top.title

    if(top.desc.length > 0)
      .desc.p3= top.desc

  .center.grid.no-grid-at-479.m-grid-at-767
    case sectionCount
      when 111
        .features.m-span3(class= centerSpanClasses)
          +featureList(features)

        .specs.m-span3(class= centerSpanClasses)
          +definitionList(specs, false)

        .last-column.has-measurements.m-span6(class= centerSpanClasses)
          .measurements
            +measurementsList(measurements)

          if(isExtras)
            .extras.with-measurements.mobile-two-col
              +extras(extras)

      when 101
        .features(class= centerSpanClasses)
          +featureList(features)

        .last-column.has-measurements(class= centerSpanClasses)       
          .measurements
            +measurementsList(measurements)

          if(isExtras)
            .extras.with-measurements
              +extras(extras) 

      when 11
        .specs(class= centerSpanClasses)
          +definitionList(specs, false)

        .last-column.has-measurements(class= centerSpanClasses)       
          .measurements
            +measurementsList(measurements)

          if(isExtras)
            .extras.with-measurements
              +extras(extras) 
      
      when 110
        .features(class= centerSpanClasses)
          +featureList(features)

        .last-column(class= centerSpanClasses)
          .specs
            +definitionList(specs, false)

          if(isExtras)
            .extras
              +extras(extras)
      
      when 100
        //- SPLIT INTO TWO COLS
        - totalItems = features.length + extras.length
      
        - col1Start = 0
        - col1End = Math.round(totalItems/2) 
        
        - col2Start = col1End
        - col2End = totalItems

        - col1Items = features.slice(col1Start, col1End)
        - col2Items = features.slice(col2Start)

        .features(class= centerSpanClasses)
          +featureList(col1Items)

        .last-column(class= centerSpanClasses)
          .features
            +featureList(col2Items)
          
          if(isExtras)
            .extras
              +extras(extras) 

      when 10
        //- SPLIT INTO TWO COLS
        - totalItems = specs.length + extras.length
        
        - col1Start = 0
        - col1End = Math.round(totalItems/2)
        
        - col2Start = col1End
        - col2End = totalItems

        - col1Items = specs.slice(col1Start, col1End)
        - col2Items = specs.slice(col2Start)

        .specs(class= centerSpanClasses)
          +definitionList(col1Items, false)

        .last-column(class= centerSpanClasses)
          .specs
            +definitionList(col2Items, false)
          
          if(isExtras)
            .extras
              +extras(extras)
  
  .bottom.grid.m-grid-at-767
    - btmCopyClasses = ["copy","p3"]
    if(isTextTout)
      +textTout(textTout)
    
    if(isBottomBtn)
      +bottomBtn(bottomBtn)
      

//- END PRODUCT DETAILS