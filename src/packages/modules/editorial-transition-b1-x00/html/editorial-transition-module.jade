include ../../../common/html/jade-helpers.jade
+includeCSS('editorial-image-sequence')
+includeJavascriptModule('editorial-transition-b1-x00')

if data.layout
  editorialClasses = [ "editorial", data.layout.mode ]
  if data.layout.background
    - editorialClasses.push( data.layout.background )

- image = data.sequence[0].image ? data.sequence[0].image : null
- extraclass = image.classes ? image.classes : ""
- id = data.id ? data.id : "e360-instance"
- startId = id+"-0"

if data.layout
  - isDark = data.layout.dark ? "dark" : "light"
  - multiModule = data.layout.multiModule ? data.layout.multiModule : ""
  - bump = (multiModule == "true") ? "multiModule" : ""
  - lod = isDark ? "l-o-d" : ""

// new image sequence additions
if data.sequenceConfig
  - autoplay = data.sequenceConfig.autoplay ? data.sequenceConfig.autoplay : ''
  - viewControls = data.sequenceConfig.viewControls ? data.sequenceConfig.viewControls : ''
  - barControls = data.sequenceConfig.barControls ? data.sequenceConfig.barControls : ''
  - loopAnimation = data.sequenceConfig.loopAnimation ? data.sequenceConfig.loopAnimation : ''
  - animationSpeed = data.sequenceConfig.animationSpeed ? data.sequenceConfig.animationSpeed : ''
  - labelLeft = data.sequenceConfig.labelLeft ? data.sequenceConfig.labelLeft : ''
  - labelRight = data.sequenceConfig.labelRight ? data.sequenceConfig.labelRight : ''

if data.hotspotConfig
  - hotspots = data.hotspotConfig.hotspots ? data.hotspotConfig.hotspots : ''

if data.variation && data.variation.background
  - editorialClasses.push( data.variation.background )

mixin slidelabels
  if data.sequence
    div(class="label-data visuallyhidden")
      for labelData, i in data.sequence
        if labelData.label
          if labelData.label.type == "icon"
            i(data-type = labelData.label.type, data-label = labelData.label.content, data-id = i )
          else if labelData.label.type == "text"
            i(data-type = labelData.label.type, data-label = labelData.label.content, data-id = i )
          else
            i(data-label = labelData.label.content, data-id = i )

mixin gridstyle(_extra, mgrid)
  extraclass = _extra ? _extra : false
  if mgrid
    .grid.m-grid-at-767(class = extraclass)(class = data.style)
      block
  else
    .grid.no-grid-at-767(class = extraclass)(class = data.style)
      block

mixin copyblock(_copy, _title, _subtitle, _body)
  copyobject = _copy ? _copy : data
  titleclass = _title ? _title : "t2"
  subtitleclass = _subtitle ? _subtitle : "t6"
  bodyclass = _body ? _body : "p2"
  linkclass = data.mode == "full" ? "lt2" : "lt3"
  .copy
    if copyobject.icon
      i(class=copyobject.icon)
    if copyobject.title
      h2(class = titleclass) !{copyobject.title}
    if copyobject.subtitle
      h3(class = subtitleclass) !{copyobject.subtitle}
    if copyobject.body
      p(class = bodyclass) !{copyobject.body}
  if copyobject.link
    .link
      linktextsize = copyobject.link.type == "txt" ? linkclass : ""
      +link(copyobject.link, [copyobject.link.type, linktextsize])

  else if copyobject.addon
    e = { "locals" : locals, "data" : data.addon }
    !{ locals.partial('packages/modules/addon/html/addon.jade', e) }

  else if copyobject.features && copyobject.features.length > 0
    ul.media-list.feature-list
      each feature in copyobject.features
        li.media
          .pull-left.img-wrap
            +iQBackgroundImage( feature.img )
          .media-body
            p.p2-bold.media-heading.text-dark !{ feature.title }
            p.p2 !{ feature.body }

mixin col(_layout, extras)
  layout = _layout ? _layout : data.layout
  if layout.text == "left"
    - span = "span" + layout.columns[0]
    div(class = span)(class = extras)
      block
  else
    - span = "span" + layout.columns[1]
    - offset = "offset" + layout.columns[0]
    div(class = span)(class = offset)(class = extras)
      block

mixin center
  .table-center-wrap
    .table-center
      block

mixin boxclass(_layout)
  layout = _layout ? _layout : data.layout
  .box(class = layout.alignment)
    block

mixin textonlylayout(_layout)
  layout = _layout ? _layout : data.layout
  if layout.text == "full"
    .span12(class = layout.alignment)
      block
  else
    extras = "box " + layout.alignment
    +col(layout, extras)
      block


mixin sequenceNotes(_data, _sequenceId)
  - containerClass = 'visuallyhidden sequence-notes sequence-'+_sequenceId
  div(class= containerClass, data-id=_sequenceId)
    for note, _j in _data
      if note.pointer
        - noteClass = 'note has-pointer direction-'+note.pointer
        - noteDataX = note.coords[0]
        - noteDataY = note.coords[1]

        div(class=noteClass, data-x=noteDataX, data-y=noteDataY)
          span.pointer
          .note-content
            if note.headline
              p.t7.headline !{note.headline}
            if note.subhead
              p.p5.subhead !{note.subhead}
      else
        - noteClass = 'note'
        div(class = noteClass, data-x=noteDataX, data-y=noteDataY)
          .note-content
            if note.headline
              p.t7.headline !{note.headline}
            if note.subhead
              p.p5.subhead !{note.subhead}


mixin boxlayout(_layout)
  layout = _layout ? _layout : data.layout
  classes = layout.style
  mode = layout.mode
  if layout.mode == "editorial"
    .sequence-copy.editorial-sequence
      if layout
        if layout.mobilealign
          classes = classes + " " + layout.mobilealign
        if layout.text == "left" || layout.text == "full"
          .grid.no-grid-at-767(class = classes)
            - span = "span" + layout.columns[0]
            div(class = span)
              +boxclass
                block
        else if layout.text == "right" || layout.text == "center"
          if layout.columns
            .grid.no-grid-at-767(class = classes)
              - span = "span" + layout.columns[1]
              - offset =  "offset" + layout.columns[0]
              div(class = span)(class = offset)
                +boxclass
                  block
  else
    .sequence-copy
      if layout
        if layout.mobilealign
          classes = classes + " " + layout.mobilealign
        if layout.text == "left" || layout.text == "full"
          .grid.no-grid-at-767(class = classes)
            - span = "span" + layout.columns[0]
            div(class = span)
              +boxclass
                block
        else if layout.text == "right" || layout.text == "center"
          if layout.columns
            .grid.no-grid-at-767(class = classes)
              - span = "span" + layout.columns[1]
              - offset =  "offset" + layout.columns[0]
              div(class = span)(class = offset)
                +boxclass
                  block

+mainElement( editorialClasses )
  if data.sequenceConfig
    div(class="sony-sequence container dim-the-lights", id=id, data-sequence-autoplay=autoplay, data-sequence-viewcontrols=viewControls, data-sequence-barcontrols=barControls, data-sequence-loop=loopAnimation, data-sequence-animation-speed=animationSpeed )
      if data.layout
        if data.layout.mode == "full"
          if data.copy
            +gridstyle
              +textonlylayout
                +copyblock(data.copy, "t2", "t7", "p2")
      if data.sequence
        .sequence-note-container
          - for imgData, i in data.sequence
            if imgData.notes
              +sequenceNotes(imgData.notes, i)

      if data.layout
        if data.layout.mode == "editorial"
          +boxlayout
            if data.copy
              +copyblock(data.copy, "t2", "t7", "p2")
        else if data.layout.mode == "full-inner"
          +boxlayout
            if data.copy
              +copyblock(data.copy, "t3", "t7", "p3")

      .outer
        if data.background == "true"
          .loading.load-indicator.text-center
            img.global-loader.load-indicator(src="img/loader.gif", alt="Loading...")
          if data.sequence
            - for imgData, i in data.sequence
              - sequenceId = id+"-"+i
              - hide = (i == 0) ? "" : "visuallyhidden"
              .image-module.track-by-background.iq-img.no-fade(id= sequenceId, class= extraclass, data-sequence-id= i, data-src-desktop= imgData.image.srcDesktop, data-src-tablet= imgData.image.srcTablet, data-src-phone= imgData.image.srcPhone, data-src-desktop-highres= imgData.image.srcDesktopHighRes, data-src-tablet-highres= imgData.image.srcTabletHighRes, data-src-phone-highres= imgData.image.srcPhoneHighRes)(class= hide)
        else
          .loading.is-asset.load-indicator.text-center
            img.load-indicator.global-loader(src="img/loader.gif", alt="Loading...")
          if data.sequence
            - for imgData, i in data.sequence
              - sequenceId = id+"-"+i
              - hide = (i == 0) ? "" : "visuallyhidden"
              img.iq-img.no-fade(id= sequenceId, class= extraclass, alt= imgData.image.alt, data-sequence-id= i, data-src-desktop= imgData.image.srcDesktop, data-src-tablet= imgData.image.srcTablet, data-src-phone= imgData.image.srcPhone, data-src-desktop-highres= imgData.image.srcDesktopHighRes, data-src-tablet-highres= imgData.image.srcTabletHighRes, data-src-phone-highres= imgData.image.srcPhoneHighRes)(class= hide)
                noscript
                  img(src= imgData.noscriptsrc)

      +slidelabels

      .grid
        .span6.offset3
          +partial("sony-slide-nav/html/sony-slide-nav.jade", "packages/modules/sony-slide-nav/demo/data/default.json")


  else
    div(class="sony-sequence container dim-the-lights", id=id)
      .outer
        if data.background == "true"
          .loading.load-indicator.text-center
            img.global-loader.load-indicator(src="img/loader.gif", alt="Loading...")
          if data.sequence
            - for imgData, i in data.sequence
              - sequenceId = id+"-"+i
              - hide = (i == 0) ? "" : "visuallyhidden"
              .image-module.track-by-background.iq-img.no-fade(id= sequenceId, class= extraclass, data-sequence-id= i, data-src-desktop= imgData.image.srcDesktop, data-src-tablet= imgData.image.srcTablet, data-src-phone= imgData.image.srcPhone, data-src-desktop-highres= imgData.image.srcDesktopHighRes, data-src-tablet-highres= imgData.image.srcTabletHighRes, data-src-phone-highres= imgData.image.srcPhoneHighRes)(class= hide)
        else
          .loading.is-asset.load-indicator.text-center
            img.load-indicator.global-loader(src="img/loader.gif", alt="Loading...")
          if data.sequence
            - for imgData, i in data.sequence
              - sequenceId = id+"-"+i
              - hide = (i == 0) ? "" : "visuallyhidden"
              img.iq-img.no-fade(id= sequenceId, class= extraclass, alt= imgData.image.alt, data-sequence-id= i, data-src-desktop= imgData.image.srcDesktop, data-src-tablet= imgData.image.srcTablet, data-src-phone= imgData.image.srcPhone, data-src-desktop-highres= imgData.image.srcDesktopHighRes, data-src-tablet-highres= imgData.image.srcTabletHighRes, data-src-phone-highres= imgData.image.srcPhoneHighRes)(class= hide)
                noscript
                  img(src= imgData.noscriptsrc)

      .grid
        .span6.offset3
          +partial("sony-slide-nav/html/sony-slide-nav.jade", "packages/modules/sony-slide-nav/demo/data/default.json")
