include ../../../common/html/jade-helpers.jade
+includeCSS('related-products-g1')
+includeJavascriptModule('related-products-g1')

layouts = locals.getConfigFile("packages/modules/related-products-g1/html/layouts.json")


mixin includeSubmodules( submodules, config, view )
  blankIndex = layouts[config.layout].indexOf('blank-normal')

  if blankIndex > -1
    - submodules.splice( blankIndex, 0, {type:'packages/modules/product/html/product.jade'} )

  i = 0
  each module in submodules
    if module.data
      moduleData = locals.data(module.data)
    else 
      moduleData = {}

    - moduleData.layout = layouts[config.layout][i++]

    if view
      - moduleData.view = view
    else
      - moduleData.view = moduleData.layout == 'blank-normal' ? 'blank' : 'basic'

    e = { 'locals' : locals , 'data' : moduleData }
    !{locals.partial(module.type , e )}


mixin titleBlock( data )
  .container
    .grid
      if data.config.tabbedLayout
        .rp-tabs
          each tab, iterator in data.config.tabbedLayout
            panelId = iterator + 1
            a.rp-tab(class='lt4 no-hover-transition' , data-rp-panel-id=panelId, href='#')
              strong= tab.title

      else
        h2.l1= data.config.headerTitle


mixin rpSlide( data )
  .rp-slide(class=data.config.variation, data-variation=data.config.variation)
    .shuffle-container.slimgrid5
      +includeSubmodules( data.submodules, data.config )


mixin rpSection( data, slideContent, panelId )
  classes = [ 'related-products', data.config.mode ]
  panelId = panelId ? panelId : false

  //- Tabbed related products passes its slide content in, others need to grab it from the data
  slideContent = slideContent ? slideContent : data.slideContent

  div(class=classes, data-mode=data.config.mode , data-variation=data.config.variation, data-rp-panel-id=panelId)
    .rp-overflow
      .rp-container

        if slideContent
          each slide in slideContent
            mdata = locals.data(slide.data)
            +rpSlide( mdata )
        else
          +rpSlide( data )


mode = data.config.mode
hasSlides = mode == 'strip' ? false : !data.config.standalone

classes = ['rp-section']
if data.config.backgroundVariation
  - classes.push(data.config.backgroundVariation)

+mainElement(classes)

  if data.config.tabbedLayout
    +titleBlock( data )

    .rp-container-tabbed
      each slideContent, iterator in data.slideContent
        panelId = iterator + 1
        +rpSection( data, slideContent, panelId )


  else if hasSlides
    +titleBlock( data )
    +rpSection( data )


  else if !hasSlides

    if mode == 'full'
      +titleBlock( data )
      +rpSection( data )


    else if mode == 'suggested'
      +titleBlock( data )

      .container
        .grid
          div.related-products(class=mode , data-mode=mode , data-variation=data.config.variation)
            +includeSubmodules( data.submodules, data.config, 'suggested' )


    else if mode == 'strip'
      - data.isSubmodule = true
      e = { 'locals' : locals , 'data' : data }
      !{locals.partial( 'packages/modules/recently-viewed/html/recently-viewed.jade', e) }






