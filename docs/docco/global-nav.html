<!DOCTYPE html>  <html> <head>   <title>global-nav.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brightcove-builder.html">                 brightcove-builder.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="hotspot_explorer.html">                 hotspot_explorer.js               </a>                                           <a class="source" href="jquery.sc.tabbednav.html">                 jquery.sc.tabbednav.js               </a>                                           <a class="source" href="jquery.sc.thumbnails.html">                 jquery.sc.thumbnails.js               </a>                                           <a class="source" href="jquery.sc.thumbsbullets.html">                 jquery.sc.thumbsbullets.js               </a>                                           <a class="source" href="jquery.sc.thumbsnav.html">                 jquery.sc.thumbsnav.js               </a>                                           <a class="source" href="jquery.viewport.html">                 jquery.viewport.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="related-products.html">                 related-products.js               </a>                                           <a class="source" href="sony-gallery.html">                 sony-gallery.js               </a>                                           <a class="source" href="sony-one-carousel.html">                 sony-one-carousel.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="exports.html">                 exports.js               </a>                                           <a class="source" href="global-init.html">                 global-init.js               </a>                                           <a class="source" href="global-nav.html">                 global-nav.js               </a>                                           <a class="source" href="iq.html">                 iq.js               </a>                                           <a class="source" href="jquery.throttle-debounce.html">                 jquery.throttle-debounce.js               </a>                                           <a class="source" href="sony-iscroll.html">                 sony-iscroll.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               global-nav.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>------------ Sony Global Nav ------------
Module: Global Nav
Version: 1.0
Modified: 2012-12-17 by Christopher Mischler
Dependencies: jQuery 1.7+, Modernizr</p>

<h2>Optional: jQuery throttle-debounce (only used on window resize)</h2>             </td>             <td class="code">               <div class="highlight"><pre>
(<span class="keyword">function</span>($, Modernizr, window, <span class="literal">undefined</span>) {

  <span class="string">'use strict'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Start module</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> GlobalNav = <span class="keyword">function</span>( $container ) {

    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    self.searchMenu = {};
    self.$container = $container;
    self.$activePrimaryNavBtns = self.$container.find(<span class="string">'.nav-dropdown-toggle'</span>);
    self.$currentOpenNavBtn = <span class="literal">false</span>;
    self.$pageWrapOuter = $(<span class="string">'#page-wrap-outer'</span>);
    self.mobileNavIScroll = <span class="literal">false</span>,
    self.mobileNavVisible = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>we should make a bunch of this stuff global.</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.transEndEventNames = {
        <span class="string">'WebkitTransition'</span> : <span class="string">'webkitTransitionEnd'</span>,
        <span class="string">'MozTransition'</span>    : <span class="string">'transitionend'</span>,
        <span class="string">'OTransition'</span>      : <span class="string">'oTransitionEnd'</span>,
        <span class="string">'msTransition'</span>     : <span class="string">'MSTransitionEnd'</span>,
        <span class="string">'transition'</span>       : <span class="string">'transitionend'</span>
    };

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Get the right prefixed names e.g. WebkitTransitionDuration</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.tapOrClick = self.hasTouch ? <span class="string">'touchstart'</span> : <span class="string">'click'</span>;
    self.transformName = Modernizr.prefixed(<span class="string">'transform'</span>); <span class="comment">// css version</span>
    self.transitionName = Modernizr.prefixed(<span class="string">'transition'</span>);
    self.transitionProperty = Modernizr.prefixed(<span class="string">'transitionProperty'</span>);
    self.transitionDuration = Modernizr.prefixed(<span class="string">'transitionDuration'</span>);
    self.transitionEasing = Modernizr.prefixed(<span class="string">'transitionTimingFunction'</span>);
    self.transitionEnd = self.transEndEventNames[self.transitionName];



    <span class="keyword">if</span> ( self.mode === <span class="string">'mobile'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>do something</p>             </td>             <td class="code">               <div class="highlight"><pre>    }


    <span class="keyword">if</span> ( $(window).width() &lt;= <span class="number">767</span> ) {
      self.initPrimaryNavBtns(<span class="literal">false</span>);
      self.initFooter(<span class="literal">false</span>);
    } <span class="keyword">else</span> {
      self.initPrimaryNavBtns(<span class="literal">true</span>);
      self.initFooter(<span class="literal">true</span>);
    }

    self.isInitialized = <span class="literal">true</span>;
  };

  GlobalNav.prototype = {

    constructor: GlobalNav,

    initPrimaryNavBtns : <span class="keyword">function</span>( isDesktop ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>console.log('## ## initPrimaryNavBtns: ' + isDesktop);</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Set up primary nav buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> (isDesktop){
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Init Desktop Nav</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$activePrimaryNavBtns.each(<span class="keyword">function</span>(){

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>init</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.resetPrimaryNavBtn($(<span class="keyword">this</span>));

          $(<span class="keyword">this</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>console.log('## ## ######CLICK######');</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> $thPrimaryNavBtn = $(<span class="keyword">this</span>);
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>var $thNavTarget = $('.' + $thPrimaryNavBtn.data('target'));</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>console.log('## CLICK $thNavTarget.height: ' + $thNavTarget.outerHeight());</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="keyword">if</span> (!$thPrimaryNavBtn.parent().hasClass(<span class="string">'nav-li-selected'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>if this button isn't already activated, deactivate any others, and activate this one.
console.log('## ## inactive button clicked');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>if there's another button already activated, deactivate it first, and delay opening the new one.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">if</span> (self.$currentOpenNavBtn !== <span class="literal">false</span> ){
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>console.log('## ## old nav was open - close it now.' );</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.resetPrimaryNavBtn(self.$currentOpenNavBtn);

                <span class="keyword">var</span> $oldNavTarget = $(<span class="string">'.'</span> + self.$currentOpenNavBtn.data(<span class="string">'target'</span>));

                <span class="keyword">if</span> ($oldNavTarget.hasClass(<span class="string">'navtray-w'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>if the open target was a navtray, delay opening the new one until the old tray has a chance to close.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>(){
                    self.setActivePrimaryNavBtn($thPrimaryNavBtn);
                  },<span class="number">350</span>);
                } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>update the Nav button &amp; open the new tray after just a short delay for the old menu to fade out.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>(){
                    self.setActivePrimaryNavBtn($thPrimaryNavBtn);
                  },<span class="number">150</span>);
                }

              } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>update the Nav button &amp; open the new tray immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.setActivePrimaryNavBtn($thPrimaryNavBtn);
              }


            } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>if this tray was already visible, hide/reset it.
console.log('## ## this is already open - close it now.' );</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.resetPrimaryNavBtn(self.$currentOpenNavBtn);
              self.$currentOpenNavBtn = <span class="literal">false</span>;
            }
          });
        });
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Init Mobile Nav</p>             </td>             <td class="code">               <div class="highlight"><pre>

        $(<span class="string">'#btn-mobile-nav'</span>).on(self.tapOrClick,<span class="keyword">function</span>(){
          <span class="keyword">if</span> (!self.mobileNavVisible){
            self.showMobileNav();
          } <span class="keyword">else</span> {
            self.hideMobileNav();
          }
        });
      }
    },

    setActivePrimaryNavBtn: <span class="keyword">function</span>( $btn ){
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.activatePrimaryNavBtn($btn);
      self.$currentOpenNavBtn = $btn;
    },

    resetPrimaryNavBtn : <span class="function"><span class="keyword">function</span> <span class="params">( $oldNavBtn )</span> {</span>
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>console.log('## ## resetPrimaryNavBtn: ' + $oldNavBtn.attr('class'));</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>reset this button</p>             </td>             <td class="code">               <div class="highlight"><pre>      $oldNavBtn.removeClass(<span class="string">'active'</span>).parent().removeClass(<span class="string">'nav-li-selected'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>if there's a navTray/navMenu, reset it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ($oldNavBtn.data(<span class="string">'target'</span>).length){
        <span class="keyword">var</span> $thNavTarget = $(<span class="string">'.'</span> + $oldNavBtn.data(<span class="string">'target'</span>));

        <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navtray-w'</span>)){
          self.slideNavTray($thNavTarget,<span class="literal">false</span>);
        } <span class="keyword">else</span> {
          $(<span class="string">'.navmenu-w-visible'</span>).removeClass(<span class="string">'navmenu-w-visible'</span>);
        }
      }
    },

    slideNavTray: <span class="keyword">function</span>( $navTray, opening ){
</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>console.log('## ## slideNavTray $navTray.outerHeight(): ' + $navTray.outerHeight());</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> self = <span class="keyword">this</span>,
        startHeight,
        endHeight,
        expandedHeight = $navTray.outerHeight();

      $navTray.data(<span class="string">'expandedHeight'</span>,expandedHeight);

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>console.log('#### $navTray.data(): ', $navTray.data('expandedHeight'));</p>             </td>             <td class="code">               <div class="highlight"><pre>
      <span class="keyword">if</span> (opening){
        startHeight = <span class="string">'1px'</span>;
        endHeight = expandedHeight;
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>if you're not opening, it's just initializing on page load</p>             </td>             <td class="code">               <div class="highlight"><pre>        startHeight = expandedHeight;
        endHeight = <span class="string">'1px'</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>console.log('## ## $navTray: ' + $navTray.attr('class'))
console.log('## ## opening: ' + opening + ', startHeight: ' + startHeight + ', expandedHeight: ' + expandedHeight);</p>             </td>             <td class="code">               <div class="highlight"><pre>
      $navTray
        .data(<span class="string">'expandedHeight'</span>,startHeight)
        .css(<span class="string">'height'</span>, startHeight)
        .find(<span class="string">'.navtray'</span>)
          .addClass(<span class="string">'navtray-absolute'</span>)
          .css(<span class="string">'height'</span>,expandedHeight);

      setTimeout(<span class="keyword">function</span>(){ <span class="comment">// wait just a moment to make sure the height is applied</span>
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>console.log('## ## setTimeout1 ' + $navTray.attr('class'));</p>             </td>             <td class="code">               <div class="highlight"><pre>        $navTray
          .removeClass(<span class="string">'no-transition'</span>);

        setTimeout(<span class="keyword">function</span>(){ <span class="comment">// wait just a moment to make sure the height is applied</span>
</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>console.log('## ## setTimeout2: opening: ' + opening + ', endHeight: ' + endHeight + ', self.transitionEnd: ' + self.transitionEnd);</p>             </td>             <td class="code">               <div class="highlight"><pre>          $navTray
            .css(<span class="string">'height'</span>,endHeight)
</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>.one(self.transitionEnd, function(){console.log('## ## ## ## WTFFFFFFFFFFFF ## ## ## ');});</p>             </td>             <td class="code">               <div class="highlight"><pre>            .one(self.transitionEnd, onNavTrayComplete);

            <span class="keyword">if</span> (opening){
              $navTray.addClass(<span class="string">'navtray-w-visible'</span>);
            } <span class="keyword">else</span> {
              $navTray.removeClass(<span class="string">'navtray-w-visible'</span>);
            }

        },<span class="number">1</span>);
      },<span class="number">1</span>);

      <span class="function"><span class="keyword">function</span> <span class="title">onNavTrayComplete</span><span class="params">()</span>{</span>
</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>console.log('## ## onNavTrayComplete');
prepare the tray for browser resize - even though it's offscreen, we still need to get its natural height next time we need to expand it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.setNavTrayContentNaturalFlow($navTray);
      }
    },

    setNavTrayContentNaturalFlow: <span class="keyword">function</span>($navTray){
      $navTray
        .css(<span class="string">'height'</span>,<span class="string">''</span>)
        .addClass(<span class="string">'no-transition'</span>)
        .find(<span class="string">'.navtray'</span>)
          .removeClass(<span class="string">'navtray-absolute'</span>)
          .css(<span class="string">'height'</span>,<span class="string">''</span>);
    },

    activatePrimaryNavBtn : <span class="function"><span class="keyword">function</span> <span class="params">($newNavBtn)</span> {</span>
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>console.log('## ## activatePrimaryNavBtn: ' + $newNavBtn.attr('class'));</p>             </td>             <td class="code">               <div class="highlight"><pre>
      $newNavBtn.addClass(<span class="string">'active'</span>).parent().addClass(<span class="string">'nav-li-selected'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>if there's a navTray/navMenu, reset it to get its height</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ($newNavBtn.data(<span class="string">'target'</span>).length){
        <span class="keyword">var</span> $thNavTarget = $(<span class="string">'.'</span> + $newNavBtn.data(<span class="string">'target'</span>));

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>console.log('## ## thNavTarget.outerHeight(): ' + $thNavTarget.outerHeight());</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>figure out if this is a tray or menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navtray-w'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Tray-style
first get the tray's natural height, which it should have offscreen.
expand the tray. When it's done, set it to position:relative and natural heights.</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.slideNavTray($thNavTarget, <span class="literal">true</span>);
        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Menu-style - show the menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>          $thNavTarget.addClass(<span class="string">'navmenu-w-visible'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>just the search menu, needs to be positioned with js. This way it can be in the flow at the top of the page, so it's in place for mobile.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navmenu-w-search'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Line it up with the right edge of the search button.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> btnRightEdge = $newNavBtn.parent().position().left + parseInt( $newNavBtn.css(<span class="string">'marginLeft'</span>),<span class="number">10</span> ) + $newNavBtn.innerWidth();
            <span class="keyword">var</span> leftPos = btnRightEdge - $thNavTarget.innerWidth();
            $thNavTarget.css({<span class="string">'right'</span>:<span class="string">'auto'</span>,<span class="string">'left'</span>:leftPos+<span class="string">'px'</span>});
          }
        }
      }
    },

    showMobileNav: <span class="keyword">function</span>(){
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.showMobileBackdrop();

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Since the page-wrap-inner is going to be fixed, the browser will see the page as having no height.
on iOS, this means the Safari nav will always be visible. And that's not cool. So, to give the
page some height, so the Safari nav will hide.
need tp compensate for Safari nav bar on iOS - MAY BE DIFFERENT ON ANDROID/OTHER.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> pageHeight = parseInt( $(window).height(),<span class="number">10</span> ) + <span class="number">60</span> + <span class="string">'px'</span>;
      self.$pageWrapOuter.height(pageHeight);

      <span class="keyword">if</span> (!self.mobileNavIScroll){
        <span class="keyword">var</span> $outer = $(<span class="string">'#nav-outer-container'</span>),
          $inner = $outer.find(<span class="string">'.nav-mobile-scroller'</span>);

        $outer.height(pageHeight);
        $inner.height($inner.height());

        setTimeout(<span class="keyword">function</span>(){ <span class="comment">// make sure heights are already set before initializing iScroll.</span>
          self.mobileNavIScroll = <span class="keyword">new</span> window.IScroll(<span class="string">'nav-outer-container'</span>,{ vScroll: <span class="literal">true</span>, hScroll: <span class="literal">false</span>, hScrollbar: <span class="literal">false</span>, snap: <span class="literal">false</span>, momentum: <span class="literal">true</span>, bounce: <span class="literal">false</span> });
        },<span class="number">1</span>);
      }

      $(<span class="string">'#page-wrap-inner'</span>).addClass(<span class="string">'show-mobile-menu'</span>);
      self.mobileNavVisible = <span class="literal">true</span>;
    },

    hideMobileNav: <span class="keyword">function</span>(){
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.hideMobileBackdrop();

      $(<span class="string">'#page-wrap-inner'</span>).one(self.transitionEnd, <span class="keyword">function</span>(){
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>wait until the $('#page-wrap-inner') is done animating closed before destroying the iScroll.</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.mobileNavIScroll.destroy();
        self.mobileNavIScroll = <span class="literal">false</span>;
        self.$pageWrapOuter.css(<span class="string">'height'</span>,<span class="string">''</span>);
      });
      $(<span class="string">'#page-wrap-inner'</span>).removeClass(<span class="string">'show-mobile-menu'</span>);
      self.mobileNavVisible = <span class="literal">false</span>;
    },

    showMobileBackdrop: <span class="keyword">function</span>(){
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$mobileScreenOverlay = $(<span class="string">'&lt;div class="modal-backdrop mobile-screen-overlay opacity0" /&gt;'</span>)
        .appendTo($(<span class="string">'#page-wrap-inner'</span>));

      setTimeout(<span class="keyword">function</span>(){
        self.$mobileScreenOverlay.removeClass(<span class="string">'opacity0'</span>).addClass(<span class="string">'opacity1'</span>);
      },<span class="number">1</span>);
    },

    hideMobileBackdrop: <span class="keyword">function</span>(){
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$mobileScreenOverlay.one(self.transitionEnd, <span class="keyword">function</span>(){
        self.$mobileScreenOverlay.remove();
      });

      self.$mobileScreenOverlay.removeClass(<span class="string">'opacity1'</span>).addClass(<span class="string">'opacity0'</span>);
    },

    initFooter : <span class="keyword">function</span>( isDesktop ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> (isDesktop){
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>just making lint happy, cuz maybe I'll use isDesktop eventually.</p>             </td>             <td class="code">               <div class="highlight"><pre>      }

      $(<span class="string">'#country-selector'</span>).on(<span class="string">'mouseenter mouseleave'</span>,<span class="keyword">function</span>(){
        <span class="keyword">var</span> pageContainerWidth = $(<span class="keyword">this</span>).closest(<span class="string">'.grid-footer'</span>).width();
        $(<span class="keyword">this</span>).find(<span class="string">'.dropdown-hover-menu-lists-w'</span>).width(pageContainerWidth);
      });

      <span class="keyword">var</span> footerNavCollapseHeight = <span class="number">49</span>; <span class="comment">// plus 1 for the border</span>
      $(<span class="string">'#footer-wrapper .footer-mobile-section h5'</span>).on(self.tapOrClick,<span class="keyword">function</span>(){
        <span class="keyword">if</span> ($(window).width() &lt;= <span class="number">767</span> ){

          <span class="keyword">var</span> $thFootSection = $(<span class="keyword">this</span>).parent();


          <span class="keyword">if</span> ($thFootSection.hasClass(<span class="string">'collapsed'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>collapsed height - expand it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            $thFootSection
              .height($thFootSection.data(<span class="string">'expHeight'</span>))
              .removeClass(<span class="string">'collapsed'</span>);

          } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>natural height - collapse it.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> expHeight = $thFootSection.height();

            $thFootSection
              .data(<span class="string">'expHeight'</span>,expHeight)
              .height(expHeight);

            setTimeout(<span class="keyword">function</span>(){
              $thFootSection.addClass(<span class="string">'transition-height'</span>);
              setTimeout(<span class="keyword">function</span>(){
                $thFootSection
                  .height(footerNavCollapseHeight)
                  .addClass(<span class="string">'collapsed'</span>);
              },<span class="number">1</span>);
            },<span class="number">1</span>);
          }
        }
      });
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav = <span class="keyword">function</span>( opts ) {
    <span class="keyword">var</span> args = Array.prototype.slice.apply( arguments );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
        globalNav = self.data(<span class="string">'globalNav'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If we don't have a stored globalNav, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !globalNav ) {
        globalNav = <span class="keyword">new</span> GlobalNav( self );
        self.data( <span class="string">'globalNav'</span>, globalNav );
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> opts === <span class="string">'string'</span> ) {
        globalNav[ opts ].apply( globalNav, args.slice(<span class="number">1</span>) );
      }
    });
  };


</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Overrideable options</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav.options = {
    sampleOption: <span class="number">0</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Not overrideable</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav.settings = {
    isTouch: !!( <span class="string">'ontouchstart'</span> <span class="keyword">in</span> window ),
    isInitialized: <span class="literal">false</span>
  };

})(jQuery, Modernizr, window);


$(<span class="keyword">function</span>() {
  $(<span class="string">'.nav-wrapper'</span>).globalNav();
});



</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 