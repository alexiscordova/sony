<!DOCTYPE html>  <html> <head>   <title>related-products.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brightcove-builder.html">                 brightcove-builder.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="global-nav.html">                 global-nav.js               </a>                                           <a class="source" href="hotspot_explorer.html">                 hotspot_explorer.js               </a>                                           <a class="source" href="jquery.viewport.html">                 jquery.viewport.js               </a>                                           <a class="source" href="one-sony-carousel-s2.html">                 one-sony-carousel-s2.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="related-products.html">                 related-products.js               </a>                                           <a class="source" href="sony-gallery.html">                 sony-gallery.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="exports.html">                 exports.js               </a>                                           <a class="source" href="iq.html">                 iq.js               </a>                                           <a class="source" href="sony-global-analytics.html">                 sony-global-analytics.js               </a>                                           <a class="source" href="sony-global-settings.html">                 sony-global-settings.js               </a>                                           <a class="source" href="sony-global-utilities.html">                 sony-global-utilities.js               </a>                                           <a class="source" href="sony-global.html">                 sony-global.js               </a>                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               related-products.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Related Products (RelatedProducts) Module</h2>

<ul>
<li><strong>Class:</strong> RelatedProducts</li>
<li><strong>Version:</strong> 1.0</li>
<li><strong>Modified:</strong> 02/22/2013</li>
<li><strong>Author:</strong> Tyler Madison, Glen Cheney, George Pantazis</li>
<li><strong>Dependencies:</strong> jQuery 1.7+ , Modernizr</li>
</ul>

<p><em>Notes:</em></p>

<p><em>Example Usage:</em></p>

<pre><code> $('.related-products').relatedProducts();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>;(<span class="keyword">function</span>(SONY , $, Modernizr, window, <span class="literal">undefined</span> , console) {

    <span class="string">'use strict'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Related Products Definition</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">var</span> RelatedProducts = <span class="keyword">function</span>(element, options){
      <span class="keyword">var</span> self           = <span class="keyword">this</span>,
      transEndEventNames = {
        <span class="string">'WebkitTransition'</span> : <span class="string">'webkitTransitionEnd'</span>,
        <span class="string">'MozTransition'</span>    : <span class="string">'transitionend'</span>,
        <span class="string">'OTransition'</span>      : <span class="string">'oTransitionEnd'</span>,
        <span class="string">'msTransition'</span>     : <span class="string">'MSTransitionEnd'</span>,
        <span class="string">'transition'</span>       : <span class="string">'transitionend'</span>};
      
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Extend Related Products instance with defaults and options</p>             </td>             <td class="code">               <div class="highlight"><pre>      $.extend(self , $.fn.relatedProducts.defaults , options);

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Debug mode for logging</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.DEBUG                  = <span class="literal">false</span>;
      
      self.LANDSCAPE_BREAKPOINT   = <span class="number">980</span>;
      self.MOBILE_BREAKPOINT      = <span class="number">568</span>;
      
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Cache common jQuery objects</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$paddles               = $({});

      self.$el                    = $(element);
      self.$slides                = self.$el.find(<span class="string">'.rp-slide'</span>);
      self.$currentSlide          = <span class="literal">null</span>;
      self.$shuffleContainers     = self.$slides.find(<span class="string">'.shuffle-container'</span>);
      self.$galleryItems          = self.$el.find(<span class="string">'.gallery-item'</span>);
      self.$plate                 = self.$slides.eq(<span class="number">0</span>).find(<span class="string">'.gallery-item.plate'</span>).first();
      self.$container             = self.$el.find(<span class="string">'.rp-container'</span>).eq(<span class="number">0</span>);
      self.$favorites             = self.$el.find(<span class="string">'.js-favorite'</span>);
      self.$tabbedContainer       = self.$el.parent();
      self.$bulletNav             = $();
      self.$doc                   = SONY.$document;
      self.$win                   = SONY.$window;
      self.$html                  = SONY.$html;
      
      self.ev                     = $({}); <span class="comment">//event object</span>
      self.prefixed               = Modernizr.prefixed;
      self.transitionName         = self.prefixed(<span class="string">'transition'</span>);
      self.isTabbedContainer      = self.$tabbedContainer.length &gt; <span class="number">0</span> &amp;&amp; self.$tabbedContainer.hasClass(<span class="string">'rp-container-tabbed'</span>);
      self.transitionEndName      = transEndEventNames[ self.transitionName ];
      self.mode                   = self.$el.data(<span class="string">'mode'</span>).toLowerCase(); <span class="comment">//Determine the mode of the module</span>
      self.variation              = self.$el.data(<span class="string">'variation'</span>).split(<span class="string">'-'</span>)[<span class="number">2</span>]; <span class="comment">//Determine the variaion of the module</span>
      self.numSlides              = self.$slides.length;
      self.sliderOverflow         = self.$el.find(<span class="string">'.rp-overflow'</span>).eq(<span class="number">0</span>);
      self.previousId             = -<span class="number">1</span>;
      self.currentId              = <span class="number">0</span>;
      self.slidePosition          = <span class="number">0</span>;
      self.animationSpeed         = <span class="number">700</span>;
      self.slides                 = [];
      self.slideCount             = self.$slides.length;
      self.currentContainerWidth  = <span class="number">0</span>;
      self.sPosition              = <span class="number">0</span>;
      self.scrollerModule         = <span class="literal">null</span>;
      self.shuffle                = <span class="literal">null</span>;
      self.shuffleSpeed           = <span class="number">250</span>;
      self.shuffleEasing          = <span class="string">'ease-out'</span>;
      self.paddlesEnabled         = <span class="literal">false</span>;
      self.resizeTimeout          = <span class="literal">null</span>;
      self.startInteractionPointX = <span class="literal">null</span>;
      self.isTransitioning        = <span class="literal">true</span>;
      self.lastTouch              = <span class="literal">null</span>;
      self.handleStartPosition    = <span class="literal">null</span>;
      self.dragThreshold          = <span class="number">50</span>;
      self.useCSS3Transitions     = Modernizr.csstransitions; <span class="comment">//Detect if we can use CSS3 transitions</span>
      self.hasMediaQueries        = Modernizr.mediaqueries;
      self.mq                     = Modernizr.mq;
      self.oldIE                  = self.$html.hasClass(<span class="string">'lt-ie10'</span>);
      self.isIE7orIE8             = self.$html.hasClass(<span class="string">'lt-ie10'</span>);
      self.inited                 = <span class="literal">false</span>;
      self.isResponsive           = !self.isIE7orIE8 &amp;&amp; !self.$html.hasClass(<span class="string">'lt-ie10'</span>) &amp;&amp; self.hasMediaQueries;
      
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Modes</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.isMobileMode    = <span class="literal">false</span>;
      self.isDesktopMode   = <span class="literal">false</span>;
      self.isTabletMode    = <span class="literal">false</span>;
      self.accelerationPos = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Startup</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.init();

    };

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Related Products protoype object definition</p>             </td>             <td class="code">               <div class="highlight"><pre>    RelatedProducts.prototype = {

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Inital setup of module</p>             </td>             <td class="code">               <div class="highlight"><pre>      init: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.mqFix();

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Initialize animation properties</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.initAnimationProps();

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Define easing equations</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.setupEasing();

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Inialize events</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.initEvents();

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Setup shuffle functions</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.initShuffleFns();

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Store gallery items parent slide</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.storeGalleryItemParentSlides();

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Setup link clicks</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.setupLinkClicks();

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Initialize tooltips</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.initTooltips();

        self.log(<span class="string">'Related Poducts init...'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Don't do this for modes other than 3,4 and 5up</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.variation === <span class="string">'3up'</span> ||
           self.variation === <span class="string">'4up'</span> ||
           self.variation === <span class="string">'5up'</span>){
            self.setSortPriorities();
            self.log(self.variation , <span class="literal">true</span>);
        }

        <span class="keyword">if</span>(self.$slides.length &gt; <span class="number">1</span>){
          self.createNavigation();
          <span class="keyword">if</span>(!self.hasTouch){
            self.createPaddles();
          }
          <span class="keyword">if</span>(self.mode != <span class="string">'strip'</span>){
            self.$container.on(self.downEvent, <span class="keyword">function</span>(e) { self.onDragStart(e); });
          }
        }<span class="keyword">else</span>{
          self.$pagination = $({});
        }

        <span class="keyword">if</span>(self.mode != <span class="string">'strip'</span>){
          self.setSortPriorities();
          self.setupResizeListener();
          self.$win.trigger(<span class="string">'resize'</span>);
        }<span class="keyword">else</span> {
          self.setupStripMode();
          self.log(<span class="string">'setting up strip mode...'</span>);
        }
      },

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Fixes a bug in IE when media queries aren't available</p>             </td>             <td class="code">               <div class="highlight"><pre>      mqFix: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        
        <span class="keyword">if</span>( !self.hasMediaQueries &amp;&amp; self.isIE7orIE8 || self.oldIE){
          self.mq = <span class="keyword">function</span>(){
            <span class="keyword">return</span> <span class="literal">false</span>;
          };
        }

      },

      initAnimationProps: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span>(self.useCSS3Transitions) {
            self.use3dTransform = Modernizr.csstransforms3d;
        }

        <span class="keyword">if</span>(self.useCSS3Transitions) {
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>some constants for CSS3</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.TP     = <span class="string">'transitionProperty'</span>;
          self.TD     = <span class="string">'transitionDuration'</span>;
          self.TTF    = <span class="string">'transitionTimingFunction'</span>;
          self.yProp  = self.xProp = self.prefixed ( <span class="string">'transform'</span> );

          <span class="keyword">if</span>(self.use3dTransform) {
            self.tPref1 = <span class="string">'translate3d('</span>;
            self.tPref2 = <span class="string">'px, '</span>;
            self.tPref3 = <span class="string">'px, 0px)'</span>;
          } <span class="keyword">else</span> {
            self.tPref1 = <span class="string">'translate('</span>;
            self.tPref2 = <span class="string">'px, '</span>;
            self.tPref3 = <span class="string">'px)'</span>;
          }

          self.$container[ self.prefixed( self.TP ) ] = self.prefixed ( <span class="string">'transform'</span> );

        } <span class="keyword">else</span> {
          self.xProp = <span class="string">'left'</span>;
          self.yProp = <span class="string">'top'</span>;
        }

      },

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Setup events</p>             </td>             <td class="code">               <div class="highlight"><pre>      initEvents: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        
        <span class="keyword">if</span>(Modernizr.touch) {
            self.hasTouch         = <span class="literal">true</span>;
            self.downEvent        = <span class="string">'touchstart.rp'</span>;
            self.moveEvent        = <span class="string">'touchmove.rp'</span>;
            self.upEvent          = <span class="string">'touchend.rp'</span>;
            self.cancelEvent      = <span class="string">'touchcancel.rp'</span>;
            self.lastItemFriction = <span class="number">0.5</span>;
        } <span class="keyword">else</span> {
            self.hasTouch = <span class="literal">false</span>;
            self.lastItemFriction = <span class="number">0.2</span>;
            self.downEvent   = <span class="string">'mousedown.rp'</span>;
            self.moveEvent   = <span class="string">'mousemove.rp'</span>;
            self.upEvent     = <span class="string">'mouseup.rp'</span>;
            self.cancelEvent = <span class="string">'mouseup.rp'</span>;
            self.clickEvent  = <span class="string">'click.rp'</span>;
        }
      },

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Store gallery items orginal parent slide for teardown and rebuild</p>             </td>             <td class="code">               <div class="highlight"><pre>      storeGalleryItemParentSlides: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.$galleryItems.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> $item = $(<span class="keyword">this</span>);
          $item.data(<span class="string">'slide'</span> , $item.parent());
        });
      },

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Set up outbound links to not interfere with dragging between slides</p>             </td>             <td class="code">               <div class="highlight"><pre>      setupLinkClicks: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        self.$galleryItems.on( self.tapOrClick() , <span class="keyword">function</span>(e){
          <span class="keyword">var</span> $item   = $(<span class="keyword">this</span>),
          destination = $item.attr(<span class="string">'href'</span>),
          point, distanceMoved;

          <span class="keyword">if</span> ( self.hasTouch ) {
            point = e.originalEvent.touches[<span class="number">0</span>] || { pageX: <span class="number">0</span> } ;
          } <span class="keyword">else</span> {
            point = e;
          }

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>To prevent drags from being misinterpreted as clicks, we only redirect the user
if their interaction time and movements are below certain thresholds.</p>             </td>             <td class="code">               <div class="highlight"><pre>
          <span class="keyword">if</span> ( self.startInteractionTime &amp;&amp; self.startInteractionPointX ) {

            distanceMoved = Math.abs(point.pageX - self.startInteractionPointX);

            <span class="keyword">if</span> ((<span class="keyword">new</span> Date().getTime()) - self.startInteractionTime &lt; <span class="number">250</span> &amp;&amp; distanceMoved &lt; <span class="number">25</span> ) {
              window.location = destination;
            }
          }
        });

        self.$galleryItems.on( self.tapOrClick() , <span class="keyword">function</span>(e){
          e.preventDefault();
        });
      },

      toString: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="string">'[ object RelatedProducts ]'</span>;
      },

      onFavorite : <span class="keyword">function</span>( evt ) {
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
            $jsFavorite = $(evt.delegateTarget),
            isAdding = !$jsFavorite.hasClass(<span class="string">'active'</span>),
            content = self.getFavoriteContent( $jsFavorite, isAdding );
        $jsFavorite.toggleClass(<span class="string">'active'</span>);

        $(<span class="string">'.gallery-tooltip .tooltip-inner'</span>)
          .html( content )
          .tooltip(<span class="string">'show'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Stop event from bubbling to <a> tag</p>             </td>             <td class="code">               <div class="highlight"><pre>        evt.preventDefault();
        evt.stopPropagation();
      },

      getFavoriteContent : <span class="keyword">function</span>( $jsFavorite, isActive ) {
        <span class="keyword">return</span> isActive ?
              $jsFavorite.data(<span class="string">'activeTitle'</span>) + <span class="string">'&lt;i class="fonticon-10-sm-bold-check"&gt;&lt;/i&gt;'</span> :
              $jsFavorite.data(<span class="string">'defaultTitle'</span>);
      },

      initTooltips : <span class="keyword">function</span>() {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Favorite Heart</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$favorites.on(<span class="string">'click'</span>, $.proxy( self.onFavorite, self ));

        self.$container.find(<span class="string">'.js-favorite'</span>).tooltip({
          placement: <span class="string">'offsettop'</span>,
          title: <span class="keyword">function</span>() {
            <span class="keyword">var</span> $jsFavorite = $(<span class="keyword">this</span>);
            <span class="keyword">return</span> self.getFavoriteContent( $jsFavorite, $jsFavorite.hasClass(<span class="string">'active'</span>) );
          },
          template: <span class="string">'&lt;div class="tooltip gallery-tooltip"&gt;&lt;div class="tooltip-arrow"&gt;&lt;/div&gt;&lt;div class="tooltip-inner"&gt;&lt;/div&gt;&lt;/div&gt;'</span>
        });
      },

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>These functions are used by the jquery.shuffle plugin</p>             </td>             <td class="code">               <div class="highlight"><pre>      initShuffleFns: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.shuffleGutters = <span class="function"><span class="keyword">function</span> <span class="params">(containerWidth)</span>{</span>
          <span class="keyword">var</span> gutter = <span class="number">0</span>,
              numColumns = <span class="number">0</span>;

          <span class="keyword">if</span> ( !Modernizr.mediaqueries || self.mq(<span class="string">'(min-width: 981px)'</span>) || self.$html.hasClass(<span class="string">'lt-ie10'</span>) ) {
            gutter = SONY.Settings.GUTTER_WIDTH_SLIM_5 * containerWidth;
            numColumns = <span class="number">5</span>;

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>// Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( self.mq(<span class="string">'(min-width: 569px)'</span>) ) {
            numColumns = <span class="number">4</span>;
            gutter = SONY.Settings.GUTTER_WIDTH_SLIM * containerWidth;
          }

          self.setColumns(numColumns);

          <span class="keyword">if</span>(gutter &lt; <span class="number">0</span>){
            gutter = <span class="number">0</span>;
          }

          <span class="keyword">return</span> gutter;
        };

        self.shuffleColumns = <span class="keyword">function</span>(containerWidth){
            <span class="keyword">var</span> column = <span class="number">0</span>;

            <span class="keyword">if</span> ( !Modernizr.mediaqueries || self.mq(<span class="string">'(min-width: 981px)'</span>) || self.$html.hasClass(<span class="string">'lt-ie10'</span>) ) {
              column = SONY.Settings.COLUMN_WIDTH_SLIM_5 * containerWidth; <span class="comment">// ~18% of container width</span>
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>            } <span class="keyword">else</span> <span class="keyword">if</span> ( self.mq(<span class="string">'(min-width: 569px)'</span>) ) {
              column = SONY.Settings.COLUMN_WIDTH_SLIM * containerWidth;
</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Default</p>             </td>             <td class="code">               <div class="highlight"><pre>            }<span class="keyword">else</span>{
              column = containerWidth;
            }

            <span class="keyword">if</span>(column === <span class="number">0</span>){
              column = <span class="number">0.001</span>; <span class="comment">// fixes a bug with shuffle that crashes when column width is returned as 0</span>
            }

            <span class="keyword">return</span> column;
        };

      },

      setupResizeListener: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self      = <span class="keyword">this</span>,
        resizeTimeout = <span class="literal">null</span>,

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Some value constants</p>             </td>             <td class="code">               <div class="highlight"><pre>        VISIBLE       = <span class="string">'visible'</span>,
        HIDDEN        = <span class="string">'hidden'</span>,
        BLANK         = <span class="string">'.blank'</span>,
        REDRAWING     = <span class="string">'redrawing'</span>;

        <span class="keyword">if</span>(self.mode !== <span class="string">'suggested'</span> &amp;&amp; !self.oldIE){
         self.$win.on(<span class="string">'resize'</span>, <span class="keyword">function</span>(){
          <span class="keyword">if</span>(!self.isMobileMode &amp;&amp; self.$win.width() &gt; self.MOBILE_BREAKPOINT) {

            self.$galleryItems.css({
              visibility : HIDDEN,
              opacity    : <span class="number">0</span>
            });
            self.$pagination.hide();
            self.$el.addClass( REDRAWING );

           }<span class="keyword">else</span>{

            self.$el.css({
              opacity : <span class="number">1</span>,
              visibility : VISIBLE
            });

            self.$galleryItems.not(BLANK).css({
              visibility : VISIBLE,
              opacity : <span class="number">1</span>
            });

            <span class="keyword">if</span>(!self.isMobileMode){
              self.$pagination.show();
            }

            self.$el.removeClass( REDRAWING );
           }
          });

        } <span class="keyword">else</span> {
          self.$el.css({
            opacity : <span class="number">1</span>,
            visibility : VISIBLE
          });
           self.$galleryItems.not(BLANK).css({
           visibility : VISIBLE,
            opacity : <span class="number">1</span>
          });
          self.$el.removeClass( REDRAWING );

          <span class="keyword">if</span>(!self.isMobileMode){
            self.$pagination.show();
          }
          
        }

        self.$pagination.hide();

        self.log(<span class="string">'setting up resize listener...'</span>);

        self.$win.on( <span class="string">'resize'</span>, $.debounce( <span class="number">500</span> , $.proxy(self.handleResize , self)) );

      },

      handleResize:<span class="keyword">function</span>() {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span>( self.oldIE &amp;&amp; self.inited ){
          self.updateSlides();
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span>( !self.inited ){
          self.inited = <span class="literal">true</span>;
        }

        self.checkForBreakpoints();
        self.updateSliderSize();
        self.updateSlides();
        self.updatePaddles();

        <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
          <span class="keyword">return</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Needed a way to kill this timer if multiple resizes happen</p>             </td>             <td class="code">               <div class="highlight"><pre>        clearTimeout( self.resizeTimeout );
        self.resizeTimeout = setTimeout(<span class="keyword">function</span>(){

          self.$shuffleContainers.each(<span class="keyword">function</span>(){
            <span class="keyword">var</span> shfflInst = $(<span class="keyword">this</span>).data(<span class="string">'shuffle'</span>);

            <span class="keyword">if</span>(shfflInst === <span class="literal">undefined</span>){
              <span class="keyword">return</span>;
            }

            setTimeout(<span class="keyword">function</span>(){
              self.updateSliderSize();
              
              <span class="keyword">if</span>(self.oldIE){
                self.$galleryItems.each(<span class="keyword">function</span>(){

                  <span class="keyword">var</span> $item        = $(<span class="keyword">this</span>),
                  $itemImg         = $item.find(<span class="string">'.product-img'</span>),
                  tileHeight       = <span class="number">285</span>,
                  galItemWidth     = <span class="number">219</span>,
                  galImageHeight   = <span class="number">190</span>,
                  medGalImgWidth   = <span class="number">462</span>,
                  medGalImgHeight  = <span class="number">495</span>,
                  medGalItemHeight = <span class="number">600</span>;
                  
                  $item.css({
                    height : tileHeight
                  });

                  <span class="keyword">if</span>($item.hasClass(<span class="string">'plate'</span>)){
                    $item.css({

                    });
                    $itemImg.css({
                      height : tileHeight
                    });
                  }<span class="keyword">else</span> <span class="keyword">if</span>( $item.hasClass(<span class="string">'medium'</span>) ){
                    $item.css({

                      height : medGalItemHeight
                    });
                    $itemImg.css({
                      height : medGalImgHeight
                    });

                  }<span class="keyword">else</span> <span class="keyword">if</span>( $item.hasClass(<span class="string">'normal'</span>) ){

                    $itemImg.css({
                      height : galImageHeight
                    });
                  }

                });

                shfflInst.update();
                self.updateSlides();
              }

              <span class="keyword">if</span>(!self.oldIE){
                self.updateTiles();
                shfflInst.update();
                self.animateTiles();

              }

            } , <span class="number">50</span>);

          });
        } , <span class="number">10</span>);
      },

      log : <span class="function"><span class="keyword">function</span> <span class="params">()</span>{</span>

        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        strOut   = <span class="string">''</span>;

        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; arguments.length ; i ++){
          strOut += arguments[i];
          strOut += i &gt; <span class="number">0</span> ? <span class="string">' , '</span> : <span class="string">' '</span>;
        }

        <span class="keyword">if</span>(self.oldIE &amp;&amp; self.DEBUG){
          <span class="keyword">if</span>(window.alert){
</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>window.alert(strOut);</p>             </td>             <td class="code">               <div class="highlight"><pre>          }
        }<span class="keyword">else</span> <span class="keyword">if</span>(self.DEBUG) {
          <span class="keyword">if</span>(window.console){
           window.console.log(strOut);
          }
        }
      },

      setupStripMode: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self       = <span class="keyword">this</span>,
        containerWidth = self.$el.width(),
        gutterWidth    = SONY.Settings.GUTTER_WIDTH_SLIM_5 * containerWidth,
        colWidth       = ( SONY.Settings.COLUMN_WIDTH_SLIM_5 * ( containerWidth ) );

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>clear out the position style on the gallery items</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$galleryItems.removeAttr(<span class="string">'style'</span>);

        self.$galleryItems.not(self.$galleryItems.first()).css({
          <span class="string">'width'</span>       : colWidth,
          <span class="string">'margin'</span>      : <span class="number">0</span>,
          <span class="string">'margin-left'</span> : <span class="number">0</span>,
          <span class="string">'margin-top'</span>  : <span class="number">0</span>
        });

        self.$galleryItems.first().css({
          <span class="string">'width'</span>  : colWidth,
          <span class="string">'margin'</span> : <span class="number">0</span>
        });

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Create the sony-scroller instance</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>(){

          <span class="keyword">if</span>(self.scrollerModule !== <span class="literal">null</span>){
            self.scrollerModule.destroy();
            self.scrollerModule = <span class="literal">null</span>;
          }

          self.scrollerModule = self.$el.find(<span class="string">'.rp-overflow'</span>).scrollerModule({
            contentSelector     : <span class="string">'.rp-container'</span>,
            itemElementSelector : <span class="string">'.gallery-item'</span>,
            mode                : <span class="string">'paginate'</span>,
            generatePagination  : <span class="literal">true</span>,
            generateNav         : <span class="literal">true</span>,
            centerItems         : <span class="literal">false</span>,
            autoGutters         : <span class="literal">false</span>,
            gutterWidth         : gutterWidth,
            iscrollProps: {
              snap       : <span class="literal">true</span>,
              momentum   : <span class="literal">false</span>,
              hScrollbar : <span class="literal">false</span>,
              vScrollbar : <span class="literal">false</span>
            }

          }).data(<span class="string">'scrollerModule'</span>);

          self.$galleryItems.find(<span class="string">'.product-name'</span>).evenHeights();

          window.iQ.update();

        }, <span class="number">50</span>);

        self.$win.on(<span class="string">'resize.rp'</span>, $.debounce(<span class="number">50</span> , <span class="keyword">function</span>() {

          <span class="keyword">if</span>(self.$win.width() &lt; <span class="number">479</span>){
            self.scrollerModule.centerItems = <span class="literal">true</span>;
          }<span class="keyword">else</span>{
            self.scrollerModule.centerItems = <span class="literal">false</span>;
          }
          
          <span class="keyword">var</span> containerWidth = self.$el.width(),
          gutterWidth        = <span class="number">0</span>,
          colWidth           = <span class="number">0</span>;

          <span class="keyword">if</span>(self.$win.width() &gt; <span class="number">767</span>){
            gutterWidth = SONY.Settings.GUTTER_WIDTH_SLIM_5 * containerWidth,
            colWidth    = ( SONY.Settings.COLUMN_WIDTH_SLIM_5 * (containerWidth ) );
          }<span class="keyword">else</span>{
            gutterWidth = <span class="number">12.745098039215685</span>;
            colWidth    = <span class="number">119.80392156862746</span>;
          }

          self.scrollerModule.setGutterWidth(gutterWidth);

          self.$galleryItems.not(self.$galleryItems.first()).css({
            <span class="string">'width'</span>       : colWidth,
            <span class="string">'margin'</span>      : <span class="number">0</span>,
            <span class="string">'margin-left'</span> : <span class="number">0</span>,
            <span class="string">'margin-top'</span>  : <span class="string">'20px'</span>
          });

          self.$galleryItems.first().css({
            <span class="string">'width'</span>   : colWidth,
            <span class="string">'margin'</span>  : <span class="number">0</span>,
            <span class="string">'margin-top'</span> : <span class="string">'20px'</span>
          });


          <span class="keyword">var</span> $oneProduct = self.$el.find(<span class="string">'.gallery-item.normal'</span>).first(),
          newContainerHeight = $oneProduct.find(<span class="string">'.product-content'</span>).outerHeight(<span class="literal">true</span>) + $oneProduct.find(<span class="string">'.product-img'</span>).height();
          newContainerHeight += <span class="number">50</span>; <span class="comment">//spacing for navigation dots</span>

      
          self.$el.css({
            <span class="string">'height'</span>     : newContainerHeight,
            <span class="string">'max-height'</span> : newContainerHeight,
            <span class="string">'min-height'</span> : newContainerHeight
          });

        }));

        self.$win.trigger(<span class="string">'resize.rp'</span>);

      },

      tapOrClick: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        <span class="keyword">return</span> self.hasTouch ? self.upEvent : self.clickEvent ;
      },

      createNavigation: <span class="keyword">function</span>(){

        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span> ( !$.fn.sonyNavDots ) {
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span> ( self.$pagination ) {
          self.$pagination.sonyNavDots(<span class="string">'reset'</span>, {
            <span class="string">'buttonCount'</span> : self.numSlides
          });
          <span class="keyword">return</span>;
        }

        self.$pagination = $(<span class="string">'&lt;div/&gt;'</span>, { <span class="string">'class'</span> : <span class="string">'navigation-container'</span> });

        self.$el.append( self.$pagination );

        self.$pagination.sonyNavDots({
          <span class="string">'buttonCount'</span>: self.numSlides
        });

        self.$pagination.on(<span class="string">'SonyNavDots:clicked'</span>, <span class="keyword">function</span>(e, a){
          self.currentId = a;
          self.moveTo();
        });

        self.ev.on( <span class="string">'rpOnUpdateNav'</span>, $.debounce(<span class="number">500</span>, <span class="keyword">function</span>() {
          self.$pagination.sonyNavDots(<span class="string">'reset'</span>, {
            <span class="string">'activeButton'</span>: self.currentId
          });
        }));
      },


      createPaddles: <span class="keyword">function</span>(){

        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.log(<span class="string">'creating paddles...'</span>);

        self.$el.sonyPaddles();

        self.$el.on(<span class="string">'sonyPaddles:clickLeft'</span>, <span class="keyword">function</span>(){
          self.currentId --;
          <span class="keyword">if</span>(self.currentId &lt; <span class="number">0</span>){
            self.currentId = <span class="number">0</span>;
          }

          self.moveTo();
        });

        self.$el.on(<span class="string">'sonyPaddles:clickRight'</span>, <span class="keyword">function</span>(){
          self.currentId ++;

          <span class="keyword">if</span>(self.currentId &gt;= self.$slides.length){
            self.currentId = self.$slides.length - <span class="number">1</span>;
          }

          self.moveTo();
        });
  
        self.onPaddleNavUpdate();
        self.ev.on(<span class="string">'rpOnUpdateNav'</span> , $.proxy(self.onPaddleNavUpdate , self));

      },



      onPaddleNavUpdate: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.$el.sonyPaddles(<span class="string">'showPaddle'</span>, <span class="string">'right'</span>);
        self.$el.sonyPaddles(<span class="string">'showPaddle'</span>, <span class="string">'left'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>check for the left paddle compatibility</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.currentId === <span class="number">0</span>){
          self.$el.sonyPaddles(<span class="string">'hidePaddle'</span>, <span class="string">'left'</span>);
        }

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>check for right paddle compatiblity</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.currentId === self.numSlides - <span class="number">1</span>){
          self.$el.sonyPaddles(<span class="string">'hidePaddle'</span>, <span class="string">'right'</span>);
        }

      },

      togglePaddles: <span class="function"><span class="keyword">function</span> <span class="params">(turnOn)</span>{</span>
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span>(turnOn){
          self.$el.find(<span class="string">'.pagination-paddles'</span>).show();
        }<span class="keyword">else</span>{
          self.$el.find(<span class="string">'.pagination-paddles'</span>).hide();
        }

        
      },

      createShuffle: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.shuffle = self.$shuffleContainers.shuffle({
          itemSelector: <span class="string">'.gallery-item'</span>,
          speed: self.shuffleSpeed,
          easing: self.shuffleEasing,
          columnWidth: self.shuffleColumns,
          gutterWidth: self.shuffleGutters,
          showInitialTransition: <span class="literal">false</span>,
          useTransition: <span class="literal">false</span>,
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>buffer: 100</p>             </td>             <td class="code">               <div class="highlight"><pre>          buffer: <span class="number">25</span>
        }).first().data(<span class="string">'shuffle'</span>);

        self.toggleShuffles();

      },

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Stops processing of jQuery.shuffle instances that are not currently active</p>             </td>             <td class="code">               <div class="highlight"><pre>      toggleShuffles: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.$shuffleContainers.each(<span class="keyword">function</span>(i){
          <span class="keyword">var</span> $shfflContainer = $(<span class="keyword">this</span>),
            sfflInst = $shfflContainer.data(<span class="string">'shuffle'</span>);
            <span class="keyword">if</span>(i === self.currentId ){
              sfflInst.enable();
            }<span class="keyword">else</span>{
              sfflInst.enable();
            }
        });
      },

      setColumns : <span class="keyword">function</span>( numColumns ) {
        <span class="keyword">var</span> self               = <span class="keyword">this</span>,
        allSpans               = <span class="string">'span1 span2 span3 span4 span6'</span>,
        shuffleDash            = <span class="string">'shuffle-'</span>,
        gridClasses            = [ shuffleDash + <span class="number">3</span>, shuffleDash + <span class="number">4</span>, shuffleDash + <span class="number">5</span>, <span class="string">'grid-small'</span> ].join(<span class="string">' '</span>),
        itemSelector           = <span class="string">'.gallery-item'</span>,
        grid5                  = <span class="string">'slimgrid5'</span>,
        slimgrid               = <span class="string">'slimgrid'</span>,
        span                   = <span class="string">'span'</span>,
        large                  = <span class="string">'.large'</span>,
        promo                  = <span class="string">'.promo'</span>,
        normal                 = <span class="string">'.normal'</span>,
        medium                 = <span class="string">'.medium'</span>,
        plate                  = <span class="string">'.plate'</span>,
        largeAndPromoAndMedium = large + <span class="string">','</span> + promo + <span class="string">','</span> + medium + <span class="string">','</span> + plate;

        <span class="keyword">if</span> ( numColumns === <span class="number">5</span> ) {
          <span class="keyword">if</span> ( !self.$container.hasClass( shuffleDash + <span class="number">5</span> ) ) {

            self.$shuffleContainers.removeClass(<span class="string">'slimgrid'</span>)
            .addClass(<span class="string">'slimgrid5'</span>);

            self.$shuffleContainers.children(itemSelector)
              .removeClass(allSpans)<span class="comment">// Remove current grid span</span>
              .filter(medium)       <span class="comment">// Select large tiles</span>
              .addClass(span+<span class="number">2</span>)     <span class="comment">// Make them 3/5 width</span>
              .end()                <span class="comment">// Go back to all items</span>
              .filter(plate)        <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">2</span>)     <span class="comment">// Make them 2/5 width</span>
              .end()                <span class="comment">// Go back to all items</span>
              .filter(normal)       <span class="comment">// Select tiles not large nor plate</span>
              .addClass(span+<span class="number">1</span>);    <span class="comment">// Make them 1/5 width</span>
          }

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">4</span> ) {

          <span class="keyword">if</span> ( !self.$shuffleContainers.hasClass( shuffleDash + <span class="number">4</span> ) ) {

            self.$shuffleContainers.removeClass(<span class="string">'slimgrid5'</span>)
            .addClass(<span class="string">'slimgrid'</span>);

            self.$shuffleContainers.children(itemSelector)
              .removeClass(allSpans)<span class="comment">// Remove current grid span</span>
              .filter(medium)       <span class="comment">// Select large and promo tiles</span>
              .addClass( span + <span class="number">6</span> ) <span class="comment">// Make them half width</span>
              .end()
              .filter(plate)        <span class="comment">// Go back to all items</span>
              .addClass( span + <span class="number">6</span> )
              .end()
              .filter(normal)       <span class="comment">// Select tiles not large nor promo</span>
              .addClass( span + <span class="number">3</span> );<span class="comment">// Make them quarter width</span>
          }

        }
        <span class="keyword">return</span> self;
      },

      setSortPriorities: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        self.$slides.each(<span class="keyword">function</span>(){

          <span class="keyword">var</span> $slide     = $(<span class="keyword">this</span>),
          $items         = $slide.find(<span class="string">'.gallery-item'</span>),
          slideVariation = $slide.data(<span class="string">'variation'</span>).split(<span class="string">'-'</span>)[<span class="number">2</span>],
          hitNormalYet      = <span class="literal">false</span>,

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Priority constants</p>             </td>             <td class="code">               <div class="highlight"><pre>          PRIORITY = <span class="string">'priority'</span>,
          MEDIUM   = <span class="string">'medium'</span>,
          NORMAL   = <span class="string">'normal'</span>,
          BLANK    = <span class="string">'blank'</span>,
          ONE      = <span class="number">1</span>,
          TWO      = <span class="number">2</span>,
          THREE    = <span class="number">3</span>,
          FOUR     = <span class="number">4</span>,
          FIVE     = <span class="number">5</span>;

          $items.each(<span class="keyword">function</span>(){
            <span class="keyword">var</span> $item = $(<span class="keyword">this</span>);
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>covers off on sorting blank tiles</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(slideVariation === <span class="string">'4up'</span>){
              <span class="keyword">if</span>($item.hasClass( MEDIUM )){
                $item.data( PRIORITY , FIVE );
              }<span class="keyword">else</span> <span class="keyword">if</span>($item.hasClass( NORMAL ) &amp;&amp; !hitNormalYet){
                $item.data( PRIORITY , TWO );
                hitNormalYet = <span class="literal">true</span>;
              }<span class="keyword">else</span> <span class="keyword">if</span>($item.hasClass( BLANK )){
                $item.data( PRIORITY , THREE );
              }
              <span class="keyword">else</span> <span class="keyword">if</span>($item.hasClass( NORMAL ) &amp;&amp; hitNormalYet === <span class="literal">true</span>){
                $item.data( PRIORITY , FOUR );
              }
            }<span class="keyword">else</span> <span class="keyword">if</span> ( slideVariation === <span class="string">'3up'</span> ){
              <span class="keyword">if</span>($item.hasClass( MEDIUM )){
                $item.data(PRIORITY , TWO );
              }<span class="keyword">else</span> <span class="keyword">if</span>($item.hasClass( NORMAL )){
                $item.data(PRIORITY , THREE );
              }
              <span class="keyword">if</span>($item.hasClass( BLANK )){
                 $item.data(PRIORITY , <span class="number">100</span>);
              }
            }
          });
        });
      },

      sortByPriority : <span class="keyword">function</span>() {
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
            isTablet = self.mq(<span class="string">'(min-width: 569px) and (max-width: 980px)'</span>);

        <span class="keyword">if</span> ( isTablet &amp;&amp; !self.sorted ) {

          self.$shuffleContainers.each(<span class="keyword">function</span>(){

            <span class="keyword">var</span> $shuffleContainer = $(<span class="keyword">this</span>),
            slideVariation = $shuffleContainer.parent().data(<span class="string">'variation'</span>).split(<span class="string">'-'</span>)[<span class="number">2</span>];

            $shuffleContainer.shuffle(<span class="string">'sort'</span>, {
              by: <span class="keyword">function</span>($el) {
                <span class="keyword">var</span> priority = $el.hasClass(<span class="string">'plate'</span>) ? <span class="number">1</span> : $el.hasClass(<span class="string">'medium'</span>) ? <span class="number">2</span> : <span class="number">3</span>;

                <span class="keyword">if</span>(slideVariation == <span class="string">'4up'</span> || slideVariation == <span class="string">'3up'</span>){
                  priority = $el.data(<span class="string">'priority'</span>);
                }
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Returning undefined to the sort plugin will cause it to revert to the original array</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">return</span> priority ? priority : <span class="literal">undefined</span>;
              }
            });
          });

          self.sorted = <span class="literal">true</span>;
        } <span class="keyword">else</span> <span class="keyword">if</span> ( !isTablet &amp;&amp; self.sorted ) {
          self.$shuffleContainers.shuffle(<span class="string">'sort'</span>, {});
          self.sorted = <span class="literal">false</span>;
        }

      },

      checkForBreakpoints: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        wW       = self.$win.width(),
        view     = wW &gt; self.LANDSCAPE_BREAKPOINT ? <span class="string">'desktop'</span> : wW &gt; self.MOBILE_BREAKPOINT ? <span class="string">'tablet'</span> : <span class="string">'mobile'</span>,
        wasMobile = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>if the browser doesnt support media queries...IE default to desktop</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(!Modernizr.mediaqueries || self.$html.hasClass(<span class="string">'lt-ie10'</span>)){
          view = <span class="string">'desktop'</span>;
        }

        self.log(<span class="string">'checking for breakpoints...'</span>);

        <span class="keyword">switch</span>(view){
          <span class="keyword">case</span> <span class="string">'desktop'</span>:


            <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
              self.$el.find(<span class="string">'.gallery-item'</span>).addClass(<span class="string">'span6'</span>);
              self.$el.removeClass(<span class="string">'grid'</span>)
              .addClass(<span class="string">'slimgrid'</span>);

              self.sortTagLines2up();
              <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>check if we are coming out of mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(self.isMobileMode === <span class="literal">true</span>){
              wasMobile = <span class="literal">true</span>;
              self.returnToFullView();

              self.log(<span class="string">'was mobile'</span>);
            }

            self.isTabletMode = self.isMobileMode = <span class="literal">false</span>;

            <span class="keyword">if</span>(self.isDesktopMode === <span class="literal">true</span>){
               self.log(<span class="string">'already desktop'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>return;</p>             </td>             <td class="code">               <div class="highlight"><pre>            }

            self.isDesktopMode = <span class="literal">true</span>;

            self.$el.removeClass(<span class="string">'rp-tablet rp-mobile'</span>)
                                    .addClass(<span class="string">'rp-desktop'</span>);

            <span class="keyword">if</span>(self.scrollerModule !== <span class="literal">null</span> || wasMobile){
              self.log(<span class="string">'destroying scroller'</span>);
              self.scrollerModule.destroy();
              self.scrollerModule = <span class="literal">null</span>;

            }

            <span class="keyword">if</span>(self.shuffle === <span class="literal">null</span> || wasMobile){
              self.log(<span class="string">'creating shuffle'</span>);
              self.$container.css(<span class="string">'width'</span> , <span class="string">'100%'</span>);
              self.createShuffle();

              
            }

            self.sortByPriority();

            window.iQ.update();

            <span class="keyword">if</span>(!self.hasTouch){
              self.togglePaddles(<span class="literal">true</span>);
            }


          <span class="keyword">break</span>;

          <span class="keyword">case</span> <span class="string">'tablet'</span>:

            wasMobile = self.isMobileMode;

            <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
              self.$el.find(<span class="string">'.gallery-item'</span>).addClass(<span class="string">'span6'</span>);
              self.$el.removeClass(<span class="string">'slimgrid'</span>)
              .addClass(<span class="string">'grid'</span>);
              self.sortTagLines2up();
              <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>check if we are coming out of mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(self.isMobileMode === <span class="literal">true</span>){
              self.returnToFullView();
            }

            <span class="keyword">if</span>(self.isTabletMode === <span class="literal">true</span>){
              <span class="keyword">return</span>;
            }

            self.isMobileMode = self.isDesktopMode = <span class="literal">false</span>;
            self.isTabletMode = <span class="literal">true</span>;

            self.$el.removeClass(<span class="string">'rp-desktop rp-mobile'</span>)
                    .addClass(<span class="string">'rp-tablet'</span>);

            <span class="keyword">if</span>(self.scrollerModule !== <span class="literal">null</span>){
              self.scrollerModule.destroy();
              self.scrollerModule = <span class="literal">null</span>;
            }

            <span class="keyword">if</span>(self.shuffle === <span class="literal">null</span>){
              self.$container.css(<span class="string">'width'</span> , <span class="string">'100%'</span>);
              self.createShuffle();
            }

            self.sortByPriority();

            window.iQ.update();

            <span class="keyword">if</span>(!self.hasTouch){
              self.togglePaddles(<span class="literal">true</span>);
            }

          <span class="keyword">break</span>;

          <span class="keyword">case</span> <span class="string">'mobile'</span>:

            <span class="keyword">if</span>(self.isMobileMode === <span class="literal">true</span>){
              <span class="keyword">return</span>;
            }

            <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
              self.$el.find(<span class="string">'.gallery-item'</span>).removeClass(<span class="string">'span6'</span>);
              self.$el.removeClass(<span class="string">'grid slimgrid'</span>);
              self.sortTagLines2up();
              <span class="keyword">return</span>;
            }

            self.isTabletMode = self.isDesktopMode = <span class="literal">false</span>;
            self.isMobileMode = <span class="literal">true</span>;

            self.$el.removeClass(<span class="string">'rp-tablet rp-desktop'</span>)
                    .addClass(<span class="string">'rp-mobile'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Destroy the shuffle instance</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(self.shuffle !== <span class="literal">null</span>){
              self.shuffle.destroy();
              self.shuffle = <span class="literal">null</span>;
              self.sorted = <span class="literal">false</span>;

              self.$shuffleContainers.each(<span class="keyword">function</span>(){
                <span class="keyword">var</span> shfflInst = $(<span class="keyword">this</span>).data(<span class="string">'shuffle'</span>);

                <span class="keyword">if</span>(shfflInst !== <span class="literal">undefined</span>){
                  shfflInst.destroy();
                  shfflInst = <span class="literal">null</span>;
                }

              });
            }

            self.shuffle = <span class="literal">null</span>;

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Hide the bullet navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.$bulletNav.hide();

            window.iQ.update();

            <span class="keyword">if</span>(self.scrollerModule !== <span class="literal">null</span>){
              self.scrollerModule.destroy();
              self.scrollerModule = <span class="literal">null</span>;
            }

            self.initMobileBreakpoint();

            self.log(<span class="string">'initing mobile'</span>);

            self.togglePaddles(<span class="literal">false</span>);

          <span class="keyword">break</span>;
        }


</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>do we need this in ALL modes?</p>             </td>             <td class="code">               <div class="highlight"><pre>
        self.setNameHeights(self.$shuffleContainers);

      },

      setGrabCursor:<span class="keyword">function</span>() {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span>(!self.hasTouch) {
          <span class="keyword">if</span>(self.grabbingCursor) {
            self.sliderOverflow.css(<span class="string">'cursor'</span>, self.grabbingCursor);
          } <span class="keyword">else</span> {
            self.sliderOverflow.removeClass(<span class="string">'grab-cursor'</span>);
            self.sliderOverflow.addClass(<span class="string">'grabbing-cursor'</span>);
          }
        }
      },

      updateSliderSize: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        newHeight = $(<span class="string">'.shuffle-container'</span>).eq(<span class="number">0</span>).height();

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>handle stuff for old IE</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>( self.oldIE ){
          self.$el.css( <span class="string">'height'</span> , <span class="number">660</span> + <span class="string">'px'</span> );
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
          <span class="keyword">return</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>handle resize for various layouts</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.isTabletMode === <span class="literal">true</span>){
          <span class="keyword">if</span>( newHeight === <span class="number">0</span> ){
            newHeight = Math.ceil( $(<span class="string">'.shuffle-container'</span>).eq(<span class="number">0</span>).width() * <span class="number">0.984615385</span> );
            self.log(<span class="string">'using alternate height calculatio &gt;&gt;&gt; TABLET'</span> , newHeight);
          }
          
         self.$el.css( <span class="string">'height'</span> , newHeight + <span class="number">62</span> + <span class="string">'px'</span> );

          <span class="keyword">if</span>(!!self.isTabbedContainer){
            self.$tabbedContainer.css(<span class="string">'height'</span> , $(<span class="string">'.shuffle-container'</span>).eq(<span class="number">0</span>).height() + <span class="number">62</span> + <span class="string">'px'</span>);
          }
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span>(self.isMobileMode === <span class="literal">true</span>){
          self.$el.css(<span class="string">'height'</span> , <span class="number">290</span>);
          <span class="keyword">if</span>(!!self.isTabbedContainer){
            self.$tabbedContainer.css(<span class="string">'height'</span> , <span class="number">290</span>);
          }
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span>( newHeight === <span class="number">0</span> ){
          newHeight = Math.ceil( $(<span class="string">'.shuffle-container'</span>).eq(<span class="number">0</span>).width() * <span class="number">0.509803922</span> );
           self.log(<span class="string">'using alternate height calculation &gt;&gt;&gt; Desktop'</span> , newHeight);
        }

        <span class="keyword">if</span>(self.$win.width() &lt; <span class="number">1120</span>){
          newHeight += <span class="number">20</span>;
        }

        self.$el.css( <span class="string">'height'</span> , newHeight + <span class="number">0</span> + <span class="string">'px'</span> );

        <span class="keyword">if</span>(!!self.isTabbedContainer){
          self.$tabbedContainer.css(<span class="string">'height'</span> , newHeight + <span class="number">0</span> + <span class="string">'px'</span>);
        }
      },

      getPagePosition: <span class="keyword">function</span>(e) {

        <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span> ( !e.pageX &amp;&amp; !e.originalEvent ) {
          <span class="keyword">return</span>;
        }

        self.lastTouch = self.lastTouch || {};

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Cache position for touchmove/touchstart, as touchend doesn't provide it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( e.type === <span class="string">'touchmove'</span> || e.type === <span class="string">'touchstart'</span> ) {
          self.lastTouch = e.originalEvent.touches[<span class="number">0</span>];
        }

        <span class="keyword">return</span> {
          <span class="string">'x'</span>: (e.pageX || self.lastTouch.pageX),
          <span class="string">'y'</span>: (e.pageY || self.lastTouch.pageY)
        };
      },

      <span class="comment">/*
      'scrubbingThreshold': function(e) {

        var self = this,
            distX = self.getPagePosition(e).x - self.handleStartPosition.x,
            distY = self.getPagePosition(e).y - self.handleStartPosition.y;

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>If you're not on touch, or if you didn't pass in a threshold setting, go ahead and scrub.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="keyword">if</span> ( !Modernizr.touch || !self.dragThreshold || self.isScrubbing ) {
          self.isScrubbing = <span class="literal">true</span>;
          self.onScrubbing(e, distX, distY);
          <span class="keyword">return</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>If you've gone past the threshold, simply do nothing for this interaction.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        if ( self.hasPassedThreshold ) { return; }

        if ( Math.abs(distX) &gt; self.dragThreshold ) {
          self.isScrubbing = true;
          self.onScrubbing(e, distX, distY);
          return;
        }

        if ( Math.abs(distY) &gt; self.dragThreshold ) {
          self.hasPassedThreshold = true;
          return;
        }
      },*/

      onDragStart : function(e){
        var self = this,
            point;

        self.dragSuccess = false;

        if(self.hasTouch){
          var touches = e.originalEvent.touches;
          if(touches &amp;&amp; touches.length &gt; 0){
            point = touches[0];
            if(touches.length &gt; 1){
              self.multipleTouches = true; //not sure why we would care
            }
          }else{
            return;
          }
        }else{
          point = e;
          e.preventDefault();

          if(e.which !== 1){
            return;
          }
        }

        self.isDragging         = true;
        self.$doc.on(self.moveEvent , $.proxy(self.dragMove , self)).on(self.upEvent , $.proxy(self.dragRelease , self));
        self.currMoveAxis       = '';
        self.hasMoved           = false;
        self.pageX              = point.pageX;
        self.pageY              = point.pageY;
        self.startDragX         = point.pageX;//
        self.startPagePos       = self.accelerationPos =  point.pageX;
        self.horDir             = 0;
        self.verDir             = 0;
        self.currRenderPosition = self.sPosition;
</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>self.startTime          = new Date().getTime();</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.startTime = self.startInteractionTime = <span class="keyword">new</span> Date().getTime();
        self.startInteractionPointX = point.pageX;
        self.handleStartPosition = self.getPagePosition(e);

        <span class="keyword">if</span>(self.hasTouch) {
          self.sliderOverflow.on(self.cancelEvent, <span class="keyword">function</span>(e) { self.dragRelease(e, <span class="literal">false</span>); });
        }

      },

</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>%renderMovement</p>             </td>             <td class="code">               <div class="highlight"><pre>      renderMovement: <span class="keyword">function</span>(point , isThumbs){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        <span class="keyword">if</span>(self.checkedAxis) {

          <span class="keyword">var</span> timeStamp = self.renderMoveTime,
          deltaX        = point.pageX - self.pageX,
          deltaY        = point.pageY - self.pageY,
          newX          = self.currRenderPosition + deltaX,
          newY          = self.currRenderPosition + deltaY,
          isHorizontal  = <span class="literal">true</span>,
          newPos        = isHorizontal ? newX : newY,
          mAxis         = self.currMoveAxis;

          self.hasMoved = <span class="literal">true</span>;
          self.pageX    = point.pageX;
          self.pageY    = point.pageY;


          <span class="keyword">var</span> pointPos = isHorizontal ? self.pageX : self.pageY;

          <span class="keyword">if</span>(mAxis === <span class="string">'x'</span> &amp;&amp; deltaX !== <span class="number">0</span>) {
              self.horDir = deltaX &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;
          } <span class="keyword">else</span> <span class="keyword">if</span>(mAxis === <span class="string">'y'</span> &amp;&amp; deltaY !== <span class="number">0</span>) {
              self.verDir = deltaY &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;
          }

          <span class="keyword">var</span> deltaPos = isHorizontal ? deltaX : deltaY;

          <span class="keyword">if</span>(!self.loop) {
            <span class="keyword">if</span>(self.currSlideId &lt;= <span class="number">0</span>) {
              <span class="keyword">if</span>(pointPos - self.startPagePos &gt; <span class="number">0</span>) {
                  newPos = self.currRenderPosition + deltaPos * self.lastItemFriction;
              }
            }
            <span class="keyword">if</span>(self.currSlideId &gt;= self.numSlides - <span class="number">1</span>) {
              <span class="keyword">if</span>(pointPos - self.startPagePos &lt; <span class="number">0</span>) {
                  newPos = self.currRenderPosition + deltaPos * self.lastItemFriction ;
              }
            }
          }

          self.currRenderPosition = newPos;

          <span class="keyword">if</span> (timeStamp - self.startTime &gt; <span class="number">200</span>) {
            self.startTime = timeStamp;
            self.accelerationPos = pointPos;
          }

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>animate?</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.setPosition(self.currRenderPosition);
        }
      },

      setPosition: <span class="keyword">function</span>(posi) {

        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        pos      = self.sPosition = posi;

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>using transforms</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.useCSS3Transitions) {
          <span class="keyword">var</span> animObj                       = {};
          animObj[ self.prefixed(self.TD) ] = <span class="number">0</span> + <span class="string">'ms'</span>;
          animObj[ self.xProp ]             = self.tPref1 + (pos + self.tPref2 + <span class="number">0</span>) + self.tPref3;
          self.$container.css(animObj);

        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>using left</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$container.css(self.xProp, pos);
        }
      },

      dragRelease: <span class="keyword">function</span>(e, isThumbs){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        totalMoveDist,
        accDist,
        duration,
        v0,
        newPos,
        newDist,
        newDuration,
        blockLink;

        self.renderMoveEvent = <span class="literal">null</span>;
        self.isDragging      = <span class="literal">false</span>;
        self.lockAxis        = <span class="literal">false</span>;
        self.checkedAxis     = <span class="literal">false</span>;
        self.renderMoveTime  = <span class="number">0</span>;

        window.cancelAnimationFrame(self.animFrame);

</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>stop listening on the document for movement</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$doc.off(self.moveEvent).off(self.upEvent);

        <span class="keyword">if</span>(self.hasTouch) {
            self.sliderOverflow.off(self.cancelEvent);
        }

        self.currMoveAxis = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>self.setGrabCursor(); // remove grabbing hand</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> orient = <span class="literal">true</span>;

        <span class="keyword">if</span>(!self.hasMoved) {
            <span class="keyword">return</span>;
        }

        self.dragSuccess = <span class="literal">true</span>;
        self.currMoveAxis = <span class="string">''</span>;

        <span class="function"><span class="keyword">function</span> <span class="title">getCorrectSpeed</span><span class="params">(newSpeed)</span> {</span>
            <span class="keyword">if</span>(newSpeed &lt; <span class="number">100</span>) {
                <span class="keyword">return</span> <span class="number">100</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span>(newSpeed &gt; <span class="number">500</span>) {
                <span class="keyword">return</span> <span class="number">500</span>;
            }
            <span class="keyword">return</span> newSpeed;
        }

        <span class="function"><span class="keyword">function</span> <span class="title">returnToCurrent</span><span class="params">(isSlow, v0)</span> {</span>
          <span class="keyword">var</span> newPos = -self.currentId * self.currentContainerWidth,
          newDist = Math.abs(self.sPosition  - newPos);
          self.currAnimSpeed = newDist / v0;

          <span class="keyword">if</span>(isSlow) {
              self.currAnimSpeed += <span class="number">250</span>;
          }
          self.currAnimSpeed = getCorrectSpeed(self.currAnimSpeed);

          self.moveTo();
        }

        <span class="keyword">var</span> snapDist = self.minSlideOffset,
            point = self.hasTouch ? e.originalEvent.changedTouches[<span class="number">0</span>] : e,
            pPos = point.pageX,
            sPos = self.startPagePos,
            axPos = self.accelerationPos,
            axCurrItem = self.currSlideId,
            axNumItems = self.numSlides,
            dir = self.horDir,
            loop = self.loop,
            changeHash = <span class="literal">false</span>,
            distOffset = <span class="number">0</span>,
            dragDirection;

        totalMoveDist = Math.abs(pPos - sPos);

        dragDirection = self.startDragX &gt; pPos ? <span class="number">1</span> : <span class="number">0</span>;

        accDist = pPos - axPos;

        duration = (<span class="keyword">new</span> Date().getTime()) - self.startTime;
        v0 = Math.abs(accDist) / duration;


        <span class="keyword">if</span>( totalMoveDist &gt; self.hasTouch ? Math.abs(self.currentContainerWidth * <span class="number">0.25</span>) : Math.abs(self.currentContainerWidth * <span class="number">0.5</span>) ){

          <span class="keyword">if</span>(dragDirection === <span class="number">1</span>){
            self.currentId ++;
            <span class="keyword">if</span>(self.currentId &gt;= self.$slides.length){
              self.currentId = self.$slides.length - <span class="number">1</span>;
            }
          }<span class="keyword">else</span>{
            self.currentId --;
           <span class="keyword">if</span>(self.currentId &lt; <span class="number">0</span>){
            self.currentId = <span class="number">0</span>;
           }
          }
          self.moveTo(v0);
        }<span class="keyword">else</span>{
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>return to current</p>             </td>             <td class="code">               <div class="highlight"><pre>          returnToCurrent(<span class="literal">true</span>, v0);
        }

      },

      dragMove: <span class="keyword">function</span>(e , isThumbs){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
            distX = self.getPagePosition(e).x - self.handleStartPosition.x,
            distY = self.getPagePosition(e).y - self.handleStartPosition.y,
            point;

        <span class="keyword">if</span>(self.hasTouch) {
          <span class="keyword">if</span>(self.lockAxis) {
              <span class="keyword">return</span>;
          }
          <span class="keyword">var</span> touches = e.originalEvent.touches;
          <span class="keyword">if</span>(touches) {
              <span class="keyword">if</span>(touches.length &gt; <span class="number">1</span>) {
                <span class="keyword">return</span>;
              } <span class="keyword">else</span> {
                point = touches[<span class="number">0</span>];
              }
          } <span class="keyword">else</span> {
            <span class="keyword">return</span>;
          }
        } <span class="keyword">else</span> {
          point = e;
        }

        <span class="keyword">if</span>(!self.hasMoved) {
          <span class="keyword">if</span>(self.useCSS3Transitions) {
            self.$container.css( self.prefixed( self.TD ) , <span class="string">'0s'</span> );
          }
          (<span class="function"><span class="keyword">function</span> <span class="title">animloop</span><span class="params">()</span>{</span>
            <span class="keyword">if</span>(self.isDragging) {
              self.animFrame = window.requestAnimationFrame(animloop);
              <span class="keyword">if</span>(self.renderMoveEvent){

                self.renderMovement(self.renderMoveEvent, isThumbs);
              }
            }
          })();
        }


        <span class="keyword">if</span> ( Math.abs(distY) &gt; self.dragThreshold ) {
          self.hasPassedThreshold = <span class="literal">true</span>;
          <span class="keyword">return</span>;
        }

       <span class="keyword">if</span>(!self.checkedAxis) {

          <span class="keyword">var</span> dir = <span class="literal">true</span>,
          diff    = (Math.abs(point.pageX - self.pageX) - Math.abs(point.pageY - self.pageY) ) - (dir ? -<span class="number">7</span> : <span class="number">7</span>);

          <span class="keyword">if</span>(diff &gt; <span class="number">7</span>) {
</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>horizontal movement</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(dir) {
              e.preventDefault();
              self.currMoveAxis = <span class="string">'x'</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span>(self.hasTouch) {
</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>self.completeGesture();</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">return</span>;
            }
            self.checkedAxis = <span class="literal">true</span>;
          } <span class="keyword">else</span> <span class="keyword">if</span>(diff &lt; -<span class="number">7</span>) {
</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>ver movement</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>(!dir) {
              e.preventDefault();
              self.currMoveAxis = <span class="string">'y'</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span>(self.hasTouch) {
</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>self.completeGesture();</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">return</span>;
            }
            self.checkedAxis = <span class="literal">true</span>;
          }
          <span class="keyword">return</span>;
        }



        e.preventDefault();
        self.renderMoveTime = <span class="keyword">new</span> Date().getTime();
        self.renderMoveEvent = point;
      },

      updateSlides: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self        = <span class="keyword">this</span>,
        cw              = self.currentContainerWidth = self.$container.outerWidth(),
        animObj         = {},
        newPos          = (-self.currentId * cw),
        widthDifference = (self.$win.width() - self.$el.find(<span class="string">'.rp-slide'</span>).eq(<span class="number">0</span>).outerWidth(<span class="literal">true</span>)) * (<span class="number">0.5</span>);

        <span class="keyword">if</span>( widthDifference &gt; <span class="number">0</span> &amp;&amp; !self.isIE7orIE8 ){
          newPos += Math.ceil(widthDifference);
        }

        <span class="keyword">if</span>( self.isIE7orIE8 &amp;&amp; self.$win.width() &lt;= <span class="number">1190</span> ){
          cw = <span class="number">1190</span>;
          newPos = ( -self.currentId * cw );
          newPos -= (<span class="number">1190</span> - self.$win.width() ) * <span class="number">0.5</span>;
        }<span class="keyword">else</span> <span class="keyword">if</span>( self.isIE7orIE8 ){
          newPos += Math.ceil(widthDifference);
        }

        <span class="keyword">if</span>(self.mode === <span class="string">'suggested'</span>){
          <span class="keyword">return</span>;
        }

        self.$slides.each(<span class="keyword">function</span>(i){
      
          $(<span class="keyword">this</span>).css({
            <span class="string">'left'</span>    : i * cw + <span class="string">'px'</span>,
            <span class="string">'z-index'</span> : i
          });

        });


        <span class="keyword">if</span>( !self.useCSS3Transitions ) {

</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>jquery fallback</p>             </td>             <td class="code">               <div class="highlight"><pre>          animObj[ self.xProp ] = newPos;
          self.$container.animate(animObj, <span class="number">0</span>);
        }<span class="keyword">else</span> {
          <span class="keyword">if</span>( self.isMobileMode ){
            <span class="keyword">return</span>;
          }
          animObj[ self.prefixed( self.TD ) ] = <span class="number">0</span> + <span class="string">'ms'</span>;
          animObj[ self.prefixed( self.TTF ) ] = self.css3Easing.easeOutBack;
          animObj[ self.xProp ] = self.tPref1 + ( newPos + self.tPref2 + <span class="number">0</span>) + self.tPref3;
          self.$container.css( animObj );
        }
      },

      moveTo: <span class="keyword">function</span>( velocity ){
        <span class="keyword">var</span> self        = <span class="keyword">this</span>,
        newPos          = -self.currentId * self.currentContainerWidth,
        animObj         = {},
        newDist         = Math.abs(self.sPosition  - newPos),
        widthDifference = ( self.$win.width() - $(<span class="string">'.rp-slide'</span>).eq(<span class="number">0</span>).outerWidth(<span class="literal">true</span>) ) * ( <span class="number">0.5</span> );

        <span class="function"><span class="keyword">function</span> <span class="title">getCorrectSpeed</span><span class="params">( newSpeed )</span> {</span>
            <span class="keyword">if</span>( newSpeed &lt; <span class="number">100</span> ) {
                <span class="keyword">return</span> <span class="number">100</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span>( newSpeed &gt; <span class="number">500</span> ) {
                <span class="keyword">return</span> <span class="number">500</span>;
            }
            <span class="keyword">return</span> newSpeed;
        }

        <span class="keyword">if</span>( self.isIE7orIE8 &amp;&amp; self.$win.width() &lt;= <span class="number">1190</span> ){
          newPos =  -self.currentId * <span class="number">1190</span> ;
          newPos -= (<span class="number">1190</span> - self.$win.width() ) * <span class="number">0.5</span>;
          newDist = Math.abs(self.sPosition  - newPos);
        }<span class="keyword">else</span> <span class="keyword">if</span>( self.isIE7orIE8 ){
          newPos += Math.ceil(widthDifference);
        }

        self.currAnimSpeed = getCorrectSpeed( newDist / velocity );

        <span class="keyword">if</span>( isNaN(self.currAnimSpeed) ){
          self.currAnimSpeed = self.animationSpeed;
        }

        <span class="keyword">if</span>( widthDifference &gt; <span class="number">0</span> &amp;&amp; !self.isIE7orIE8 ){
          newPos += Math.ceil( widthDifference );
        }

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Shuffle optimization</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.toggleShuffles();

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>jQuery animation fallback</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>( !self.useCSS3Transitions ) {
          animObj[ self.xProp ] = newPos;
          self.$container.animate( animObj, self.currAnimSpeed );
        }<span class="keyword">else</span>{
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>css3 transition</p>             </td>             <td class="code">               <div class="highlight"><pre>          animObj[ self.prefixed( self.TD ) ]  = self.currAnimSpeed + <span class="string">'ms'</span>;

          <span class="keyword">if</span>(self.currAnimSpeed === self.animationSpeed){
            animObj[ self.prefixed( self.TTF )  ] = self.css3Easing.easeOutBack;
          }<span class="keyword">else</span>{
            animObj[ self.prefixed( self.TTF ) ] = self.css3Easing.sonyScrollEase;
          }

          self.$container.css( animObj );
          animObj[ self.xProp ] = self.tPref1 + (( newPos ) + self.tPref2 + <span class="number">0</span>) + self.tPref3;
          self.$container.css( animObj );

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>IQ Update</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$container.one(self.transitionEndName , <span class="keyword">function</span>(){
            window.iQ.update();
          });
        }

</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>update the overall position</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.sPosition = self.currRenderPosition = newPos;

        self.isTransitioning = <span class="literal">true</span>;

        self.ev.trigger(<span class="string">'rpOnUpdateNav'</span>);
      },

      returnToFullView: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        <span class="keyword">if</span>(self.isDesktopMode === <span class="literal">false</span>){
          self.isDesktopMode = <span class="literal">true</span>;


          self.$galleryItems.each(<span class="keyword">function</span>(){
            <span class="keyword">var</span> item = $(<span class="keyword">this</span>).removeClass(<span class="string">'small-size mobile-item'</span>),
                slide = item.data(<span class="string">'slide'</span>);
                item.appendTo(slide);
          });

          self.$container.css( <span class="string">'width'</span> , <span class="string">''</span> );
          self.$container.append(self.$slides);
          self.$container.on(self.downEvent, <span class="keyword">function</span>(e) { self.onDragStart(e); });

          <span class="keyword">if</span>(!self.hasTouch){
            self.$paddles.show();
          }
          
        }
      },

      sortTagLines2up: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
            $taglines = self.$el.find(<span class="string">'.product-tagline'</span>);

        $taglines.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> $line = $(<span class="keyword">this</span>);

          <span class="keyword">if</span>( $line.height() / parseInt($line.css(<span class="string">'line-height'</span>) , <span class="number">10</span> ) &gt; <span class="number">1</span> ){
            $line.parent().addClass(<span class="string">'two-line'</span>);
          }

        });
      },

      disableShuffle: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        self.$shuffleContainers.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> sffleInst = $(<span class="keyword">this</span>).data(<span class="string">'shuffle'</span>);
          <span class="keyword">if</span>(sffleInst !== <span class="literal">undefined</span> || sffleInst !== <span class="literal">null</span>){
            <span class="keyword">if</span>(sffleInst){
               sffleInst.disable();
            }
          }
        });
      },

      enableShuffle: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        self.$shuffleContainers.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> sffleInst = $(<span class="keyword">this</span>).data(<span class="string">'shuffle'</span>);
          <span class="keyword">if</span>(sffleInst !== <span class="literal">undefined</span> || sffleInst !== <span class="literal">null</span>){
            <span class="keyword">if</span>(sffleInst){
               sffleInst.enable();
            }
          }
        });
      },

      updatePaddles: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
            wW = self.$win.width(),
            px = <span class="string">'px'</span>;

        <span class="keyword">if</span>(!self.paddlesEnabled){
          <span class="keyword">return</span>;
        }

        <span class="keyword">var</span> $plate = self.$el.find(<span class="string">'.plate'</span>),
            hasPlate = $plate.length &gt; <span class="number">0</span>,
            plateHeight = $plate.outerHeight(<span class="literal">true</span>),
            spaceAvail = wW - self.$el.find(<span class="string">'.rp-slide'</span>).eq(<span class="number">0</span>).width();

        <span class="keyword">if</span> ( self.mq(<span class="string">'(min-width: 981px)'</span>) &amp;&amp; hasPlate) {

          self.$rightPaddle.css({
            top :  plateHeight,
            right: (spaceAvail / <span class="number">4</span>) - (parseInt(self.$rightPaddle.width() , <span class="number">10</span>) / <span class="number">2</span>) + px
          });

          self.$leftPaddle.css({
            top :  plateHeight,
            left: (spaceAvail / <span class="number">4</span>) - ( parseInt(self.$leftPaddle.width() , <span class="number">10</span>) ) + <span class="number">10</span> + px
          });
        }<span class="keyword">else</span> <span class="keyword">if</span>(self.mq(<span class="string">'(min-width: 569px)'</span>) &amp;&amp; hasPlate){

          self.$rightPaddle.css({
            top :  plateHeight + <span class="number">130</span>,
            right: (spaceAvail / <span class="number">4</span>) - (parseInt(self.$rightPaddle.width() , <span class="number">10</span>) / <span class="number">2</span>) + <span class="number">20</span> + px

          });

          self.$leftPaddle.css({
            top :  plateHeight + <span class="number">130</span>,
            left: (spaceAvail / <span class="number">4</span>) - ( parseInt(self.$leftPaddle.width() , <span class="number">10</span>) ) + <span class="number">35</span> + px
          });
        }

      },

      updateTiles: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        isFullView = self.mq(<span class="string">'(min-width: 981px)'</span>),
        $mediumTile = <span class="literal">null</span>,
        $normalTile = <span class="literal">null</span>,
        newHeight = <span class="number">0</span>,
        slideVariation = <span class="string">''</span>,
        radix = <span class="number">10</span>;

        <span class="keyword">if</span>(self.isMobileMode){
          $mediumTile = self.$slides.find(<span class="string">'.gallery-item.medium .product-img'</span>).first();
          $mediumTile.css(<span class="string">'height'</span> , <span class="string">''</span>);

          <span class="keyword">return</span>;
        }

        self.$slides.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> $slide = $(<span class="keyword">this</span>);

          slideVariation = $slide.data(<span class="string">'variation'</span>).split(<span class="string">'-'</span>)[<span class="number">2</span>].toLowerCase();

          $mediumTile = $slide.find(<span class="string">'.gallery-item.medium .product-img'</span>).first();
          $normalTile = $slide.find(<span class="string">'.gallery-item.normal'</span>).first();

          <span class="keyword">var</span> tileHeight = $slide.find(<span class="string">'.gallery-item.plate'</span>).first().height() +  ( self.mq(<span class="string">'(max-width: 769px)'</span>) ? <span class="number">26</span> : <span class="number">0</span> ),
              testHeight = $(<span class="string">'.gallery-item.normal'</span>).first().find(<span class="string">'.product-content'</span>).outerWidth(<span class="literal">true</span>);

          <span class="keyword">if</span>(slideVariation !== <span class="string">'3up'</span>){
            $slide.find( <span class="string">'.gallery-item.normal'</span>).css({
              <span class="string">'max-height'</span> : tileHeight,
              <span class="string">'height'</span>     : tileHeight
            });
<span class="comment">/*
            if( slideVariation === '4up' &amp;&amp; self.mq( '(min-width: 567px) and (max-width: 768px)' ) ){
              $slide.find( '.gallery-item.normal').each(function(){
                var $item = $(this);

                self.log( $item.outerHeight(true) , $slide.find('.gallery-item.plate').first().height() );

                if ( $item.outerHeight( true ) &gt;  $slide.find('.gallery-item.plate').first().height() ) {
                  $slide.find('.gallery-item.plate').first().css({
                    'max-height' : $item.outerHeight(true),
                    'height'     : $item.outerHeight(true)
                  });
                }
              });
            }
            self.log( 'Setting new tile height on gallery items, ' , $slide.find('.gallery-item.plate').first().height(), tileHeight  , self.mq('(min-width: 769px)'));*/</span>
          }

          <span class="keyword">switch</span>( slideVariation ){
            <span class="keyword">case</span> <span class="string">'5up'</span>:
              <span class="keyword">if</span>(isFullView){
                newHeight = $normalTile.outerHeight(<span class="literal">true</span>) + $normalTile.find(<span class="string">'.product-img'</span>).height();
                $mediumTile.css({
                  <span class="string">'height'</span> : newHeight + <span class="string">'px'</span>
                });
              }<span class="keyword">else</span>{
                newHeight = $slide.find(<span class="string">'.plate'</span>).height() + $normalTile.find(<span class="string">'.product-img'</span>).height() + parseInt( $normalTile.css(<span class="string">'marginTop'</span>), radix );
                $mediumTile.css({
                  <span class="string">'height'</span> : newHeight + <span class="string">'px'</span>
                });
              }
            <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'4up'</span>:
              <span class="keyword">if</span>(isFullView){
                newHeight = $slide.find(<span class="string">'.plate'</span>).height() + $normalTile.find(<span class="string">'.product-img'</span>).height() + parseInt( $normalTile.css(<span class="string">'marginTop'</span>), radix );
                $mediumTile.css({
                  <span class="string">'height'</span> : newHeight + <span class="string">'px'</span>
                });
              }<span class="keyword">else</span>{
                newHeight = $normalTile.outerHeight(<span class="literal">true</span>) + $normalTile.find(<span class="string">'.product-img'</span>).height();
                $mediumTile.css(<span class="string">'height'</span> , newHeight);
              }
            <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'3up'</span>:
              <span class="keyword">if</span>(isFullView){
                newHeight = $slide.find(<span class="string">'.plate'</span>).height() + $normalTile.find(<span class="string">'.product-img'</span>).height() + parseInt( $normalTile.css(<span class="string">'marginTop'</span>), radix );
                $mediumTile.css({
                  <span class="string">'height'</span> : newHeight + <span class="string">'px'</span>
                });
              }<span class="keyword">else</span>{
                $mediumTile.css(<span class="string">'height'</span> , <span class="string">''</span>);
              }
            <span class="keyword">break</span>;
          }
        });

        setTimeout( <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
          self.updateSliderSize();
        } , <span class="number">250</span>);

      },

      animateTiles: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>,
        totalAnimationDelay = <span class="number">0</span>;

        self.$el.removeClass(<span class="string">'redrawing'</span>);

        <span class="keyword">if</span>(self.oldIE){
          <span class="keyword">return</span>;
        }

        self.$galleryItems.not(<span class="string">'.blank'</span>).each(<span class="keyword">function</span>(){

          <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
          animationDelay = <span class="number">0</span>;

          $item.css({
            visibility : <span class="string">'visible'</span>
          });

          animationDelay = $item.hasClass(<span class="string">'plate'</span>) ? <span class="number">0</span> : $item.hasClass(<span class="string">'medium'</span>) ? <span class="number">25</span> : <span class="number">2000</span>;

          <span class="keyword">if</span>($item.hasClass(<span class="string">'plate'</span>) === <span class="literal">true</span>){
            animationDelay = <span class="number">0</span>;
          }<span class="keyword">else</span> <span class="keyword">if</span>($item.hasClass(<span class="string">'medium'</span>) === <span class="literal">true</span>){
             animationDelay = <span class="number">150</span>;
          }<span class="keyword">else</span>{
             animationDelay = <span class="number">250</span> + Math.floor(Math.random() * <span class="number">500</span>);
          }

          totalAnimationDelay += animationDelay;

          $item.stop(<span class="literal">true</span>,<span class="literal">true</span>).delay(animationDelay).animate({ opacity: <span class="number">1</span> },{ duration: <span class="number">250</span> , complete: <span class="keyword">function</span>(){}});

        });

        totalAnimationDelay = Math.min( <span class="number">750</span> , totalAnimationDelay );

        <span class="keyword">if</span>( totalAnimationDelay &gt; <span class="number">0</span> ){
          setTimeout( <span class="keyword">function</span>(){
            self.$pagination.stop(<span class="literal">true</span>,<span class="literal">true</span>).fadeIn(<span class="number">250</span>);
          }, totalAnimationDelay );
        }<span class="keyword">else</span>{
           self.$pagination.stop(<span class="literal">true</span>,<span class="literal">true</span>).fadeIn(<span class="number">250</span>);
        }

      },

      initMobileBreakpoint: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Cancel touch events for the 'slideshow'</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.off(self.downEvent);

</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>hide paddles and nav</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$paddles.hide();

</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>hide navigation dots</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$pagination.hide();

</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>attemp to place the title plates in the first position before detaching</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$slides.each(<span class="keyword">function</span>(){
          <span class="keyword">var</span> $s = $(<span class="keyword">this</span>),
          $plate = $s.find(<span class="string">'.plate'</span>).eq(<span class="number">0</span>);

</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>put the title plate at the beginning</p>             </td>             <td class="code">               <div class="highlight"><pre>          $s.prepend($plate);
        });

</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>gather gallery items and save local reference - may need to set on self</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$galleryItems.detach().addClass(<span class="string">'small-size'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>remove the slides</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$slides.detach();

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>clear out the position style on the gallery items</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$galleryItems.removeAttr(<span class="string">'style'</span>);

        self.$galleryItems.addClass(<span class="string">'mobile-item'</span>).first().removeClass(<span class="string">'mobile-item'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>put the item back into the container / make sure to not include blanks</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$galleryItems.not(<span class="string">'.blank'</span>).appendTo(self.$container);

        self.$el.find(<span class="string">'.gallery-item.medium'</span>).css(<span class="string">'height'</span> , <span class="string">''</span>);
        self.$el.find(<span class="string">'.gallery-item.medium .product-img'</span>).css(<span class="string">'height'</span> , <span class="string">''</span>);

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>init the scroller module</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>(){

          <span class="keyword">if</span>(self.scrollerModule !== <span class="literal">null</span>){
            self.scrollerModule.destroy();
            self.scrollerModule = <span class="literal">null</span>;
          }

          self.scrollerModule = self.$el.find(<span class="string">'.rp-overflow'</span>).scrollerModule({
            contentSelector: <span class="string">'.rp-container'</span>,
            itemElementSelector: <span class="string">'.gallery-item'</span>,
            mode: <span class="string">'free'</span>,
            lastPageCenter: <span class="literal">false</span>,
            extraSpacing: <span class="number">0</span>,

            iscrollProps: {
              snap: <span class="literal">false</span>,
              hScroll: <span class="literal">true</span>,
              vScroll: <span class="literal">false</span>,
              hScrollbar: <span class="literal">false</span>,
              vScrollbar: <span class="literal">false</span>,
              momentum: <span class="literal">true</span>,
              bounce: <span class="literal">true</span>,
              onScrollEnd: <span class="literal">null</span>,
              lockDirection:<span class="literal">true</span>,
              onBeforeScrollStart:<span class="literal">null</span>
            }

          }).data(<span class="string">'scrollerModule'</span>);

          self.$galleryItems.find(<span class="string">'.product-name'</span>).evenHeights();
          self.$el.find(<span class="string">'.gallery-item.medium'</span>).css(<span class="string">'height'</span> , <span class="string">''</span>);
          self.$el.find(<span class="string">'.gallery-item.medium .product-img'</span>).css(<span class="string">'height'</span> , <span class="string">''</span>);

          window.iQ.update();
        }, <span class="number">100</span>);
        
      },

      setNameHeights : <span class="keyword">function</span>( $container ) {
        <span class="keyword">var</span> nameMaxHeight = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Set the height of the product name + model because the text can wrap and make it taller</p>             </td>             <td class="code">               <div class="highlight"><pre>        $container
          .find(<span class="string">'.product-name-wrap'</span>)
          .css(<span class="string">'height'</span>, <span class="string">''</span>) <span class="comment">// remove heights in case they've been set before</span>
          .each(<span class="keyword">function</span>() {
            <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
                height = parseFloat( $<span class="keyword">this</span>.css(<span class="string">'height'</span>) );

            <span class="keyword">if</span> ( height &gt; nameMaxHeight ) {
              nameMaxHeight = height;
            }
          })
          .css(<span class="string">'height'</span>, nameMaxHeight);

        <span class="keyword">return</span> <span class="keyword">this</span>;
      },

      setupEasing: <span class="keyword">function</span>(){
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Define easing equations</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.css3Easing = {
            easeOutSine     : <span class="string">'cubic-bezier(0.390, 0.575, 0.565, 1.000)'</span>,
            easeInOutSine   : <span class="string">'cubic-bezier(0.445, 0.050, 0.550, 0.950)'</span>,
            easeOutBack     : <span class="string">'cubic-bezier(0.595, -0.160, 0.255, 1.140)'</span>,
            sonyScrollEase  : <span class="string">'cubic-bezier(0.33,0.66,0.66,1)'</span>
        };
      }
    };

</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Related Products definition on jQuery</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.relatedProducts = <span class="keyword">function</span>(options) {
      <span class="keyword">var</span> args = arguments;

      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>(){
        <span class="keyword">var</span> self = $(<span class="keyword">this</span>);
        <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">"object"</span> ||  !options) {
          <span class="keyword">if</span>( !self.data(<span class="string">'relatedProducts'</span>) ) {
            self.data(<span class="string">'relatedProducts'</span>, <span class="keyword">new</span> RelatedProducts(self, options));
          }
        } <span class="keyword">else</span> {
          <span class="keyword">var</span> relatedProducts = self.data(<span class="string">'relatedProducts'</span>);
          <span class="keyword">if</span> (relatedProducts &amp;&amp; relatedProducts[options]) {
              <span class="keyword">return</span> relatedProducts[options].apply(relatedProducts, Array.prototype.slice.call(args, <span class="number">1</span>));
          }
        }
      });
    };

</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Defaults for the related products</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.relatedProducts.defaults = {
      throttleTime: <span class="number">50</span>,
      autoScaleContainer: <span class="literal">true</span>,
      minSlideOffset: <span class="number">10</span>,
      navigationControl: <span class="string">'bullets'</span>
    };
    
</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Listen for global sony ready event</p>             </td>             <td class="code">               <div class="highlight"><pre>    SONY.on(<span class="string">'global:ready'</span>, <span class="keyword">function</span>(){
      $(<span class="string">'.related-products'</span>).relatedProducts();
    });

 })(SONY,jQuery, Modernizr, window,<span class="literal">undefined</span> , window.console);


<span class="comment">/*
  Tab system for managing multiple
  instances of related products
*/</span>
$(<span class="keyword">function</span>(){
  <span class="comment">/*
    figure out tabbed stuff here and let that
    module instantiate the related products that its bound to
  */</span>

  <span class="keyword">if</span>($(<span class="string">'.rp-container-tabbed'</span>).length === <span class="number">0</span>){
    $(<span class="string">'.rp-tabs'</span>).hide();
    <span class="keyword">return</span>;
  }

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Get transitionend event name</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> transEndEventNames = {
      <span class="string">'WebkitTransition'</span> : <span class="string">'webkitTransitionEnd'</span>,
      <span class="string">'MozTransition'</span>    : <span class="string">'transitionend'</span>,
      <span class="string">'OTransition'</span>      : <span class="string">'oTransitionEnd'</span>,
      <span class="string">'msTransition'</span>     : <span class="string">'MSTransitionEnd'</span>,
      <span class="string">'transition'</span>       : <span class="string">'transitionend'</span>
  },
  transitionEndName;
  transitionEndName = transEndEventNames[ window.Modernizr.prefixed(<span class="string">'transition'</span>) ];

  <span class="keyword">var</span> $tabs = $(<span class="string">'.rp-tabs'</span>).find(<span class="string">'.rp-tab'</span>),
      currentPanelId = <span class="number">1</span>,
      $currentPanel = $(<span class="string">'.related-products[data-rp-panel-id='</span> + currentPanelId + <span class="string">']'</span>),
      $productPanels = $(<span class="string">'.related-products[data-rp-panel-id]'</span>);

  $productPanels.not($currentPanel).css({
    <span class="string">'opacity'</span> : <span class="number">0</span>,
    <span class="string">'z-index'</span> : <span class="number">0</span>
  });

  $currentPanel.css({
    <span class="string">'z-index'</span> : <span class="number">1</span>
  });

  $tabs.eq(<span class="number">0</span>).addClass(<span class="string">'active'</span>);

  <span class="keyword">if</span>($tabs.length &gt; <span class="number">0</span>){
    <span class="keyword">var</span> handleTabClick = <span class="keyword">function</span>(e){
      <span class="keyword">var</span> $tab = $(<span class="keyword">this</span>),
      visibleObj = <span class="keyword">function</span>(visibleBool , zIndx){
        <span class="keyword">var</span> cssO = {<span class="string">'visibility'</span> : visibleBool === <span class="literal">true</span> ? <span class="string">'visible'</span> : <span class="string">'hidden'</span>};
        <span class="keyword">if</span>(zIndx !== <span class="literal">undefined</span>){
          cssO.zIndex = zIndx;
        }
        <span class="keyword">return</span> cssO;
      };

      e.preventDefault();
      $tabs.removeClass(<span class="string">'active'</span>);
      $tab.addClass(<span class="string">'active'</span>);

      newPanelId = $tab.data(<span class="string">'rpPanelId'</span>);

      <span class="keyword">if</span>(newPanelId === currentPanelId) {
        <span class="keyword">return</span>;
      }
      $oldPanel = $currentPanel;
      currentPanelId = newPanelId;
      $currentPanel = $(<span class="string">'.related-products[data-rp-panel-id='</span>+ currentPanelId +<span class="string">']'</span>);

      $oldPanel.css(visibleObj(<span class="literal">true</span>, <span class="number">1</span>));
      $oldPanel.stop(<span class="literal">true</span>,<span class="literal">true</span>).animate({ opacity: <span class="number">0</span> },{ duration: <span class="number">500</span> , delay: <span class="number">0</span> , complete: <span class="keyword">function</span>(){
        $oldPanel.css(visibleObj(<span class="literal">false</span>, <span class="number">0</span>));
        $oldPanel.data(<span class="string">'relatedProducts'</span>).disableShuffle();
      }});

      $currentPanel.css(visibleObj(<span class="literal">true</span>, <span class="number">1</span>));
      $currentPanel.data(<span class="string">'relatedProducts'</span>).enableShuffle();
      $currentPanel.stop(<span class="literal">true</span>,<span class="literal">true</span>).animate({ opacity: <span class="number">1</span> },{ duration: <span class="number">500</span>});
    };

    $tabs.on(window.Modernizr.touch ? <span class="string">'touchend'</span> : <span class="string">'click'</span> , handleTabClick);
  }

});



</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 