<!DOCTYPE html>  <html> <head>   <title>sony-draggable.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brightcove-builder.html">                 brightcove-builder.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="hotspot_explorer.html">                 hotspot_explorer.js               </a>                                           <a class="source" href="jquery.viewport.html">                 jquery.viewport.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="related-products.html">                 related-products.js               </a>                                           <a class="source" href="sony-gallery.html">                 sony-gallery.js               </a>                                           <a class="source" href="sony-one-carousel.html">                 sony-one-carousel.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="exports.html">                 exports.js               </a>                                           <a class="source" href="global-init.html">                 global-init.js               </a>                                           <a class="source" href="global-nav.html">                 global-nav.js               </a>                                           <a class="source" href="iq.html">                 iq.js               </a>                                           <a class="source" href="jquery.throttle-debounce.html">                 jquery.throttle-debounce.js               </a>                                           <a class="source" href="sony-iscroll.html">                 sony-iscroll.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sony-draggable.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Sony Draggable Object (SonyDraggable) Module</h2>

<ul>
<li><strong>Class:</strong> SonyDraggable</li>
<li><strong>Version:</strong> 0.1</li>
<li><strong>Modified:</strong> 01/23/2013</li>
<li><strong>Author:</strong> George Pantazis</li>
<li><strong>Dependencies:</strong> jQuery 1.7+</li>
</ul>

<p><em>Notes:</em></p>

<p>This plugin is based loosely on the API of <a href="http://api.jqueryui.com/draggable">jQuery UI Draggable</a>,
and serves as a bare(ish)-bones class to satisfy the needs of the Dual Viewer (E9).</p>

<p><em>Example Usage:</em></p>

<pre><code> $('#foo').sonyDraggable({
   'axis': 'x',
   'unit': '%',
   'containment': $('#foo-wrapper'),
   'drag': self.beingDragged,
   'bounds': { x: { 'mix': 10, 'max': 90 } }
 });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
(<span class="keyword">function</span>($) {

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> _startEvents = <span class="string">'mousedown.sonyDraggable touchstart.sonyDraggable'</span>,
      _endEvents = <span class="string">'mouseup.sonyDraggable touchend.sonyDraggable'</span>,
      _moveEvents = <span class="string">'mousemove.sonyDraggable touchmove.sonyDraggable'</span>;

  <span class="keyword">var</span> SonyDraggable = <span class="keyword">function</span>($element, options){

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $.extend(self, {}, $.fn.sonyDraggable.defaults, options);

    self.$win = $(window);
    self.$el = $element;
    self.$containment = $(self.containment);

    self.init();
  };

  SonyDraggable.prototype = {

    <span class="string">'constructor'</span>: SonyDraggable,

    <span class="string">'init'</span>: <span class="keyword">function</span>() {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$containment.on(_startEvents, $.proxy(self.onScrubStart, self));
      self.$containment.on(_endEvents + <span class="string">' click.sonyDraggable'</span>, $.proxy(self.onScrubEnd, self));
      self.$win.on(_endEvents, $.proxy(self.onScrubEnd, self));

      self.setDimensions();
      self.setPositions();
    },

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>On scrubbing start, cache (or re-cache) the relevant dimensions with setDimensions(),
cache the new interaction's start position, then bind for movement onto onScrubbing().</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'onScrubStart'</span>: <span class="keyword">function</span>(e) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $<span class="keyword">this</span> = $(e.target);

      <span class="keyword">if</span> ( self.$el.has($<span class="keyword">this</span>).length === <span class="number">0</span> ) {
        <span class="keyword">return</span>;
      }

      e.preventDefault();

      self.setDimensions();
      self.handleStartPosition = self.getPagePosition(e);

      self.$containment.on(_moveEvents, $.proxy(self.onScrubbing, self));
    },

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Crunch some vectors to compute the handle's position relative to the user's click/touch.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'onScrubbing'</span>: <span class="keyword">function</span>(e) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      e.preventDefault();

      self.handlePosition.x = self.scrubberLeft + self.getPagePosition(e).x - self.handleStartPosition.x;
      self.handlePosition.y = self.scrubberTop + self.getPagePosition(e).y - self.handleStartPosition.y;

      self.setPositions();
    },

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>User interaction complete; unbind movement events.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'onScrubEnd'</span>: <span class="keyword">function</span>(e) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      e.preventDefault();

      self.$containment.off(_moveEvents);
    },

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Applies the user-defined boundaries to a given position. The <em>which</em> parameter defines the x/y axis.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'getConstrainedBounds'</span>: <span class="keyword">function</span>(val, which) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.bounds &amp;&amp; self.bounds[which] ) {
        <span class="keyword">if</span> ( val &lt; self.bounds[which].min ) {
          <span class="keyword">return</span> self.bounds[which].min;
        } <span class="keyword">else</span> <span class="keyword">if</span> ( val &gt; self.bounds[which].max ) {
          <span class="keyword">return</span> self.bounds[which].max;
        }
      }

      <span class="keyword">return</span> val;
    },

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Smooths out different event data for desktop and touch users, returns a consistent pageX/Y.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'getPagePosition'</span>: <span class="keyword">function</span>(e) {

      <span class="keyword">if</span> ( !e.pageX &amp;&amp; !e.originalEvent ) {
        <span class="keyword">return</span>;
      }

      <span class="keyword">return</span> {
        <span class="string">'x'</span>: (e.pageX || e.originalEvent.touches[<span class="number">0</span>].pageX),
        <span class="string">'y'</span>: (e.pageY || e.originalEvent.touches[<span class="number">0</span>].pageY)
      };
    },

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Reposition the handle based on mouse movement, or may be called at init for initial placement.
Also broadcasts the new position via the self.drag() callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'setPositions'</span>: <span class="keyword">function</span>(){

      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          newX, newY;

      <span class="keyword">if</span> ( self.unit === <span class="string">'px'</span> ) {
        <span class="keyword">if</span> ( self.axis.search(<span class="string">'x'</span>) &gt;= <span class="number">0</span> ) {
          newX = self.handlePosition.x;
        }
        <span class="keyword">if</span> ( self.axis.search(<span class="string">'y'</span>) &gt;= <span class="number">0</span> ) {
          newY = self.handlePosition.y;
        }
      }

      <span class="keyword">if</span> ( self.unit === <span class="string">'%'</span> ) {
        <span class="keyword">if</span> ( self.axis.search(<span class="string">'x'</span>) &gt;= <span class="number">0</span> ) {
          newX = ((self.handlePosition.x) / self.containmentWidth * <span class="number">100</span>);
        }
        <span class="keyword">if</span> ( self.axis.search(<span class="string">'y'</span>) &gt;= <span class="number">0</span> ) {
          newY = ((self.handlePosition.y) / self.containmentHeight * <span class="number">100</span>);
        }
      }

      newX = self.getConstrainedBounds(newX, <span class="string">'x'</span>);
      newY = self.getConstrainedBounds(newY, <span class="string">'y'</span>);

      self.$el.css({
        <span class="string">'left'</span>: newX + self.unit,
        <span class="string">'top'</span>: newY + self.unit
      });

      self.drag({
        <span class="string">'position'</span>: {
          <span class="string">'left'</span>: newX,
          <span class="string">'top'</span>: newY
        }
      });
    },

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Caches important dimensions and positions.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'setDimensions'</span>: <span class="keyword">function</span>() {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.containmentWidth = self.$containment.width();
      self.containmentHeight = self.$containment.height();
      self.scrubberLeft = self.$el.position().left;
      self.scrubberTop = self.$el.position().top;
    },

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Allows other classes to reset the handle's position if needed, by calling:</p>

<pre><code> $('#foo').sonyDraggable('setBounds', {...});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="string">'setBounds'</span>: <span class="keyword">function</span>(newBounds) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.bounds = newBounds;
      self.setPositions();
    }

  };

  $.fn.sonyDraggable = <span class="keyword">function</span>( options ) {
    <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
        sonyDraggable = self.data(<span class="string">'sonyDraggable'</span>);

      <span class="keyword">if</span> ( !sonyDraggable ) {
          sonyDraggable = <span class="keyword">new</span> SonyDraggable( self, options );
          self.data( <span class="string">'sonyDraggable'</span>, sonyDraggable );
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> options === <span class="string">'string'</span> ) {
        sonyDraggable[ options ].apply( sonyDraggable, args );
      }
    });
  };

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>Defaults</h2>             </td>             <td class="code">               <div class="highlight"><pre>
  $.fn.sonyDraggable.defaults = {
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Define the axes along which the handle may be dragged.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="string">'axis'</span>: <span class="string">'xy'</span>,
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>'px' or '%' based positioning for handle / callback coords.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="string">'unit'</span>: <span class="string">'px'</span>,
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Initial position of handle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="string">'handlePosition'</span>: {
      <span class="string">'x'</span>: <span class="number">0</span>,
      <span class="string">'y'</span>: <span class="number">0</span>
    },
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Callback for drag motion, may be used to reposition other elements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="string">'drag'</span>: <span class="keyword">function</span>(){}
  };

})(jQuery);

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 