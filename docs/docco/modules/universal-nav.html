<!DOCTYPE html>  <html> <head>   <title>universal-nav.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="alert-module.html">                 alert-module.js               </a>                                           <a class="source" href="country-region-selection-z10.html">                 country-region-selection-z10.js               </a>                                           <a class="source" href="demo-x99.html">                 demo-x99.js               </a>                                           <a class="source" href="editorial-carousel-e13.html">                 editorial-carousel-e13.js               </a>                                           <a class="source" href="editorial-chapters-e5.html">                 editorial-chapters-e5.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="hotspots-controller.html">                 hotspots-controller.js               </a>                                           <a class="source" href="editorial-layouts-e1.html">                 editorial-layouts-e1.js               </a>                                           <a class="source" href="editorial-slideshows-e4.html">                 editorial-slideshows-e4.js               </a>                                           <a class="source" href="footnotes-module.html">                 footnotes-module.js               </a>                                           <a class="source" href="gallery-g2-g3.html">                 gallery-g2-g3.js               </a>                                           <a class="source" href="global-header-footer.html">                 global-header-footer.js               </a>                                           <a class="source" href="light-compare-d9.html">                 light-compare-d9.js               </a>                                           <a class="source" href="one-sony-carousel-s2.html">                 one-sony-carousel-s2.js               </a>                                           <a class="source" href="pdp-slideshow-d4.html">                 pdp-slideshow-d4.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="product-details-d5.html">                 product-details-d5.js               </a>                                           <a class="source" href="product-summary-d1-d2.html">                 product-summary-d1-d2.js               </a>                                           <a class="source" href="recently-viewed.html">                 recently-viewed.js               </a>                                           <a class="source" href="related-products-g1.html">                 related-products-g1.js               </a>                                           <a class="source" href="reviews-awards-d6.html">                 reviews-awards-d6.js               </a>                                           <a class="source" href="secondary-touts-s1-s4.html">                 secondary-touts-s1-s4.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="subnavigation-n4.html">                 subnavigation-n4.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="universal-nav.html">                 universal-nav.js               </a>                                           <a class="source" href="unsupported-z19.html">                 unsupported-z19.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="whats-new-tout-s4.html">                 whats-new-tout-s4.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               universal-nav.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/* Universal Nav - Stand-Alone */</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Universal Nav ------------
Module: Universal Nav
Version: 1.0
Modified: 2013-04-19 by Christopher Mischler</p>

<h2>Dependencies: jQuery 1.7+</h2>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="keyword">var</span> UNAV = ( <span class="keyword">function</span>(window, document, $, <span class="literal">undefined</span>){
  
  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> _init = <span class="keyword">function</span>($triggerLink, $pageWrapInner, $pageWrapOuter){

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>console.log("UNAV init");</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="keyword">var</span> _cssTransitions = _browserCssTransitionDetect(),
      $uNav = $(<span class="string">'#universal-nav'</span>),
      $uNavPrimary = $uNav.find(<span class="string">'.u-nav-primary'</span>),
      $firstChild = $uNavPrimary.children().first(),
      $closeBtn = $(<span class="string">'#u-nav-close-btn'</span>),
      uNavColWidth = $firstChild.outerWidth(),
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>So we don't have to download the images before we can figure out how high the module will be,
we need to figure out the height the image should be at this width, based on current browser width.
So based on the image aspect ratio, what height should the image be at this width?</p>             </td>             <td class="code">               <div class="highlight"><pre>      uNav2highImgHeight = uNavColWidth * <span class="number">0.887538</span>,
      uNavColHeight = uNav2highImgHeight + $firstChild.find(<span class="string">'.u-nav-primary-caption'</span>).outerHeight(<span class="literal">true</span>),
      uNavOuterHeight;

    $firstChild.height(uNavColHeight + <span class="string">"px"</span>);
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>now they we set the height of the images container, we can grab the height of the entire u-nav for our js.</p>             </td>             <td class="code">               <div class="highlight"><pre>    setTimeout(<span class="keyword">function</span>(){
      uNavOuterHeight = $uNav.outerHeight();
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>console.log("uNavOuterHeight: " + uNavOuterHeight);</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout(<span class="keyword">function</span>(){
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>once we have the outerheight, clear the custom height from the $firstChild so it's back to the natural flow.
delays just to make sure the new heights are set before the next step.</p>             </td>             <td class="code">               <div class="highlight"><pre>        $firstChild.css(<span class="string">'height'</span>,<span class="string">''</span>);
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>set the height to make sure there aren't rounding errors, where 'top' and 'height' are 1px off, and you can see a little of the </p>             </td>             <td class="code">               <div class="highlight"><pre>        $uNav.css(<span class="string">'top'</span>,<span class="string">'-'</span> + uNavOuterHeight + <span class="string">'px'</span>);
      },<span class="number">5</span>);
    },<span class="number">5</span>);

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <ul>
<li>At least jQuery 1.7 is needed to use $.on() - if using an older version, changing these to $.bind() should work.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    $triggerLink.on(<span class="string">'click'</span>,<span class="keyword">function</span>(e){
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>console.log("$triggerLink");</p>             </td>             <td class="code">               <div class="highlight"><pre>      e.preventDefault();
      <span class="keyword">if</span> ($pageWrapOuter.hasClass(<span class="string">'unav-open'</span>)){
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>console.log("Nav is open.");</p>             </td>             <td class="code">               <div class="highlight"><pre>        _closeUNav();
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>console.log("Nav is closed.");</p>             </td>             <td class="code">               <div class="highlight"><pre>        _openUNav();
      }
    });

    $closeBtn.on(<span class="string">'click'</span>,<span class="keyword">function</span>(e){
      e.preventDefault();
      _closeUNav();
    });



    <span class="function"><span class="keyword">function</span> <span class="title">_openUNav</span><span class="params">()</span>{</span>
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>console.log("_openUNav");</p>             </td>             <td class="code">               <div class="highlight"><pre>
      $pageWrapOuter.addClass(<span class="string">'unav-open unav-open-until-transition-end'</span>);
      <span class="keyword">if</span> (_cssTransitions){
        $pageWrapInner.css(<span class="string">'margin-top'</span>, uNavOuterHeight + <span class="string">'px'</span>);
      } <span class="keyword">else</span> {
        $pageWrapInner.animate({ <span class="string">'marginTop'</span>: uNavOuterHeight + <span class="string">'px'</span>}, <span class="number">400</span>);
      }

      setTimeout(<span class="keyword">function</span>() {
        $triggerLink.blur();
      }, <span class="number">1</span>);
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_closeUNav</span><span class="params">()</span>{</span>
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>console.log("_closeUNav");</p>             </td>             <td class="code">               <div class="highlight"><pre>
      $pageWrapInner.one(<span class="string">'transitionend webkitTransitionEnd oTransitionEnd otransitionend'</span>, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>console.log("$pageWrapInner transitionend");</p>             </td>             <td class="code">               <div class="highlight"><pre>        $pageWrapOuter.removeClass(<span class="string">'unav-open-until-transition-end'</span>);
        $triggerLink.add($closeBtn).blur();
      });      

      $pageWrapOuter.removeClass(<span class="string">'unav-open'</span>);
      <span class="keyword">if</span> (_cssTransitions){
        $pageWrapInner.css(<span class="string">'margin-top'</span>, <span class="string">'0px'</span>);
      } <span class="keyword">else</span> {
        $pageWrapInner.animate({ <span class="string">'marginTop'</span>: <span class="string">'0px'</span>}, <span class="number">400</span>,  <span class="keyword">function</span>(){
          $pageWrapOuter.removeClass(<span class="string">'unav-open-until-transition-end'</span>);
          $triggerLink.add($closeBtn).blur();
        });
      }
    }

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>in case Modernizr isn't available, let's do our own check for css transitions.
via http://stackoverflow.com/questions/7264899/detect-css-transitions-using-javascript-and-without-modernizr</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="function"><span class="keyword">function</span> <span class="title">_browserCssTransitionDetect</span><span class="params">()</span>{</span>
      <span class="keyword">var</span> s = document.createElement(<span class="string">'p'</span>).style,
        supportsTransitions = <span class="string">'transition'</span> <span class="keyword">in</span> s ||
                              <span class="string">'WebkitTransition'</span> <span class="keyword">in</span> s ||
                              <span class="string">'MozTransition'</span> <span class="keyword">in</span> s ||
                              <span class="string">'msTransition'</span> <span class="keyword">in</span> s ||
                              <span class="string">'OTransition'</span> <span class="keyword">in</span> s;
      <span class="keyword">return</span> supportsTransitions;
    }

  }; <span class="comment">// end _init</span>


  <span class="keyword">return</span> {
    init: _init
  };

})(window, document, jQuery);


</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Document.ready call</p>             </td>             <td class="code">               <div class="highlight"><pre>$(<span class="keyword">function</span>(){
  <span class="keyword">if</span> ($(<span class="string">'#universal-nav'</span>).length){
    UNAV.init($(<span class="string">'#nav-li-link-universal'</span>), $(<span class="string">'#page-wrap-inner'</span>), $(<span class="string">'#page-wrap-outer'</span>));
  }
});


</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 