<!DOCTYPE html>  <html> <head>   <title>gallery-g2-g3.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="editorial-carousel-e13.html">                 editorial-carousel-e13.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="editorial-e1-e15.html">                 editorial-e1-e15.js               </a>                                           <a class="source" href="hotspots-controller.html">                 hotspots-controller.js               </a>                                           <a class="source" href="footnotes-module.html">                 footnotes-module.js               </a>                                           <a class="source" href="gallery-g2-g3.html">                 gallery-g2-g3.js               </a>                                           <a class="source" href="global-header-footer.html">                 global-header-footer.js               </a>                                           <a class="source" href="one-sony-carousel-s2.html">                 one-sony-carousel-s2.js               </a>                                           <a class="source" href="pdp-slideshow-d04_2.html">                 pdp-slideshow-d04_2.js               </a>                                           <a class="source" href="pdp-slideshow-d4.html">                 pdp-slideshow-d4.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="product-details-d5.html">                 product-details-d5.js               </a>                                           <a class="source" href="product-summary-d1-d2.html">                 product-summary-d1-d2.js               </a>                                           <a class="source" href="recently-viewed.html">                 recently-viewed.js               </a>                                           <a class="source" href="related-products-g1.html">                 related-products-g1.js               </a>                                           <a class="source" href="reviews-awards-d6.html">                 reviews-awards-d6.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               gallery-g2-g3.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*global define, Modernizr, log*/</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Gallery ------------
Module: Gallery
Version: 1.0
Modified: 03/02/2013
Dependencies: jQuery 1.7+, Modernizr</p>

<h2>Author: Glen Cheney</h2>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require){

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
      iQ = require(<span class="string">'iQ'</span>),
      bootstrap = require(<span class="string">'bootstrap'</span>),
      Settings = require(<span class="string">'require/sony-global-settings'</span>),
      Environment = require(<span class="string">'require/sony-global-environment'</span>),
      Utilities = require(<span class="string">'require/sony-global-utilities'</span>),
      jqueryShuffle = require(<span class="string">'secondary/index'</span>).jqueryShuffle,
      scroller = require(<span class="string">'secondary/index'</span>).sonyScroller,
      sonyEvenHeights = require(<span class="string">'secondary/index'</span>).sonyEvenHeights,
      sonyTab = require(<span class="string">'secondary/index'</span>).sonyTab,
      sonyStickyTabs = require(<span class="string">'secondary/index'</span>).sonyStickyTabs,
      jquerySimpleScroll = require(<span class="string">'secondary/index'</span>).jquerySimpleScroll,
      rangeControl = require(<span class="string">'secondary/jodo.rangecontrol.1.4'</span>);

  <span class="keyword">var</span> module = {

    init: <span class="keyword">function</span>() {

      <span class="keyword">if</span> ( $(<span class="string">'.gallery'</span>).length &gt; <span class="number">0</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Initialize galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>        $(<span class="string">'.gallery'</span>).each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Stagger gallery initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="keyword">function</span>() {
            <span class="keyword">var</span> id = $<span class="keyword">this</span>.attr(<span class="string">'id'</span>).substring( <span class="number">0</span>, $<span class="keyword">this</span>.attr(<span class="string">'id'</span>).lastIndexOf(<span class="string">'-'</span>) );
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>console.time( id );</p>             </td>             <td class="code">               <div class="highlight"><pre>            $<span class="keyword">this</span>.gallery( $<span class="keyword">this</span>.data() );
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>console.timeEnd( id );</p>             </td>             <td class="code">               <div class="highlight"><pre>          }, <span class="number">0</span>);
        });

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Register for tab show(n) events here because not all tabs are galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>        $(<span class="string">'[data-tab]'</span>)
          .on(<span class="string">'show'</span>, module.onGalleryTabShow )
          .on(<span class="string">'shown'</span>, module.onGalleryTabShown );

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Initialize sticky tabs</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.requestAnimationFrame(<span class="keyword">function</span>() {
          $(<span class="string">'.tab-strip'</span>).stickyTabs();
        });

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The galleries are in timeouts, so this has to be too</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Hide other tabs</p>             </td>             <td class="code">               <div class="highlight"><pre>          $(<span class="string">'.tab-pane:not(.active)'</span>).addClass(<span class="string">'off-screen'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Should be called after everything is initialized</p>             </td>             <td class="code">               <div class="highlight"><pre>          $(window).trigger(<span class="string">'hashchange'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Disable hidden galleries.
Using a timeout here because the tab shown event is triggered at the end of the transition,
which depends on how long the page takes to load (and if the browser has transitions)</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="keyword">function</span>() {
            $(<span class="string">'.tab-pane:not(.active) .gallery'</span>).gallery(<span class="string">'disable'</span>);
          }, <span class="number">500</span>);
        }, <span class="number">16</span>);

      }
    }
  };

  <span class="keyword">var</span> Gallery = <span class="keyword">function</span>( $container, options ) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $.extend(self, $.fn.gallery.options, options, $.fn.gallery.settings);

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>jQuery objects</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$container = $container;
    self.$window = Settings.$window;
    self.id = self.$container[<span class="number">0</span>].id;
    self.$grid = self.$container.find(<span class="string">'.products'</span>);
    self.$filterOpts = self.$container.find(<span class="string">'.filter-options'</span>);
    self.$sortOpts = self.$container.find(<span class="string">'.sort-options'</span>);
    self.$filterColumns = self.$filterOpts.find(<span class="string">'.grid'</span>).children();
    self.$sortSelect = self.$container.find(<span class="string">'.sort-options select'</span>);
    self.$sortBtns = self.$container.find(<span class="string">'.sort-options .dropdown-menu a'</span>);
    self.$dropdownToggleText = self.$container.find(<span class="string">'.sort-options .js-toggle-text'</span>);
    self.$productCount = self.$container.find(<span class="string">'.product-count'</span>);
    self.$activeFilters = self.$container.find(<span class="string">'.active-filters'</span>);
    self.$filterArrow = self.$container.find(<span class="string">'.slide-arrow-under, .slide-arrow-over'</span>);
    self.$favorites = self.$grid.find(<span class="string">'.js-favorite'</span>);
    self.$gridProductNames = self.$grid.find(<span class="string">'.product-name-wrap'</span>);
    self.$carousels = self.$grid.find(<span class="string">'.js-item-carousel'</span>);
    self.$zeroMessage = self.$container.find(<span class="string">'.zero-products-message'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Modes</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.isEditorialMode = self.mode === <span class="string">'editorial'</span>;
    self.isDetailedMode = self.mode === <span class="string">'detailed'</span>;
    self.isCompareMode = self.mode === <span class="string">'compare'</span>;

    self.$compareBtn = self.$container.find(<span class="string">'.js-compare-toggle'</span>);
    self.$compareReset = self.$container.find(<span class="string">'.js-compare-reset'</span>);
    self.itemSelector = <span class="string">'.'</span> + ( self.isCompareMode ? <span class="string">'compare'</span> : <span class="string">'gallery'</span> ) + <span class="string">'-item'</span>;
    self.$items = self.$grid.find( self.itemSelector );

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>What do we have here?</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.hasInfiniteScroll = self.$container.find(<span class="string">'div.navigation a'</span>).length &gt; <span class="number">0</span>;
    self.hasFilters = self.$filterOpts.length &gt; <span class="number">0</span>;
    self.hasSorting = self.$sortBtns.length &gt; <span class="number">0</span>;
    self.hasCarousels = self.$carousels.length &gt; <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Other vars</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.windowWidth = Settings.windowWidth;
    self.windowHeight = Settings.windowHeight;

    self.setColumnMode();

    self.$container.addClass(<span class="string">'gallery-'</span> + self.mode);
</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Adding a class causes a style recalculation, let's throw in the column rearranging here too</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.isEditorialMode ) {
      self.shuffleGutters();
    }

    <span class="keyword">if</span> ( self.isEditorialMode || self.isDetailedMode ) {
      self.initShuffle();
    } <span class="keyword">else</span> {
      self.onGalleryLoading();
      self.initCompareGallery();
    }

    self.$window.on(<span class="string">'onorientationchange'</span>, $.debounce( <span class="number">325</span>, $.proxy( self.onResize, self ) ) );
    self.$window.on(<span class="string">'resize.gallery'</span>, $.debounce( <span class="number">325</span>, $.proxy( self.onResize, self ) ) );

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Infinite scroll?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
      self.initInfscr();
    }

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Initialize filter dictionaries to keep track of everything</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasFilters ) {
      self.initFilters();
    }

    <span class="keyword">if</span> ( self.hasSorting ) {
      self.initSorting();
    }

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Swatches and tooltips are triggered on hover, so they don't need to be
initialized immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>    setTimeout(<span class="keyword">function</span>() {
      self.initSwatches();
      self.initTooltips();
    }, <span class="number">200</span>);

    self.onResize( <span class="literal">true</span> );

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Compare mode doesn't have a shuffle plugin to execute the event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.isCompareMode ) {
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>self.$compareBtn.on('click', $.proxy( self.onCompareLaunch, self ));
self.$compareTool.on('hidden', $.proxy( self.onCompareClosed, self ));
self.$compareTool.on('shown', $.proxy( self.onCompareShown, self ));</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.onGalleryDoneLoading();
    }

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>We're done.</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.isInitialized = <span class="literal">true</span>;

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Run once</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasFilters ) {
</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Defer it, then wait until a good time for the browser</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout(<span class="keyword">function</span>() {
        window.requestAnimationFrame(<span class="keyword">function</span>() {
          self.filter();
        });
      }, <span class="number">400</span>);
    }

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Add the .iq-img class to hidden swatch images, then tell iQ to update itself</p>             </td>             <td class="code">               <div class="highlight"><pre>    setTimeout( $.proxy( self.loadSwatchImages, self ) , <span class="number">2000</span>);

    log(<span class="string">'SONY : Gallery : Initialized'</span>);

  };

  Gallery.prototype = {

    constructor: Gallery,

    enable : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Trigger the resize event. Maybe they changed tabs, resized, then changed back.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.onResize( <span class="literal">undefined</span>, <span class="literal">true</span> );

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Already enabled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.enabled ) {
        <span class="keyword">return</span>;
      }

      self.enabled = <span class="literal">true</span>;

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Enable shuffle, which triggers a layout update</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.isCompareMode ) {
        self.shuffle.enable();
      }

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Resume infinite scroll if it's there yo</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
        self.$grid.infinitescroll(<span class="string">'updateNavLocation'</span>);
        self.$grid.infinitescroll(<span class="string">'resume'</span>);
      }

      self.$container.removeClass(<span class="string">'disabled'</span>);

      <span class="keyword">if</span> ( self.hasEnabledCarousels ) {
        self.$carousels.scrollerModule(<span class="string">'enable'</span>);
        self.$carousels.scrollerModule(<span class="string">'refresh'</span>);
      }
    },

    disable : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Already disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.enabled ) {
        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Disable shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.isCompareMode ) {
        self.shuffle.disable();
      }

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Disable carousels</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasEnabledCarousels ) {
        self.$carousels.scrollerModule(<span class="string">'disable'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Pause infinite scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self &amp;&amp; self.hasInfiniteScroll ) {
        self.$grid.infinitescroll(<span class="string">'pause'</span>);
      }

      self.$container.addClass(<span class="string">'disabled'</span>);

      self.enabled = <span class="literal">false</span>;
    },

    filter : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          context,
          filterFunction = !self.isCompareMode ? self.$grid.shuffle : self.manualFilter,
          returnFilteredItem;

      <span class="keyword">if</span> ( self.isCompareMode ) {
        context = self;
        filterFunction = self.manualFilter;

      } <span class="keyword">else</span> {
        context = self.shuffle;
        filterFunction = self.shuffle.shuffle;
      }

</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>If there are active filters, we need to check each item to see if it passes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasActiveFilters() ) {
        returnFilteredItem = <span class="keyword">function</span>( $el ) {
          <span class="keyword">return</span> self.itemPassesFilters( $el.data() );
        };

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Otherwise, we just want to show them all</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        returnFilteredItem = <span class="string">'all'</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Run the filtering function</p>             </td>             <td class="code">               <div class="highlight"><pre>      filterFunction.call( context, returnFilteredItem );

      self
        .setFilterStatuses()
        .toggleZeroMessage();
    },

    manualFilter : <span class="keyword">function</span>( fn ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          deferreds = [],
          $items = self.$items,
          $filtered = $(),
          $concealed = $(),
          showAll = fn === <span class="string">'all'</span>,
          concealed = <span class="string">'concealed'</span>,
          filtered = <span class="string">'filtered'</span>;

      <span class="keyword">if</span> ( !showAll ) {
        $items.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
              passes = fn.call($item[<span class="number">0</span>], $item, self);

          <span class="keyword">if</span> ( passes ) {
            $filtered = $filtered.add( $item );
          }
        });

        $concealed = $items.not( $filtered );

      } <span class="keyword">else</span> {
        $filtered = $items;
      }

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Individually add/remove concealed/filtered classes</p>             </td>             <td class="code">               <div class="highlight"><pre>      $filtered.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $filteredItem = $(<span class="keyword">this</span>);

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Remove concealed if it's there</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( $filteredItem.hasClass( concealed ) ) {
            $filteredItem.removeClass( concealed );
            deferreds.push( self.showCompareItem( $filteredItem ) );
          }
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Add filtered class if it's not there</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !$filteredItem.hasClass( filtered ) ) {
            $filteredItem.addClass( filtered );
          }
      });
      $concealed.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $filteredItem = $(<span class="keyword">this</span>);
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Add concealed if it's not there</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !$filteredItem.hasClass( concealed ) ) {
            $filteredItem.addClass( concealed );
            deferreds.push( self.hideCompareItem( $filteredItem ) );
          }
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Remove filtered class if it's there</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( $filteredItem.hasClass( filtered ) ) {
            $filteredItem.removeClass( filtered );
          }
      });

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>When everything is done animating</p>             </td>             <td class="code">               <div class="highlight"><pre>      $.when.apply( $, deferreds ).always( $.proxy( self.onCompareFiltered, self ) );

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Kill it with fire!</p>             </td>             <td class="code">               <div class="highlight"><pre>      $items = $filtered = $concealed = <span class="literal">null</span>;
    },

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>From the element's data-* attributes, test to see if it passes</p>             </td>             <td class="code">               <div class="highlight"><pre>    itemPassesFilters : <span class="keyword">function</span>( data ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterName = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Loop through each filter in the elements filter set</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterName <span class="keyword">in</span> data.filterSet ) {
        <span class="keyword">if</span> ( !data.filterSet.hasOwnProperty(filterName) || !self.filterTypes[ filterName ] ) {
          <span class="keyword">continue</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>filterName e.g. 'price'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> filter = data.filterSet[ filterName ], <span class="comment">// e.g. 399.99</span>
            filterType = self.filterTypes[ filterName ], <span class="comment">// e.g. 'range'</span>
            activeFilters = self.filters[ filterType ][ filterName ]; <span class="comment">// e.g. ["lcd"]</span>

        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">var</span> method = $.isArray( filter ) ? <span class="string">'arrayContainsArray'</span> : <span class="string">'valueInArray'</span>;
          <span class="keyword">if</span> ( activeFilters.length &gt; <span class="number">0</span> &amp;&amp; !self[ method ]( filter, activeFilters ) ) {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          <span class="keyword">if</span> ( filter &lt; self.price.min || ( filter &gt; self.price.max &amp;&amp; self.price.max !== self.MAX_PRICE ) ) {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        }
      }

      <span class="keyword">return</span> <span class="literal">true</span>;
    },

    hasActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          hasActive = <span class="literal">false</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>;

      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">if</span> ( !self.filters.hasOwnProperty(filterType) ) {
          <span class="keyword">continue</span>;
        }


        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {
            <span class="keyword">var</span> activeFilters = self.filters[ filterType ][ filterName ];
            hasActive = activeFilters.length &gt; <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>There is an active filter, break out of the loop and return</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( hasActive ) {
              <span class="keyword">break</span>;
            }
          }
        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          hasActive = self.price.min !== self.MIN_PRICE || self.price.max !== self.MAX_PRICE;
        }

        <span class="keyword">if</span> ( hasActive ) {
          <span class="keyword">return</span> hasActive;
        }
      }
      <span class="keyword">return</span> hasActive;
    },

    displayActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>,
          filters = {},
          frag = document.createDocumentFragment(),
          $clearAll;

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>self.filters ~= self.filters.button.megapixels["14-16", "16-18"]</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">if</span> ( !self.filters.hasOwnProperty(filterType) ) {
          <span class="keyword">continue</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Loop through filter types because there could be more than one 'button' or 'checkbox'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {
            <span class="keyword">var</span> activeFilters = self.filters[ filterType ][ filterName ];

</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>This filterType.filterName has some active filters, build an object of its labels and filter names</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( activeFilters.length ) {
              <span class="keyword">for</span> ( <span class="keyword">var</span> j = <span class="number">0</span>; j &lt; activeFilters.length; j++ ) {
                <span class="keyword">var</span> label = self.filterLabels[ filterName ][ activeFilters[ j ] ];
                filters[ activeFilters[ j ] ] = {
                  label: label,
                  name: filterName
                };
              }
            }
          }

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Handle range control a bit differently</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          <span class="keyword">if</span> ( self.price.min !== self.MIN_PRICE ) {
            filters.min = {
              key: <span class="string">'price'</span>,
              label: <span class="string">'Min price: $'</span> + self.price.min,
              name: <span class="string">'min'</span>
            };
          }
          <span class="keyword">if</span> ( self.price.max !== self.MAX_PRICE) {
            filters.max = {
              key: <span class="string">'price'</span>,
              label: <span class="string">'Max price: $'</span> + self.price.max,
              name: <span class="string">'max'</span>
            };
          }
        }
      }

      <span class="keyword">if</span> ( !$.isEmptyObject( filters ) ) {
</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Create labels showing current filters</p>             </td>             <td class="code">               <div class="highlight"><pre>        $.each(filters, <span class="keyword">function</span>(key, obj) {
          <span class="keyword">var</span> $label = $(<span class="string">'&lt;span&gt;'</span>, {
            <span class="string">'class'</span> : <span class="string">'label label-close fonticon-10-circle-x--after'</span>,
            <span class="string">'data-filter'</span> : key,
            <span class="string">'data-filter-name'</span> : obj.key || obj.name,
            text : obj.label,
            click : $.proxy( self.onRemoveFilter, self )
          });

          frag.appendChild( $label[<span class="number">0</span>] );

          $label = <span class="literal">null</span>;
        });

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Using em here so I can use :last-of-type to get the spans</p>             </td>             <td class="code">               <div class="highlight"><pre>        $clearAll = $(<span class="string">'&lt;em/&gt;'</span>, {
          <span class="string">'class'</span> : <span class="string">'clear-all-filters lt3 js-clear-filters'</span>,
          text: self.$activeFilters.data(<span class="string">'clearLabel'</span>)
        });

        frag.appendChild( $clearAll[<span class="number">0</span>] );

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Manipulate DOM at the same time to prevent multiple layouts</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$activeFilters
          .empty()
          .append( frag );

        <span class="keyword">if</span> ( !self.$activeFilters.hasClass(<span class="string">'has-active-filters'</span>) ) {
          self.$activeFilters.addClass(<span class="string">'has-active-filters'</span>);
        }

      } <span class="keyword">else</span> {

        self.$activeFilters.empty();
        <span class="keyword">if</span> ( self.$activeFilters.hasClass(<span class="string">'has-active-filters'</span>) ) {
          self.$activeFilters.removeClass(<span class="string">'has-active-filters'</span>);
        }
      }

      filters = <span class="literal">null</span>;
      $clearAll = <span class="literal">null</span>;
      frag = <span class="literal">null</span>;
    },

</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Removes a single filter from stored data. Does NOT change UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    undoFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          pos;

      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
        pos = $.inArray( filterValue, self.filters[ filterType ][ filterName ] );
        self.filters[ filterType ][ filterName ].splice( pos, <span class="number">1</span> );

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
        <span class="keyword">delete</span> self.filters[ filterType ][ filterName ][ filterValue ];
      }

      <span class="keyword">return</span> self;
    },

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Removes the active state of a filter. Changes UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    removeFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>,
          rangeControl,
          method;

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).button(<span class="string">'toggle'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .active'</span> ).button(<span class="string">'toggle'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>[data-filter="features"] [value="lcd"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector )
          .prop(<span class="string">'checked'</span>, <span class="literal">false</span>)
          .removeClass(<span class="string">'active'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Slide appropriate handle to the intial value</p>             </td>             <td class="code">               <div class="highlight"><pre>        rangeControl = self.$rangeControl.data(<span class="string">'rangeControl'</span>);
        method = filterValue === <span class="string">'min'</span> ? <span class="string">'slideToInitialMin'</span> : <span class="string">'slideToInitialMax'</span>;
        rangeControl[ method ]();
      }

      <span class="keyword">return</span> self;
    },

    disableFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .btn'</span> ).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).prop(<span class="string">'disabled'</span>, <span class="literal">true</span>);
      }
    },

    deleteFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">this</span>
</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Remove from internal data</p>             </td>             <td class="code">               <div class="highlight"><pre>      .undoFilter( filterValue, filterName, filterType )
</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Remove active/checked state</p>             </td>             <td class="code">               <div class="highlight"><pre>      .removeFilter( filterValue, filterName, filterType );

      <span class="keyword">return</span> <span class="keyword">this</span>;
    },

    enableFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).removeAttr(<span class="string">'disabled'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .btn'</span> ).removeAttr(<span class="string">'disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).prop(<span class="string">'disabled'</span>, <span class="literal">false</span>);
      }
    },

    getFilterStatus : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        <span class="keyword">return</span> !self.$container.find( selector ).is(<span class="string">':disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>[data-filter="features"] [value="lcd"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        <span class="keyword">return</span> !self.$container.find( selector ).is(<span class="string">':disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>range is never disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">return</span> <span class="literal">true</span>;
      }

      <span class="keyword">return</span> <span class="literal">null</span>;
    },

    removeActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>,
          filterValues = [],
          filterValue = <span class="string">''</span>;

      self.lastFilterGroup = <span class="literal">null</span>;
      self.secondLastFilterGroup = <span class="literal">null</span>;
      self.lastFilterStatuses = <span class="literal">null</span>;
      self.secondLastFilterStatuses = <span class="literal">null</span>;
      self.currentFilterColor = <span class="literal">null</span>;
      self.hideFilteredSwatchImages();

      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {

          <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
            <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filters[ filterType ][ filterName ] ) {
</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Remove from internal data and UI</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.deleteFilter( filterValue, filterName, filterType );
            }

          } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Get the filter values without a reference because we want to delete parts of the array
as its looped through</p>             </td>             <td class="code">               <div class="highlight"><pre>            filterValues = $.extend([], self.filters[ filterType ][ filterName ]);
            <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; filterValues.length; i++ ) {
              filterValue = filterValues[ i ];
</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Remove from internal data and UI</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.deleteFilter( filterValue, filterName, filterType );
            }
          }
        }
      }

      self.filter();
    },

    toggleZeroMessage : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          visibleItems = self.shuffle ? self.shuffle.visibleItems : self.$items.filter(<span class="string">'.filtered'</span>).length;

      <span class="keyword">if</span> ( visibleItems ) {
        <span class="keyword">if</span> ( !self.$zeroMessage.hasClass(<span class="string">'hide'</span>) ) {
          self.$zeroMessage.addClass(<span class="string">'hide'</span>);
        }
      } <span class="keyword">else</span> {
        <span class="keyword">if</span> ( self.$zeroMessage.hasClass(<span class="string">'hide'</span>) ) {
          self.$zeroMessage.removeClass(<span class="string">'hide'</span>);
        }
      }

      <span class="keyword">return</span> self;
    },

    onRemoveFilter : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          data = $(evt.target).data(),
          filterType = self.filterTypes[ data.filterName ];

</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Remove from internal data and UI</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.deleteFilter( data.filter, data.filterName, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Remove this label</p>             </td>             <td class="code">               <div class="highlight"><pre>      $(evt.target).remove();

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Trigger shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.filter();
    },

    initCompareGallery : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Add events to close buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$items.find(<span class="string">'.js-remove-item'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>( evt ) {
        $.when( self.hideCompareItem( evt ) ).always(<span class="keyword">function</span>() {
          self.onCompareFiltered();
        });
      });

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Reset button</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareReset.on(<span class="string">'click'</span>, $.proxy( self.onCompareReset, self ));
    },

    initShuffle : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$grid.on(<span class="string">'loading.shuffle'</span>, $.proxy( self.onGalleryLoading, self ));
      self.$grid.on(<span class="string">'done.shuffle'</span>, $.proxy( self.onGalleryDoneLoading, self ));

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>instantiate shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$grid.shuffle({
        itemSelector: self.itemSelector,
        speed: self.shuffleSpeed,
        easing: self.shuffleEasing,
        columnWidth: self.shuffleColumns,
        gutterWidth: self.shuffleGutters,
        showInitialTransition: <span class="literal">false</span>,
        hideLayoutWithFade: <span class="literal">true</span>,
        sequentialFadeDelay: <span class="number">60</span>,
        buffer: <span class="number">8</span>
      });

      self.shuffle = self.$grid.data(<span class="string">'shuffle'</span>);

      self.$grid.find(<span class="string">'.iq-img'</span>).on(<span class="string">'imageLoaded'</span>, $.debounce( <span class="number">200</span>, $.proxy( self.shuffle.layout, self.shuffle ) ) );

</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Displays active filters on <code>filter</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$grid.on(<span class="string">'filter.shuffle'</span>, $.proxy( self.displayActiveFilters, self ) );

</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Filtered should already be throttled because whatever calls <code>.filter()</code> should be throttled.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$grid.on(<span class="string">'layout.shuffle'</span>, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Things moved around and could possibly be in the viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>        iQ.update();

</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>The position of the nav has changed, update it in infinitescroll</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
          self.$grid.infinitescroll(<span class="string">'updateNavLocation'</span>);
        }
      });

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Sort elements by data-priority attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.sortByPriority();
    },

    initFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.filters = {
        range: {},
        button: {},
        checkbox: {}
      };
      self.filterTypes = {};
      self.filterLabels = {};
      self.filterValues = {};

</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>The filter type is sometimes changed because they have
the same look and functionality as another filter type
Here is where we keep the origial type</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.filterData = {};

      self.$filterOpts.find(<span class="string">'[data-filter]'</span>).each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
            data = $<span class="keyword">this</span>.data(),
            type = data.filterType,
            realType = type,
            name = data.filter,
            init = [];

</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Initialize it based on type</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">switch</span> ( type ) {
          <span class="keyword">case</span> <span class="string">'range'</span>:
            init = {};
            self.range( $<span class="keyword">this</span>, name, data.min, data.max );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'button'</span>:
            self.button( $<span class="keyword">this</span>, name, realType );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'group'</span>:
</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Treat groups and colors the same as buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>            type = <span class="string">'button'</span>;
            self.button( $<span class="keyword">this</span>, name, realType );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'color'</span>:
</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Treat groups and colors the same as buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>            type = <span class="string">'button'</span>;
            self.button( $<span class="keyword">this</span>, name, realType );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'checkbox'</span>:
            self.checkbox ( $<span class="keyword">this</span>, name );
            <span class="keyword">break</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Save the active filters in this filter to an empty array or object</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.filters[ type ][ name ] = init;
        self.filterTypes[ name ] = type;
        self.filterData[ name ] = {
          name: name,
          type: type,
          realType: realType
        };
      });

</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Init popovers</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.initPopovers();

</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Slide toggle. Reset range control if it was hidden on initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$container.find(<span class="string">'.collapse'</span>)
        .on(<span class="string">'shown'</span>, $.proxy( self.onFiltersShown, self ))
        .on(<span class="string">'show'</span>, $.proxy( self.onFiltersShow, self ))
        .on(<span class="string">'hide'</span>, $.proxy( self.onFiltersHide, self ));

</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Bind clearing filters to any class that has <code>.js-clear-filters</code> on it</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$container.on(<span class="string">'click'</span>, <span class="string">'.js-clear-filters'</span>, <span class="keyword">function</span>() {
        self.removeActiveFilters();
</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Tell jQuery to preventDefault() and stopPropagation()</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">return</span> <span class="literal">false</span>;
      });
    },

    initPopovers : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $triggers = self.$filterOpts.find(<span class="string">'.js-popover-trigger'</span>);

      $triggers.each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $trigger = $(<span class="keyword">this</span>);

        $trigger.popover({
          placement: <span class="string">'in offsetright'</span>,
          trigger: <span class="string">'click'</span>,
          getArrowOffset : <span class="keyword">function</span>() {
            <span class="keyword">var</span> containerWidth = self.$filterOpts.find(<span class="string">'.filter-container'</span>).first().parent().width(),
                columnWidth = self.$filterOpts.find(<span class="string">'.filter-container'</span>).first().width();

            <span class="keyword">return</span> containerWidth - columnWidth;
          },
          getWidth: <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>get the width of the filter-container's parent</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">return</span> self.$filterOpts.find(<span class="string">'.filter-container'</span>).first().parent().width();
          },
          content: <span class="keyword">function</span>() {
            <span class="keyword">return</span> $(<span class="keyword">this</span>).find(<span class="string">'.js-popover-content'</span>).html();
          }
        });
      });

</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Hide other popovers when another is clicked</p>             </td>             <td class="code">               <div class="highlight"><pre>      $triggers.on(<span class="string">'tipshow'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> $trigger = $(<span class="keyword">this</span>);
        $triggers.not( $trigger ).popover(<span class="string">'hide'</span>);
      });
    },

    initSorting : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Show first dropdown as active</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortBtns.first().parent().addClass(<span class="string">'active'</span>);
      self.currentSort = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Set up sorting ---- dropdowm</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortBtns.on(<span class="string">'click'</span>,  $.proxy( self.sort, self ));

</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Set up sorting ---- select menu</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortSelect.on(<span class="string">'change'</span>, $.proxy( self.sort, self ));

      <span class="keyword">if</span> ( !self.hasFilters ) {
        self.$productCount.text( self.$items.length );
      }

</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Firefox's and IE's <select> menu is hard to style...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> ua = navigator.userAgent.toLowerCase();
      <span class="keyword">if</span> ( ua.indexOf(<span class="string">'firefox'</span>) &gt; -<span class="number">1</span> || ua.indexOf(<span class="string">'msie'</span>) &gt; -<span class="number">1</span> ) {
        self.$sortSelect.parent().addClass(<span class="string">'moz-ie'</span>);
      }
    },

    initInfscr : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">galleryItemsAdded</span><span class="params">( newElements )</span> {</span>
          <span class="keyword">var</span> $newElements = $( newElements ).addClass(<span class="string">'via-ajax'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Bump up the delay so it's more noticeable.</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.shuffle.sequentialFadeDelay = <span class="number">250</span>;

</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Get shuffle to append and show the items for us</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid.shuffle( <span class="string">'appended'</span>, $newElements );

</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Now put it back</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.shuffle.sequentialFadeDelay = <span class="number">60</span>;

</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Show new product count</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$productCount.text( self.$grid.data(<span class="string">'shuffle'</span>).visibleItems );

</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Initialize swatches and tooltips for ajax content</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.initSwatches( $newElements.find(<span class="string">'.mini-swatch[data-color]'</span>) );
          self.initTooltips( $newElements.find(<span class="string">'.js-favorite'</span>) );

</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Add the .iq-img class to hidden swatch images, then tell iQ to update itself</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>This also calls iQ.update( true )</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.loadSwatchImages();

            <span class="keyword">if</span> ( self.currentFilterColor ) {
              self.displayFilteredSwatchImages();
            }

</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>This is silly. Maybe a new method for iQ. iQ.refresh()</p>             </td>             <td class="code">               <div class="highlight"><pre>            setTimeout(<span class="keyword">function</span>() {
              iQ.update( <span class="literal">true</span> );
            }, <span class="number">300</span>);
          }, <span class="number">15</span>);
      }

      self.$grid.infinitescroll({
        local: <span class="literal">true</span>,
</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>debug: true,</p>             </td>             <td class="code">               <div class="highlight"><pre>        bufferPx: -<span class="number">100</span>, <span class="comment">// Load 100px after the navSelector has entered the viewport</span>
        navSelector: <span class="string">'div.navigation'</span>, <span class="comment">// selector for the paged navigation</span>
        nextSelector: <span class="string">'div.navigation a'</span>, <span class="comment">// selector for the NEXT link (to page 2)</span>
        itemSelector: <span class="string">'.gallery-item'</span>, <span class="comment">// selector for all items you'll retrieve</span>
        loading: {
          selector: <span class="string">'.infscr-holder'</span>,
          msgText: <span class="string">'&lt;em&gt;Loading the next set of products...&lt;/em&gt;'</span>,
          finishedMsg: <span class="string">'&lt;em&gt;Finished loading products.&lt;/em&gt;'</span>,
          img: self.loadingGif
        }
      }, galleryItemsAdded );
    },

    initSwatches : <span class="keyword">function</span>( $collection ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $collection = $collection || self.$grid.find(<span class="string">'.mini-swatch[data-color]'</span>);
      $collection.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $swatch = $(<span class="keyword">this</span>),
              hidden = <span class="string">'hidden'</span>,
              color = $swatch.data(<span class="string">'color'</span>),
              $productImg = $swatch.closest(<span class="string">'.product-img'</span>).find(<span class="string">'.js-product-imgs .js-product-img-main'</span>),
              $swatchImg = $swatch.closest(<span class="string">'.product-img'</span>).find(<span class="string">'.js-product-imgs [data-color="'</span> + color + <span class="string">'"]'</span>);

          $swatch.on(<span class="string">'click'</span>, <span class="literal">false</span>);

          $swatch.hover(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Mouse over, hide the main image, show the swatch image</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.currentFilterColor ) {
              $swatchImg.siblings(<span class="string">':not(.hidden)'</span>).addClass( hidden );
            } <span class="keyword">else</span> {
              $productImg.addClass( hidden );
            }
            $swatchImg.removeClass( hidden );
          }, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Mouse out, hide the swatch image, show the main image</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.currentFilterColor !== color ) {
              $swatchImg.addClass( hidden );
            }
            <span class="keyword">if</span> ( self.currentFilterColor ) {
              $swatchImg.siblings(<span class="string">'[data-color="'</span> + self.currentFilterColor + <span class="string">'"]'</span>).removeClass( hidden );
            } <span class="keyword">else</span> {
              $productImg.removeClass( hidden );
            }
          });

          $swatch = <span class="literal">null</span>;
      });

      $collection = <span class="literal">null</span>;

      <span class="keyword">return</span> self;
    },

    loadSwatchImages : <span class="keyword">function</span>() {
      <span class="keyword">this</span>.$grid.find(<span class="string">'.js-product-imgs img:not(.iq-img)'</span>).addClass(<span class="string">'iq-img'</span>);
      iQ.update( <span class="literal">true</span> );

      <span class="keyword">return</span> <span class="keyword">this</span>;
    },

    displayFilteredSwatchImages : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          hidden = <span class="string">'hidden'</span>,
          $productImgs = self.$grid.find(<span class="string">'.js-product-imgs:not(.no-swatches)'</span>),
          $mainImgs = $productImgs.find(<span class="string">'.js-product-img-main, [data-color]:not(.hidden)'</span>),
          $swatchImgs = $productImgs.find(<span class="string">'[data-color="'</span> + self.currentFilterColor + <span class="string">'"]'</span>);

      $mainImgs.addClass( hidden );
      $swatchImgs.removeClass( hidden );

      <span class="keyword">return</span> self;
    },

    hideFilteredSwatchImages : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          hidden = <span class="string">'hidden'</span>,
          $productImgs = self.$grid.find(<span class="string">'.js-product-imgs:not(.no-swatches)'</span>),
          $mainImgs = $productImgs.find(<span class="string">'.js-product-img-main'</span>),
          $swatchImgs = $productImgs.find(<span class="string">'[data-color]:not(.hidden)'</span>);

      $mainImgs.removeClass( hidden );
      $swatchImgs.addClass( hidden );

      <span class="keyword">return</span> self;
    },

    initTooltips : <span class="keyword">function</span>( $favorites ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $favorites = $favorites || self.$favorites;

</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Favorite the gallery item immediately on touch devices</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.isTouch ) {
        $favorites
          .on(<span class="string">'touchend'</span>, $.proxy( self.onFavorite, self ))
          .on(<span class="string">'click'</span>, <span class="literal">false</span>);

</pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Show a tooltip on hover before favoriting on desktop devices</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        $favorites.on(<span class="string">'click'</span>, $.proxy( self.onFavorite, self ));

        $favorites.tooltip({
          placement: <span class="string">'offsettop'</span>,
          title: <span class="keyword">function</span>() {
            <span class="keyword">var</span> $jsFavorite = $(<span class="keyword">this</span>);
            <span class="keyword">return</span> self.getFavoriteContent( $jsFavorite, $jsFavorite.hasClass(<span class="string">'active'</span>) );
          },
          template: <span class="string">'&lt;div class="tooltip gallery-tooltip"&gt;&lt;div class="tooltip-arrow"&gt;&lt;/div&gt;&lt;div class="tooltip-inner"&gt;&lt;/div&gt;&lt;/div&gt;'</span>
        });
      }

      $favorites = <span class="literal">null</span>;

</pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Update our favorites</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$favorites = self.$grid.find(<span class="string">'.js-favorite'</span>);
    },

    initCarousels : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">initializeScroller</span><span class="params">( $carousel )</span> {</span>

</pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Carousels inside gallery items can be delayed</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>The gallery could have been disabled within the time we
tried to execute this function and when the browser actually
gets around to running the code.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !self.enabled ) {
            <span class="keyword">return</span>;
          }

          $carousel.scrollerModule({
            mode: <span class="string">'carousel'</span>,
            contentSelector: <span class="string">'.js-carousel-container'</span>,
            itemElementSelector: <span class="string">'.slide'</span>
          });

          self.hasEnabledCarousels = <span class="literal">true</span>;

          $carousel = <span class="literal">null</span>;
        }, <span class="number">0</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>Go through each possible carousel</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.hasEnabledCarousels ) {
        self.$carousels.each(<span class="keyword">function</span>(i,e) {
          <span class="keyword">var</span> $carousel = $(e),
              $firstImage;

</pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>If this call is from the initial setup, we have to wait for the first image to load
to get its height.</p>             </td>             <td class="code">               <div class="highlight"><pre>          $firstImage = $carousel.find(<span class="string">'img'</span>).first();

          <span class="keyword">if</span> ( $firstImage[<span class="number">0</span>].naturalHeight &gt; <span class="number">0</span> ) {
            initializeScroller( $carousel );
          } <span class="keyword">else</span> {
             $firstImage.on(<span class="string">'imageLoaded'</span>, <span class="keyword">function</span>() {
              initializeScroller( $carousel );
            });
          }

        });
      }
    },

    destroyCarousels : <span class="keyword">function</span>() {
      <span class="keyword">if</span> ( <span class="keyword">this</span>.hasEnabledCarousels ) {
        <span class="keyword">this</span>.$carousels.scrollerModule(<span class="string">'destroy'</span>);
        <span class="keyword">this</span>.hasEnabledCarousels = <span class="literal">false</span>;
      }
    },

    fixCarousels : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.hasCarousels ) {
</pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>980+</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 61.25em)'</span>) ) {
          self.initCarousels();
        } <span class="keyword">else</span> {
          self.destroyCarousels();
        }
      }
    },

    setFilterStatuses : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $visible = self.$items.filter(<span class="string">'.filtered'</span>),
          statuses = {},
          lastFilterGroup = self.lastFilterGroup,
          isRange = lastFilterGroup === <span class="string">'price'</span>,
          isRangeActive = self.filters.range.price.max !== <span class="literal">undefined</span> &amp;&amp; (self.filters.range.price.max !== self.MAX_PRICE || self.filters.range.price.min !== self.MIN_PRICE);

      <span class="function"><span class="keyword">function</span> <span class="title">testGalleryItems</span><span class="params">( filterName, filterValue )</span> {</span>
        <span class="keyword">var</span> shouldEnable = <span class="literal">false</span>;

        <span class="keyword">if</span> ( filterName === <span class="string">'price'</span> ) {
          statuses[ filterName ][ filterValue ] = <span class="literal">true</span>;
          <span class="keyword">return</span> <span class="literal">true</span>;
        }

        $visible.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
              filterSet = $item.data(<span class="string">'filterSet'</span>),
              filterGroupValue = filterSet[ filterName ],
              isArray = $.isArray( filterGroupValue );

          shouldEnable = isArray ?
            self.valueInArray( filterValue, filterGroupValue ) :
            filterValue === filterGroupValue;

          statuses[ filterName ][ filterValue ] = shouldEnable;

</pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>If we've found a match, we don't need to go through the rest of the items</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( shouldEnable ) {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        });

        <span class="keyword">return</span> shouldEnable;
      }

      <span class="function"><span class="keyword">function</span> <span class="title">setFilterStatusesObject</span><span class="params">()</span> {</span>
        <span class="keyword">var</span> filterName,
            filterValue,
            hasActiveFilter;

        <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filterValues ) {
          hasActiveFilter = filterName === lastFilterGroup;
          statuses[ filterName ] = {};

          <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filterValues[ filterName ] ) {

            <span class="keyword">if</span> ( hasActiveFilter ) {
              statuses[ filterName ][ filterValue ] = <span class="string">'skip'</span>;
            } <span class="keyword">else</span> {
              testGalleryItems( filterName, filterValue );
            }
          }
        }
      }

      <span class="function"><span class="keyword">function</span> <span class="title">setFilters</span><span class="params">()</span> {</span>
        <span class="keyword">var</span> filterGroup,
            filterValue,
            filterType,
            status,
            realStatus,
            method;

        <span class="keyword">for</span> ( filterGroup <span class="keyword">in</span> statuses ) {
          <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> statuses[ filterGroup ] ) {
            status = statuses[ filterGroup ][ filterValue ];
            filterType = self.filterTypes[ filterGroup ];
            <span class="keyword">if</span> ( status !== <span class="string">'skip'</span> ) {
              method = status ? <span class="string">'enable'</span> : <span class="string">'disable'</span>;
              self[ method + <span class="string">'Filter'</span> ]( filterValue, filterGroup, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>We know we want to skip it, but we need to save the current status so we can come back to it</p>             </td>             <td class="code">               <div class="highlight"><pre>            } <span class="keyword">else</span> {
              realStatus = self.getFilterStatus( filterValue, filterGroup, filterType );
              statuses[ filterGroup ][ filterValue ] = realStatus;
            }
          }
        }
      }


</pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Use the last filter status that wasn't from this filter group, if appropriate</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( (lastFilterGroup === <span class="literal">null</span> || isRange) &amp;&amp; self.lastFilterStatuses !== <span class="literal">null</span> &amp;&amp; self.secondLastFilterStatuses !== <span class="literal">null</span> &amp;&amp; !(isRange &amp;&amp; isRangeActive) &amp;&amp; self.hasActiveFilters() ) {
        statuses = self.secondLastFilterStatuses;
      } <span class="keyword">else</span> {
        setFilterStatusesObject();
      }

</pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>Enable or disable them</p>             </td>             <td class="code">               <div class="highlight"><pre>      setFilters();

</pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>If we're filtering again (for example, by "colors"), don't add this statuses object as the
second to last one, it should refer to the last one that is not in the current filter group</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( lastFilterGroup !== self.secondLastFilterGroup ) {
        self.secondLastFilterStatuses = self.lastFilterStatuses;
      }
      self.lastFilterStatuses = statuses;

      self.secondLastFilterGroup = lastFilterGroup;

</pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>Update product count</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$productCount.text( $visible.length );

</pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>Release for IE</p>             </td>             <td class="code">               <div class="highlight"><pre>      $visible = <span class="literal">null</span>;

      <span class="keyword">return</span> self;
    },

    valueInArray : <span class="keyword">function</span>( value, arr ) {
      <span class="keyword">return</span> $.inArray(value, arr) !== -<span class="number">1</span>;
    },

    arrayContainsArray : <span class="keyword">function</span>( arrToTest, requiredArr ) {
      <span class="keyword">var</span> i = <span class="number">0</span>,
          dictionary = {},
          j;

</pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>Convert groups into object which we can test the keys</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; arrToTest.length; j++) {
        dictionary[ arrToTest[j] ] = <span class="literal">true</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Loop through selected features, if that feature is not in this elements groups, return false</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> (; i &lt; requiredArr.length; i++) {
        <span class="keyword">if</span> ( dictionary[ requiredArr[i] ] === <span class="literal">undefined</span> ) {
          <span class="keyword">return</span> <span class="literal">false</span>;
        }
      }
      <span class="keyword">return</span> <span class="literal">true</span>;
    },

    button : <span class="keyword">function</span>( $filterGroup, filterName, realType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          labels = {},
          values = {},
          $btns = $filterGroup.children();

      $btns.on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
            isMediaGroup = $<span class="keyword">this</span>.hasClass(<span class="string">'media'</span>),
            $alreadyChecked,
            checked = [],
            active = <span class="string">'active'</span>,
            isActive;

</pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>Abort if this button is disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( $<span class="keyword">this</span>.is(<span class="string">'[disabled]'</span>) ) {
          <span class="keyword">return</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Already checked buttons which are not this one</p>             </td>             <td class="code">               <div class="highlight"><pre>        $alreadyChecked = $<span class="keyword">this</span>.siblings(<span class="string">'.'</span> + active);

        <span class="keyword">if</span> ( isMediaGroup ) {
          $<span class="keyword">this</span>.find(<span class="string">'.btn'</span>).button(<span class="string">'toggle'</span>);
          $<span class="keyword">this</span>.toggleClass(active);

          <span class="keyword">if</span> ( $alreadyChecked.length ) {
            $alreadyChecked.removeClass(active);
            $alreadyChecked.find(<span class="string">'.btn'</span>).button(<span class="string">'toggle'</span>);
          }
        } <span class="keyword">else</span> {
          $<span class="keyword">this</span>.button(<span class="string">'toggle'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Remove active on already checked buttons to act like radio buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( $alreadyChecked.length ) {
            $alreadyChecked.button(<span class="string">'toggle'</span>);
          }
        }

        isActive = $<span class="keyword">this</span>.hasClass( active );

        <span class="keyword">if</span> ( isActive ) {
          checked.push( $<span class="keyword">this</span>.data( filterName ) );
          self.lastFilterGroup = filterName;
        } <span class="keyword">else</span> {
          self.lastFilterGroup = <span class="literal">null</span>;
        }

        <span class="keyword">if</span> ( realType === <span class="string">'color'</span> ) {
          self.currentFilterColor = isActive ? $<span class="keyword">this</span>.data( filterName ) : <span class="literal">null</span>;
          <span class="keyword">if</span> ( isActive ) {
            self.displayFilteredSwatchImages();
          } <span class="keyword">else</span> {
            self.hideFilteredSwatchImages();
          }
        }

        self.filters.button[ filterName ] = checked;

        self.filter();
      })

</pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Save each label to the labels object</p>             </td>             <td class="code">               <div class="highlight"><pre>      .each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> data = $(<span class="keyword">this</span>).data();
        labels[ data[ filterName ] ] = data.label;
        values[ data[ filterName ] ] = data[ filterName ];
      });

      self.filterLabels[ filterName ] = labels;
      self.filterValues[ filterName ] = values;

      $btns = <span class="literal">null</span>;
      labels = <span class="literal">null</span>;
      values = <span class="literal">null</span>;
    },

    checkbox : <span class="keyword">function</span>( $filterGroup, filterName ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          labels = {},
          values = {},
          $inputs = $filterGroup.find(<span class="string">'input'</span>);

      $inputs.on(<span class="string">'change'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> $input = $(<span class="keyword">this</span>),
            $checked = $filterGroup.find(<span class="string">'input:checked'</span>),
            checked = [],
            isActive;

</pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>At least one checkbox is checked, clear the array and loop through the checked checkboxes
to build an array of strings</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( $checked.length !== <span class="number">0</span> ) {
          $checked.each(<span class="keyword">function</span>() {
            checked.push(<span class="keyword">this</span>.value);
          });
          isActive = <span class="literal">true</span>;
        } <span class="keyword">else</span> {
          isActive = <span class="literal">false</span>;
        }
        self.filters.checkbox[ filterName ] = checked;

</pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Less than IE9 doesn't support the :checked pseudo class</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Settings.isLTIE9 ) {
          $input.toggleClass(<span class="string">'active'</span>);
        }

        <span class="keyword">if</span> ( isActive ) {
          self.lastFilterGroup = filterName;
        } <span class="keyword">else</span> {
          self.lastFilterGroup = <span class="literal">null</span>;
        }

        self.filter();
      })

</pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Save each label to the labels object</p>             </td>             <td class="code">               <div class="highlight"><pre>      .each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> data = $(<span class="keyword">this</span>).data();
        labels[ <span class="keyword">this</span>.value ] = data.label;
        values[ <span class="keyword">this</span>.value ] = <span class="keyword">this</span>.value;
      });

      self.filterLabels[ filterName ] = labels;
      self.filterValues[ filterName ] = values;

      $inputs = <span class="literal">null</span>;
      labels = <span class="literal">null</span>;
      values = <span class="literal">null</span>;
    },

    range : <span class="keyword">function</span>( $rangeControl, filterName, MIN_PRICE, MAX_PRICE ) {
      <span class="keyword">this</span>.MAX_PRICE = MAX_PRICE;
      <span class="keyword">this</span>.MIN_PRICE = MIN_PRICE;
      <span class="keyword">this</span>.price = {
        MIN_PRICE: <span class="keyword">this</span>.MIN_PRICE,
        MAX_PRICE: <span class="keyword">this</span>.MAX_PRICE
      };

      <span class="keyword">var</span> self = <span class="keyword">this</span>,

      diff = MAX_PRICE - MIN_PRICE,
      $output = $rangeControl.closest(<span class="string">'.filter-container'</span>).find(<span class="string">'.range-output-container'</span>),
      $minOutputWrap = $output.find(<span class="string">'.range-output-min'</span>),
      $maxOutputWrap = $output.find(<span class="string">'.range-output-max'</span>),
      $minOutput = $output.find(<span class="string">'.range-output-min .val'</span>),
      $maxOutput = $output.find(<span class="string">'.range-output-max .val'</span>),

      delay = self.isTouch ? <span class="number">1000</span> : <span class="number">750</span>,
      method = self.isTouch ? <span class="string">'debounce'</span> : <span class="string">'throttle'</span>,
      debouncedFilter = $[ method ]( delay, <span class="keyword">function</span>() {
        self.filter();
      });

      <span class="function"><span class="keyword">function</span> <span class="title">getPrice</span><span class="params">( percent )</span> {</span>
        <span class="keyword">return</span> Math.round( diff * (percent / <span class="number">100</span>) ) + MIN_PRICE;
      }

</pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Range control update callback</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">( evt, positions, percents )</span> {</span>
        <span class="keyword">var</span> minPrice = getPrice(percents.min),
        maxPrice = getPrice(percents.max),
        maxPriceStr = maxPrice === MAX_PRICE ? maxPrice + <span class="string">'+'</span> : maxPrice,
        prevMin = self.price.min,
        prevMax = self.price.max;

        self.lastFilterGroup = filterName;

</pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>Display values</p>             </td>             <td class="code">               <div class="highlight"><pre>        displayValues(minPrice, maxPriceStr, percents);

</pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>Save values</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.price.min = minPrice;
        self.price.max = maxPrice;

</pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>Filter results only if values have changed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( (prevMin !== minPrice || prevMax !== maxPrice) &amp;&amp; self.isInitialized ) {

</pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>Save current filters</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.filters.range[ filterName ].min = minPrice;
          self.filters.range[ filterName ].max = maxPrice;

</pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>Throttle filtering (especially on touch)</p>             </td>             <td class="code">               <div class="highlight"><pre>          debouncedFilter();
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Show what's happening with the range control</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">displayValues</span><span class="params">( min, max, percents )</span> {</span>
        <span class="keyword">var</span> minWidth,
            maxWidth;

</pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>Set the new html, then get it's width, then set it's margin-left to negative half that</p>             </td>             <td class="code">               <div class="highlight"><pre>        $minOutput.text( min );
        $maxOutput.text( max );
        minWidth = $minOutputWrap.width();
        maxWidth = $maxOutputWrap.width();

        $minOutputWrap.css({
          left: percents.min + <span class="string">'%'</span>,
          marginLeft: -minWidth / <span class="number">2</span>
        });

</pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Do it all over for the max handle</p>             </td>             <td class="code">               <div class="highlight"><pre>        $maxOutputWrap.css({
          left: percents.max + <span class="string">'%'</span>,
          marginLeft: -maxWidth / <span class="number">2</span>
        });
      }

</pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Store jQuery object for later access</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$rangeControl = $rangeControl;

</pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Do a fake update to position the display values. We do this here instead of registering
the slid event because that will be triggered twice on init (once for both handles)</p>             </td>             <td class="code">               <div class="highlight"><pre>      update( <span class="literal">undefined</span>, <span class="literal">undefined</span>, {min: <span class="number">0</span>, max: <span class="number">100</span>} );

      self.$rangeControl.rangeControl({
        initialMin: <span class="string">'0%'</span>,
        initialMax: <span class="string">'100%'</span>,
        range: <span class="literal">true</span>,
        rangeThreshold: <span class="number">0.25</span>
      });

</pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>On handle slid, update. Register after initialized so it's not called during initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$rangeControl.on(<span class="string">'slid.rangecontrol'</span>, update);

      self.filterValues[ filterName ] = { min: <span class="literal">true</span>, max: <span class="literal">true</span> };

      $rangeControl = <span class="literal">null</span>;
    },

</pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>If there is a range control in this element and it's in need of an update</p>             </td>             <td class="code">               <div class="highlight"><pre>    maybeResetRange : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $rangeControl = self.$container.find(<span class="string">'.range-control'</span>);
      <span class="keyword">if</span> ( $rangeControl.length &gt; <span class="number">0</span> &amp;&amp; $rangeControl.data(<span class="string">'rangeControl'</span>).isHidden ) {
        $rangeControl.rangeControl(<span class="string">'reset'</span>);
        <span class="keyword">return</span> <span class="literal">true</span>;
      }
      <span class="keyword">return</span> <span class="literal">false</span>;
    },

</pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>setRangeValue : function( min, max ) {
  var self = this,
      rangeControl = self.$rangeControl.data('rangeControl'),
      minPos = 0,
      maxPos = 0,
      diff = self.MAX<em>PRICE - self.MIN</em>PRICE,
      railSize = rangeControl.railSize,</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>priceToRangePosition = function( price ) {
    return ( ( price - self.MIN_PRICE ) / diff ) * railSize;
  };</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>if ( min &amp;&amp; min &lt;= self.MAX<em>PRICE &amp;&amp; min >= self.MIN</em>PRICE ) {
    minPos = priceToRangePosition( min );
    rangeControl.slideToPos( minPos, rangeControl.$minHandle );
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>if ( max &amp;&amp; max &lt;= self.MAX<em>PRICE &amp;&amp; max >= self.MIN</em>PRICE ) {
    // console.assert( max > min, 'uh oh. Max higher than min.' );
    maxPos = priceToRangePosition( max );
    rangeControl.slideToPos( maxPos );
  }
},</p>             </td>             <td class="code">               <div class="highlight"><pre>

    getSortObject : <span class="keyword">function</span>( evt, $btnText ) {
      <span class="keyword">var</span> $target = $(evt.target),
          isSelect = $target.is(<span class="string">'select'</span>),
          data,
          filterName,
          reverse,
          sortObj = {},
          index;

</pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>Get variables based on what kind of component we're working with</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( isSelect ) {
        filterName = $target.val();
        index = evt.target.selectedIndex;
        reverse = evt.target[ index ].getAttribute(<span class="string">'data-reverse'</span>);
        reverse = reverse === <span class="string">'true'</span> ? <span class="literal">true</span> : <span class="literal">false</span>;
      } <span class="keyword">else</span> {
        data = $target.data();
        filterName = data.value;
        reverse = data.reverse ? <span class="literal">true</span> : <span class="literal">false</span>;
        index = $target.closest(<span class="string">'li'</span>).index();
        evt.preventDefault();
        $btnText.text( $target.text() );
      }

      <span class="keyword">if</span> ( filterName !== <span class="string">'default'</span> ) {
        sortObj = {
          sortIndex: index,
          reverse: reverse,
          by: <span class="keyword">function</span>($el) {
</pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>e.g. filterSet.price</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">return</span> $el.data(<span class="string">'filterSet'</span>)[ filterName ];
          }
        };
      } <span class="keyword">else</span> {
        sortObj.sortIndex = index;
      }

      <span class="keyword">return</span> sortObj;

    },

    updateSortDisplay : <span class="keyword">function</span>( $container ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          currentSortValue = <span class="string">''</span>;

      <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>) ) {
</pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>Dealing with the select option menu</p>             </td>             <td class="code">               <div class="highlight"><pre>        currentSortValue = $container.find(<span class="string">'select'</span>).children().eq( self.currentSort ).val();
        $container
          .find(<span class="string">'select'</span>)
          .val( currentSortValue )
          .trigger(<span class="string">'change'</span>);
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>The dropdown component</p>             </td>             <td class="code">               <div class="highlight"><pre>        $container
          .find(<span class="string">'.dropdown-menu'</span>)
          .children()
          .eq( self.currentSort )
          .find(<span class="string">'a'</span>)
          .trigger(<span class="string">'click'</span>);
      }

      <span class="keyword">return</span> self;
    },

    sort : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          sortObj = self.getSortObject( evt, self.$dropdownToggleText );

      self.currentSort = sortObj.sortIndex;
      self.$grid.shuffle(<span class="string">'sort'</span>, sortObj);

      <span class="keyword">return</span> self;
    },

    sortByPriority : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          isTablet = Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>);

      <span class="keyword">if</span> ( isTablet &amp;&amp; !self.sorted ) {
        self.$grid.shuffle(<span class="string">'sort'</span>, {
          by: <span class="keyword">function</span>($el) {
            <span class="keyword">var</span> priority = $el.data(<span class="string">'priority'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>Returning undefined to the sort plugin will cause it to revert to the original array</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">return</span> priority ? priority : <span class="literal">undefined</span>;
          }
        });
        self.sorted = <span class="literal">true</span>;

      } <span class="keyword">else</span> <span class="keyword">if</span> ( !isTablet &amp;&amp; self.sorted ) {
        self.$grid.shuffle(<span class="string">'sort'</span>, {});
        self.sorted = <span class="literal">false</span>;
      }
    },

</pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>sortComparedItems : function( evt ) {
  var self = this,
      sortObj = self.getSortObject( evt, self.$compareTool.find('.js-toggle-text') ),
      sortedItems,
      frag = document.createDocumentFragment();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>// Sort elements
  sortedItems = self.$compareItems.sorted( sortObj );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>// Remove old elements from DOM
  self.$compareItems.detach();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>// Not default order
  if ( sortObj.by ) {
    // Append sorted elements to a document fragment
    $.each(sortedItems, function(i, element) {
      frag.appendChild( element );
    });</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <pre><code>// Append document fragment to the compare-item container
self.$compareTool.find('.compare-items-container').append( frag );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <pre><code>// Save our new compare items
self.$compareItems = $( sortedItems );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>// Default order is saved in the state variable
  } else {
    self.$compareItems = self.compareState.$items;
    self.$compareTool.find('.compare-items-container').append( self.$compareItems );
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>// Make sure we can press reset (if it wasn't manually triggered)
  if ( !evt.isTrigger ) {
    self.$compareReset.removeClass('disabled');
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
    onResize : <span class="keyword">function</span>( isInit, force ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          windowWidth = !Settings.isLTIE9 ? <span class="number">0</span> : self.$window.width(),
          windowHeight = !Settings.isLTIE9 ? <span class="number">0</span> : self.$window.height(),
          hasWindowChanged = !Settings.isLTIE9 || windowWidth !== self.windowWidth || windowHeight !== self.windowHeight;

</pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>Make sure isInit is not an event object</p>             </td>             <td class="code">               <div class="highlight"><pre>      isInit = isInit === <span class="literal">true</span>;

</pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Return if the window hasn't changed sizes or the gallery is disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !force &amp;&amp; !isInit &amp;&amp; (!self.enabled || !hasWindowChanged) ) {
        <span class="keyword">return</span>;
      }

      self.windowWidth = windowWidth;
      self.windowHeight = windowHeight;

</pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>Don't change columns for detail galleries
Change the filters column layout</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.isDetailedMode || self.isCompareMode ) {
</pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>Remove heights in case they've aready been set</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>) ) {
          self.$gridProductNames.css(<span class="string">'height'</span>, <span class="string">''</span>);

</pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>Make all product name heights even</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>Let the browser choose the best time to do this becaues it causes a layout</p>             </td>             <td class="code">               <div class="highlight"><pre>          window.requestAnimationFrame(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>Make all product name heights even</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.$gridProductNames.evenHeights();
          });
        }

</pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>768-979
Make filters a 2up with a span12 below</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 48em) and (max-width: 61.1875em)'</span>) ) {
          <span class="keyword">if</span> ( self.$filterColumns.eq(<span class="number">0</span>).hasClass(<span class="string">'span4'</span>) ) {
            self.$filterColumns
              .removeClass(<span class="string">'span4'</span>)
              .slice(<span class="number">0</span>, <span class="number">2</span>)
                .addClass(<span class="string">'span6'</span>)
                .end()
              .last()
                .addClass(<span class="string">'span12'</span>)
                .find(<span class="string">'.media-list'</span>)
                  .addClass(<span class="string">'inline'</span>);

          }

</pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>Reset filters to 3 columns</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> {
          <span class="keyword">if</span> ( self.$filterColumns.eq(<span class="number">0</span>).hasClass(<span class="string">'span6'</span>) ) {
            self.$filterColumns
              .removeClass(<span class="string">'span6 span12'</span>)
              .addClass(<span class="string">'span4'</span>)
              .find(<span class="string">'.media-list'</span>)
                .removeClass(<span class="string">'inline'</span>);
          }
        }

</pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>Move sort options around</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>) ) {
          <span class="keyword">if</span> ( !self.hasSorterMoved ) {
            <span class="keyword">var</span> $sorter = self.$sortOpts.detach();
            $sorter.insertAfter( self.$container.find(<span class="string">'.slide-toggle-target'</span>) );
            $sorter.wrap(<span class="string">'&lt;div id="sort-options-holder" class="container"&gt;&lt;div class="grid"&gt;&lt;/div&gt;&lt;/div&gt;'</span>);
            self.hasSorterMoved = <span class="literal">true</span>;
          }
        } <span class="keyword">else</span> {
          <span class="keyword">if</span> ( self.hasSorterMoved ) {
            self.$sortOpts.detach().appendTo( self.$container.find(<span class="string">'.slide-toggle-parent .grid'</span>) );
            self.$container.find(<span class="string">'#sort-options-holder'</span>).remove();
            self.hasSorterMoved = <span class="literal">false</span>;
          }
        }


</pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>Tell infinite scroll to update where it thinks it's target it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
          setTimeout(<span class="keyword">function</span>() {
            self.$grid.infinitescroll(<span class="string">'updateNavLocation'</span>);
          }, <span class="number">25</span>);
        }

        <span class="keyword">if</span> ( self.$rangeControl ) {
          self.$rangeControl.rangeControl(<span class="string">'reset'</span>);
        }

        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>Let the browser choose the best time to do this</p>             </td>             <td class="code">               <div class="highlight"><pre>      window.requestAnimationFrame(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>Make all product name heights even</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$gridProductNames.evenHeights();
      });

      Utilities.forceWebkitRedraw();

      self.fixCarousels();

      <span class="keyword">if</span> ( self.isEditorialMode ) {
        self.sortByPriority();
      }
    },

    getFavoriteContent : <span class="keyword">function</span>( $jsFavorite, isActive ) {
      <span class="keyword">return</span> isActive ?
            $jsFavorite.data(<span class="string">'activeTitle'</span>) + <span class="string">'&lt;i class="fonticon-10-sm-bold-check"&gt;&lt;/i&gt;'</span> :
            $jsFavorite.data(<span class="string">'defaultTitle'</span>);
    },

    onFavorite : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $jsFavorite = $(evt.delegateTarget),
          isAdding = !$jsFavorite.hasClass(<span class="string">'active'</span>),
          content = self.isTouch ? <span class="string">''</span> : self.getFavoriteContent( $jsFavorite, isAdding );

      $jsFavorite.toggleClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>Show the tooltip if it isn't a touch device</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.isTouch ) {
        $(<span class="string">'.gallery-tooltip .tooltip-inner'</span>)
          .html( content )
          .tooltip(<span class="string">'show'</span>);
      }


</pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>Stop event from bubbling to <a> tag</p>             </td>             <td class="code">               <div class="highlight"><pre>      evt.preventDefault();
      evt.stopPropagation();
    },

    onFiltersHide : <span class="keyword">function</span>( evt ) {
      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>
      <span class="keyword">this</span>.$filterArrow.removeClass(<span class="string">'in'</span>);
    },

    onFiltersShow : <span class="keyword">function</span>( evt ) {
      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>
      <span class="keyword">this</span>.$filterArrow.addClass(<span class="string">'in'</span>);
    },

    onFiltersShown : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          didReset = self.maybeResetRange(evt);

      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>

      <span class="keyword">if</span> ( !didReset ) {
        self.filter();
      }

</pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>Scroll the window so we can see what's happening with the filtered items</p>             </td>             <td class="code">               <div class="highlight"><pre>      $.simplescroll({
        offset: <span class="number">24</span>, <span class="comment">// margin-top of the gallery is 1.5em (24px)</span>
        target: self.$container
      });
    },

    onGalleryLoading : <span class="keyword">function</span>() {
      <span class="keyword">var</span> $div = $(<span class="string">'&lt;div&gt;'</span>, { <span class="string">'class'</span> : <span class="string">'gallery-loader text-center'</span> }),
          $img = $(<span class="string">'&lt;img&gt;'</span>, { src: <span class="keyword">this</span>.loadingGif });
      $div.append($img);
      $div.insertBefore( <span class="keyword">this</span>.$grid );
    },

    onGalleryDoneLoading : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          isFadedIn = self.$container.hasClass(<span class="string">'in'</span>);

      <span class="keyword">if</span> ( isFadedIn ) {
        self.$container.find(<span class="string">'.gallery-loader'</span>).remove();

</pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>Fade in the gallery if it isn't already</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        setTimeout(<span class="keyword">function</span>() {
          module.removeGalleryLoader();
          self.$container.find(<span class="string">'.gallery-loader'</span>).remove();
          self.$container.addClass(<span class="string">'in'</span>);
        }, <span class="number">0</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>Product names get zero height in IE8</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( Settings.isLTIE9 ) {
        setTimeout(<span class="keyword">function</span>() {
          self.$gridProductNames.evenHeights();
        }, <span class="number">1000</span>);
      }
    },

</pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>onCompareLaunch : function() {
  var self = this,</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <pre><code>  // Clone all visible
  $currentItems = self.$items.filter('.filtered').clone(),
  $compareItemsContainer = $('&lt;div class="compare-items-container grab"&gt;'),
  $compareItemsWrapper = $('&lt;div class="compare-items-wrap"&gt;'),
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <pre><code>  // Get product count
  productCount = $currentItems.length,
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <pre><code>  $container = $('&lt;div class="container js-compare-wrap"&gt;'),
  $content = $('&lt;div class="compare-container clearfix"&gt;'),
  $header = self.$compareTool.find('.modal-header'),
  $modalBody = self.$compareTool.find('.modal-body'),
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <pre><code>  $label = self.$compareTool.find('#compare-tool-label'),
  originalLabel = $label.text(),
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <pre><code>  $labelColumnWrap = $('&lt;div class="span2 detail-labels-wrap hidden-phone"&gt;'),
  $labelColumn = $('&lt;div class="detail-labels-wrapping"&gt;'),
  $labelGroup = $('&lt;div class="detail-label-group"&gt;'),
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <pre><code>  // Clone sort button
  $sortOpts = self.$container.find('.sort-options').clone();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>// Disable the main gallery (from executing resize events, etc.)
  self.disable();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>self.compareTitle = originalLabel + ' ' + self.$container.find('.compare-name').text();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>// Clone the product count
  self.$compareCountWrap = self.$container.find('.product-count-wrap').clone().removeClass('ib');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>// Create reset button
  self.$compareReset = $('<button/>', {
      'class' : 'btn btn-small btn-alt-special btn-reset disabled js-compare-reset',
      'text' : $header.data('resetLabel')
  });
  self.$compareReset.append('<i class="fonticon-10-circlearrow">');
  self.$compareReset.on('click', $.proxy( self.onCompareReset, self ));</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>self.isFixedHeader = false;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>self.$detailLabelsWrap = $labelColumnWrap;
  self.$compareItemsWrap = $compareItemsWrapper;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>// Convert cloned gallery items to compare items
  self.$compareItems = self.getCompareItems( $currentItems );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>// Create sticky header for count
  $labelColumnWrap
    .append('<div class="span2 compare-sticky-header sticky-count">')
    .find('.compare-sticky-header')
    .append( self.$compareCountWrap.clone() );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>// Create labels column
  self.$container.find('.comparables [data-label]').each(function() {
      var $label = $(this).clone(),
          $strong = $('<strong/>');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <pre><code>  $strong.text( $label.attr('data-label') );
  $label.append( $strong );
  $labelGroup.append($label);
</code></pre>

<p>});</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>// Remove compare items on click
  self.$compareItems.find('.compare-item-remove').on('click', $.proxy( self.onCompareItemRemove, self ));</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>// Set up sort events
  $sortOpts.find('.dropdown a').on('click', $.proxy( self.sortComparedItems, self ));
  $sortOpts.find('.native-dropdown').on('change', $.proxy( self.sortComparedItems, self ));</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>// Set the right heading. e.g. Compare Cyber-shot
  $label.text( self.compareTitle );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>if ( !self.isUsingOuterScroller ) {
    self.$compareTool.addClass('native-scrolling');
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>if ( !self.showCompareStickyHeaders ) {
    self.$compareTool.addClass('no-sticky-headers');
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>self.compareWindowWidth = self.windowWidth;
  self.compareWindowHeight = self.windowHeight;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>// Save state for reset
  self.compareState = {
      count: productCount,
      sort: self.currentSort,
      $items : self.$compareItems,
      label: originalLabel,
      snap: true
  };</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>// Append count and labels
  $labelColumn.append( self.$compareCountWrap );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>// On window resize
  self.$window.on('resize.comparetool', $.debounce(350, function() {
    self.onCompareResize( $header, $sortOpts );
  }));
  self.onCompareResize( $header, $sortOpts, true );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>self.$compareReset.addClass('pull-right');
  $labelColumn.append( $labelGroup );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>// Set current sort. After saving state so we get the correct DOM order for compareItems
  self.updateSortDisplay( $sortOpts );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>$labelColumnWrap.append( $labelColumn );
  $content.append( $labelColumnWrap );
  $compareItemsContainer.append( self.$compareItems );
  $compareItemsWrapper.append( $compareItemsContainer );
  $content.append( $compareItemsWrapper );
  $container.append( $content );
  $modalBody.append( $container );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>// Could probably be deferred
  self.addCompareNav( $compareItemsWrapper );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>// Cloned images need to be updated
  iQ.update( true );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>// Save a reference to the count
  self.$compareCount = self.$compareTool.find('.product-count');
  // Set item count
  self.$compareCount.text( productCount );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>// Save refs
  self.$stickyHeaders = self.$compareTool.find('.compare-sticky-header');
  self.$compareProductNameWraps = self.$compareTool.find('.gallery-item-inner .product-name-wrap');
  self.$compareItemsContainer = self.$compareTool.find('.compare-items-container');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>// Trigger modal
  self.$compareTool
    .data('galleryId', self.id) // Set some data on the modal so we know which gallery it belongs to
    .modal({
      backdrop: false
    }); // Show the modal</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>onCompareShown : function() {
  var self = this;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>self.isCompareToolOpen = true;
  self.stickyTriggerPoint = self.getCompareStickyTriggerPoint();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>// Set a margin-left on the compare items wrap
  if ( !self.isFixedHeader ) {
    self.$compareItemsWrap.css('marginLeft', self.$detailLabelsWrap.width());
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>// Set the height, jQuery object, and text of the takeover sticky nav
  self.setTakeoverStickyHeader( self.compareTitle );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>self
    .setCompareRowHeights()
    .setCompareDimensions()
    .setCompareItemsOffset()
    .setStickyHeaderPos( 0 );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>// Nested iscroll isn't working on android 4.1.1
  if ( self.isUsingOuterScroller ) {</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <pre><code>// Initialize outer scroller (vertical scrolling of the fixed position modal)
self.outerScroller = new IScroll( self.$compareTool[0], {
  bounce: false,
  hScrollbar: false,
  vScrollbar: false,
  onBeforeScrollStart : function(e) {
    var target = e.target;
    while ( target.nodeType !== 1 ) {
      target = target.parentNode;
    }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <pre><code>    if ( target.tagName !== 'SELECT' &amp;&amp; target.tagName !== 'INPUT' &amp;&amp; target.tagName !== 'TEXTAREA' ) {
      e.preventDefault();
    }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <pre><code>    // Add `grabbing` class
    if ( !self.isTouch &amp;&amp; !self.$compareItemsContainer.hasClass('grabbing') ) {
      self.$compareItemsContainer.addClass('grabbing');
    }
  },
  onBeforeScrollEnd : function() {
    // Remove `grabbing` class
    if ( !self.isTouch &amp;&amp; self.$compareItemsContainer.hasClass('grabbing') ) {
      self.$compareItemsContainer.removeClass('grabbing');
    }
  },
  onScrollMove : function() {
    self.onCompareScroll( self.stickyTriggerPoint, this );
  },
  onAnimate : function() {
    self.onCompareScroll( self.stickyTriggerPoint, this );
  },
  onAnimationEnd : function() {
    iQ.update();
    self.onCompareScroll( self.stickyTriggerPoint, this );
  }
});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>} else {
    self.$compareTool.on('scroll', function() {
      self.onCompareScroll( self.stickyTriggerPoint );
      iQ.update();
    });
    // self.$compareTool.on('touchmove', function(e) {
    //   e.stopPropagation();
    // });
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>// Initialize inner scroller (for the comparable product items)
  self.innerScroller = new IScroll( self.$compareTool.find('.compare-items-wrap')[0], {
    vScroll: false,
    // hScrollbar: self.isTouch,
    // snap: '.compare-item',
    snap: self.compareState.snap, // this is required for iscroll.scrollToPage
    bounce: false,
    onBeforeScrollStart : function() {</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <pre><code>  // Add `grabbing` class
  if ( !self.isTouch &amp;&amp; !self.$compareItemsContainer.hasClass('grabbing') ) {
    self.$compareItemsContainer.addClass('grabbing');
  }
},
onBeforeScrollEnd : function() {
  // Remove `grabbing` class
  if ( !self.isTouch &amp;&amp; self.$compareItemsContainer.hasClass('grabbing') ) {
    self.$compareItemsContainer.removeClass('grabbing');
  }
},
onScrollMove : function() {
  self.onCompareScroll( 'inner', this );
},
onAnimate : function() {
  self.onCompareScroll( 'inner', this );
},
onAnimationEnd : function() {
  iQ.update();
  self.onCompareScroll( 'inner', this );
  self.afterCompareScrolled( this );
}
</code></pre>

<p>});</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>// Fade in the labels to hide the fact that it took so long to compute heights.
  self.$compareTool.find('.detail-labels-wrapping').addClass('complete');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>// These can be deferred
  setTimeout(function() {
    iQ.update();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <pre><code>// Hide the previous nav paddle because we're on the first page
self.afterCompareScrolled( self.innerScroller );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <pre><code>// Bind events to the paddles
self.addCompareNavEvents();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <pre><code>// Get an updated value for how much the compare sticky headers should be offset
self.setCompareItemsOffset();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>}, 250);</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>onCompareClosed : function() {
  var self = this;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>if ( self.$compareTool.data('galleryId') !== self.id ) {
    return;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>self.isCompareToolOpen = false;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>// Delete the id from memory
  self.$compareTool.removeData('galleryId');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>// Clean up
  self.$compareTool.find('.sort-options').remove();
  self.$takeoverStickyHeader.removeClass('open').removeAttr('style');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>// Destroy iscrolls
  if ( self.isUsingOuterScroller ) {
    self.outerScroller.destroy();
  } else {
    self.$compareTool.off('scroll');
    self.$compareTool.removeClass('native-scrolling');
  }
  self.innerScroller.destroy();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>// Remove listeners for nav button clicks
  self.removeCompareNavEvents();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>// Empty out html
  // Remove scroll event
  self.$compareTool
    .find('.js-compare-wrap')
    .remove()
    .end()
    .find('.modal-subheader')
    .remove()
    .end()
    .find('#compare-tool-label')
    .text( self.compareState.label )
    .end()
    .off('.comparetool');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>// Set count to zero
  self.$compareCount.text(0);</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>self.$compareReset.remove();
  self.$compareReset = null;
  self.$compareItems = null;
  self.$compareItemsContainer = null;
  self.$compareItemsWrap = null;
  self.$compareNav = null;
  self.$detailLabelsWrap = null;
  self.$takeoverStickyHeader = null;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>// Set state to null
  self.compareState = null;
  self.isFixedHeader = null;
  self.compareTitle = null;
  self.compareItemOffset = null;
  self.compareWindowWidth = null;
  self.compareWindowHeight = null;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>// Remove resize event
  self.$window.off('.comparetool');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>self.enable();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
    onCompareReset : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      evt.preventDefault();

      <span class="keyword">if</span> ( self.$compareReset.hasClass(<span class="string">'disabled'</span>) ) {
        evt.stopImmediatePropagation();
        <span class="keyword">return</span> self;
      }

</pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>self.$items
  .find('.compare-item-remove')
  .parent()
  .addBack()
  .removeClass('hide faded no-width');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>Disable reset button</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareReset.addClass(<span class="string">'disabled'</span>).removeClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>Set container width
self.setCompareWidth();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>Reset iscroll
self.innerScroller.refresh();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>self.afterCompareScrolled( self.innerScroller );</p>             </td>             <td class="code">               <div class="highlight"><pre>
      <span class="keyword">return</span> self;
    },

    showCompareItem : <span class="keyword">function</span>( $item ) {
      <span class="keyword">var</span> dfd = <span class="keyword">new</span> $.Deferred();

</pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>1</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">showItem</span><span class="params">()</span> {</span>
</pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>Show the column</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item.removeClass(<span class="string">'hide'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>2</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">giveWidth</span><span class="params">()</span> {</span>
        $item
          .one( $.support.transition.end, fadeItemIn )
          .removeClass(<span class="string">'no-width'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>3</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">fadeItemIn</span><span class="params">()</span> {</span>
        $item
          .one( $.support.transition.end, <span class="keyword">function</span>() {
            dfd.resolve();
          })
          .removeClass(<span class="string">'fade'</span>);
      }

      <span class="keyword">if</span> ( Modernizr.csstransitions ) {
        showItem();
        giveWidth();

      } <span class="keyword">else</span> {
        showItem();
      }

      <span class="keyword">return</span> dfd.promise();
    },

    hideCompareItem : <span class="keyword">function</span>( $item ) {
      <span class="keyword">var</span> dfd = <span class="keyword">new</span> $.Deferred();

      $item = $item.jquery ? $item : $($item.target).closest(<span class="string">'.compare-item'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>3</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">hideItem</span><span class="params">()</span> {</span>
</pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>Hide the column</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item.addClass(<span class="string">'hide'</span>);
        dfd.resolve();
      }

</pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>2</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">noWidth</span><span class="params">()</span> {</span>
        $item
          .one( $.support.transition.end, hideItem )
          .addClass(<span class="string">'no-width'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-268">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-268">&#182;</a>               </div>               <p>1</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">fadeItemOut</span><span class="params">()</span> {</span>
        $item.addClass(<span class="string">'fade'</span>);
      }

      <span class="keyword">if</span> ( Modernizr.csstransitions ) {
        $item.one( $.support.transition.end, noWidth );
        fadeItemOut();

      } <span class="keyword">else</span> {
        hideItem();
      }

      <span class="keyword">return</span> dfd.promise();
    },

</pre></div>             </td>           </tr>                               <tr id="section-269">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-269">&#182;</a>               </div>               <p>onCompareItemRemove : function( evt ) {
  var self = this,
      remaining,
      $compareItem = $(evt.target).closest('.compare-item');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-270">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-270">&#182;</a>               </div>               <p>console.log('on compare item remove');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-271">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-271">&#182;</a>               </div>               <p>function afterHidden() {
    // console.log('Finished', $compareItem.index(), ':', evt.originalEvent.propertyName);
    // Hide the column
    $compareItem.addClass('hide');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-272">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-272">&#182;</a>               </div>               <pre><code>// Make sure we can press reset
self.$compareReset.removeClass('disabled').addClass('active');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-273">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-273">&#182;</a>               </div>               <pre><code>// Get remaining
remaining = self.$compareItems.not('.hide').length;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-274">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-274">&#182;</a>               </div>               <pre><code>// Set remaining text
self.$compareCount.text( remaining );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-275">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-275">&#182;</a>               </div>               <pre><code>// Hide close button if there are only 2 left
if ( remaining &lt; 3 ) {
  self.$compareTool.find('.compare-item-remove').addClass('hide');
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-276">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-276">&#182;</a>               </div>               <pre><code>self.setCompareWidth();
self.innerScroller.refresh();
self.afterCompareScrolled( self.innerScroller );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-277">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-277">&#182;</a>               </div>               <pre><code>// Maybe they haven't scrolled horizontally to see other images
iQ.update();
</code></pre>

<p>}</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-278">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-278">&#182;</a>               </div>               <p>function noWidth() {
    // console.log('Finished', $compareItem.index(), ':', evt.originalEvent.propertyName );
    $compareItem
      .one( $.support.transition.end, afterHidden )
      .addClass('no-width');
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-279">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-279">&#182;</a>               </div>               <p>if ( Modernizr.csstransitions ) {
    // console.log('adding opacity:0');
    $compareItem
      .one( $.support.transition.end, noWidth )
      .addClass('faded');
  } else {
    afterHidden();
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-280">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-280">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
    onCompareFiltered : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          total = self.$items.length,
          remaining = self.$items.not(<span class="string">'.hide'</span>).length;


      <span class="keyword">if</span> ( total !== remaining ) {
        self.$compareReset.removeClass(<span class="string">'disabled'</span>).addClass(<span class="string">'active'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-281">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-281">&#182;</a>               </div>               <p>Set remaining text</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-282">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-282">&#182;</a>               </div>               <p>Hide close button if there are only 2 left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( remaining &lt; <span class="number">3</span> ) {
        self.$grid.find(<span class="string">'.js-remove-item'</span>).addClass(<span class="string">'hide'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-283">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-283">&#182;</a>               </div>               <p>self.setCompareWidth();
self.innerScroller.refresh();
self.afterCompareScrolled( self.innerScroller );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-284">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-284">&#182;</a>               </div>               <p>Maybe they haven't scrolled horizontally to see other images</p>             </td>             <td class="code">               <div class="highlight"><pre>      iQ.update();
    },

</pre></div>             </td>           </tr>                               <tr id="section-285">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-285">&#182;</a>               </div>               <p>onCompareResize : function( $header, $sortOpts, isFirst ) {
  var self = this,
      windowWidth = self.$window.width(),
      windowHeight = self.$window.height(),
      hasWindowChanged = windowWidth !== self.compareWindowWidth || windowHeight !== self.compareWindowHeight,
      $subheader,
      $resetBtn,
      $sorter,
      snap;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-286">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-286">&#182;</a>               </div>               <p>// If we somehow got here and the compare tool is closed or the window hasn't actually resized, return
  if ( !isFirst &amp;&amp; (!self.isCompareToolOpen || !hasWindowChanged) ) {
    return;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-287">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-287">&#182;</a>               </div>               <p>self.compareWindowWidth = windowWidth;
  self.compareWindowHeight = windowHeight;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-288">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-288">&#182;</a>               </div>               <p>// Phone = sticky header
  if ( Modernizr.mq('(max-width: 47.9375em)') ) {</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-289">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-289">&#182;</a>               </div>               <pre><code>// Setup sticky header
if ( isFirst || !self.isFixedHeader ) {
  self.isFixedHeader = true;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-290">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-290">&#182;</a>               </div>               <pre><code>  $subheader = $('&lt;div class="modal-subheader clearfix"&gt;');
  self.$compareCountWrap.addClass('hidden');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-291">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-291">&#182;</a>               </div>               <pre><code>  // If this isn't the first call, the elements are already on the page and need to be detached
  $resetBtn = isFirst ? self.$compareReset : self.$compareReset.detach();
  $sorter = isFirst ? $sortOpts : $sortOpts.detach();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-292">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-292">&#182;</a>               </div>               <pre><code>  // Put the dropdown menu on the left
  if ( !self.isTouch ) {
    $sorter.find('.dropdown-menu').removeClass('pull-right');
  }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-293">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-293">&#182;</a>               </div>               <pre><code>  $subheader.append( $resetBtn, $sorter );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-294">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-294">&#182;</a>               </div>               <pre><code>  // Insert subhead in the modal header
  $header.append( $subheader );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-295">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-295">&#182;</a>               </div>               <pre><code>  self.$compareItemsWrap.css('marginLeft', '');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-296">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-296">&#182;</a>               </div>               <pre><code>  snap = false;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-297">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-297">&#182;</a>               </div>               <pre><code>  // Let the scroller flow freely on mobile
  if ( self.innerScroller ) {
    self.innerScroller.options.snap = snap;
  }
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-298">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-298">&#182;</a>               </div>               <p>// Larger than phone
  } else {</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-299">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-299">&#182;</a>               </div>               <pre><code>// Set a margin-left on the compare items wrap
self.$compareItemsWrap.css('marginLeft', self.$detailLabelsWrap.width());
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-300">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-300">&#182;</a>               </div>               <pre><code>if ( isFirst || self.isFixedHeader ) {
  self.isFixedHeader = false;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-301">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-301">&#182;</a>               </div>               <pre><code>  self.$compareCountWrap.removeClass('hidden');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-302">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-302">&#182;</a>               </div>               <pre><code>  // Append sort dropdown
  // If this isn't the first call, the elements are already on the page and need to be detached
  $resetBtn = isFirst ? self.$compareReset : self.$compareReset.detach();
  $sorter = isFirst ? $sortOpts : $sortOpts.detach();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-303">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-303">&#182;</a>               </div>               <pre><code>  // Make dropdown menu on the right
  if ( !self.isTouch ) {
    $sorter.find('.dropdown-menu').addClass('pull-right');
  }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-304">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-304">&#182;</a>               </div>               <pre><code>  $header.append( $resetBtn, $sorter );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-305">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-305">&#182;</a>               </div>               <pre><code>  self.$compareTool.find('.modal-subheader').remove();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-306">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-306">&#182;</a>               </div>               <pre><code>  snap = true;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-307">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-307">&#182;</a>               </div>               <pre><code>  // Snap to pages on 'desktop'
  if ( self.innerScroller ) {
    self.innerScroller.options.snap = snap;
  }
}
</code></pre>

<p>}</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-308">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-308">&#182;</a>               </div>               <p>// This is where you get off, first guy
  if ( isFirst ) {
    self.compareState.snap = snap;
    return self;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-309">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-309">&#182;</a>               </div>               <p>self.stickyTriggerPoint = self.getCompareStickyTriggerPoint();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-310">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-310">&#182;</a>               </div>               <p>self
    .setCompareRowHeights()
    .setCompareDimensions()
    .setCompareItemsOffset()
    .setStickyHeaderPos();</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-311">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-311">&#182;</a>               </div>               <p>self.innerScroller.refresh();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-312">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-312">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-313">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-313">&#182;</a>               </div>               <p>onCompareScroll : function( offsetTop, iscroll ) {
  var self = this,
      scrollTop = self.isUsingOuterScroller ? iscroll.y * -1 : self.$compareTool.scrollTop();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-314">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-314">&#182;</a>               </div>               <p>// Determine if this is the inner scroller
  if ( offsetTop === 'inner' ) {
    if ( iscroll.x &lt; -3 &amp;&amp; !self.$detailLabelsWrap.hasClass('overflowing') ) {
      self.$detailLabelsWrap.addClass('overflowing');
    } else if ( iscroll.x >= -3 &amp;&amp; self.$detailLabelsWrap.hasClass('overflowing') ) {
      self.$detailLabelsWrap.removeClass('overflowing');
    }
    return;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-315">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-315">&#182;</a>               </div>               <p>if ( scrollTop >= offsetTop ) {
    if ( !self.$stickyHeaders.hasClass('open') ) {
      self.$compareNav.addClass('sticky-nav-open');
      self.$takeoverStickyHeader.addClass('open');
      self.$stickyHeaders.addClass('open');
    }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-316">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-316">&#182;</a>               </div>               <pre><code>self.setStickyHeaderPos( scrollTop );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-317">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-317">&#182;</a>               </div>               <p>} else {
    if ( self.$stickyHeaders.hasClass('open') ) {
      self.$compareNav.removeClass('sticky-nav-open');
      self.$takeoverStickyHeader.removeClass('open');
      self.$stickyHeaders.removeClass('open');
    }
  }
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-318">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-318">&#182;</a>               </div>               <p>getCompareStickyTriggerPoint : function() {
  var self = this,
      offsetTop = 0,
      extra = 0;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-319">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-319">&#182;</a>               </div>               <p>offsetTop = self.$compareItems.not('.hide').offset().top;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-320">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-320">&#182;</a>               </div>               <p>// see http://bugs.jquery.com/ticket/8362
  if ( offsetTop &lt; 0 &amp;&amp; Modernizr.csstransforms ) {
    var matrix = Utilities.parseMatrix( self.$compareTool.find('.modal-inner').css('transform') );
    offsetTop = -matrix.translateY + offsetTop;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-321">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-321">&#182;</a>               </div>               <p>extra = parseInt( self.$compareTool.find('.compare-item .product-img').last().css('height'), 10 );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-322">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-322">&#182;</a>               </div>               <p>return offsetTop + extra;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-323">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-323">&#182;</a>               </div>               <p>getCompareItems : function( $items ) {
  var $newItems = $();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-324">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-324">&#182;</a>               </div>               <p>// Build / manipulate compare items from the gallery items
  $items.each(function() {
    var $item = $(this),
        $swatches,
        $div = $('<div/>'),
        $stickyHeader;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-325">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-325">&#182;</a>               </div>               <pre><code>// Create remove button, show detail group, remove label, remove product-meta,
// wrap name and model in a container (to set the height on), create fixed header clones
$item
  .removeClass()
  .addClass('span4 compare-item')
  .removeAttr('style')
  .append('&lt;span class="box-close box-close-small compare-item-remove"&gt;&lt;i class="fonticon-10-x"&gt;&lt;/i&gt;&lt;/span&gt;')
  .find('.detail-group')
    .removeClass('hidden')
    .end()
  .find('.label, .product-meta, .js-favorite')
    .remove()
    .end()
  .find('.product-name-wrap')
    .css('height', '')
    .end()
  .prepend('&lt;div class="span4 compare-sticky-header"&gt;')
  .find('.compare-sticky-header')
    .append('&lt;div class="media"&gt;');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-326">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-326">&#182;</a>               </div>               <pre><code>// Remove and reattach the swatches to after the price
$swatches = $item.find('.product-img .color-swatches').detach();
$item.find('.product-price').after($swatches);
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-327">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-327">&#182;</a>               </div>               <pre><code>$stickyHeader = $item.find('.compare-sticky-header');
// Needed to detach swatches before cloning!
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-328">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-328">&#182;</a>               </div>               <pre><code>// Compare X
$item
  .find('.compare-item-remove')
  .clone(true) // true for compare item remove's functionality
  .appendTo( $stickyHeader );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-329">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-329">&#182;</a>               </div>               <pre><code>// Product image to media object
$item
  .find('.product-img .js-product-img-main')
  .clone()
  .addClass('media-object')
  .appendTo( $stickyHeader.find('.media') )
  .wrap('&lt;div class="pull-left"&gt;');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-330">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-330">&#182;</a>               </div>               <pre><code>// Product name wrap to media object
$item
  .find('.product-name-wrap')
  .clone()
  .addClass('media-body')
  .appendTo( $stickyHeader.find('.media') );
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-331">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-331">&#182;</a>               </div>               <pre><code>// Swap .p2 for .p3
$stickyHeader
  .find('.product-name')
  .addClass('p3')
  .removeClass('p2');
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-332">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-332">&#182;</a>               </div>               <pre><code>// Create a new div with the same attributes as the anchor tag
// We no longer want the entire thing to be clickable
$div.attr({
    'class' : $item.attr('class'),
    'data-filter-set' : $item.attr('data-filter-set')
});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-333">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-333">&#182;</a>               </div>               <pre><code>$div.append( $item.children().detach() );
$newItems = $newItems.add( $div );
</code></pre>

<p>});</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-334">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-334">&#182;</a>               </div>               <p>return $newItems;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-335">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-335">&#182;</a>               </div>               <p>addCompareNav : function( $parent ) {
  var $navContainer = $('<nav class="compare-nav">'),
      $prevPaddle = $('<button class="nav-paddle nav-prev"><i class="fonticon-10-chevron-reverse"></i></button>'),
      $nextPaddle = $('<button class="nav-paddle nav-next"><i class="fonticon-10-chevron"></i></button>');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-336">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-336">&#182;</a>               </div>               <p>$navContainer.append( $prevPaddle, $nextPaddle );
  $parent.append( $navContainer );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-337">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-337">&#182;</a>               </div>               <p>this.$compareNav = $navContainer;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-338">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-338">&#182;</a>               </div>               <p>addCompareNavEvents : function() {
  var self = this,
      iscroll = self.innerScroller,
      $prev = self.$compareTool.find('.nav-prev'),
      $next = self.$compareTool.find('.nav-next');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-339">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-339">&#182;</a>               </div>               <p>$prev.on('click', function() {
    iscroll.scrollToPage('prev');
  });</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-340">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-340">&#182;</a>               </div>               <p>$next.on('click', function() {
    iscroll.scrollToPage('next');
  });
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-341">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-341">&#182;</a>               </div>               <p>afterCompareScrolled : function( iscroll ) {
  var self = this,
      $prev = self.$compareTool.find('.nav-prev'),
      $next = self.$compareTool.find('.nav-next');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-342">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-342">&#182;</a>               </div>               <p>// Hide show prev button depending on where we are
  if ( iscroll.currPageX === 0 ) {
    $prev.addClass('hide');
  } else {
    $prev.removeClass('hide');
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-343">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-343">&#182;</a>               </div>               <p>// Hide show next button depending on where we are
  if ( iscroll.currPageX === iscroll.pagesX.length - 1 ) {
    $next.addClass('hide');
  } else {
    $next.removeClass('hide');
  }
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-344">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-344">&#182;</a>               </div>               <p>removeCompareNavEvents : function() {
  this.$compareTool.find('.compare-nav').children().off('click');
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-345">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-345">&#182;</a>               </div>               <p>setTakeoverStickyHeader : function( title ) {
  var self = this;
  self.$takeoverStickyHeader = self.$compareTool.find('.takeover-sticky-header');
  self.$takeoverStickyHeader.find('.sticky-nav-title').text( title );
  self.takeoverHeaderHeight = self.$takeoverStickyHeader.outerHeight();
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
    getY : <span class="keyword">function</span>( y ) {
      <span class="keyword">return</span> [ <span class="keyword">this</span>.valStart, y, <span class="keyword">this</span>.valEnd, <span class="keyword">this</span>.translateZ ].join(<span class="string">''</span>);
    },

</pre></div>             </td>           </tr>                               <tr id="section-346">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-346">&#182;</a>               </div>               <p>setCompareItemsOffset : function() {
  var self = this;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-347">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-347">&#182;</a>               </div>               <p>if ( self.isUsingOuterScroller ) {
    var $containerWithTransform = self.$compareTool.find('.modal-inner'),
        temp = $containerWithTransform.css('transform');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-348">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-348">&#182;</a>               </div>               <pre><code>if ( temp !== 'none' ) {
  $containerWithTransform.css('transform', '');
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-349">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-349">&#182;</a>               </div>               <pre><code>self.compareItemOffset = self.$compareItemsWrap.offset().top;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-350">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-350">&#182;</a>               </div>               <pre><code>if ( temp !== 'none' ) {
  $containerWithTransform.css('transform', temp);
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-351">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-351">&#182;</a>               </div>               <p>} else {
    self.compareItemOffset = self.$compareItemsWrap.offset().top;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-352">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-352">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-353">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-353">&#182;</a>               </div>               <p>Elements here cannot use <code>fixed</code> positioning because of a webkit bug.
Fixed positions don't work inside an element which has <code>transform</code> on it.
https://code.google.com/p/chromium/issues/detail?id=20574
setStickyHeaderPos : function( scrollTop ) {
  var self = this,
      offset,
      compareOffset,
      takeoverValue,
      compareValue;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-354">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-354">&#182;</a>               </div>               <p>if ( !self.showCompareStickyHeaders ) {
    return;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-355">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-355">&#182;</a>               </div>               <p>// If we're not given a scrollTop, figure it out
  if ( scrollTop || scrollTop === 0 ) {
    scrollTop = scrollTop;
  } else {
    scrollTop = self.isUsingOuterScroller ?
      self.outerScroller.y * -1 :
      self.$compareTool.scrollTop();
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-356">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-356">&#182;</a>               </div>               <p>offset = scrollTop - self.compareItemOffset;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-357">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-357">&#182;</a>               </div>               <p>compareOffset = offset + self.takeoverHeaderHeight;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-358">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-358">&#182;</a>               </div>               <p>// We really shouldn't get to this point anyways... IE8
  if ( compareOffset &lt; 0 ) {
    return;
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-359">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-359">&#182;</a>               </div>               <p>compareValue = self.getY( compareOffset );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-360">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-360">&#182;</a>               </div>               <p>// Position the sticky headers. These are relative to .compare-item
  self.$stickyHeaders.css( self.prop, compareValue );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-361">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-361">&#182;</a>               </div>               <p>if ( self.isUsingOuterScroller ) {
    takeoverValue = self.getY( scrollTop );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-362">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-362">&#182;</a>               </div>               <pre><code>// Position takeover header. This is relative to .modal-inner,
// so we can take the outer scroller's y offset
self.$takeoverStickyHeader.css( self.prop, takeoverValue );
</code></pre>

<p>}</p>             </td>             <td class="code">               <div class="highlight"><pre>


</pre></div>             </td>           </tr>                               <tr id="section-363">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-363">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
    setColumnMode : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.isEditorialMode ) {
</pre></div>             </td>           </tr>                               <tr id="section-364">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-364">&#182;</a>               </div>               <p>Make this a 5 column grid. Added to parent because grid must be a descendant of grid5</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( !self.$grid.hasClass(<span class="string">'slimgrid5'</span>) ) {
          self.$grid.addClass(<span class="string">'slimgrid5'</span>);
        }


        self.shuffleColumns = <span class="keyword">function</span>( containerWidth ) {
          <span class="keyword">var</span> column;

</pre></div>             </td>           </tr>                               <tr id="section-365">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-365">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 75em)'</span>) ) {
            column = Settings.COLUMN_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-366">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-366">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( !Modernizr.mediaqueries || Modernizr.mq(<span class="string">'(min-width: 61.25em)'</span>) ) {
            column = Settings.COLUMN_WIDTH_SLIM_5 * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-367">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-367">&#182;</a>               </div>               <p>Portrait Tablet ( 4 columns )
} else if ( Modernizr.mq('(min-width: 48em)') ) {
  column = Settings.COLUMN<em>WIDTH</em>768 * containerWidth;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-368">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-368">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )
568px+</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 35.5em)'</span>) ) {
            column = Settings.COLUMN_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-369">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-369">&#182;</a>               </div>               <p>Phone ( 2 columns )
&lt; 568px</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> {
            column = Settings.COLUMN_WIDTH_320 * containerWidth;
          }


          <span class="keyword">return</span> column;
        };

        self.shuffleGutters = <span class="keyword">function</span>( containerWidth ) {
          <span class="keyword">var</span> gutter,
              numColumns = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-370">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-370">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 75em)'</span>) ) {
            gutter = Settings.GUTTER_WIDTH_SLIM * containerWidth;
            numColumns = <span class="number">6</span>;

</pre></div>             </td>           </tr>                               <tr id="section-371">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-371">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( !Modernizr.mediaqueries || Modernizr.mq(<span class="string">'(min-width: 61.25em)'</span>) ) {
            gutter = Settings.GUTTER_WIDTH_SLIM_5 * containerWidth;
            numColumns = <span class="number">5</span>;

</pre></div>             </td>           </tr>                               <tr id="section-372">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-372">&#182;</a>               </div>               <p>// Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 48em)'</span>) ) {
            numColumns = <span class="number">4</span>;
            gutter = Settings.GUTTER_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-373">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-373">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 35.5em)'</span>) ) {
            gutter = Settings.GUTTER_WIDTH_SLIM * containerWidth;
            numColumns = <span class="number">3</span>;


</pre></div>             </td>           </tr>                               <tr id="section-374">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-374">&#182;</a>               </div>               <p>Phone ( 2 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> {
            gutter = Settings.GUTTER_WIDTH_320 * containerWidth; <span class="comment">// 2% of container width</span>
            numColumns = <span class="number">2</span>;
          }

          self.setColumns(numColumns);

          <span class="keyword">return</span> gutter;
        };


</pre></div>             </td>           </tr>                               <tr id="section-375">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-375">&#182;</a>               </div>               <p>Use the default 12 column slim grid.</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( self.isDetailedMode ) {
        self.shuffleColumns = Utilities.masonryColumns;
        self.shuffleGutters = Utilities.masonryGutters;
      }

      <span class="keyword">return</span> self;
    },

    setColumns : <span class="keyword">function</span>( numColumns ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          allSpans = <span class="string">'span1 span2 span3 span4 span6 m-span3'</span>,
          shuffleDash = <span class="string">'shuffle-'</span>,
          grid = <span class="string">'slimgrid'</span>,
          grid5 = grid+<span class="number">5</span>,
          gridClasses = [ shuffleDash+<span class="number">2</span>, shuffleDash+<span class="number">3</span>, shuffleDash+<span class="number">4</span>, shuffleDash+<span class="number">5</span>, shuffleDash+<span class="number">6</span>, grid, grid5 ].join(<span class="string">' '</span>),
          itemSelector = <span class="string">'.gallery-item'</span>,
          span = <span class="string">'span'</span>,
          mspan = <span class="string">'m-'</span> + span,
          large = <span class="string">'.large'</span>,
          promo = <span class="string">'.promo'</span>,
          normal = <span class="string">'.normal'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-376">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-376">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( numColumns === <span class="number">6</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">6</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-377">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-377">&#182;</a>               </div>               <p>add .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">6</span> + <span class="string">' '</span> + grid)
            .parent()
            .removeClass(grid5);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
              .filter(large) <span class="comment">// Select large tiles</span>
              .addClass(span+<span class="number">6</span>) <span class="comment">// Make them 6/12 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">4</span>) <span class="comment">// Make them 4/12 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(normal) <span class="comment">// Select tiles not large nor promo</span>
              .addClass(span+<span class="number">2</span>); <span class="comment">// Make them 2/12 width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-378">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-378">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">5</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">5</span>) ) {
</pre></div>             </td>           </tr>                               <tr id="section-379">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-379">&#182;</a>               </div>               <p>add .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">5</span> + <span class="string">' '</span> + grid5);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
            .filter(large) <span class="comment">// Select large tiles</span>
              .addClass(span+<span class="number">3</span>) <span class="comment">// Make them 3/5 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">2</span>) <span class="comment">// Make them 2/5 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(normal) <span class="comment">// Select tiles not large nor promo</span>
              .addClass(span+<span class="number">1</span>); <span class="comment">// Make them 1/5 width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-380">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-380">&#182;</a>               </div>               <p>Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">4</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">4</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-381">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-381">&#182;</a>               </div>               <p>Remove .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">4</span> + <span class="string">' '</span> + grid);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">6</span>) <span class="comment">// Make them half width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(large + <span class="string">','</span> + normal) <span class="comment">// Select tiles not promo</span>
              .addClass(span+<span class="number">3</span>); <span class="comment">// Make them quarter width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-382">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-382">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">3</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">3</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-383">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-383">&#182;</a>               </div>               <p>Remove .slimgrid5, add .grid-small</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">3</span> + <span class="string">' '</span> + grid);

</pre></div>             </td>           </tr>                               <tr id="section-384">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-384">&#182;</a>               </div>               <p>Remove current grid span</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid.children(itemSelector)
            .removeClass(allSpans)
            .addClass(span+<span class="number">4</span>);
        }


</pre></div>             </td>           </tr>                               <tr id="section-385">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-385">&#182;</a>               </div>               <p>Phone ( 2 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">2</span> ) {
        <span class="keyword">if</span> ( !self.$grid.parent().hasClass(shuffleDash+<span class="number">2</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-386">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-386">&#182;</a>               </div>               <p>remove .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">2</span> + <span class="string">' '</span> + grid);

</pre></div>             </td>           </tr>                               <tr id="section-387">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-387">&#182;</a>               </div>               <p>Remove current grid span</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid.children(itemSelector)
            .removeClass(allSpans)
            .addClass(mspan+<span class="number">3</span>);
        }
      }
      <span class="keyword">return</span> self;
    }

</pre></div>             </td>           </tr>                               <tr id="section-388">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-388">&#182;</a>               </div>               <p>setCompareDimensions : function() {
  return this
    .setCompareHeight()
    .setCompareWidth();
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-389">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-389">&#182;</a>               </div>               <p>setCompareHeight : function() {
  var self = this,
      windowHeight = Settings.isIPhone || Settings.isAndroid ? window.innerHeight : self.$window.height(); // document.documentElement.clientHeight also wrong</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-390">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-390">&#182;</a>               </div>               <p>self.$compareTool.find('.compare-container').height( self.$compareItems.first().height() );
  self.$compareTool.height( windowHeight );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-391">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-391">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-392">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-392">&#182;</a>               </div>               <p>setCompareWidth : function() {
  var self = this,
      contentWidth = 0;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-393">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-393">&#182;</a>               </div>               <p>// Count it
  self.$compareItems.not('.hide').each(function() {
    contentWidth += $(this).outerWidth(true);
  });</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-394">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-394">&#182;</a>               </div>               <p>// Set it
  self.$compareTool.find('.compare-items-container').width( contentWidth );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-395">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-395">&#182;</a>               </div>               <p>return self;
},</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-396">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-396">&#182;</a>               </div>               <p>setCompareRowHeights : function() {
  var self = this,
      $detailGroup = self.$compareItems.not('.hide').find('.detail-group').first(),
      offset = 0;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-397">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-397">&#182;</a>               </div>               <p>self.$stickyHeaders.evenHeights();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-398">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-398">&#182;</a>               </div>               <p>// Set the height of the product name + model because the text can wrap and make it taller
  self.$compareProductNameWraps.evenHeights();</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-399">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-399">&#182;</a>               </div>               <p>// Set detail rows to even heights
  self.$compareTool.find('.detail-label').each(function(i) {
    var $detailLabel = $(this),
        $detail = self.$compareItems.find('.detail:nth-child(' + (i + 1) + ')');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-400">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-400">&#182;</a>               </div>               <pre><code>// Find all detail lines that have this "name"
$detail.add($detailLabel).evenHeights();
</code></pre>

<p>});</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-401">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-401">&#182;</a>               </div>               <p>// Set the top offset for the labels
  offset = $detailGroup.position().top;
  offset += parseFloat( $detailGroup.css('marginTop') );
  self.$compareTool.find('.detail-label-group').css('top', offset);</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-402">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-402">&#182;</a>               </div>               <p>// Refresh outer iScroll
  if ( self.outerScroller ) {
    self.outerScroller.refresh();
  }</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-403">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-403">&#182;</a>               </div>               <p>return self;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>
  };

</pre></div>             </td>           </tr>                               <tr id="section-404">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-404">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery = <span class="keyword">function</span>( options ) {
    <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
          gallery = self.data(<span class="string">'gallery'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-405">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-405">&#182;</a>               </div>               <p>If we don't have a stored gallery, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !gallery ) {
        gallery = <span class="keyword">new</span> Gallery( self, options );
        self.data( <span class="string">'gallery'</span>, gallery );
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> options === <span class="string">'string'</span> ) {
        gallery[ options ].apply( gallery, args );
      }
    });
  };


</pre></div>             </td>           </tr>                               <tr id="section-406">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-406">&#182;</a>               </div>               <p>Overrideable options</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery.options = {
    mode: <span class="string">'editorial'</span>,
    shuffleSpeed: Settings.shuffleSpeed,
    shuffleEasing: Settings.shuffleEasing
  };

</pre></div>             </td>           </tr>                               <tr id="section-407">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-407">&#182;</a>               </div>               <p>Not overrideable</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery.settings = {
    MIN_PRICE: <span class="literal">undefined</span>,
    MAX_PRICE: <span class="literal">undefined</span>,
    price: {},
    enabled: <span class="literal">true</span>,
    hasEnabledCarousels: <span class="literal">false</span>,
    hasSorterMoved: <span class="literal">false</span>,
    isInitialized: <span class="literal">false</span>,
    isCompareToolOpen: <span class="literal">false</span>,
    isTouch: Settings.hasTouchEvents,
    isiPhone: Settings.isIPhone,
    sorted: <span class="literal">false</span>,
</pre></div>             </td>           </tr>                               <tr id="section-408">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-408">&#182;</a>               </div>               <p>isUsingOuterScroller: !( Settings.isLTIE9 || Settings.isPS3 ),
showCompareStickyHeaders: true,</p>             </td>             <td class="code">               <div class="highlight"><pre>    currentFilterColor: <span class="literal">null</span>,
    lastFilterGroup: <span class="literal">null</span>,
    lastFilterStatuses: <span class="literal">null</span>,
    secondLastFilterGroup: <span class="literal">null</span>,
    secondLastFilterStatuses: <span class="literal">null</span>,
    loadingGif: <span class="string">'img/loader.gif'</span>,
    prop: Modernizr.csstransforms ? <span class="string">'transform'</span> : <span class="string">'top'</span>,
    valStart : Modernizr.csstransforms ? <span class="string">'translate(0,'</span> : <span class="string">''</span>,
    valEnd : Modernizr.csstransforms ? <span class="string">'px)'</span> : <span class="string">'px'</span>,
    translateZ : Modernizr.csstransforms3d ? <span class="string">' translateZ(0)'</span> : <span class="string">''</span>
  };


</pre></div>             </td>           </tr>                               <tr id="section-409">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-409">&#182;</a>               </div>               <p>Event triggered when the previous tab/pane is about to be hidden</p>             </td>             <td class="code">               <div class="highlight"><pre>  module.onGalleryTabShow = <span class="keyword">function</span>( evt ) {
    <span class="keyword">var</span> $prevPane;

    <span class="keyword">if</span> ( evt ) {
      $prevPane = evt.prevPane;
      <span class="keyword">if</span> ( evt.prevPane ) {
        $prevPane = evt.prevPane;
      } <span class="keyword">else</span> <span class="keyword">if</span> ( evt.originalEvent &amp;&amp; evt.originalEvent.prevPane ) {
        $prevPane = evt.originalEvent.prevPane;
      } <span class="keyword">else</span> {
        $prevPane = <span class="literal">false</span>;
      }
    }

    <span class="keyword">if</span> ( !evt || !$prevPane ) {
      <span class="keyword">return</span>;
    }


</pre></div>             </td>           </tr>                               <tr id="section-410">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-410">&#182;</a>               </div>               <p>Loop through each gallery in the tab (there could be more than 1)
Disable the gallery (which disableds shuffle and pauses infinite scrolling) for galleries being hidden</p>             </td>             <td class="code">               <div class="highlight"><pre>    $prevPane.find(<span class="string">'.gallery'</span>).each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> gallery = $(<span class="keyword">this</span>).data(<span class="string">'gallery'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-411">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-411">&#182;</a>               </div>               <p>If there are active filters, remove them.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( gallery.hasActiveFilters() ) {
        gallery.removeActiveFilters();
      }

      gallery.disable();
    });

    $prevPane = <span class="literal">null</span>;

  };

</pre></div>             </td>           </tr>                               <tr id="section-412">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-412">&#182;</a>               </div>               <p>Event triggered when the next tab/pane is finished being shown</p>             </td>             <td class="code">               <div class="highlight"><pre>  module.onGalleryTabShown = <span class="keyword">function</span>( evt ) {
</pre></div>             </td>           </tr>                               <tr id="section-413">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-413">&#182;</a>               </div>               <p>Only continue if this is a tab shown event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">var</span> $pane,
        $galleries;

    <span class="keyword">if</span> ( evt ) {
      $pane = evt.pane;
      <span class="keyword">if</span> ( evt.pane ) {
        $pane = evt.pane;
      } <span class="keyword">else</span> <span class="keyword">if</span> ( evt.originalEvent &amp;&amp; evt.originalEvent.pane ) {
        $pane = evt.originalEvent.pane;
      } <span class="keyword">else</span> {
        $pane = <span class="literal">false</span>;
      }
    }

    <span class="keyword">if</span> ( !evt || !$pane ) {
      <span class="keyword">return</span>;
    }

    $galleries = $pane.find(<span class="string">'.gallery'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-414">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-414">&#182;</a>               </div>               <p>Force redraw before fixing galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>    Utilities.forceWebkitRedraw();

    $galleries.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> gallery = $(<span class="keyword">this</span>).data(<span class="string">'gallery'</span>),
          $collapse = gallery.$container.find(<span class="string">'[data-toggle="collapse"]'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-415">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-415">&#182;</a>               </div>               <p>Enable all galleries in this tab</p>             </td>             <td class="code">               <div class="highlight"><pre>      gallery.enable();

</pre></div>             </td>           </tr>                               <tr id="section-416">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-416">&#182;</a>               </div>               <p>Slide up the collapsable if it's visible</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( $collapse.length &amp;&amp; !$collapse.hasClass(<span class="string">'collapsed'</span>) ) {
        $collapse.click();
      }

      <span class="keyword">if</span> ( gallery ) {
        gallery.fixCarousels();
      }
    });

    $galleries = <span class="literal">null</span>;
    $pane = <span class="literal">null</span>;
  };

  module.removeGalleryLoader = <span class="keyword">function</span>() {
    <span class="keyword">if</span> ( !module.galleryLoaderRemoved ) {
      $(<span class="string">'.gallery-loader'</span>).first().remove();
    }
    module.galleryLoaderRemoved = <span class="literal">true</span>;
  };

  <span class="keyword">return</span> module;

});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 