<!DOCTYPE html>  <html> <head>   <title>hotspots-controller.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="SEN-convergence-e12.html">                 SEN-convergence-e12.js               </a>                                           <a class="source" href="alert-module.html">                 alert-module.js               </a>                                           <a class="source" href="country-region-selection-z10.html">                 country-region-selection-z10.js               </a>                                           <a class="source" href="demo-x99.html">                 demo-x99.js               </a>                                           <a class="source" href="360viewer-controller.html">                 360viewer-controller.js               </a>                                           <a class="source" href="editorial-carousel-e13.html">                 editorial-carousel-e13.js               </a>                                           <a class="source" href="editorial-chapters-e5.html">                 editorial-chapters-e5.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="hotspots-controller.html">                 hotspots-controller.js               </a>                                           <a class="source" href="editorial-layouts-e1.html">                 editorial-layouts-e1.js               </a>                                           <a class="source" href="editorial-slideshows-e4.html">                 editorial-slideshows-e4.js               </a>                                           <a class="source" href="footnotes-module.html">                 footnotes-module.js               </a>                                           <a class="source" href="gallery-g2-g3.html">                 gallery-g2-g3.js               </a>                                           <a class="source" href="global-header-footer.html">                 global-header-footer.js               </a>                                           <a class="source" href="light-compare-d9.html">                 light-compare-d9.js               </a>                                           <a class="source" href="one-sony-carousel-s2.html">                 one-sony-carousel-s2.js               </a>                                           <a class="source" href="pdp-slideshow-d4.html">                 pdp-slideshow-d4.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="product-details-d5.html">                 product-details-d5.js               </a>                                           <a class="source" href="product-summary-d1-d2.html">                 product-summary-d1-d2.js               </a>                                           <a class="source" href="recently-viewed.html">                 recently-viewed.js               </a>                                           <a class="source" href="related-products-g1.html">                 related-products-g1.js               </a>                                           <a class="source" href="reviews-awards-d6.html">                 reviews-awards-d6.js               </a>                                           <a class="source" href="search-results-z07.html">                 search-results-z07.js               </a>                                           <a class="source" href="secondary-touts-s1-s4.html">                 secondary-touts-s1-s4.js               </a>                                           <a class="source" href="sony-video.html">                 sony-video.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="subnavigation-n4.html">                 subnavigation-n4.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="universal-nav.html">                 universal-nav.js               </a>                                           <a class="source" href="unsupported-z19.html">                 unsupported-z19.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="whats-new-tout-s4.html">                 whats-new-tout-s4.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               hotspots-controller.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*global define, Modernizr, log*/</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Editorial Hotspots ------------
Module: Editorial Hotspots E6
Version: 0.9
Modified: 05/12/2013
Dependencies: jQuery 1.7+, Modernizr</p>

<h2>Author: Brian Kenny</h2>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require) {

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require( <span class="string">'jquery'</span> ),
      iQ = require( <span class="string">'iQ'</span> ),
      bootstrap = require( <span class="string">'bootstrap'</span> ),
      enquire = require(<span class="string">'enquire'</span>),
      Settings = require( <span class="string">'require/sony-global-settings'</span> ),
      Environment = require( <span class="string">'require/sony-global-environment'</span> ),
      Utilities = require( <span class="string">'require/sony-global-utilities'</span> );

  <span class="keyword">var</span> self = {
    <span class="string">'init'</span>: <span class="keyword">function</span>() {
      <span class="comment">/*  !! DISABLED SINCE IQ IS EXPENSIVE AND WE'RE NOT WORRIED ABOUT ADAPTIVE IMAGES WHEN THE BROWSER RESIZES
      var breakpoints = [ 360, 479, 567, 640, 767, 979, 1100 ];
      var breakpointReactor = function( e ) {
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>iQ.update();</p>             </td>             <td class="code">               <div class="highlight"><pre>      };

      if( enquire ) {
        for( var i=0; i &lt; breakpoints.length; i++ ) {
          if( 0 === i ) {
            enquire.register( "(max-width: " + breakpoints[ i ] + "px)", breakpointReactor).listen();
          } else {
            enquire.register( "(min-width: " + ( breakpoints[ i-1 ] + 1 ) + "px) and (max-width: " + breakpoints[ i ] + "px)", breakpointReactor).listen();
          }
        }
      } */

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>detect if there are any hotspot containers present</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( <span class="string">'.hotspot-instance'</span> ).each( <span class="keyword">function</span>( index, el ) {
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>for each container, initialize an instance</p>             </td>             <td class="code">               <div class="highlight"><pre>        $( <span class="keyword">this</span> ).hotspotsController({});
      });
    }
  };

  <span class="keyword">var</span> HotspotsController = <span class="keyword">function</span>( element, options ){

    <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>SETUP DEFAULTS
...</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>SELECTORS</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$window                        = Settings.$window;
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>container element holding the hotspots</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$container                     = $( element );
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>collection of hotspots we must initialize</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$els                           = self.$container.find( <span class="string">".hspot-outer"</span> );

<span class="comment">/*
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>COORDINATES AND HOTSPOT STATUS COLLECTION</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$hotspotData                    = [];
*/

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>LAST OPEN</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$lastOpen                       = <span class="literal">null</span>;

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>TRANSITION VARIABLES</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$transitionSpeed                = <span class="number">500</span>;
    self.$lastTimer                      = <span class="literal">null</span>;
    self.lastOverlayTimeout              = <span class="literal">null</span>;
    self.lastWidth                       = <span class="literal">null</span>;
    self.lastHeight                      = <span class="literal">null</span>;
    self.direction                       = <span class="literal">null</span>;
    self.directionV                      = <span class="literal">null</span>;
    self.variant1TopHeight               = <span class="number">145</span>;
    self.variant2TopHeight               = <span class="number">119</span>;
    self.variant1FloorHeight             = <span class="number">100</span>;
    self.variant2FloorHeight             = <span class="number">108</span>;
    self.variant1Differential            = <span class="number">145</span>;
    self.variant2Differential            = <span class="number">120</span>;
    self.showOverlayCentered             = ( $( window ).width() &lt; <span class="number">768</span> ) ? <span class="literal">true</span> : <span class="literal">false</span>;
    self.lastOverlayFadein               = <span class="literal">null</span>;
    self.lastOverlayFadeout              = <span class="literal">null</span>;
    self.lastCenteredOverlay             = <span class="literal">null</span>;
    self.trackingMode                    = <span class="literal">null</span>;
    self.trackingState                   = <span class="string">'off'</span>;
    self.trackOpacity                    = <span class="literal">null</span>;
    self.trackOpacityTimer               = <span class="literal">null</span>;
    self.canShowHotspots                 = <span class="literal">false</span>;
    self.curAnimationCount               = <span class="number">0</span>;
    self.id                              = <span class="literal">null</span>;
    self.variant                         = <span class="literal">null</span>;
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>MODAL</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$modal                          = self.$container.find( <span class="string">'.hotspot-modal'</span> );
    self.$modalBody                      = self.$modal.find( <span class="string">'.modal-body'</span> );
    self.isModalOpen                     = <span class="literal">true</span>;
    self.hasTouch                        = Settings.hasTouchEvents;

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>EXTEND THIS OBJECT TO BE A JQUERY PLUGIN</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.extend( self, {}, $.fn.hotspotsController.defaults, options, $.fn.hotspotsController.settings );
    self.init();
  };

  HotspotsController.prototype = {
    constructor: HotspotsController,
    init : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>inject the underlay node near the top of the dom tree</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*
      var underlayNode = $( '.hspot-underlay' ).get( 0 );
      $( '.hspot-underlay' ).detach();
      $( 'body' ).append( underlayNode );
*/</span>
            
</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>detect what type of tracking we need to bind the instance to</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> moduleHandle = self.$container.parent().find( <span class="string">'.image-module'</span> );
      <span class="keyword">if</span>( moduleHandle.hasClass( <span class="string">'track-by-background'</span> ) ) {
        self.trackingMode   = <span class="string">'background'</span>;
        self.trackingAsset  = moduleHandle;
        self.variant        = <span class="string">'variant1'</span>;
      } <span class="keyword">else</span> {
        self.trackingMode   = <span class="string">'asset'</span>;
        self.trackingAsset  = $( moduleHandle.children( <span class="string">'.iq-img'</span> )[<span class="number">0</span>] );
        self.variant        = <span class="string">'variant2'</span>;
      }
      
      self.id = self.trackingAsset.attr( <span class="string">'id'</span> );

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>IE7 zindex fix</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( Settings.isLTIE8 ) {
</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>address the joke that is stack order and zindexing in IE7  </p>             </td>             <td class="code">               <div class="highlight"><pre>        self.hotspotId = self.id+<span class="string">"-hotspot"</span>;
        $( Settings.$body ).append( <span class="string">'&lt;div class="ltie8-hotspot '</span>+self.variant+<span class="string">'" id="'</span>+self.hotspotId+<span class="string">'" /&gt;'</span> );
        $( Settings.$body ).append( <span class="string">'&lt;div class="ltie8-hotspot-arrow-left-'</span>+self.variant+<span class="string">' hidden" id="'</span>+self.hotspotId+<span class="string">'-arrow-left" /&gt;'</span> );
        $( Settings.$body ).append( <span class="string">'&lt;div class="ltie8-hotspot-arrow-right-'</span>+self.variant+<span class="string">' hidden" id="'</span>+self.hotspotId+<span class="string">'-arrow-right" /&gt;'</span> );
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>in the case of full-inner, reparent the hotspots globally in the case of this blend of editorials</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> $searchAnchor = self.$container.parent().parent(),
            hasInner      = $searchAnchor.hasClass( <span class="string">'full-inner'</span> ),
            $top          = $searchAnchor.find( <span class="string">'.container'</span> ).not( <span class="string">'.inner'</span> ).find( <span class="string">'div.image-module'</span> ),
            $temp         = $searchAnchor.find( <span class="string">'.container.inner'</span> );
        <span class="keyword">if</span>( <span class="literal">true</span> === hasInner ) {
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>reparent the full-inner html behind the hotspots, lets play nice kids...</p>             </td>             <td class="code">               <div class="highlight"><pre>          $top.prepend( $temp.remove() );
        }
      }



</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>when the tracking item changes it's opacity, we trigger the initial flyon animation for the hotspot</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.trackOpacity = <span class="keyword">function</span>() {
        <span class="keyword">switch</span>( self.trackingAsset.css( <span class="string">'opacity'</span> ) ) {
          <span class="keyword">case</span> <span class="literal">undefined</span>:
          <span class="keyword">case</span> <span class="string">"undefined"</span>:
            clearInterval( self.trackOpacityTimer );
          <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">"1"</span>:
            clearInterval( self.trackOpacityTimer );
            self.canShowHotspots = <span class="literal">true</span>;
            triggerInitialPosition();
          <span class="keyword">break</span>;
        }
      };

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>we've been polling for changes to the height of the background, once it is
injected into the DOM as a background image, we stop polling</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.trackHeight = <span class="keyword">function</span>() {
        <span class="keyword">if</span>( <span class="string">"none"</span> !== self.trackingAsset.css( <span class="string">'background-image'</span> ) ) {
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>bg detected, clearing</p>             </td>             <td class="code">               <div class="highlight"><pre>          clearInterval( self.trackOpacityTimer );
          self.canShowHotspots = <span class="literal">true</span>;
          triggerInitialPosition();
        }
      };

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>set up polling for two types if indicators, opacity for inline images with hotspots and
height changes for backgrounds with hotspots</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( <span class="string">'asset'</span> === self.trackingMode ) {
        self.trackOpacityTimer = setInterval( self.trackOpacity, <span class="number">50</span> );
      } <span class="keyword">else</span> {
        self.trackOpacityTimer = setInterval( self.trackHeight, <span class="number">1000</span> );
      }

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>closure used to trigger hotspots for images</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> triggerInitialPosition = <span class="keyword">function</span>() {

        self.follow();
</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>since we're ready to show it, show it!</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.show();
      };

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>initialize hotspot(s)</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( self.$els ).each(<span class="keyword">function</span>( index, el ) {
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>subscribe to events</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.bind( el );
</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>initial placement</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.place( el );
      });


</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>BELOW THIS THRESHHOLD WE ARE FLAGGING THE STATE FOR OTHER FNS TO
REPARTENT OVERLAY NODES TO DISPLAY CENTER OF MODULE</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( enquire ) {
        enquire.register( <span class="string">"(max-width: 767px)"</span> , <span class="keyword">function</span>() {
          self.showOverlayCentered = <span class="literal">true</span>;
          self.follow();
          <span class="keyword">if</span>( self.$lastOpen ) {
            self.reanchor( self.$lastOpen[<span class="number">0</span>], self.$lastOpen[<span class="number">1</span>], self.$lastOpen[<span class="number">2</span>], <span class="literal">true</span> );
          }
        }).listen();

        enquire.register( <span class="string">"(min-width: 768px)"</span> , <span class="keyword">function</span>() {
          self.showOverlayCentered = <span class="literal">false</span>;
          self.follow();
          <span class="keyword">if</span>( self.$lastOpen ) {
            self.reanchor( self.$lastOpen[<span class="number">0</span>], self.$lastOpen[<span class="number">1</span>], self.$lastOpen[<span class="number">2</span>], <span class="literal">false</span> );
          }
        }).listen();

      }

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>listen for modal events</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$modal.on( <span class="string">'show'</span>, $.proxy( self.onModalShow, self ) );
      self.$modal.on( <span class="string">'shown'</span>, $.proxy( self.onModalShown, self ) );
      self.$modal.on( <span class="string">'hidden'</span>, $.proxy( self.onModalClosed, self ) );

      <span class="keyword">if</span> ( Settings.isLTIE9 ) {
        self.$modalBody.removeClass( <span class="string">'fade'</span> );
      }

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>TODO: switch to global throttled scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( window ).scroll( <span class="function"><span class="keyword">function</span> <span class="params">( e )</span> {</span>
          self.trackingState = <span class="string">'fadein'</span>;
          self.follow();
      });

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>TODO: switch to global throttled resize
for inline image type</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( window ).resize( <span class="keyword">function</span>() {
        self.follow();
      });

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>finally, seed the hotspot to fly on 1/2 second after set conditions are met</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout(triggerInitialPosition, <span class="number">500</span>);

      log(<span class="string">'SONY : Editorial Hotspots : Initialized'</span>);
    },

    onModalShow: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self         = <span class="keyword">this</span>,
          windowHeight = self.getMaxModalHeights().maxBodyHeight,
          modalHeight  = self.$modal.height(),
          newOffset    = <span class="number">0</span>;
      
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>newOffset = ( windowHeight / 2 ) - ( modalHeight / 2 );
self.$modal.css( 'top', newOffset+'px' );</p>             </td>             <td class="code">               <div class="highlight"><pre>      
      self.$modal.css( <span class="string">'top'</span>, <span class="string">'0px'</span> );
      <span class="keyword">return</span>;
    },

    onModalShown : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.isModalOpen = <span class="literal">true</span>;

      evt.stopPropagation();

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Update max height for modal body</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.getMaxModalHeights();
    },

    onModalClosed : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      evt.stopPropagation();

      <span class="keyword">if</span> ( <span class="literal">true</span> <span class="comment">/* self.hasTouch */</span> ) {
        $( <span class="string">'body'</span> ).css({
          height: <span class="string">''</span>,
          maxHeight: <span class="string">''</span>,
          overflow: <span class="string">''</span>
        });
      }

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>self.$modal.css( 'height', '' );
self.$modalBody.removeClass('in'); // need this?</p>             </td>             <td class="code">               <div class="highlight"><pre>
      self.isModalOpen = <span class="literal">false</span>;
      self.isFadedIn = <span class="literal">false</span>;

      <span class="keyword">if</span>( <span class="literal">true</span> === self.showOverlayCentered ) {
        self.close( self.$lastOpen[ <span class="number">0</span> ], self.$lastOpen[ <span class="number">1</span> ], self.$lastOpen[ <span class="number">2</span> ] );
      }

      $( <span class="string">'body'</span> ).find( <span class="string">'.modal-backdrop'</span> ).remove();

    },

    getMaxModalHeights : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          screenHeight,
          maxModalHeight,
          modalHeaderHeight,
          maxBodyHeight;

      screenHeight = self.$window.height();

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>90% of the available height</p>             </td>             <td class="code">               <div class="highlight"><pre>      maxModalHeight = <span class="number">0.9</span> * screenHeight;

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Lock it at 90% or 900px</p>             </td>             <td class="code">               <div class="highlight"><pre>      maxModalHeight = Math.min( maxModalHeight, <span class="number">900</span> );

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Get the combined height of the header and subheader</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="comment">/* modalHeaderHeight = self.$modalHeader.outerHeight() + self.$modalSubhead.outerHeight(); */</span>

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Get the max height of the body</p>             </td>             <td class="code">               <div class="highlight"><pre>      maxBodyHeight = maxModalHeight; <span class="comment">// - modalHeaderHeight;</span>

</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>console.log('screenHeight: ' + screenHeight, ' maxModalHeight: ' + maxModalHeight, ' modalHeaderHeight: ' + modalHeaderHeight, ' maxBodyHeight: ' + maxBodyHeight);</p>             </td>             <td class="code">               <div class="highlight"><pre>
      <span class="keyword">return</span> {
        maxModalHeight: maxModalHeight,
        maxBodyHeight: maxBodyHeight
      };
    },


    follow: <span class="keyword">function</span>( doShowAfterFollow ) {
      <span class="keyword">var</span> self       = <span class="keyword">this</span>,
          inViewport = <span class="literal">null</span>;

      <span class="keyword">if</span>( <span class="string">'asset'</span> === self.trackingMode ) {
        self.$els.each( <span class="keyword">function</span>( index, el) {
          <span class="keyword">var</span> offsetX     = self.trackingAsset.position().left,
              offsetY     = self.trackingAsset.position().top,
              percX       = $( el ).data( <span class="string">"x"</span> ).replace( <span class="string">'%'</span>, <span class="string">''</span> ),
              percY       = $( el ).data( <span class="string">"y"</span> ).replace( <span class="string">'%'</span>, <span class="string">''</span> ),
              assetW      = self.trackingAsset.width(),
              assetH      = self.trackingAsset.innerHeight(),
              adjustedX   = <span class="literal">null</span>,
              adjustedY   = <span class="literal">null</span>,
              widthOffset = <span class="number">0</span>,
              heightOffset = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>compensate for centering in the parent node
if( $( window ).width() > 768 ) {</p>             </td>             <td class="code">               <div class="highlight"><pre>                widthOffset = ( self.trackingAsset.parent().width() - assetW ) / <span class="number">2</span>;
                heightOffset = parseInt( self.trackingAsset.parent().css( <span class="string">'padding-top'</span> ), <span class="number">10</span> );
</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>}
get x coordinate</p>             </td>             <td class="code">               <div class="highlight"><pre>              adjustedX = ( percX * assetW ) / <span class="number">100</span> + widthOffset;
              adjustedY = ( percY * assetH ) / <span class="number">100</span> + heightOffset;

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>lets stop animation</p>             </td>             <td class="code">               <div class="highlight"><pre>              $( el ).css( <span class="string">"left"</span>, adjustedX );
              $( el ).css( <span class="string">"top"</span>, adjustedY );
        });
      }
    },

    disableScroll: <span class="keyword">function</span>( flag ) {
      <span class="keyword">if</span>( flag ) {
        document.documentElement.style.overflow = <span class="string">'hidden'</span>;  <span class="comment">// firefox, chrome</span>
        document.body.scroll = <span class="string">"no"</span>; <span class="comment">// ie only</span>
      } <span class="keyword">else</span> {
        document.documentElement.style.overflow = <span class="string">'auto'</span>;  <span class="comment">// firefox, chrome</span>
        document.body.scroll = <span class="string">"yes"</span>; <span class="comment">// ie only</span>
      }
    },

    hover: <span class="keyword">function</span>( el, self, flag ) {
      <span class="keyword">switch</span>(flag) {
        <span class="keyword">case</span> <span class="literal">true</span>:
          $( el ).find( <span class="string">'.hspot-core, .hspot-core-on'</span> ).removeClass( <span class="string">'hspot-hover-off'</span> ).addClass( <span class="string">'hspot-hover-on'</span> );
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="literal">false</span>:
          $( el ).find( <span class="string">'.hspot-core, .hspot-core-on'</span> ).removeClass( <span class="string">'hspot-hover-on'</span> ).addClass( <span class="string">'hspot-hover-off'</span> );
        <span class="keyword">break</span>;
      }
    },

    bind: <span class="keyword">function</span>( el ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>hotspot clicks</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( $( el ).find( <span class="string">'.hspot-core'</span> ) ).bind( <span class="string">'click'</span>, <span class="keyword">function</span>( event ) {
        self.click( event, self );
      });

      $( $( el ).find( <span class="string">'.hspot-core'</span> ) ).bind( <span class="string">'mouseover'</span>, <span class="keyword">function</span>( event ) {
        self.hover( el, self, <span class="literal">true</span> );
      });

      $( $( el ).find( <span class="string">'.hspot-core'</span> ) ).bind( <span class="string">'mouseout'</span>, <span class="keyword">function</span>( event ) {
        self.hover( el, self, <span class="literal">false</span> );
      });

    },

    place: <span class="keyword">function</span>( el ) {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">if</span>( <span class="string">'background'</span> === self.trackingMode ) {

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>this places the hotspot absolutely (currently by % fed from data-x,-y attrib)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> xAnchor = $( el ).data( <span class="string">"x"</span> );
        <span class="keyword">var</span> yAnchor = $( el ).data( <span class="string">"y"</span> );
        $( el ).css( <span class="string">"left"</span>, xAnchor );
        $( el ).css( <span class="string">"top"</span>, yAnchor );
      } <span class="keyword">else</span> {
        self.follow( el );
      }
    },

    show: <span class="keyword">function</span>( el ) {
      <span class="keyword">var</span> self        = <span class="keyword">this</span>,
          offsetTime  = <span class="number">400</span>;

      <span class="keyword">if</span>( <span class="literal">true</span> === self.canShowHotspots ) {
        $( self.$els ).each(<span class="keyword">function</span>( index, el ) {
          <span class="keyword">if</span>( $( el ).hasClass( <span class="string">'eh-transparent'</span> ) ) {
            <span class="keyword">var</span> stagger = <span class="keyword">function</span>() {
              $( el ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
            };
            setTimeout( stagger, ( self.curAnimationCount * offsetTime ) );
            self.curAnimationCount++;
          }
        });
      }
    },

    find: <span class="keyword">function</span>( currentTarget ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.$els.each( <span class="keyword">function</span>( index, el ) {
        <span class="keyword">if</span>( $( el ).is( currentTarget ) ) {
          <span class="keyword">return</span> el;
        }
      });
    },

    click: <span class="keyword">function</span>( event, self ) {
      <span class="keyword">var</span> container = $( event.currentTarget ).parent(),
          hotspot   = container.find( <span class="string">'.hspot-core, .hspot-core-on'</span> ),
          info      = container.find( <span class="string">'.overlay-base'</span> );

      <span class="keyword">if</span>( container.data( <span class="string">'state'</span> ) == <span class="string">'open'</span> ) {
        self.close( container, hotspot, info );
      } <span class="keyword">else</span> {
        <span class="keyword">if</span>( self.$lastOpen &amp;&amp; !container.is( self.$lastOpen ) ) {
          self.reset();
        }
         self.open( container, hotspot, info );
      }
    },

    reanchor: <span class="keyword">function</span>( container, hotspot, info, placeInModal ) {
      <span class="keyword">var</span> self          = <span class="keyword">this</span>,
          maxBodyHeight = <span class="literal">null</span>,
          screenHeight  = <span class="literal">null</span>,
          $modal        = self.$modal.find( <span class="string">'.modal-body'</span> );

      <span class="keyword">if</span>( placeInModal ) {
        info.addClass( <span class="string">'hidden'</span> );
</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>defer trigger modal</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {

          maxBodyHeight = <span class="string">'none'</span>;

          <span class="keyword">if</span> ( <span class="literal">true</span> <span class="comment">/* self.hasTouch */</span> ) {
            screenHeight = Settings.isIPhone || Settings.isAndroid ? window.innerHeight : self.$window.height();
</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Stop the page from scrolling behind the modal</p>             </td>             <td class="code">               <div class="highlight"><pre>            $( <span class="string">'body'</span> ).css({
              height: screenHeight,
              maxHeight: screenHeight,
              overflow: <span class="string">'hidden'</span>
            });
          }

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Set a maximum height on the modal body so that it will scroll
Sony tablet s is completely busted in the modal....</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !Settings.isSonyTabletS ) {
            self.$modalBody.css( <span class="string">'maxHeight'</span>, maxBodyHeight );
          }

          self.$modal.css( <span class="string">'height'</span>, <span class="string">''</span> );
        }, <span class="number">0</span>);

        $modal.html( info.html() );

        $modal.find( <span class="string">'.overlay-inner'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );

        $modal.find( <span class="string">'.box-close'</span> ).removeClass( <span class="string">'hidden'</span> );

        self.$modal.modal({
          backdrop: <span class="literal">true</span>,
          keyboard: <span class="literal">true</span>,
          show: <span class="literal">true</span>
        });

      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>self.close( container, hotspot, info );</p>             </td>             <td class="code">               <div class="highlight"><pre>        info.removeClass( <span class="string">'hidden'</span> );
        info.find( <span class="string">'.overlay-base'</span> ).removeClass( <span class="string">'hidden'</span> );
        info.find( <span class="string">'.overlay-inner'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
        self.$modal.modal( <span class="string">'hide'</span> );
      }
    },

    repositionByQuadrant: <span class="keyword">function</span>( el, fromResize ) {
</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>this function will reposition the hotspots in a simple way: by calculating what quadrant the hotspot is nested, and open the
hotspot overlay in the most likely ideal position, i.e. quadrant 1 should have a hotspot appear left of it,</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> self                  = <span class="keyword">this</span>,
          $parentContainer       = el.parent(),
          parentWidth            = $parentContainer.width(),
          parentHeight           = $parentContainer.height(),
          $hotspot               = el,
          hotspotPosition        = $hotspot.position(),
          $overlay               = el.find( <span class="string">'.overlay-base'</span> ),
          variantSmall           = $overlay.hasClass( <span class="string">'variant2'</span> ) ? <span class="literal">true</span> : <span class="literal">false</span>,
          $top                   = $overlay.find( <span class="string">'.top'</span> ),
          topHeight              = $top.height(),
          hasTop                 = topHeight &gt; <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>,
          $bottom                = $overlay.find( <span class="string">'.footer'</span> ),
          hasBottom              = $bottom.html() === <span class="string">""</span> ? <span class="literal">false</span> : <span class="literal">true</span>,
          $middle                = $overlay.find( <span class="string">'.middle'</span> ),
          middleHeight           = ( <span class="literal">false</span> === hasTop &amp;&amp; <span class="literal">false</span> === hasBottom ) ? $middle.outerHeight() - $middle.css( <span class="string">'padding-bottom'</span> ).replace( <span class="string">'px'</span>, <span class="string">''</span> ) : $middle.outerHeight(),
          topOffsetLowLg         = ( ( middleHeight * <span class="number">73.26102088</span> ) / <span class="number">100</span> ) + topHeight,
          topOffsetHighLg        = ( ( middleHeight * <span class="number">11.11111111</span> ) / <span class="number">100</span> ) + topHeight,
          topOffsetLowSm         = ( ( middleHeight * <span class="number">74.50000000</span> ) / <span class="number">100</span> ) + topHeight,
          topOffsetHighSm        = ( ( middleHeight * <span class="number">10.71428571</span> ) / <span class="number">100</span> ) + topHeight,
          topOffsetLow           = variantSmall ? topOffsetLowSm : topOffsetLowLg,
          topOffsetHigh          = variantSmall ? topOffsetHighSm : topOffsetHighLg,
          side                   = [],
          quadrant               = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>what horizontal half are we in?</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span>( hotspotPosition.left &lt; ( parentWidth / <span class="number">2</span> ) ) {
            side[<span class="number">0</span>] = <span class="number">2</span>;
          } <span class="keyword">else</span> {
            side[<span class="number">0</span>] = <span class="number">4</span>;
          }

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>what vertical half are we in?</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span>( hotspotPosition.top &lt; ( parentHeight / <span class="number">2</span> ) ) {
            side[<span class="number">1</span>] = <span class="number">6</span>;
          } <span class="keyword">else</span> {
            side[<span class="number">1</span>] = <span class="number">7</span>;
          }

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>sum up the answer, just chose 4 weights that would never sum up the same</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">switch</span>( ( side[ <span class="number">0</span> ] + side[ <span class="number">1</span> ] ) ) {
            <span class="keyword">case</span> <span class="number">8</span>:
              quadrant = <span class="number">2</span>;
            <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">10</span>:
              quadrant = <span class="number">1</span>;
            <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">9</span>:
              quadrant = <span class="number">3</span>;
            <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">11</span>:
              quadrant = <span class="number">4</span>;
            <span class="keyword">break</span>;
          }

</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>adjust layout classes per quadrant</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">switch</span>( quadrant ) {
            <span class="keyword">case</span> <span class="number">1</span>:
            <span class="keyword">case</span> <span class="number">4</span>:
</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>position overlay to the left of hotspot</p>             </td>             <td class="code">               <div class="highlight"><pre>              $overlay.addClass( <span class="string">'to-left'</span> );
              $overlay.parent().find( <span class="string">'.arrow-right'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
              quadrant === <span class="number">1</span> ? $overlay.css( <span class="string">'top'</span>, <span class="string">'-'</span>+topOffsetHigh+<span class="string">'px'</span> ) : $overlay.css( <span class="string">'top'</span>, <span class="string">'-'</span>+topOffsetLow+<span class="string">'px'</span> );
            <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">2</span>:
            <span class="keyword">case</span> <span class="number">3</span>:
</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>add to-right</p>             </td>             <td class="code">               <div class="highlight"><pre>              $overlay.addClass( <span class="string">'to-right'</span> );
              $overlay.parent().find( <span class="string">'.arrow-left'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
              quadrant === <span class="number">2</span> ? $overlay.css( <span class="string">'top'</span>, <span class="string">'-'</span>+topOffsetHigh+<span class="string">'px'</span> ) : $overlay.css( <span class="string">'top'</span>, <span class="string">'-'</span>+topOffsetLow+<span class="string">'px'</span> );
            <span class="keyword">break</span>;
          }

    },

    transition: <span class="keyword">function</span>( collection, direction ) {
      $( collection ).each( <span class="keyword">function</span>( index, _el ) {
        <span class="keyword">switch</span>(direction) {
          <span class="keyword">case</span> <span class="string">"on"</span>:
            $( _el ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
          <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">"off"</span>:
            $( _el ).removeClass( <span class="string">'eh-visible'</span> ).addClass( <span class="string">'eh-transparent'</span> );
          <span class="keyword">break</span>;
        }
      });
    },

    close: <span class="keyword">function</span>( container, hotspot, info ) {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>we are setting display:none when the trasition is complete, and managing the timer here</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.cleanTimer();

</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>save last close state</p>             </td>             <td class="code">               <div class="highlight"><pre>        container.data( <span class="string">'state'</span>, <span class="string">'closed'</span> ).removeClass( <span class="string">'info-jump-to-top'</span> );

</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>perform CSS transitions</p>             </td>             <td class="code">               <div class="highlight"><pre>        hotspot.removeClass( <span class="string">'hspot-core-on'</span> ).addClass( <span class="string">'hspot-core'</span> );

        <span class="keyword">if</span>( Settings.isLTIE8 || Settings.isLTIE9 ) {
          hotspot.parent().removeClass( <span class="string">'ie-on'</span> );
        }


        <span class="keyword">if</span>( Settings.isLTIE8 ) {
          $( Settings.$body ).find( <span class="string">'#'</span>+self.hotspotId ).html( <span class="string">''</span> );
          $( <span class="string">'#'</span>+self.hotspotId+<span class="string">'-arrow-left'</span> ).addClass( <span class="string">'hidden'</span> );
          $( <span class="string">'#'</span>+self.hotspotId+<span class="string">'-arrow-right'</span> ).addClass( <span class="string">'hidden'</span> );
        }
        
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>begin fade out</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.transition([
          info.parent().find(<span class="string">'.arrow-left'</span>),
          info.parent().find(<span class="string">'.arrow-right'</span>),
          info.find(<span class="string">'.overlay-inner'</span>)
        ], <span class="string">'off'</span> );

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>closure to hide overlays after they fade out</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> anon = <span class="keyword">function</span>() {
          info.addClass( <span class="string">'hidden'</span> );
        };

</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>fire a timer that will set the display to none when the element is closed.</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$lastTimer = setTimeout( anon, self.$transitionSpeed );

</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>set the open status to zilch</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$lastOpen = <span class="literal">null</span>;

    },

    open: <span class="keyword">function</span>( container, hotspot, info ) {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>we are setting display:none when the trasition is complete, and managing the timer here</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>( self.$lastOpen &amp;&amp; container.is( self.$lastOpen[<span class="number">0</span>] ) ) {
          self.cleanTimer();
        }

</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>save last open state</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$lastOpen = <span class="keyword">new</span> Array( container, hotspot, info );

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>add data- info to this hotspot</p>             </td>             <td class="code">               <div class="highlight"><pre>        container.data( <span class="string">'state'</span>, <span class="string">'open'</span> ).addClass( <span class="string">'info-jump-to-top'</span> );

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>perform CSS transitions</p>             </td>             <td class="code">               <div class="highlight"><pre>        hotspot.removeClass( <span class="string">'hspot-core'</span> ).addClass( <span class="string">'hspot-core-on'</span> );

        <span class="keyword">if</span>( Settings.isLTIE8 || Settings.isLTIE9 ) {
          hotspot.parent().addClass( <span class="string">'ie-on'</span> );
        }

</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>we have to set display: block to allow DOM to calculate dimension</p>             </td>             <td class="code">               <div class="highlight"><pre>        info.removeClass( <span class="string">'hidden'</span> );

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>reposition window per it's collision detection result</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.repositionByQuadrant( container );
</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>self.reposition( container );</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>fade in info window</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>( <span class="literal">true</span> === self.showOverlayCentered ) {
</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>$( '.hspot-global-details-overlay' ).find( '.overlay-inner' ).removeClass( 'eh-transparent' ).addClass( 'eh-visible' );</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.reanchor( container, hotspot, info, <span class="literal">true</span> );
        } <span class="keyword">else</span> {
          <span class="keyword">if</span>( Settings.isLTIE8 ) {
</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>turn on the window</p>             </td>             <td class="code">               <div class="highlight"><pre>            info.find( <span class="string">'.overlay-inner'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> );
</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>get the global handle for iE7</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> $ieHackAttack = $( Settings.$body ).find( <span class="string">'#'</span>+self.hotspotId );
</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>apply the offset window value </p>             </td>             <td class="code">               <div class="highlight"><pre>            $ieHackAttack.css({
              <span class="string">'left'</span>: info.offset().left,
              <span class="string">'top'</span>: info.offset().top
            });
            $ieHackAttack.html( info.html() );
</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>orient the correct arrow and turn it on</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> $arrow, $arrow_global;
            <span class="keyword">if</span>( info.hasClass( <span class="string">'to-right'</span> ) ) {
              $arrow_global = $( <span class="string">'#'</span>+self.hotspotId+<span class="string">'-arrow-left'</span> );
              $arrow = $( hotspot ).parent().find( <span class="string">'.arrow-left'</span> );
            } <span class="keyword">else</span> {
              $arrow_global = $( <span class="string">'#'</span>+self.hotspotId+<span class="string">'-arrow-right'</span> );
              $arrow = $( hotspot ).parent().find( <span class="string">'.arrow-right'</span> );
            }
            $arrow_global.removeClass( <span class="string">'hidden'</span> ).css({
              <span class="string">'left'</span>: $arrow.offset().left,
              <span class="string">'top'</span>: $arrow.offset().top
            });
          } <span class="keyword">else</span> {
            info.find( <span class="string">'.overlay-inner'</span> ).removeClass( <span class="string">'eh-transparent'</span> ).addClass( <span class="string">'eh-visible'</span> ); 
          }
        }
    },

    reset: <span class="keyword">function</span>( container ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.close( self.$lastOpen[ <span class="number">0</span> ], self.$lastOpen[ <span class="number">1</span> ], self.$lastOpen[ <span class="number">2</span> ] );
    },

    defaultPositions: <span class="keyword">function</span>() {
      <span class="keyword">for</span>(<span class="keyword">var</span> el <span class="keyword">in</span> self.$els) {

      }
    },

    cleanTimer: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">if</span>( self.$lastTimer ) {
        clearTimeout( self.$lastTimer );
      }
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.hotspotsController = <span class="keyword">function</span>( options ) {
    <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
        hotspotsController = self.data(<span class="string">'hotspotsController'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>If we don't have a stored tertiaryModule, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( !hotspotsController ) {
            hotspotsController = <span class="keyword">new</span> HotspotsController( self, options );
            self.data( <span class="string">'hotspotsController'</span>, hotspotsController );
        }

        <span class="keyword">if</span> ( <span class="keyword">typeof</span> options === <span class="string">'string'</span> ) {
          hotspotsController[ options ].apply( hotspotsController, args );
        }
      });
  };

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Defaults options for the module</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.hotspotsController.defaults = {
    options : {

    }
  };

  <span class="keyword">return</span> self;

});
</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 