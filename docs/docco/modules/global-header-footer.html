<!DOCTYPE html>  <html> <head>   <title>global-header-footer.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="country-region-selection-z10.html">                 country-region-selection-z10.js               </a>                                           <a class="source" href="editorial-carousel-e13.html">                 editorial-carousel-e13.js               </a>                                           <a class="source" href="editorial-chapters-e5.html">                 editorial-chapters-e5.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="hotspots-controller.html">                 hotspots-controller.js               </a>                                           <a class="source" href="editorial-layouts-e1.html">                 editorial-layouts-e1.js               </a>                                           <a class="source" href="editorial-slideshows-e4.html">                 editorial-slideshows-e4.js               </a>                                           <a class="source" href="footnotes-module.html">                 footnotes-module.js               </a>                                           <a class="source" href="gallery-g2-g3.html">                 gallery-g2-g3.js               </a>                                           <a class="source" href="global-header-footer.html">                 global-header-footer.js               </a>                                           <a class="source" href="one-sony-carousel-s2.html">                 one-sony-carousel-s2.js               </a>                                           <a class="source" href="pdp-slideshow-d4.html">                 pdp-slideshow-d4.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="product-details-d5.html">                 product-details-d5.js               </a>                                           <a class="source" href="product-summary-d1-d2.html">                 product-summary-d1-d2.js               </a>                                           <a class="source" href="recently-viewed.html">                 recently-viewed.js               </a>                                           <a class="source" href="related-products-g1.html">                 related-products-g1.js               </a>                                           <a class="source" href="reviews-awards-d6.html">                 reviews-awards-d6.js               </a>                                           <a class="source" href="secondary-touts-s1-s4.html">                 secondary-touts-s1-s4.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="unsupported-z19.html">                 unsupported-z19.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="whats-new-tout-s4.html">                 whats-new-tout-s4.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               global-header-footer.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*global SONY*/</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Global Nav ------------
Module: Global Nav
Version: 1.0
Modified: 2012-12-17 by Christopher Mischler
Dependencies: jQuery 1.7+, Modernizr</p>

<h2>Optional: jQuery throttle-debounce (only used on window resize)</h2>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require){

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
      bootstrap = require(<span class="string">'bootstrap'</span>),
      Modernizr = require(<span class="string">'modernizr'</span>),
      enquire = require(<span class="string">'enquire'</span>),
      iQ = require(<span class="string">'iQ'</span>),
      Settings = require(<span class="string">'require/sony-global-settings'</span>),
      Utilities = require(<span class="string">'require/sony-global-utilities'</span>),
      Environment = require(<span class="string">'require/sony-global-environment'</span>),
      formActions = require(<span class="string">'secondary/form-actions'</span>);

  <span class="keyword">var</span> module = {
    init: <span class="keyword">function</span>() {
      $(<span class="string">'#nav-wrapper'</span>).globalNav();
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Start module</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> GlobalNav = <span class="keyword">function</span>($container) {

    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    self.usernameSpace = <span class="number">40</span>;
    self.minUsernameLength = <span class="number">6</span>;
    self.searchMenu = {};
    self.$html = Settings.$html;
    self.$window = Settings.$window;
    self.$container = $container;
    self.$activeNavBtns = self.$container.find(<span class="string">'.nav-dropdown-toggle'</span>);
    self.$navbar = $(<span class="string">'#navbar'</span>);
    self.$currentOpenNavBtn = <span class="literal">false</span>;
    self.$pageWrapOuter = $(<span class="string">'#page-wrap-outer'</span>);
    self.$accountUsername = $(<span class="string">'#nav-account-btn'</span>).find(<span class="string">'.username'</span>);
    self.fullAccountUsername = self.$accountUsername.text();
    self.mobileNavIScroll = <span class="literal">false</span>, self.mobileNavVisible = <span class="literal">false</span>;
    self.mobileNavThreshold = <span class="number">767</span>;
    self.mobileFooterThreshold = <span class="number">567</span>;
    self.mouseLeaveDelay = <span class="number">500</span>;
    self.active = <span class="literal">false</span>;
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>delay in ms</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.mouseleaveTimer = <span class="literal">false</span>;

    <span class="keyword">if</span> (Modernizr.touch) {
      self.hasTouch = <span class="literal">true</span>;
    }
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Get the right prefixed names e.g. WebkitTransitionDuration</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.tapOrClick = self.hasTouch ? <span class="string">'touchstart'</span> : <span class="string">'click'</span>;
    self.transformName = Modernizr.prefixed(<span class="string">'transform'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>css version</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.transitionName = Modernizr.prefixed(<span class="string">'transition'</span>);
    self.transitionProperty = Modernizr.prefixed(<span class="string">'transitionProperty'</span>);
    self.transitionDuration = Modernizr.prefixed(<span class="string">'transitionDuration'</span>);
    self.transitionEasing = Modernizr.prefixed(<span class="string">'transitionTimingFunction'</span>);
    self.transitionEnd = Settings.transEndEventName;

    self.init();

  };

  GlobalNav.prototype = {

    constructor : GlobalNav,

    init : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.isInitialized = <span class="literal">true</span>;
      self.isDesktopNav = <span class="literal">false</span>;
      self.isMobileNav = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Setting up enquire listeners.
These fire the first time they're hit (page-load), and if the breakpoint becomes active during browser resize.</p>             </td>             <td class="code">               <div class="highlight"><pre>
      <span class="keyword">if</span> ( !Settings.isLTIE10 ) {

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>switch to desktop nav</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.enquire.register(<span class="string">'(min-width: '</span> + (self.mobileNavThreshold + <span class="number">1</span>) + <span class="string">'px)'</span>, {
          match : <span class="keyword">function</span>() {
            self.initDesktopNav();
            self.resetMobileNav();
            self.$html.removeClass(<span class="string">'bp-nav-mobile'</span>).addClass(<span class="string">'bp-nav-desktop'</span>);
            self.isDesktopNav = <span class="literal">true</span>;
            self.isMobileNav = <span class="literal">false</span>;
          }

        });
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>switch to desktop footer</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.enquire.register(<span class="string">'(min-width: '</span> + (self.mobileFooterThreshold + <span class="number">1</span>) + <span class="string">'px)'</span>, {
          match : <span class="keyword">function</span>() {
            self.resetMobileFooter();
          }
        });

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>switch to mobile nav</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.enquire.register(<span class="string">'(max-width: '</span> + self.mobileNavThreshold + <span class="string">'px)'</span>, {
          match : <span class="keyword">function</span>() {
            self.initMobileNav();
            self.resetDesktopNav();
            self.$html.removeClass(<span class="string">'bp-nav-desktop'</span>).addClass(<span class="string">'bp-nav-mobile'</span>);
            self.isDesktopNav = <span class="literal">false</span>;
            self.isMobileNav = <span class="literal">true</span>;
          }

        });
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>switch to mobile footer</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.enquire.register(<span class="string">'(max-width: '</span> + self.mobileFooterThreshold + <span class="string">'px)'</span>, {
          match : <span class="keyword">function</span>() {
            self.initMobileFooter();
          }

        });
      } <span class="keyword">else</span> {
        self.initDesktopNav();
        self.resetMobileNav();
        self.$html.removeClass(<span class="string">'bp-nav-mobile'</span>).addClass(<span class="string">'bp-nav-desktop'</span>);
        self.isDesktopNav = <span class="literal">true</span>;
        self.isMobileNav = <span class="literal">false</span>;
      }
    },

    initDesktopNav : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>add a click event to close the currently open navmenu/navtray if you click outside of it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$pageWrapOuter.on(<span class="string">'click touchstart focus'</span>,<span class="keyword">function</span>(e) {
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>as long as the click wasn't on one of the nav-menu/trays, or one of their children, or one of the activeNavBtns, reset any active menus.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> clickIsInNavItem = $(e.target).hasClass(<span class="string">'navtray-w'</span>) || $(e.target).hasClass(<span class="string">'navmenu-w'</span>) || $(e.target).hasClass(<span class="string">'nav-dropdown-toggle'</span>) || $(e.target).parents(<span class="string">'.navtray-w,.navmenu-w,nav-dropdown-toggle, .nav'</span>).length &gt; <span class="number">0</span>;
        <span class="keyword">if</span> (!clickIsInNavItem){
          $(<span class="string">'.nav .nav-li a.active'</span>).trigger(<span class="string">'touchstart'</span>);
          self.resetActiveNavBtn($(<span class="string">'.nav-dropdown-toggle.active'</span>));
          $(<span class="string">'#nav-search-input'</span>).blur();
        }
      });
      
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Set up primary nav buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$activeNavBtns.each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $thNavBtn = $(<span class="keyword">this</span>), $thNavBtnTarget = $(<span class="string">'.'</span> + $thNavBtn.data(<span class="string">'target'</span>)), $thNavBtnAndTarget = $thNavBtn.add($thNavBtnTarget);

        $thNavBtn.on(<span class="string">'click touchstart'</span>, <span class="keyword">function</span>(e) {
          e.preventDefault();
        });

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>init</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.resetActiveNavBtn($thNavBtn);

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>UPDATE</p>

<p>On hover, add the 'selected' (or whatever) class to the button. set a 'justActivated' boolean to true, 
and set a timer that so if you click before the timer is up, it doesn't toggle the menu back closed. This way
if the user goes to click the button, they won't get a double-toggle (hover followed by click)</p>

<p>On click, check for the 'justActivated' boolean - if it's not true, toggle the menu state.
This will allow closing by way of clicking the button when the menu is open.
This may also mean we can just have 1 function for touch-or-click, since touch will
never trigger hover, it'll just be ready for the touch to toggle it.</p>

<p>TODO: Why does search menu close
TODO: Clicking off the nav will close it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>$(this).on(self.tapOrClick + ' focus blur', function() {
$(this).on(self.tapOrClick, function() {
$(this).on('touchstart mouseenter', function() {</p>             </td>             <td class="code">               <div class="highlight"><pre>


</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>TOUCH DEVICES</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> (self.hasTouch) {

          $thNavBtn.on(<span class="string">'touchstart'</span>, <span class="keyword">function</span>() {
            $(<span class="string">'#nav-search-input'</span>).blur();
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>if this button is already activated,</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ($thNavBtn.parent().hasClass(<span class="string">'nav-li-selected'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>just hide/reset it.</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.resetActiveNavBtn(self.$currentOpenNavBtn);
              self.$currentOpenNavBtn = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>if this button isn't already activated,</p>             </td>             <td class="code">               <div class="highlight"><pre>            } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>See if any other buttons are activated. If there's NOT</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">var</span> otherIsActive = self.$currentOpenNavBtn !== <span class="literal">false</span> ? <span class="literal">true</span> : <span class="literal">false</span>;
              <span class="keyword">if</span> (!otherIsActive) {
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>update the Nav button &amp; open the new tray/menu immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.setActiveNavBtn($thNavBtn);

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>if there WAS already an active button,</p>             </td>             <td class="code">               <div class="highlight"><pre>              } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>deactivate it first</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.resetActiveNavBtn(self.$currentOpenNavBtn);
                <span class="keyword">var</span> $oldNavTarget = $(<span class="string">'.'</span> + self.$currentOpenNavBtn.data(<span class="string">'target'</span>));

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>if the open target was a navtray,</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ($oldNavTarget.hasClass(<span class="string">'navtray-w'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>delay opening the new one until the old tray has a chance to close.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>() {
                    self.setActiveNavBtn($thNavBtn);
                  }, <span class="number">350</span>);
                } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>update the Nav button &amp; open the new tray after just a short delay for the old menu to fade out.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>() {
                    self.setActiveNavBtn($thNavBtn);
                  }, <span class="number">150</span>);
                }
              }
            }
          });
</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>end touchstart</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>NOT touch device - set up HOVER triggers</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> {
  
          <span class="keyword">var</span> thTrigger = <span class="string">'mouseenter focus'</span>;
          
</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>for the search button only, we want it to trigger on click. All others on mouseenter.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ($thNavBtn.parent().hasClass(<span class="string">'nav-li-search'</span>)) {
              thTrigger = <span class="string">'click focus'</span>;
          }
          
          $thNavBtn.on(thTrigger, <span class="keyword">function</span>(e) {
            
            <span class="keyword">var</span> isSearchButtonActive = $thNavBtn.data(<span class="string">'target'</span>) ===<span class="string">'navmenu-w-search'</span> &amp;&amp; self.active ? <span class="literal">true</span> : <span class="literal">false</span>;
        
</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Prevent focus and click to trigger at the same time</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> (self.active) {
              <span class="keyword">return</span> <span class="literal">false</span>;                     
            }
            <span class="keyword">else</span> {
              self.active = <span class="literal">true</span>;
            }
            
            $(<span class="string">'.nav .nav-li a.active'</span>).trigger(<span class="string">'touchstart'</span>);
            self.resetActiveNavBtn($(<span class="string">'.nav-dropdown-toggle.active'</span>));
            $(<span class="string">'#nav-search-input'</span>).blur();
            
            $(<span class="keyword">this</span>).data(<span class="string">'hovering'</span>, <span class="literal">true</span>);
            self.resetMouseleaveTimer();

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>if this button is NOT activated,</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> (!$thNavBtn.parent().hasClass(<span class="string">'nav-li-selected'</span>) &amp;&amp; !isSearchButtonActive) { 
</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>See if any other buttons are activated.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">var</span> otherIsActive = self.$currentOpenNavBtn !== <span class="literal">false</span> ? <span class="literal">true</span> : <span class="literal">false</span>;

              <span class="keyword">if</span>(isSearchButtonActive) {
                otherIsActive = <span class="literal">false</span>;
              }
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>If there's NOT</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">if</span> (!otherIsActive) {
</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>update the Nav button &amp; open this tray/menu immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.setActiveNavBtn($thNavBtn);

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>if there WAS already an active button,</p>             </td>             <td class="code">               <div class="highlight"><pre>              } <span class="keyword">else</span> {
                
</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>deactivate it first</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.resetActiveNavBtn(self.$currentOpenNavBtn);
                <span class="keyword">var</span> $oldNavTarget = $(<span class="string">'.'</span> + self.$currentOpenNavBtn.data(<span class="string">'target'</span>));

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>if the open target was a navtray,</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ($oldNavTarget.hasClass(<span class="string">'navtray-w'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>delay opening the new one until the old tray has a chance to close.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>() {
                    self.setActiveNavBtn($thNavBtn);
                  }, <span class="number">250</span>);
                } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>update the Nav button &amp; open the new tray after just a short delay for the old menu to fade out.</p>             </td>             <td class="code">               <div class="highlight"><pre>                  setTimeout(<span class="keyword">function</span>() {
                    self.setActiveNavBtn($thNavBtn);
                  }, <span class="number">150</span>);
                }
              }

            }
          });
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>end mouseenter</p>             </td>             <td class="code">               <div class="highlight"><pre>          

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>If you mouseOut of the nav button</p>             </td>             <td class="code">               <div class="highlight"><pre>          $thNavBtn.on(<span class="string">'mouseleave'</span>, <span class="keyword">function</span>() {
            
            self.active = <span class="literal">false</span>;
            $thNavBtn.data(<span class="string">'hovering'</span>, <span class="literal">false</span>);
  
</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Check to see if it was onto the navtray/navmenu.
Wait a few ticks to give it a chance for the hover to fire first.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            setTimeout(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>if you're not hovering over the target,</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">if</span> (!$thNavBtnTarget.data(<span class="string">'hovering'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>shut it down.</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.startMouseleaveTimer($thNavBtn);
              } <span class="keyword">else</span> {
                self.resetMouseleaveTimer();
              }
            }, <span class="number">25</span>);

          });

          $thNavBtnTarget.on(<span class="string">'mouseenter focus'</span>, <span class="keyword">function</span>() {
            self.active = <span class="literal">false</span>;
            $(<span class="keyword">this</span>).data(<span class="string">'hovering'</span>, <span class="literal">true</span>);
            self.resetMouseleaveTimer();
          });

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Activate click for tab navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>          $thNavBtnTarget.find(<span class="string">'a'</span>).on(<span class="string">'focus'</span>, <span class="keyword">function</span>() {

            self.active = <span class="literal">false</span>;
            $thNavBtnTarget.data(<span class="string">'hovering'</span>, <span class="literal">true</span>);
            $thNavBtn.trigger(<span class="string">'mouseenter'</span>);

            <span class="keyword">if</span> (!($thNavBtnTarget.hasClass(<span class="string">'navtray-w-visible'</span>) || $thNavBtnTarget.hasClass(<span class="string">'navmenu-w-visible'</span>))) {
              $thNavBtn.focus();
            }
          });

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>If you mouseOut of the target</p>             </td>             <td class="code">               <div class="highlight"><pre>          $thNavBtnTarget.on(<span class="string">'mouseleave'</span>, <span class="keyword">function</span>() {

            $(<span class="keyword">this</span>).data(<span class="string">'hovering'</span>, <span class="literal">false</span>);

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Remove focus from search input on mouse out in ie</p>             </td>             <td class="code">               <div class="highlight"><pre>          
            <span class="keyword">if</span> (Settings.isLTIE10) {
                $(<span class="string">'#nav-search-input'</span>).blur();
            }
            <span class="keyword">if</span> (Settings.isLTIE9) {
                $(<span class="string">'.navmenu-w-search, .navmenu-w-account'</span>).removeClass(<span class="string">'navmenu-w-visible'</span>).attr(<span class="string">'style'</span>, <span class="string">'opacity:0'</span>);
            }
          
</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Check to see if it was onto this target's button.
Wait a few ticks to give it a chance for the hover to fire first.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> timeout = <span class="number">50</span>;
            <span class="keyword">if</span>(<span class="keyword">this</span>.id === <span class="string">'navmenu-w-search'</span>) {
              timeout = <span class="number">2000</span>;
            }

            setTimeout(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>if you're not hovering over the target's button</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">if</span> (!$thNavBtn.data(<span class="string">'hovering'</span>) &amp;&amp; !$thNavBtnTarget.data(<span class="string">'hovering'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>shut it down.</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.startMouseleaveTimer($thNavBtn);
                self.active = <span class="literal">false</span>;
              } <span class="keyword">else</span> {
                self.resetMouseleaveTimer();
              }
            }, timeout);
          });
        }
      });


      self.resizeAccountUsername();
      Environment.on(<span class="string">'global:resizeDebounced-200ms'</span>, <span class="keyword">function</span>(){
        self.resizeAccountUsername();
      });
    }, <span class="comment">// end initDesktopNav</span>

    resetDesktopNav : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$pageWrapOuter.off(<span class="string">'click touchstart focus'</span>);

      self.$activeNavBtns.each(<span class="keyword">function</span>() {

        <span class="keyword">var</span> $thNavBtn = $(<span class="keyword">this</span>);

        self.resetActiveNavBtn($thNavBtn);

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>reset the button</p>             </td>             <td class="code">               <div class="highlight"><pre>        $thNavBtn.removeClass(<span class="string">'active'</span>).parent().removeClass(<span class="string">'nav-li-selected'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>if there's a navTray/navMenu, reset it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ($thNavBtn.data(<span class="string">'target'</span>).length) {
          <span class="keyword">var</span> $thNavTarget = $(<span class="string">'.'</span> + $thNavBtn.data(<span class="string">'target'</span>));

          <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navtray-w'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>self.setNavTrayContentNaturalFlow($thNavTarget, false);
WHICH ONE?</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.slideNavTray($thNavTarget, <span class="literal">false</span>);
          } <span class="keyword">else</span> {
            self.resetActiveNavMenu();
          }
          $thNavTarget.off(<span class="string">'touchstart mouseenter mouseleave click'</span>);
        }
</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>reset touch -- even if these aren't visible on mobile, it's still better to reset them, since they'll get re-inited if switch back</p>             </td>             <td class="code">               <div class="highlight"><pre>        $thNavBtn.off(<span class="string">'touchstart mouseenter mouseleave click'</span>);
      });
    },


    resetActiveNavMenu : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

        <span class="keyword">if</span> (Settings.isLTIE10) {
            $(<span class="string">'#nav-search-input'</span>).blur();
        }
        <span class="keyword">if</span> (Settings.isLTIE9) {
            $(<span class="string">'.navmenu-w-search, .navmenu-w-account'</span>).removeClass(<span class="string">'navmenu-w-visible'</span>).attr(<span class="string">'style'</span>, <span class="string">'opacity:0'</span>);
            $(<span class="string">'.nav-li-search a'</span>).blur();
        }
 
      $(<span class="string">'.navmenu-w-visible'</span>).each(<span class="keyword">function</span>(){
        $(<span class="keyword">this</span>)
          .removeClass(<span class="string">'navmenu-w-visible'</span>)
          .one(self.transitionEnd, <span class="keyword">function</span>() {
 
            <span class="keyword">var</span> $transitionContainer = $(<span class="keyword">this</span>).find(<span class="string">'.reveal-transition-container'</span>);
            $transitionContainer.css(<span class="string">'height'</span>, <span class="string">''</span>);
            $(<span class="keyword">this</span>).css({<span class="string">'left'</span>:<span class="string">''</span>, <span class="string">'right'</span>:<span class="string">''</span>});

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>clear active class from THIS button!
$('.nav-li-search a').removeClass('active');</p>             </td>             <td class="code">               <div class="highlight"><pre>            
</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>setTimeout(function(){
  var c = $transitionContainer.attr('class');
  var h = $transitionContainer.outerHeight();
  console.log("c: " + c + ", h: " + h);
},5);</p>             </td>             <td class="code">               <div class="highlight"><pre>        });
      });
    },

    resizeAccountUsername : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>reset it first so we measure off the full username.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$accountUsername.text(self.fullAccountUsername);

      <span class="keyword">var</span> $nbi = self.$navbar.children(<span class="string">'.grid'</span>);

      <span class="keyword">if</span> (isTooLong()){
        shortenUsername();
      }

      <span class="function"><span class="keyword">function</span> <span class="title">isTooLong</span><span class="params">()</span>{</span>
        <span class="keyword">var</span> navbarWidth = $nbi.outerWidth();
        <span class="keyword">var</span> navbarContentsWidth = <span class="number">0</span>;
        $nbi.children().each(<span class="keyword">function</span>(){
          navbarContentsWidth += parseInt($(<span class="keyword">this</span>).outerWidth(<span class="literal">true</span>),<span class="number">10</span>);
        });
        <span class="keyword">return</span> navbarWidth - navbarContentsWidth &lt; self.usernameSpace ? <span class="literal">true</span> : <span class="literal">false</span>;
      }

      <span class="function"><span class="keyword">function</span> <span class="title">shortenUsername</span><span class="params">()</span>{</span>
        <span class="keyword">var</span> currentUsername = self.$accountUsername.text();
</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>take 1 letter off the end of the username</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> shortUsername = currentUsername.substring(<span class="number">0</span>,currentUsername.length-<span class="number">1</span>);
        self.$accountUsername.html(shortUsername);
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>loop through, taking 1 letter off at a time, until it's either short enough, or down to just minUsernameLength letters.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> (shortUsername.length &gt; self.minUsernameLength &amp;&amp; isTooLong()){
          shortenUsername();
        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>only shorten it if it's cut off more than 2 letters; otherwise the ellipses makes it so it's not any shorter anyway.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( shortUsername.length &lt; (self.fullAccountUsername.length - <span class="number">2</span>) ){
            self.$accountUsername.html(shortUsername + <span class="string">"&amp;hellip;"</span>);
          } <span class="keyword">else</span> {
            self.$accountUsername.html(self.fullAccountUsername);
          }
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>check to see if the Account Button still has enough room to display the entire username; and if not, cut it down.</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>get the width of the entire nav</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>for each child of $navbarInner, add its width to the total</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>var logoWidth = $nbi.find('.brand').outerWidth();
var primaryWidth = $nbi.find('.nav-primary').outerWidth();</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>self.$accountBtn</p>             </td>             <td class="code">               <div class="highlight"><pre>    },

    startMouseleaveTimer : <span class="keyword">function</span>($thNavBtn) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">if</span> ($(<span class="string">'mouseleaveTimerActive'</span>).length) {
        self.resetMouseleaveTimer();
      }
      $thNavBtn.addClass(<span class="string">'mouseleaveTimerActive'</span>);
      self.mouseleaveTimer = setTimeout(<span class="keyword">function</span>() {
        self.resetActiveNavBtn($thNavBtn);
        self.resetMouseleaveTimer();
      }, self.mouseLeaveDelay);
    },
    resetMouseleaveTimer : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      clearTimeout(self.mouseleaveTimer);
      $(<span class="string">'.mouseleaveTimerActive'</span>).removeClass(<span class="string">'mouseleaveTimerActive'</span>);
    },

    setActiveNavBtn : <span class="keyword">function</span>($btn) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.activateNavBtn($btn);
      self.$currentOpenNavBtn = $btn;
    },
    resetActiveNavBtn : <span class="keyword">function</span>($oldNavBtn) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>reset this button</p>             </td>             <td class="code">               <div class="highlight"><pre>      !!$oldNavBtn &amp;&amp; $oldNavBtn.removeClass(<span class="string">'active'</span>).blur().parent().removeClass(<span class="string">'nav-li-selected'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>if there's a navTray/navMenu, reset it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> (!!$oldNavBtn.data(<span class="string">'target'</span>)) {
        <span class="keyword">var</span> $thNavTarget = $(<span class="string">'.'</span> + $oldNavBtn.data(<span class="string">'target'</span>));

        <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navtray-w'</span>)) {
          self.slideNavTray($thNavTarget, <span class="literal">false</span>);
        } <span class="keyword">else</span> {
          self.resetActiveNavMenu();
        }
      }
    },

    slideNavTray : <span class="keyword">function</span>($navTray, opening) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>, startHeight, endHeight, expandedHeight = $navTray.outerHeight();

      $navTray.data(<span class="string">'expandedHeight'</span>, expandedHeight);

      <span class="keyword">if</span> (opening) {
        startHeight = expandedHeight;
        endHeight = <span class="string">'1px'</span>;

      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>if you're not opening, it's just initializing on page load</p>             </td>             <td class="code">               <div class="highlight"><pre>        startHeight = <span class="string">'1px'</span>;
        endHeight = expandedHeight;

      }

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>$navTray.data('expandedHeight', startHeight).css('top', startHeight).find('.navtray').addClass('navtray-absolute').css('top', expandedHeight);</p>             </td>             <td class="code">               <div class="highlight"><pre>
      setTimeout(<span class="keyword">function</span>() {<span class="comment">// wait just a moment to make sure the height is applied</span>
        $navTray.removeClass(<span class="string">'no-transition'</span>);

        setTimeout(<span class="keyword">function</span>() {<span class="comment">// wait just a moment to make sure the height is applied</span>
</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>$navTray.css('height', endHeight).one(self.transitionEnd, onNavTrayComplete);</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">var</span> elemHeight = $navTray.find(<span class="string">'.navtray'</span>).height();
          <span class="keyword">if</span> (opening) {
           $navTray.addClass(<span class="string">'navtray-w-visible'</span>);
          } <span class="keyword">else</span> {
           $navTray.removeClass(<span class="string">'navtray-w-visible'</span>);
          }

        }, <span class="number">10</span>);
      }, <span class="number">10</span>);

      <span class="function"><span class="keyword">function</span> <span class="title">onNavTrayComplete</span><span class="params">()</span> {</span>
</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>prepare the tray for browser resize - even though it's offscreen, we still need to get its natural height next time we need to expand it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.setNavTrayContentNaturalFlow($navTray);
      }

    },
    resetNavTray : <span class="keyword">function</span>($navTray) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $navTray.removeClass(<span class="string">'navtray-w-visible'</span>)
</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>.removeClass('no-transition')</p>             </td>             <td class="code">               <div class="highlight"><pre>      .css(<span class="string">'height'</span>, <span class="string">''</span>).find(<span class="string">'.navtray'</span>).removeClass(<span class="string">'navtray-absolute'</span>).css(<span class="string">'height'</span>, <span class="string">''</span>);
    },

    setNavTrayContentNaturalFlow : <span class="keyword">function</span>($navTray) {
      $navTray.css(<span class="string">'height'</span>, <span class="string">''</span>).find(<span class="string">'.navtray'</span>).removeClass(<span class="string">'navtray-absolute'</span>).css(<span class="string">'height'</span>, <span class="string">''</span>);
    },

    activateNavBtn : <span class="keyword">function</span>($newNavBtn) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>.removeClass('no-transition')</p>             </td>             <td class="code">               <div class="highlight"><pre>      $newNavBtn.addClass(<span class="string">'active'</span>).parent().addClass(<span class="string">'nav-li-selected'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>if there's a navTray/navMenu, reset it to get its height</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ($newNavBtn.data(<span class="string">'target'</span>).length) {
        <span class="keyword">var</span> $thNavTarget = $(<span class="string">'.'</span> + $newNavBtn.data(<span class="string">'target'</span>));

</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>figure out if this is a tray or menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navtray-w'</span>)) {

</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Force an iQ check whenever the navs expand.</p>             </td>             <td class="code">               <div class="highlight"><pre>          $thNavTarget.one(self.transitionEnd, <span class="keyword">function</span>() {
            iQ.update(<span class="literal">true</span>);
          });

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>it's a nav-tray
first get the tray's natural height, which it should have offscreen.
expand the tray. When it's done, set it to position:relative and natural heights.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> (Settings.isLTIE10) {
</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>going to do something special for oldIE since it's not sliding anyway, and it can be set up to just use display:none.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.slideNavTray($thNavTarget, <span class="literal">true</span>);
          } <span class="keyword">else</span> {
            self.slideNavTray($thNavTarget, <span class="literal">true</span>);
          }
        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>it's a nav-menu - show the menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">var</span> $revealContainer = $thNavTarget.find(<span class="string">'.reveal-transition-container'</span>);
          <span class="keyword">var</span> expHeight = $revealContainer.height();  

          $revealContainer.css(<span class="string">'height'</span>, <span class="string">'1px'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>wait a tick to make sure the height is set before adding the transition-height class, to make sure it doesn't animate</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="keyword">function</span>() {
            $revealContainer.addClass(<span class="string">'transition-height'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>wait a tick to make sure the transition-height is set before changing the height &amp; animating.</p>             </td>             <td class="code">               <div class="highlight"><pre>            setTimeout(<span class="keyword">function</span>() {
              $thNavTarget.addClass(<span class="string">'navmenu-w-visible'</span>);
              $revealContainer.height(expHeight);
              $revealContainer.one(self.transitionEnd, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>when it's done revealing, get rid of the height transition</p>             </td>             <td class="code">               <div class="highlight"><pre>                $revealContainer.removeClass(<span class="string">'transition-height'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>wait a tick to make sure the transition-height class is gone. </p>             </td>             <td class="code">               <div class="highlight"><pre>                setTimeout(<span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>reset to natural height</p>             </td>             <td class="code">               <div class="highlight"><pre>                  $revealContainer.css(<span class="string">'height'</span>, <span class="string">''</span>);
</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>setTimeout(function() {
  var expHeight = $revealContainer.height();
  console.log("expHeight: " + expHeight); <br />
}, 1);</p>             </td>             <td class="code">               <div class="highlight"><pre>
                }, <span class="number">1</span>);
              });
            }, <span class="number">1</span>);
          }, <span class="number">1</span>);

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>the search menu, needs to be positioned with js. This way it can be in the flow at the top of the page, so it's in place for mobile.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navmenu-w-search'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Line it up with the right edge of the search button.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="keyword">var</span> searchBtnRightEdge = $newNavBtn.parent().position().left + parseInt($newNavBtn.css(<span class="string">'marginLeft'</span>), <span class="number">10</span>) + $newNavBtn.innerWidth();
            <span class="keyword">var</span> searchLeftPos = searchBtnRightEdge - $thNavTarget.innerWidth();
            $thNavTarget.css({
              <span class="string">'right'</span> : <span class="string">'auto'</span>,
              <span class="string">'left'</span> : searchLeftPos + <span class="string">'px'</span>
            });
          } <span class="keyword">else</span> <span class="keyword">if</span> ($thNavTarget.hasClass(<span class="string">'navmenu-w-account'</span>)) {
            <span class="keyword">var</span> accountLeftPos = parseInt($newNavBtn.css(<span class="string">'marginLeft'</span>), <span class="number">10</span>);

</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>center the carrot under the button</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> $carrot = $thNavTarget.find(<span class="string">'.nav-indicator'</span>);
            <span class="keyword">var</span> carrotLeftPos = (parseInt($newNavBtn.outerWidth(),<span class="number">10</span>) - parseInt($carrot.outerWidth(),<span class="number">10</span>) ) / <span class="number">2</span>;
            $thNavTarget.css({
              <span class="string">'right'</span> : <span class="string">'auto'</span>,
              <span class="string">'left'</span> : accountLeftPos + <span class="string">'px'</span>
            });
            $carrot.css(<span class="string">'left'</span>,carrotLeftPos+<span class="string">'px'</span>);
          }
        }
      }
    },

</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>MOBILE NAV</p>             </td>             <td class="code">               <div class="highlight"><pre>    initMobileNav : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $(<span class="string">'#btn-mobile-nav'</span>).on(self.tapOrClick, <span class="keyword">function</span>(e) {
        e.preventDefault();
        <span class="keyword">if</span> (!self.mobileNavVisible) {
          self.showMobileNav();
        } <span class="keyword">else</span> {
          self.hideMobileNav();
        }
      });
      <span class="keyword">var</span> $thInput = $(<span class="string">'#nav-search-input'</span>);

      $thInput.on(<span class="string">'focus'</span>, <span class="keyword">function</span>() {
        <span class="keyword">if</span> (self.$html.hasClass(<span class="string">'bp-nav-mobile'</span>)) {
          module.initMobileNavIScroll();
        }
        $(<span class="string">'.page-wrap-inner'</span>).addClass(<span class="string">'show-mobile-search-results'</span>);
      }).on(<span class="string">'blur'</span>, <span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>disable blur on mobile search input</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> (!self.$html.hasClass(<span class="string">'bp-nav-mobile'</span>)) {
          $(<span class="string">'.page-wrap-inner'</span>).removeClass(<span class="string">'show-mobile-search-results'</span>);
        }
      }).closest(<span class="string">'.input-group'</span>).find(<span class="string">'.input-clear-btn'</span>).on(self.tapOrClick, <span class="keyword">function</span>() {
        <span class="keyword">if</span> (self.$html.hasClass(<span class="string">'bp-nav-mobile'</span>)) {
          module.initMobileNavIScroll();
          $(<span class="string">'.page-wrap-inner'</span>).removeClass(<span class="string">'show-mobile-search-results'</span>);
          setTimeout(<span class="keyword">function</span>() {
            $thInput.trigger(<span class="string">'blur'</span>);
          }, <span class="number">0</span>);
        }
      });

    }, <span class="comment">// end initMobileNav</span>
    resetMobileNav : <span class="keyword">function</span>() {

      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.hideMobileNav();
      $(<span class="string">'#btn-mobile-nav'</span>).off(self.tapOrClick);
      $(<span class="string">'.mobile-screen-overlay'</span>).remove();
    },

    showMobileNav : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.showMobileBackdrop();

</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Since the page-wrap-inner is going to be fixed, the browser will see the page as having no height.
on iOS, this means the Safari nav will always be visible. And that's not cool. So, to give the
page some height, so the Safari nav will hide.
need tp compensate for Safari nav bar on iOS - MAY BE DIFFERENT ON ANDROID/OTHER.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> pageHeight = Settings.isIPhone || Settings.isAndroid ? window.innerHeight : self.$window.height();
</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>var pageHeight = parseInt(self.$window.height(), 10) + 'px';
var pageHeight = parseInt( self.$window.height(),10 ) + 60 + 'px';</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$pageWrapOuter.height(pageHeight);

      <span class="keyword">if</span> (!self.mobileNavIScroll) {
        <span class="keyword">var</span> $outer = $(<span class="string">'#nav-outer-container'</span>), $inner = $outer.find(<span class="string">'.nav-mobile-scroller'</span>), innerHeight = $inner.height();

        $outer.height(pageHeight);
        $inner.height(innerHeight);

        setTimeout(<span class="keyword">function</span>() {<span class="comment">// make sure heights are already set before initializing iScroll.</span>
          module.initMobileNavIScroll();
        }, <span class="number">1</span>);
      }

      $(<span class="string">'#page-wrap-inner'</span>).addClass(<span class="string">'show-mobile-menu'</span>);
      self.mobileNavVisible = <span class="literal">true</span>;
    },
    hideMobileNav : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.hideMobileBackdrop();

      <span class="keyword">if</span> (self.mobileNavVisible){
        $(<span class="string">'#page-wrap-inner'</span>).one(self.transitionEnd, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>wait until the $('#page-wrap-inner') is done animating closed before destroying the iScroll.</p>             </td>             <td class="code">               <div class="highlight"><pre>          module.destroyMobileNavIScroll();
        });
      }
      $(<span class="string">'#page-wrap-inner'</span>).removeClass(<span class="string">'show-mobile-menu'</span>);
      self.mobileNavVisible = <span class="literal">false</span>;
    },

    showMobileBackdrop : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$mobileScreenOverlay = $(<span class="string">'&lt;div class="modal-backdrop mobile-screen-overlay opacity0" /&gt;'</span>).appendTo($(<span class="string">'#page-wrap-inner'</span>));

      setTimeout(<span class="keyword">function</span>() {
        self.$mobileScreenOverlay.removeClass(<span class="string">'opacity0'</span>).addClass(<span class="string">'opacity1'</span>);
        <span class="keyword">if</span> ( Settings.isAndroid ) {
          Utilities.forceWebkitRedraw();
        }
      }, <span class="number">1</span>);
    },
    hideMobileBackdrop : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( !!self.$mobileScreenOverlay ) {
        self.$mobileScreenOverlay.one(self.transitionEnd, <span class="keyword">function</span>() {
          self.$mobileScreenOverlay.remove();
        });
      }

      <span class="keyword">if</span> ( !!self.$mobileScreenOverlay ) {
       self.$mobileScreenOverlay.removeClass(<span class="string">'opacity1'</span>).addClass(<span class="string">'opacity0'</span>);
      }
    },

</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>MOBILE FOOTER</p>             </td>             <td class="code">               <div class="highlight"><pre>    initMobileFooter : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>init the country-selector popup menu -- disabled.
$('#country-selector').on('mouseenter mouseleave',function(){
  var pageContainerWidth = $(this).closest('.grid-footer').width();
  $(this).find('.dropdown-hover-menu-lists-w').width(pageContainerWidth);
});</p>             </td>             <td class="code">               <div class="highlight"><pre>
      self.footerNavCollapseHeight = <span class="number">49</span>;
</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>plus 1 for the border</p>             </td>             <td class="code">               <div class="highlight"><pre>
      $(<span class="string">'#footer-wrapper .footer-mobile-section h5'</span>).each(<span class="keyword">function</span>() {

        <span class="keyword">var</span> $thFootSection = $(<span class="keyword">this</span>).parent();

</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>on init, the footers should collapse.</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.collapseMobileFooterSec($thFootSection, <span class="literal">true</span>);

        $(<span class="keyword">this</span>).on(self.tapOrClick, <span class="keyword">function</span>() {

          <span class="keyword">if</span> ($thFootSection.hasClass(<span class="string">'collapsed'</span>)) {
</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>collapsed height - expand it.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.expandMobileFooterSec($thFootSection);
          } <span class="keyword">else</span> {
            self.collapseMobileFooterSec($thFootSection);
          }
        });
      });
    },
    resetMobileFooter : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $(<span class="string">'#footer-wrapper .footer-mobile-section h5'</span>).each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $thFootSection = $(<span class="keyword">this</span>).parent();
        $thFootSection.css(<span class="string">'height'</span>, <span class="string">''</span>).removeClass(<span class="string">'collapsed transition-height'</span>);
        $(<span class="keyword">this</span>).off(self.tapOrClick);
      });

    }, <span class="comment">// end resetMobileFooter</span>

    collapseMobileFooterSec : <span class="keyword">function</span>($thFootSection, isPageInit) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      isPageInit = <span class="keyword">typeof</span> isPageInit !== <span class="string">'undefined'</span> ? isPageInit : <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>natural height - collapse it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> expHeight = $thFootSection.height();
      $thFootSection.data(<span class="string">'expHeight'</span>, expHeight);

      <span class="keyword">if</span> (isPageInit) {
        $thFootSection.height(self.footerNavCollapseHeight).addClass(<span class="string">'collapsed'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>after it's collapsed, add the transition-height class for animating later.</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {
          $thFootSection.addClass(<span class="string">'transition-height'</span>);
        }, <span class="number">1</span>);
</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>NOT on page init, collapse it normally.</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>set initial height to its current / expanded height so there's something to animate from</p>             </td>             <td class="code">               <div class="highlight"><pre>        $thFootSection.height(expHeight);
</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>wait a tick to make sure the height is set before adding the transition-height class, to make sure it doesn't animate</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {
          $thFootSection.addClass(<span class="string">'transition-height'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>wait a tick to make sure the transition-height is set before changing the height &amp; animating.</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="keyword">function</span>() {
            $thFootSection.height(self.footerNavCollapseHeight).addClass(<span class="string">'collapsed'</span>);
          }, <span class="number">1</span>);
        }, <span class="number">1</span>);
      }
    },
    expandMobileFooterSec : <span class="keyword">function</span>($thFootSection) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $thFootSection.height($thFootSection.data(<span class="string">'expHeight'</span>)).removeClass(<span class="string">'collapsed'</span>).one(self.transitionEnd, <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>when the transition is complete, put the section back into natural height, in case the window was resized.</p>             </td>             <td class="code">               <div class="highlight"><pre>        $thFootSection.removeClass(<span class="string">'transition-height'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>...after waiting a tick to make sure everything else is already set.</p>             </td>             <td class="code">               <div class="highlight"><pre>        setTimeout(<span class="keyword">function</span>() {
          $thFootSection.css(<span class="string">'height'</span>, <span class="string">''</span>);
        }, <span class="number">1</span>);
      });
    } <span class="comment">// end expandMobileFooterSec</span>

  };
</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>end GlobalNav.prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav = <span class="keyword">function</span>(opts) {
    <span class="keyword">var</span> args = Array.prototype.slice.apply(arguments);
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
        globalNav = self.data(<span class="string">'globalNav'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>If we don't have a stored globalNav, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> (!globalNav) {
        globalNav = <span class="keyword">new</span> GlobalNav(self);
        self.data(<span class="string">'globalNav'</span>, globalNav);
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> opts === <span class="string">'string'</span>) {
        globalNav[opts].apply(globalNav, args.slice(<span class="number">1</span>));
      }
    });
  };
</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>end $.fn.globalNav</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Overrideable options</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav.options = {
    sampleOption : <span class="number">0</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Not overrideable</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.globalNav.settings = {
    hasTouch : Settings.hasTouchEvents || Settings.hasPointerEvents,
    isInitialized : <span class="literal">false</span>
  };

  module.initMobileNavIScroll = <span class="keyword">function</span>() {
    <span class="keyword">var</span> globalNav = $(<span class="string">'.nav-wrapper'</span>).data(<span class="string">'globalNav'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>if there's alreaddy a mobileNavIScroll, refresh it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> (!!globalNav.mobileNavIScroll) {
      <span class="keyword">var</span> $scroller = $(<span class="string">'.nav-mobile-scroller'</span>);
      $scroller.css(<span class="string">'height'</span>, <span class="string">''</span>);
      setTimeout(<span class="keyword">function</span>(){
        <span class="keyword">var</span> scrollerHeight = $scroller.outerHeight();
        $scroller.css(<span class="string">'height'</span>, scrollerHeight);

        setTimeout(<span class="keyword">function</span>(){
          globalNav.mobileNavIScroll.refresh();
        },<span class="number">50</span>);
      },<span class="number">50</span>);
</pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>if not, init it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    } <span class="keyword">else</span> {
      globalNav.mobileNavIScroll = <span class="keyword">new</span> window.IScroll(<span class="string">'nav-outer-container'</span>, {
        vScroll : <span class="literal">true</span>,
        hScroll : <span class="literal">false</span>,
        hScrollbar : <span class="literal">false</span>,
        snap : <span class="literal">false</span>,
        momentum : <span class="literal">true</span>,
        bounce : <span class="literal">false</span>,
        onBeforeScrollStart: <span class="keyword">function</span>(e) {
          <span class="keyword">var</span> target = e.target;

          <span class="keyword">while</span> ( target.nodeType !== <span class="number">1</span> ) {
            target = target.parentNode;
          }

          <span class="keyword">if</span> (target.tagName !== <span class="string">'SELECT'</span> &amp;&amp; target.tagName !== <span class="string">'INPUT'</span> &amp;&amp; target.tagName !== <span class="string">'TEXTAREA'</span>) {
            e.preventDefault();
          }
        }

      });

    }
  };

  module.destroyMobileNavIScroll = <span class="keyword">function</span>() {
    <span class="keyword">var</span> globalNav = $(<span class="string">'.nav-wrapper'</span>).data(<span class="string">'globalNav'</span>);
    <span class="keyword">if</span> ( !!globalNav.mobileNavIScroll ) {
      globalNav.mobileNavIScroll.destroy();
    }
    globalNav.mobileNavIScroll = <span class="literal">false</span>;
    globalNav.$pageWrapOuter.css(<span class="string">'height'</span>, <span class="string">''</span>);
  };

  Environment.on(<span class="string">'SONY:Navigation:initMobileNavIScroll'</span>, module.initMobileNavIScroll);
  Environment.on(<span class="string">'SONY:Navigation:destroyMobileNavIScroll'</span>, module.destroyMobileNavIScroll);

  <span class="keyword">return</span> module;

});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 