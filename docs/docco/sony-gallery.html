<!DOCTYPE html>  <html> <head>   <title>sony-gallery.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brightcove-builder.html">                 brightcove-builder.js               </a>                                           <a class="source" href="editorial-dual-viewer-e9.html">                 editorial-dual-viewer-e9.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="hotspot_explorer.html">                 hotspot_explorer.js               </a>                                           <a class="source" href="jquery.viewport.html">                 jquery.viewport.js               </a>                                           <a class="source" href="primary-tout-p1-d7.html">                 primary-tout-p1-d7.js               </a>                                           <a class="source" href="related-products.html">                 related-products.js               </a>                                           <a class="source" href="sony-gallery.html">                 sony-gallery.js               </a>                                           <a class="source" href="sony-one-carousel.html">                 sony-one-carousel.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="spec-multi-z2.html">                 spec-multi-z2.js               </a>                                           <a class="source" href="spec-single-z1.html">                 spec-single-z1.js               </a>                                           <a class="source" href="tertiary-t1-t5-module.html">                 tertiary-t1-t5-module.js               </a>                                           <a class="source" href="ux-marketing-convergence-e14.html">                 ux-marketing-convergence-e14.js               </a>                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="enquire.html">                 enquire.js               </a>                                           <a class="source" href="exports.html">                 exports.js               </a>                                           <a class="source" href="global-init.html">                 global-init.js               </a>                                           <a class="source" href="global-nav.html">                 global-nav.js               </a>                                           <a class="source" href="iq.html">                 iq.js               </a>                                           <a class="source" href="jquery.imagesloaded.html">                 jquery.imagesloaded.js               </a>                                           <a class="source" href="jquery.throttle-debounce.html">                 jquery.throttle-debounce.js               </a>                                           <a class="source" href="sony-iscroll.html">                 sony-iscroll.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sony-gallery.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*global jQuery, Modernizr, Exports, IScroll*/</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Gallery ------------
Module: Gallery
Version: 1.0
Modified: 01/01/2013
Dependencies: jQuery 1.7+, Modernizr</p>

<h2>Author: Glen Cheney</h2>             </td>             <td class="code">               <div class="highlight"><pre>
(<span class="keyword">function</span>($, Modernizr, window, <span class="literal">undefined</span>) {
  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> Gallery = <span class="keyword">function</span>( $container, options ) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $.extend(self, $.fn.gallery.options, options, $.fn.gallery.settings);

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>jQuery objects</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$container = $container;
    self.$window = $(window);
    self.id = self.$container[<span class="number">0</span>].id;
    self.$grid = self.$container.find(<span class="string">'.products'</span>);
    self.$filterOpts = self.$container.find(<span class="string">'.filter-options'</span>);
    self.$filterColumns = self.$filterOpts.find(<span class="string">'.grid'</span>).children();
    self.$sortSelect = self.$container.find(<span class="string">'.sort-options select'</span>);
    self.$sortBtns = self.$container.find(<span class="string">'.sort-options .dropdown-menu a'</span>);
    self.$dropdownToggleText = self.$container.find(<span class="string">'.sort-options .js-toggle-text'</span>);
    self.$productCount = self.$container.find(<span class="string">'.product-count'</span>);
    self.$activeFilters = self.$container.find(<span class="string">'.active-filters'</span>);
    self.$filterArrow = self.$container.find(<span class="string">'.slide-arrow-under, .slide-arrow-over'</span>);
    self.$favorites = self.$grid.find(<span class="string">'.js-favorite'</span>);
    self.$gridProductNames = self.$grid.find(<span class="string">'.product-name-wrap'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Compare modal</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$compareBtn = self.$container.find(<span class="string">'.js-compare-toggle'</span>);
    self.hasCompareModal = self.$compareBtn.length &gt; <span class="number">0</span>;
    self.$compareTool = $(<span class="string">'#compare-tool'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Other vars</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.hasInfiniteScroll = self.$container.find(<span class="string">'div.navigation a'</span>).length &gt; <span class="number">0</span>;
    self.hasFilters = self.$filterOpts.length &gt; <span class="number">0</span>;
    self.windowSize = self.$window.width();

    self.$container.addClass(<span class="string">'gallery-'</span> + self.mode);

    self.setColumnMode();

    self.$grid.on(<span class="string">'loading.shuffle'</span>, $.proxy( self.onShuffleLoading, self ));
    self.$grid.on(<span class="string">'done.shuffle'</span>, $.proxy( self.onShuffleDone, self ));

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>instantiate shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$grid.shuffle({
      itemSelector: <span class="string">'.gallery-item'</span>,
      speed: self.shuffleSpeed,
      easing: self.shuffleEasing,
      columnWidth: self.shuffleColumns,
      gutterWidth: self.shuffleGutters,
      showInitialTransition: <span class="literal">false</span>,
      buffer: <span class="number">5</span>
    });

    self.shuffle = self.$grid.data(<span class="string">'shuffle'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Displays active filters on <code>filter</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$grid.on(<span class="string">'filter.shuffle'</span>, $.proxy( self.displayActiveFilters, self ));

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Things moved around and could possibly be in the viewport
Filtered should already be throttled because whatever calls .filter() should be throttled.</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$grid.on(<span class="string">'layout.shuffle'</span>, <span class="keyword">function</span>() {
      window.iQ.update();
    });

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Sort elements by data-priority attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.sortByPriority();

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Infinite scroll?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
      self.initInfscr();
    }

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Initialize filter dictionaries to keep track of everything</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasFilters ) {
      self.initFilters();
    }

    self.initSwatches();
    self.initTooltips();

    self.$window.on(<span class="string">'resize.gallery'</span>, $.proxy( self.onResize, self ) );
    self.onResize();

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Launch compare tool on click</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasCompareModal ) {
      self.$compareBtn.on(<span class="string">'click'</span>, $.proxy( self.onCompareLaunch, self ));
      self.$compareTool.on(<span class="string">'hidden'</span>, $.proxy( self.onCompareClosed, self ));
      self.$compareTool.on(<span class="string">'shown'</span>, $.proxy( self.onCompareShown, self ));
    }

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>We're done.</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.isInitialized = <span class="literal">true</span>;

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Run once</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( self.hasFilters ) {
      self.filter();
    }
  };

  Gallery.prototype = {

    constructor: Gallery,

    enable : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Already enabled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.enabled ) {
        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Enable shuffle, which triggers a layout update</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.shuffle.enable();

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Resume infinite scroll if it's there yo</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasInfiniteScroll ) {
        self.$grid.infinitescroll(<span class="string">'updateNavLocation'</span>);
        self.$grid.infinitescroll(<span class="string">'resume'</span>);
      }

      self.enabled = <span class="literal">true</span>;
    },

    disable : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Already disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.enabled ) {
        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Disable shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.shuffle.disable();

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Pause infinite scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self &amp;&amp; self.hasInfiniteScroll ) {
        self.$grid.infinitescroll(<span class="string">'pause'</span>);
      }

      self.enabled = <span class="literal">false</span>;
    },

    filter : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.hasActiveFilters() ) {
        self.$grid.shuffle(<span class="keyword">function</span>($el) {
          <span class="keyword">return</span> self.itemPassesFilters( $el.data() );
        });
      } <span class="keyword">else</span> {
        self.$grid.shuffle(<span class="string">'all'</span>);
      }

      self.setFilterStatuses();
    },

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>From the element's data-* attributes, test to see if it passes</p>             </td>             <td class="code">               <div class="highlight"><pre>    itemPassesFilters : <span class="keyword">function</span>( data ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterName = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Loop through each filter in the elements filter set</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterName <span class="keyword">in</span> data.filterSet ) {
        <span class="keyword">if</span> ( !data.filterSet.hasOwnProperty(filterName) || !self.filterTypes[ filterName ] ) {
          <span class="keyword">continue</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>filterName e.g. 'price'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">var</span> filter = data.filterSet[ filterName ], <span class="comment">// e.g. 399.99</span>
            filterType = self.filterTypes[ filterName ], <span class="comment">// e.g. 'range'</span>
            activeFilters = self.filters[ filterType ][ filterName ]; <span class="comment">// e.g. ["lcd"]</span>

        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">var</span> method = $.isArray( filter ) ? <span class="string">'arrayContainsArray'</span> : <span class="string">'valueInArray'</span>;
          <span class="keyword">if</span> ( activeFilters.length &gt; <span class="number">0</span> &amp;&amp; !self[ method ]( filter, activeFilters ) ) {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          <span class="keyword">if</span> ( filter &lt; self.price.min || ( filter &gt; self.price.max &amp;&amp; self.price.max !== self.MAX_PRICE ) ) {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        }
      }

      <span class="keyword">return</span> <span class="literal">true</span>;
    },

    hasActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          hasActive = <span class="literal">false</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>;

      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">if</span> ( !self.filters.hasOwnProperty(filterType) ) {
          <span class="keyword">continue</span>;
        }


        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {
            <span class="keyword">var</span> activeFilters = self.filters[ filterType ][ filterName ];
            hasActive = activeFilters.length &gt; <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>There is an active filter, break out of the loop and return</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( hasActive ) {
              <span class="keyword">break</span>;
            }
          }
        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          hasActive = self.price.min !== self.MIN_PRICE || self.price.max !== self.MAX_PRICE;
        }

        <span class="keyword">if</span> ( hasActive ) {
          <span class="keyword">return</span> hasActive;
        }
      }
      <span class="keyword">return</span> hasActive;
    },

    displayActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>,
          filters = {},
          frag = document.createDocumentFragment();

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>self.filters ~= self.filters.button.megapixels["14-16", "16-18"]</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">if</span> ( !self.filters.hasOwnProperty(filterType) ) {
          <span class="keyword">continue</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Loop through filter types because there could be more than one 'button' or 'checkbox'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
          <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {
            <span class="keyword">var</span> activeFilters = self.filters[ filterType ][ filterName ];

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>This filterType.filterName has some active filters, build an object of its labels and filter names</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( activeFilters.length ) {
              <span class="keyword">for</span> ( <span class="keyword">var</span> j = <span class="number">0</span>; j &lt; activeFilters.length; j++ ) {
                <span class="keyword">var</span> label = self.filterLabels[ filterName ][ activeFilters[ j ] ];
                filters[ activeFilters[ j ] ] = {
                  label: label,
                  name: filterName
                };
              }
            }
          }

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Handle range control a bit differently</p>             </td>             <td class="code">               <div class="highlight"><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
          <span class="keyword">if</span> ( self.price.min !== self.MIN_PRICE ) {
            filters.min = {
              key: <span class="string">'price'</span>,
              label: <span class="string">'Min price: $'</span> + self.price.min,
              name: <span class="string">'min'</span>
            };
          }
          <span class="keyword">if</span> ( self.price.max !== self.MAX_PRICE) {
            filters.max = {
              key: <span class="string">'price'</span>,
              label: <span class="string">'Max price: $'</span> + self.price.max,
              name: <span class="string">'max'</span>
            };
          }
        }
      }


</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Create labels showing current filters</p>             </td>             <td class="code">               <div class="highlight"><pre>      $.each(filters, <span class="keyword">function</span>(key, obj) {
        <span class="keyword">var</span> $label = $(<span class="string">'&lt;span&gt;'</span>, {
          <span class="string">'class'</span> : <span class="string">'label label-close fonticon-10-circle-x--after'</span>,
          <span class="string">'data-filter'</span> : key,
          <span class="string">'data-filter-name'</span> : obj.key || obj.name,
          text : obj.label,
          click : $.proxy( self.onRemoveFilter, self )
        });

        frag.appendChild( $label[<span class="number">0</span>] );
      });


      self.$activeFilters.empty().append(frag);
    },

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Removes a single filter from stored data. Does NOT change UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    undoFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          pos;

      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> || filterType === <span class="string">'checkbox'</span> ) {
        pos = $.inArray( filterValue, self.filters[ filterType ][ filterName ] );
        self.filters[ filterType ][ filterName ].splice( pos, <span class="number">1</span> );
      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
        <span class="keyword">delete</span> self.filters[ filterType ][ filterName ][ filterValue ];
      }
    },

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Removes the active state of a filter. Changes UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    removeFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>,
          rangeControl,
          method;

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).button(<span class="string">'toggle'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .active'</span> ).button(<span class="string">'toggle'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).prop(<span class="string">'checked'</span>, <span class="literal">false</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Slide appropriate handle to the intial value</p>             </td>             <td class="code">               <div class="highlight"><pre>        rangeControl = self.$rangeControl.data(<span class="string">'rangeControl'</span>);
        method = filterValue === <span class="string">'min'</span> ? <span class="string">'slideToInitialMin'</span> : <span class="string">'slideToInitialMax'</span>;
        rangeControl[ method ]();
      }
    },

    disableFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .btn'</span> ).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).prop(<span class="string">'disabled'</span>, <span class="literal">true</span>);
      }

    },

    enableFilter : <span class="keyword">function</span>( filterValue, filterName, filterType ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          selector = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>There's probably a better way to do this... (store jQuery objects for each filter?)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( filterType === <span class="string">'button'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>[data-filter="megapixels"] [data-megapixels="14-16"]</p>             </td>             <td class="code">               <div class="highlight"><pre>        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [data-'</span> + filterName + <span class="string">'="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).removeAttr(<span class="string">'disabled'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Handle media groups</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$container.find( selector + <span class="string">' .btn'</span> ).removeAttr(<span class="string">'disabled'</span>);

      } <span class="keyword">else</span> <span class="keyword">if</span> ( filterType === <span class="string">'checkbox'</span> ) {
        selector = <span class="string">'[data-filter="'</span> + filterName + <span class="string">'"] [value="'</span> + filterValue + <span class="string">'"]'</span>;
        self.$container.find( selector ).prop(<span class="string">'disabled'</span>, <span class="literal">false</span>);
      }
    },

    removeActiveFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          filterType = <span class="string">''</span>,
          filterName = <span class="string">''</span>,
          filterValue = <span class="string">''</span>;

      <span class="keyword">for</span> ( filterType <span class="keyword">in</span> self.filters ) {
        <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filters[ filterType ] ) {

          <span class="keyword">if</span> ( filterType === <span class="string">'range'</span> ) {
            <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filters[ filterType ][ filterName ] ) {

</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Remove from internal data</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.undoFilter( filterValue, filterName, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Remove active/checked state</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.removeFilter( filterValue, filterName, filterType );
            }
          } <span class="keyword">else</span> {
            <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.filters[ filterType ][ filterName ].length; i++ ) {
              filterValue = self.filters[ filterType ][ filterName ][ i ];

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Remove from internal data</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.undoFilter( filterValue, filterName, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Remove active/checked state</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.removeFilter( filterValue, filterName, filterType );
            }
          }
        }
      }

      self.filter();

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Slide up the collapsable if it's visible</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.$container.find(<span class="string">'.collapse'</span>).hasClass(<span class="string">'in'</span>) ) {
        self.$container.find(<span class="string">'.collapse'</span>).collapse(<span class="string">'hide'</span>);
      }
    },

    onRemoveFilter : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          data = $(evt.target).data(),
          filterType = self.filterTypes[ data.filterName ];

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Remove from internal data</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.undoFilter( data.filter, data.filterName, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Remove active/checked state</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.removeFilter( data.filter, data.filterName, filterType );

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Remove this label</p>             </td>             <td class="code">               <div class="highlight"><pre>      $(evt.target).remove();

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Trigger shuffle</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.filter();
    },

    initFilters : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.filters = {
        range: {},
        button: {},
        checkbox: {}
      };
      self.filterTypes = {};
      self.filterLabels = {};
      self.filterValues = {};

      self.$filterOpts.find(<span class="string">'[data-filter]'</span>).each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
            data = $<span class="keyword">this</span>.data(),
            type = data.filterType,
            name = data.filter,
            init = [];


</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Initialize it based on type</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">switch</span> ( type ) {
          <span class="keyword">case</span> <span class="string">'range'</span>:
            init = {};
            self.range( $<span class="keyword">this</span>, name, data.min, data.max );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'button'</span>:
            self.button( $<span class="keyword">this</span>, name );
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'group'</span>:
          <span class="keyword">case</span> <span class="string">'color'</span>:
</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Treat groups and colors the same as buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>            type = <span class="string">'button'</span>;
            self.button( $<span class="keyword">this</span>, name );
              <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'checkbox'</span>:
            self.checkbox ( $<span class="keyword">this</span>, name );
            <span class="keyword">break</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Save the active filters in this filter to an empty array or object</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.filters[ type ][ name ] = init;
        self.filterTypes[ name ] = type;
      });

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Show first dropdown as active</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortBtns.first().parent().addClass(<span class="string">'active'</span>);
      self.currentSort = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Init popovers</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$filterOpts.find(<span class="string">'.js-popover-trigger'</span>).popover({
        placement: <span class="string">'in top'</span>,
        trigger: <span class="string">'click'</span>,
        content: <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>setTimeout(function() {
  var popoverWidth = self.$filterOpts.find('.span4').first().width();
  $('.popover').width( popoverWidth );
}, 250);</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">return</span> $(<span class="keyword">this</span>).find(<span class="string">'.js-popover-content'</span>).html();
        }
      });

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Slide toggle. Reset range control if it was hidden on initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$container.find(<span class="string">'.collapse'</span>)
        .on(<span class="string">'shown'</span>, $.proxy( self.onFiltersShown, self ))
        .on(<span class="string">'show'</span>, $.proxy( self.onFiltersShow, self ))
        .on(<span class="string">'hide'</span>, $.proxy( self.onFiltersHide, self ));

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Set up sorting ---- dropdowm</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortBtns.on(<span class="string">'click'</span>,  $.proxy( self.sort, self ));

</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Set up sorting ---- select menu</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sortSelect.on(<span class="string">'change'</span>, $.proxy( self.sort, self ));
    },

    initInfscr : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$grid.infinitescroll({
        local: <span class="literal">true</span>,
</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>debug: true,</p>             </td>             <td class="code">               <div class="highlight"><pre>        bufferPx: -<span class="number">100</span>, <span class="comment">// Load 100px after the navSelector has entered the viewport</span>
        navSelector: <span class="string">'div.navigation'</span>, <span class="comment">// selector for the paged navigation</span>
        nextSelector: <span class="string">'div.navigation a'</span>, <span class="comment">// selector for the NEXT link (to page 2)</span>
        itemSelector: <span class="string">'.gallery-item'</span>, <span class="comment">// selector for all items you'll retrieve</span>
        loading: {
          selector: <span class="string">'.infscr-holder'</span>,
          msgText: <span class="string">'&lt;em&gt;Loading the next set of products...&lt;/em&gt;'</span>,
          finishedMsg: <span class="string">'&lt;em&gt;Finished loading products.&lt;/em&gt;'</span>,
          img: self.loadingGif
        }
      },
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>call shuffle as a callback</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">function</span>( newElements ) {
        <span class="keyword">var</span> $newElements = $( newElements ).addClass(<span class="string">'via-ajax'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Get shuffle to append and show the items for us</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$grid.shuffle( <span class="string">'appended'</span>, $newElements );

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Show new product count</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$productCount.text( self.$grid.data(<span class="string">'shuffle'</span>).visibleItems );

        self.initSwatches( $newElements.find(<span class="string">'.mini-swatch[data-color]'</span>) );

</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Update iQ images</p>             </td>             <td class="code">               <div class="highlight"><pre>        window.iQ.update( <span class="literal">true</span> );
      });
    },

    initSwatches : <span class="keyword">function</span>( $collection ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $collection = $collection || self.$grid.find(<span class="string">'.mini-swatch[data-color]'</span>);
      $collection.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $swatch = $(<span class="keyword">this</span>),
              color = $swatch.data(<span class="string">'color'</span>),
              $productImg = $swatch.closest(<span class="string">'.product-img'</span>).find(<span class="string">'.js-product-imgs .js-product-img-main'</span>),
              $swatchImg = $swatch.closest(<span class="string">'.product-img'</span>).find(<span class="string">'.js-product-imgs [data-color="'</span> + color + <span class="string">'"]'</span>);

          $swatch.hover(<span class="keyword">function</span>() {
            $productImg.addClass(<span class="string">'hidden'</span>);
            $swatchImg.removeClass(<span class="string">'hidden'</span>);
          }, <span class="keyword">function</span>() {
            $productImg.removeClass(<span class="string">'hidden'</span>);
            $swatchImg.addClass(<span class="string">'hidden'</span>);
          });
      });
    },

    initTooltips : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Favorite Heart</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$favorites.on(<span class="string">'click'</span>, $.proxy( self.onFavorite, self ));

      self.$container.find(<span class="string">'.js-favorite'</span>).tooltip({
        template: <span class="string">'&lt;div class="tooltip gallery-tooltip"&gt;&lt;div class="tooltip-arrow"&gt;&lt;/div&gt;&lt;div class="tooltip-inner"&gt;&lt;/div&gt;&lt;/div&gt;'</span>
      });
    },

    setFilterStatuses : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $visible = self.$grid.data(<span class="string">'shuffle'</span>).$items.filter(<span class="string">'.filtered'</span>),
          filterName, filterValue, method;


</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Reset stored data by setting all filterValue values to null</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filterValues ) {
        <span class="keyword">if</span> ( !self.filterValues.hasOwnProperty(filterName) ) {
          <span class="keyword">continue</span>;
        }

        <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filterValues[ filterName ] ) {
          self.filterValues[ filterName ][ filterValue ] = <span class="literal">null</span>;
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Build up the dictionary of the filters that should be shown/hidden</p>             </td>             <td class="code">               <div class="highlight"><pre>      $visible.each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
              filterSet = $item.data(<span class="string">'filterSet'</span>),
              filterValue,
              filterName;

          <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filterValues ) {
            <span class="keyword">if</span> ( !self.filterValues.hasOwnProperty(filterName) ) {
              <span class="keyword">continue</span>;
            }


            <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filterValues[ filterName ] ) {
</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>If we've already set this to false, we don't need to check again on another element</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="keyword">if</span> ( self.filterValues[ filterName ][ filterValue ] === <span class="literal">true</span> ) {
                  <span class="keyword">continue</span>;
              }

              <span class="keyword">var</span> isArray = $.isArray( filterSet[ filterName ] ),
                  shouldEnable;

              shouldEnable = isArray ?
                  self.valueInArray( filterValue, filterSet[ filterName ] ) :
                  filterValue === filterSet[ filterName ];

              self.filterValues[ filterName ][ filterValue ] = shouldEnable;
            }
          }
      });

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Loop through all filters again to disable/enable them</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> ( filterName <span class="keyword">in</span> self.filterValues ) {
        <span class="keyword">if</span> ( !self.filterValues.hasOwnProperty(filterName) ) {
          <span class="keyword">continue</span>;
        }

        <span class="keyword">for</span> ( filterValue <span class="keyword">in</span> self.filterValues[ filterName ] ) {
          method = self.filterValues[ filterName ][ filterValue ] ? <span class="string">'enable'</span> : <span class="string">'disable'</span>;
          self[ method + <span class="string">'Filter'</span> ]( filterValue, filterName, self.filterTypes[ filterName ] );
        }
      }

      self.$productCount.text( $visible.length );

    },
    valueInArray : <span class="keyword">function</span>( value, arr ) {
      <span class="keyword">return</span> $.inArray(value, arr) !== -<span class="number">1</span>;
    },

    arrayContainsArray : <span class="keyword">function</span>( arrToTest, requiredArr ) {
      <span class="keyword">var</span> i = <span class="number">0</span>,
          dictionary = {},
          j;

</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Convert groups into object which we can test the keys</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; arrToTest.length; j++) {
        dictionary[ arrToTest[j] ] = <span class="literal">true</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Loop through selected features, if that feature is not in this elements groups, return false</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span> (; i &lt; requiredArr.length; i++) {
        <span class="keyword">if</span> ( dictionary[ requiredArr[i] ] === <span class="literal">undefined</span> ) {
          <span class="keyword">return</span> <span class="literal">false</span>;
        }
      }
      <span class="keyword">return</span> <span class="literal">true</span>;
    },

    button : <span class="keyword">function</span>( $parent, filterName ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          labels = {},
          values = {},
          $btns = $parent.children();

      $btns.on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
            isMediaGroup = $<span class="keyword">this</span>.hasClass(<span class="string">'media'</span>),
            $checked,
            checked = [];

</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Abort if this button is disabled</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( $<span class="keyword">this</span>.is(<span class="string">'[disabled]'</span>) ) {
          <span class="keyword">return</span>;
        }

        <span class="keyword">if</span> ( isMediaGroup ) {
          $<span class="keyword">this</span>.find(<span class="string">'.btn'</span>).button(<span class="string">'toggle'</span>);
          $<span class="keyword">this</span>.toggleClass(<span class="string">'active'</span>);
        } <span class="keyword">else</span> {
          $<span class="keyword">this</span>.button(<span class="string">'toggle'</span>);
        }

        $checked = $parent.find(<span class="string">'&gt; .active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Get all data-* filters</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( $checked.length !== <span class="number">0</span> ) {
          $checked.each(<span class="keyword">function</span>() {
            <span class="keyword">var</span> filter = $(<span class="keyword">this</span>).data( filterName );
            checked.push( filter );
          });
        }
        self.filters.button[ filterName ] = checked;

        self.filter();
      })

</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Save each label to the labels object</p>             </td>             <td class="code">               <div class="highlight"><pre>      .each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> data = $(<span class="keyword">this</span>).data();
        labels[ data[ filterName ] ] = data.label;
        values[ data[ filterName ] ] = data[ filterName ];
      });

      self.filterLabels[ filterName ] = labels;
      self.filterValues[ filterName ] = values;
    },

    checkbox : <span class="keyword">function</span>( $parent, filterName ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          labels = {},
          values = {},
          $inputs = $parent.find(<span class="string">'input'</span>);

      $inputs.on(<span class="string">'change'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> $checked = $parent.find(<span class="string">'input:checked'</span>),
        checked = [];

</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>At least one checkbox is checked, clear the array and loop through the checked checkboxes
to build an array of strings</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( $checked.length !== <span class="number">0</span> ) {
          $checked.each(<span class="keyword">function</span>() {
            checked.push(<span class="keyword">this</span>.value);
          });
        }
        self.filters.checkbox[ filterName ] = checked;

        self.filter();
      })

</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Save each label to the labels object</p>             </td>             <td class="code">               <div class="highlight"><pre>      .each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> data = $(<span class="keyword">this</span>).data();
        labels[ <span class="keyword">this</span>.value ] = data.label;
        values[ <span class="keyword">this</span>.value ] = <span class="keyword">this</span>.value;
      });

      self.filterLabels[ filterName ] = labels;
      self.filterValues[ filterName ] = values;
    },

    range : <span class="keyword">function</span>( $rangeControl, filterName , min, max ) {
      <span class="keyword">this</span>.MAX_PRICE = max;
      <span class="keyword">this</span>.MIN_PRICE = min;
      <span class="keyword">this</span>.price = {
        min: <span class="keyword">this</span>.MIN_PRICE,
        max: <span class="keyword">this</span>.MAX_PRICE
      };

      <span class="keyword">var</span> self = <span class="keyword">this</span>,
      diff = self.MAX_PRICE - self.MIN_PRICE,
      $output = $rangeControl.closest(<span class="string">'.filter-container'</span>).find(<span class="string">'.range-output-container'</span>),
      $minOutput = $output.find(<span class="string">'.range-output-min'</span>),
      $maxOutput = $output.find(<span class="string">'.range-output-max'</span>),

      getPrice = <span class="keyword">function</span>(percent) {
        <span class="keyword">return</span> Math.round( diff * (percent / <span class="number">100</span>) ) + self.MIN_PRICE;
      },

</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Range control update callback</p>             </td>             <td class="code">               <div class="highlight"><pre>      update = <span class="keyword">function</span>(evt, positions, percents) {
        <span class="keyword">var</span> minPrice = getPrice(percents.min),
        maxPrice = getPrice(percents.max),
        maxPriceStr = maxPrice === self.MAX_PRICE ? maxPrice + <span class="string">'+'</span> : maxPrice,
        prevMin = self.price.min,
        prevMax = self.price.max,
        delay;

</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Display values</p>             </td>             <td class="code">               <div class="highlight"><pre>        displayValues(minPrice, maxPriceStr, percents);

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Save values</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.price.min = minPrice;
        self.price.max = maxPrice;

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Filter results only if values have changed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( (prevMin !== self.price.min || prevMax !== self.price.max) &amp;&amp; self.isInitialized ) {

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Save current filters</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.filters.range[ filterName ].min = self.price.min;
          self.filters.range[ filterName ].max = self.price.max;

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Throttle filtering (especially on touch)</p>             </td>             <td class="code">               <div class="highlight"><pre>          delay = self.isTouch ? <span class="number">2500</span> : <span class="number">250</span>;
          $.debounce( delay, <span class="keyword">function</span>() {
            self.filter();
          })();
        }
      },

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Show what's happening with the range control</p>             </td>             <td class="code">               <div class="highlight"><pre>      displayValues = <span class="keyword">function</span>( min, max, percents ) {
</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>$output.html('$' + min + ' - $' + max);</p>             </td>             <td class="code">               <div class="highlight"><pre>        $minOutput.css(<span class="string">'left'</span>, percents.min + <span class="string">'%'</span>).html(<span class="string">'&lt;sup&gt;$&lt;/sup&gt;'</span> + min);
        $maxOutput.css(<span class="string">'left'</span>, percents.max + <span class="string">'%'</span>).html(<span class="string">'&lt;sup&gt;$&lt;/sup&gt;'</span> + max);
      };

</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Store jQuery object for later access</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$rangeControl = $rangeControl;

</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>On handle slid, update. Register before initialized so it's called during initialization</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$rangeControl.on(<span class="string">'slid.rangecontrol'</span>, update);

      self.$rangeControl.rangeControl({
        initialMin: <span class="string">'0%'</span>,
        initialMax: <span class="string">'100%'</span>,
        range: <span class="literal">true</span>
      });
    },

</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>If there is a range control in this element and it's in need of an update</p>             </td>             <td class="code">               <div class="highlight"><pre>    maybeResetRange : <span class="keyword">function</span>() {
      <span class="keyword">var</span> th = <span class="keyword">this</span>,
          $rangeControl = th.$container.find(<span class="string">'.range-control'</span>);
      <span class="keyword">if</span> ( $rangeControl.length &gt; <span class="number">0</span> &amp;&amp; $rangeControl.data(<span class="string">'rangeControl'</span>).isHidden ) {
        $rangeControl.rangeControl(<span class="string">'reset'</span>);
        <span class="keyword">return</span> <span class="literal">true</span>;
      }
      <span class="keyword">return</span> <span class="literal">false</span>;
    },

    getSortObject : <span class="keyword">function</span>( evt, $btnText ) {
      <span class="keyword">var</span> $target = $(evt.target),
          isSelect = $target.is(<span class="string">'select'</span>),
          data,
          filterName,
          reverse,
          sortObj = {},
          index;

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Get variables based on what kind of component we're working with</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( isSelect ) {
        filterName = $target.val();
        index = evt.target.selectedIndex;
        reverse = evt.target[ index ].getAttribute(<span class="string">'data-reverse'</span>);
        reverse = reverse === <span class="string">'true'</span> ? <span class="literal">true</span> : <span class="literal">false</span>;
      } <span class="keyword">else</span> {
        data = $target.data();
        filterName = data.value;
        reverse = data.reverse ? <span class="literal">true</span> : <span class="literal">false</span>;
        index = $target.closest(<span class="string">'li'</span>).index();
        evt.preventDefault();
        $btnText.text( $target.text() );
      }

      <span class="keyword">if</span> ( filterName !== <span class="string">'default'</span> ) {
        sortObj = {
          sortIndex: index,
          reverse: reverse,
          by: <span class="keyword">function</span>($el) {
</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>e.g. filterSet.price</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">return</span> $el.data(<span class="string">'filterSet'</span>)[ filterName ];
          }
        };
      } <span class="keyword">else</span> {
        sortObj.sortIndex = index;
      }

      <span class="keyword">return</span> sortObj;

    },

    updateSortDisplay : <span class="keyword">function</span>( $container ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          currentSortValue = <span class="string">''</span>;

      <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>) ) {
</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Dealing with the select option menu</p>             </td>             <td class="code">               <div class="highlight"><pre>        currentSortValue = $container.find(<span class="string">'select'</span>).children().eq( self.currentSort ).val();
        $container
          .find(<span class="string">'select'</span>)
          .val( currentSortValue )
          .trigger(<span class="string">'change'</span>);
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>The dropdown component</p>             </td>             <td class="code">               <div class="highlight"><pre>        $container
          .find(<span class="string">'.dropdown-menu'</span>)
          .children()
          .eq( self.currentSort )
          .find(<span class="string">'a'</span>)
          .trigger(<span class="string">'click'</span>);
      }

      <span class="keyword">return</span> self;
    },

    sort : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          sortObj = self.getSortObject( evt, self.$dropdownToggleText );

      self.currentSort = sortObj.sortIndex;
      self.$grid.shuffle(<span class="string">'sort'</span>, sortObj);

      <span class="keyword">return</span> self;
    },

    sortByPriority : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          isTablet = Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>);

      <span class="keyword">if</span> ( isTablet &amp;&amp; !self.sorted ) {
        self.$grid.shuffle(<span class="string">'sort'</span>, {
          by: <span class="keyword">function</span>($el) {
            <span class="keyword">var</span> priority = $el.data(<span class="string">'priority'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Returning undefined to the sort plugin will cause it to revert to the original array</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">return</span> priority ? priority : <span class="literal">undefined</span>;
          }
        });
        self.sorted = <span class="literal">true</span>;
      } <span class="keyword">else</span> <span class="keyword">if</span> ( !isTablet &amp;&amp; self.sorted ) {
        self.$grid.shuffle(<span class="string">'sort'</span>, {});
        self.sorted = <span class="literal">false</span>;
      }
    },

    sortComparedItems : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          sortObj = self.getSortObject( evt, self.$compareTool.find(<span class="string">'.js-toggle-text'</span>) ),
          sortedItems,
          frag = document.createDocumentFragment();

</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Sort elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      sortedItems = self.$compareItems.sorted( sortObj );

</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Remove old elements from DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareItems.detach();

</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Not default order</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( sortObj.by ) {
</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Append sorted elements to a document fragment</p>             </td>             <td class="code">               <div class="highlight"><pre>        $.each(sortedItems, <span class="keyword">function</span>(i, element) {
          frag.appendChild( element );
        });

</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Append document fragment to the compare-item container</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$compareTool.find(<span class="string">'.compare-items-container'</span>).append( frag );

</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Save our new compare items</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$compareItems = $( sortedItems );

</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Default order is saved in the state variable</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        self.$compareItems = self.compareState.$items;
        self.$compareTool.find(<span class="string">'.compare-items-container'</span>).append( self.$compareItems );
      }

</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Make sure we can press reset (if it wasn't manually triggered)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !evt.isTrigger ) {
        self.$compareReset.removeClass(<span class="string">'disabled'</span>);
      }

      <span class="keyword">return</span> self;
    },

    onResize : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( !self.enabled ) {
        <span class="keyword">return</span>;
      }

      console.log(<span class="string">'iOS is triggering resizes when it shouldnt be: onResize'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Make all product name heights even</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$gridProductNames.evenHeights();

</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Don't change columns for detail galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.mode === <span class="string">'detailed'</span> ) {

</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>768-979</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 48em) and (max-width: 61.1875em)'</span>) ) {
          <span class="keyword">if</span> ( self.$filterColumns.eq(<span class="number">0</span>).hasClass(<span class="string">'span4'</span>) ) {
            self.$filterColumns
              .removeClass(<span class="string">'span4'</span>)
              .slice(<span class="number">0</span>, <span class="number">2</span>)
                .addClass(<span class="string">'span6'</span>)
                .end()
              .last()
                .addClass(<span class="string">'span12'</span>)
                .find(<span class="string">'.media-list'</span>)
                  .addClass(<span class="string">'inline'</span>);
          }
        } <span class="keyword">else</span> {
          <span class="keyword">if</span> ( self.$filterColumns.eq(<span class="number">0</span>).hasClass(<span class="string">'span6'</span>) ) {
            self.$filterColumns
              .removeClass(<span class="string">'span6 span12'</span>)
              .addClass(<span class="string">'span4'</span>)
              .find(<span class="string">'.media-list'</span>)
                .removeClass(<span class="string">'inline'</span>);
          }
        }

        <span class="keyword">return</span>;
      }

      self.sortByPriority();
    },

    onFavorite : <span class="keyword">function</span>( evt ) {
      $(evt.delegateTarget).toggleClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Stop event from bubbling to <a> tag</p>             </td>             <td class="code">               <div class="highlight"><pre>      evt.preventDefault();
      evt.stopPropagation();
    },

    onFiltersHide : <span class="keyword">function</span>( evt ) {
      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>
      <span class="keyword">var</span> $toggle = <span class="keyword">this</span>.$container.find(<span class="string">'.slide-toggle'</span>);
      <span class="keyword">this</span>.$filterArrow.removeClass(<span class="string">'in'</span>);
      $toggle.find(<span class="string">'.up'</span>).addClass(<span class="string">'hide'</span>);
      $toggle.find(<span class="string">'.down'</span>).removeClass(<span class="string">'hide'</span>);
    },

    onFiltersShow : <span class="keyword">function</span>( evt ) {
      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>
      <span class="keyword">var</span> $toggle = <span class="keyword">this</span>.$container.find(<span class="string">'.slide-toggle'</span>);
      <span class="keyword">this</span>.$filterArrow.addClass(<span class="string">'in'</span>);
      $toggle.find(<span class="string">'.up'</span>).removeClass(<span class="string">'hide'</span>);
      $toggle.find(<span class="string">'.down'</span>).addClass(<span class="string">'hide'</span>);

    },

    onFiltersShown : <span class="keyword">function</span>( evt ) {
      evt.stopPropagation(); <span class="comment">// stop this event from bubbling up to .gallery</span>
      <span class="keyword">var</span> didReset = <span class="keyword">this</span>.maybeResetRange(evt);
      <span class="keyword">if</span> ( !didReset ) {
        <span class="keyword">this</span>.filter();
      }
    },

    onShuffleLoading : <span class="keyword">function</span>() {
      <span class="keyword">var</span> $div = $(<span class="string">'&lt;div&gt;'</span>, { <span class="string">'class'</span> : <span class="string">'gallery-loader text-center'</span> }),
          $img = $(<span class="string">'&lt;img&gt;'</span>, { src: <span class="keyword">this</span>.loadingGif });
      $div.append($img);
      $div.insertBefore(<span class="keyword">this</span>.$grid);
    },

    onShuffleDone : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      setTimeout(<span class="keyword">function</span>() {
        self.$container.find(<span class="string">'.gallery-loader'</span>).remove();
        self.$container.addClass(<span class="string">'in'</span>);
      }, <span class="number">250</span>);
    },

    onCompareLaunch : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          shuffle = self.$grid.data(<span class="string">'shuffle'</span>),

</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Clone all visible</p>             </td>             <td class="code">               <div class="highlight"><pre>          $currentItems = shuffle.$items.filter(<span class="string">'.filtered'</span>).clone(),
          $compareItemsContainer = $(<span class="string">'&lt;div class="compare-items-container grab"&gt;'</span>),
          $compareItemsWrapper = $(<span class="string">'&lt;div class="compare-items-wrap"&gt;'</span>),

</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Get product count</p>             </td>             <td class="code">               <div class="highlight"><pre>          productCount = $currentItems.length,

          $container = $(<span class="string">'&lt;div class="container js-compare-wrap"&gt;'</span>),
          $content = $(<span class="string">'&lt;div class="compare-container clearfix"&gt;'</span>),
          $header = self.$compareTool.find(<span class="string">'.modal-header'</span>),
          $modalBody = self.$compareTool.find(<span class="string">'.modal-body'</span>),

          $label = self.$compareTool.find(<span class="string">'#compare-tool-label'</span>),
          originalLabel = $label.text(),

          $labelColumnWrap = $(<span class="string">'&lt;div class="span2 detail-labels-wrap hidden-phone"&gt;'</span>),
          $labelColumn = $(<span class="string">'&lt;div class="detail-labels-wrapping"&gt;'</span>),
          $labelGroup = $(<span class="string">'&lt;div class="detail-label-group"&gt;'</span>),

</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Clone sort button</p>             </td>             <td class="code">               <div class="highlight"><pre>          $sortOpts = self.$container.find(<span class="string">'.sort-options'</span>).clone();

</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Disable the main gallery (from executing resize events, etc.)</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.disable();

      self.compareTitle = originalLabel + <span class="string">' '</span> + self.$container.find(<span class="string">'.compare-name'</span>).text();

</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Clone the product count</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareCountWrap = self.$container.find(<span class="string">'.product-count-wrap'</span>).clone().removeClass(<span class="string">'ib'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Create reset button</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareReset = $(<span class="string">'&lt;button/&gt;'</span>, {
          <span class="string">'class'</span> : <span class="string">'btn btn-small btn-alt-special btn-reset disabled js-compare-reset iconTrigger-ui2-reset'</span>,
          <span class="string">'text'</span> : $header.data(<span class="string">'resetLabel'</span>)
      });
      self.$compareReset.append(<span class="string">'&lt;i class="icon-ui2-reset"&gt;'</span>);
      self.$compareReset.on(<span class="string">'click'</span>, $.proxy( self.onCompareReset, self ));

      self.isFixedHeader = <span class="literal">false</span>;

      self.$detailLabelsWrap = $labelColumnWrap;

</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Convert cloned gallery items to compare items</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareItems = self.getCompareItems( $currentItems );

</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Create sticky header for count</p>             </td>             <td class="code">               <div class="highlight"><pre>      $labelColumnWrap
        .append(<span class="string">'&lt;div class="span2 compare-sticky-header sticky-count"&gt;'</span>)
        .find(<span class="string">'.compare-sticky-header'</span>)
        .append( self.$compareCountWrap.clone() );

</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Create labels column</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$container.find(<span class="string">'.comparables [data-label]'</span>).each(<span class="keyword">function</span>() {
          <span class="keyword">var</span> $label = $(<span class="keyword">this</span>).clone(),
              $strong = $(<span class="string">'&lt;strong/&gt;'</span>);

          $strong.text( $label.attr(<span class="string">'data-label'</span>) );
          $label.append( $strong );
          $labelGroup.append($label);
      });

</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Remove compare items on click</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareItems.find(<span class="string">'.compare-item-remove'</span>).on(<span class="string">'click'</span>, $.proxy( self.onCompareItemRemove, self ));

</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Set up sort events</p>             </td>             <td class="code">               <div class="highlight"><pre>      $sortOpts.find(<span class="string">'.dropdown a'</span>).on(<span class="string">'click'</span>, $.proxy( self.sortComparedItems, self ));
      $sortOpts.find(<span class="string">'.native-dropdown'</span>).on(<span class="string">'change'</span>, $.proxy( self.sortComparedItems, self ));

</pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Set the right heading. e.g. Compare Cyber-shot</p>             </td>             <td class="code">               <div class="highlight"><pre>      $label.text( self.compareTitle );


</pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Save state for reset</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.compareState = {
          count: productCount,
          sort: self.currentSort,
          $items : self.$compareItems,
          label: originalLabel,
          snap: <span class="literal">true</span>
      };

</pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Append count and labels</p>             </td>             <td class="code">               <div class="highlight"><pre>      $labelColumn.append( self.$compareCountWrap );

</pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>On window resize</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$window.on(<span class="string">'resize.comparetool'</span>, $.debounce(<span class="number">250</span>, <span class="keyword">function</span>() {
        self.onCompareResize( $header, $sortOpts );
      }));
      self.onCompareResize( $header, $sortOpts, <span class="literal">true</span> );

      self.$compareReset.addClass(<span class="string">'pull-right'</span>);
      $labelColumn.append( $labelGroup );

</pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>Set current sort. After saving state so we get the correct DOM order for compareItems</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.updateSortDisplay( $sortOpts );

      $labelColumnWrap.append( $labelColumn );
      $content.append( $labelColumnWrap );
      $compareItemsContainer.append( self.$compareItems );
      $compareItemsWrapper.append( $compareItemsContainer );
      $content.append( $compareItemsWrapper );
      $container.append( $content );
      $modalBody.append( $container );

      self.addCompareNav( $compareItemsWrapper );

</pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Trigger modal</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool
        .data(<span class="string">'galleryId'</span>, self.id) <span class="comment">// Set some data on the modal so we know which gallery it belongs to</span>
        .modal({
          backdrop: <span class="literal">false</span>
        }); <span class="comment">// Show the modal</span>


</pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <h2>WORK TO DO AFTER ITEMS HAVE BEEN PUT INTO THE DOM</h2>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>Cloned images need to be updated</p>             </td>             <td class="code">               <div class="highlight"><pre>      window.iQ.update( <span class="literal">true</span> );

</pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>Save a reference to the count</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareCount = self.$compareTool.find(<span class="string">'.product-count'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Set item count</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareCount.text( productCount );

</pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>Save reference to sticky headers</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$stickyHeaders = self.$compareTool.find(<span class="string">'.compare-sticky-header'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>Save ref to the .product-name-wraps</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareProductNameWraps = self.$compareTool.find(<span class="string">'.product-name-wrap'</span>);
      self.$compareItemsContainer = self.$compareTool.find(<span class="string">'.compare-items-container'</span>);

    },

    onCompareShown : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          offsetTop = <span class="number">0</span>,
          extra = <span class="number">0</span>;

      offsetTop = self.$compareItems.first().offset().top;
      extra = parseInt( self.$compareTool.find(<span class="string">'.compare-item .product-img'</span>).last().css(<span class="string">'height'</span>), <span class="number">10</span> );
      offsetTop += extra;

      self
        .setCompareRowHeights( <span class="literal">true</span> )
        .setCompareDimensions();


</pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>Initialize outer scroller (vertical scrolling of the fixed position modal)</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.outerScroller = <span class="keyword">new</span> IScroll( self.$compareTool[<span class="number">0</span>], {
        bounce: <span class="literal">false</span>,
        onBeforeScrollStart : <span class="keyword">function</span>(e) {
          <span class="keyword">var</span> target = e.target;
          <span class="keyword">while</span> ( target.nodeType !== <span class="number">1</span> ) {
            target = target.parentNode;
          }

          <span class="keyword">if</span> ( target.tagName !== <span class="string">'SELECT'</span> &amp;&amp; target.tagName !== <span class="string">'INPUT'</span> &amp;&amp; target.tagName !== <span class="string">'TEXTAREA'</span> ) {
            e.preventDefault();
          }
        },
        onScrollStart : <span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>Add <code>grabbing</code> class</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !self.$compareItemsContainer.hasClass(<span class="string">'grabbing'</span>) ) {
            self.$compareItemsContainer.addClass(<span class="string">'grabbing'</span>);
          }
        },
        onScrollEnd : <span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>Remove <code>grabbing</code> class</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( self.$compareItemsContainer.hasClass(<span class="string">'grabbing'</span>) ) {
            self.$compareItemsContainer.removeClass(<span class="string">'grabbing'</span>);
          }
        },
        onScrollMove : <span class="keyword">function</span>() {
          self.onCompareScroll( offsetTop, <span class="keyword">this</span> );
        },
        onAnimate : <span class="keyword">function</span>() {
          self.onCompareScroll( offsetTop, <span class="keyword">this</span> );
        },
        onAnimationEnd : <span class="keyword">function</span>() {
          self.onCompareScroll( offsetTop, <span class="keyword">this</span> );
        }
      });


</pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Initialize inner scroller (for the comparable product items)</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.innerScroller = <span class="keyword">new</span> IScroll( self.$compareTool.find(<span class="string">'.compare-items-wrap'</span>)[<span class="number">0</span>], {
        vScroll: <span class="literal">false</span>,
</pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>snap: '.compare-item',</p>             </td>             <td class="code">               <div class="highlight"><pre>        snap: self.compareState.snap, <span class="comment">// this is required for iscroll.scrollToPage</span>
        onScrollStart : <span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Add <code>grabbing</code> class</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( !self.$compareItemsContainer.hasClass(<span class="string">'grabbing'</span>) ) {
            self.$compareItemsContainer.addClass(<span class="string">'grabbing'</span>);
          }
        },
        onScrollEnd : <span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Remove <code>grabbing</code> class</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( self.$compareItemsContainer.hasClass(<span class="string">'grabbing'</span>) ) {
            self.$compareItemsContainer.removeClass(<span class="string">'grabbing'</span>);
          }
        },
        onScrollMove : <span class="keyword">function</span>() {
          self.onCompareScroll( <span class="string">'inner'</span>, <span class="keyword">this</span> );
        },
        onAnimate : <span class="keyword">function</span>() {
          self.onCompareScroll( <span class="string">'inner'</span>, <span class="keyword">this</span> );
        },
        onAnimationEnd : <span class="keyword">function</span>() {
          window.iQ.update();
          self.onCompareScroll( <span class="string">'inner'</span>, <span class="keyword">this</span> );
          self.afterCompareScrolled( <span class="keyword">this</span> );
        }
      });

</pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Set the height, jQuery object, and text of the takeover sticky nav</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.setTakeoverStickyHeader( self.compareTitle );

</pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Position sticky headers</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.setStickyHeaderPos();

</pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Fade in the labels to hide the fact that it took so long to compute heights.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool.find(<span class="string">'.detail-labels-wrapping'</span>).addClass(<span class="string">'complete'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>These can be deferred</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout(<span class="keyword">function</span>() {

</pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Hide the previous nav paddle because we're on the first page</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.afterCompareScrolled( self.innerScroller );

</pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>Bind events to the paddles</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.addCompareNavEvents();

      }, <span class="number">100</span>);

      <span class="keyword">return</span> self;
    },

    onCompareClosed : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.$compareTool.data(<span class="string">'galleryId'</span>) !== self.id ) {
        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>Delete the id from memory</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool.removeData(<span class="string">'galleryId'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>Clean up</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool.find(<span class="string">'.sort-options'</span>).remove();
      self.$takeoverStickyHeader.removeClass(<span class="string">'open'</span>).removeAttr(<span class="string">'style'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>Destroy iscrolls</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.outerScroller.destroy();
      self.innerScroller.destroy();

</pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>Remove listeners for nav button clicks</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.removeCompareNavEvents();

</pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Empty out html
Remove scroll event</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool
        .find(<span class="string">'.js-compare-wrap'</span>)
        .remove()
        .end()
        .find(<span class="string">'.modal-subheader'</span>)
        .remove()
        .end()
        .find(<span class="string">'#compare-tool-label'</span>)
        .text( self.compareState.label )
        .end()
        .off(<span class="string">'.comparetool'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>Set count to zero</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareCount.text(<span class="number">0</span>);

      self.$compareReset.remove();
      self.$compareReset = <span class="literal">null</span>;
      self.$compareItems = <span class="literal">null</span>;
      self.$compareItemsContainer = <span class="literal">null</span>;
      self.$detailLabelsWrap = <span class="literal">null</span>;
      self.$takeoverStickyHeader = <span class="literal">null</span>;

</pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Set state to null</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.compareState = <span class="literal">null</span>;
      self.isFixedHeader = <span class="literal">null</span>;
      self.compareTitle = <span class="literal">null</span>;

</pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Remove resize event</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$window.off(<span class="string">'.comparetool'</span>);

      self.enable();

      <span class="keyword">return</span> self;
    },

    onCompareReset : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          state = self.compareState;

      <span class="keyword">if</span> ( self.$compareReset.hasClass(<span class="string">'disabled'</span>) || self.$compareTool.data(<span class="string">'galleryId'</span>) !== self.id ) {
        <span class="keyword">return</span>;
      }

      self.$compareCount.text( state.count );
      state.$items
        .find(<span class="string">'.compare-item-remove'</span>)
        .parent()
        .addBack()
        .removeClass(<span class="string">'hide'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Disable reset button</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareReset.addClass(<span class="string">'disabled'</span>).removeClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>Reset sort</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.updateSortDisplay( self.$compareTool );

</pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>Set container width</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.setCompareWidth();

</pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>Reset iscroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.innerScroller.refresh();

      <span class="keyword">return</span> self;
    },

    onCompareItemRemove : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          remaining;

</pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>Hidet the column</p>             </td>             <td class="code">               <div class="highlight"><pre>      $(evt.target).closest(<span class="string">'.compare-item'</span>).addClass(<span class="string">'hide'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Make sure we can press reset</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareReset.removeClass(<span class="string">'disabled'</span>).addClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>Get remaining</p>             </td>             <td class="code">               <div class="highlight"><pre>      remaining = self.$compareItems.not(<span class="string">'.hide'</span>).length;

</pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>Set remaining text</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareCount.text( remaining );

</pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>Hide close button if there are only 2 left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( remaining &lt; <span class="number">3</span> ) {
        self.$compareTool.find(<span class="string">'.compare-item-remove'</span>).addClass(<span class="string">'hide'</span>);
      }

      self.setCompareWidth();
      self.innerScroller.refresh();

      <span class="keyword">return</span> self;
    },

    onCompareResize : <span class="keyword">function</span>( $header, $sortOpts, isFirst ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $subheader,
          $resetBtn,
          $sorter,
          snap;

</pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>Phone = sticky header</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(max-width: 47.9375em)'</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>Setup sticky header</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( isFirst || !self.isFixedHeader ) {
          self.isFixedHeader = <span class="literal">true</span>;

          $subheader = $(<span class="string">'&lt;div class="modal-subheader clearfix"&gt;'</span>);
          self.$compareCountWrap.addClass(<span class="string">'hidden'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>If this isn't the first call, the elements are already on the page and need to be detached</p>             </td>             <td class="code">               <div class="highlight"><pre>          $resetBtn = isFirst ? self.$compareReset : self.$compareReset.detach();
          $sorter = isFirst ? $sortOpts : $sortOpts.detach();
          $subheader.append( $resetBtn, $sorter );

</pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>Insert subhead in the modal header</p>             </td>             <td class="code">               <div class="highlight"><pre>          $header.append( $subheader );

          snap = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Let the scroller flow freely on mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( self.innerScroller ) {
            self.innerScroller.options.snap = snap;
          }
        }

</pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>Larger than phone</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {

        <span class="keyword">if</span> ( isFirst || self.isFixedHeader ) {
          self.isFixedHeader = <span class="literal">false</span>;

          self.$compareCountWrap.removeClass(<span class="string">'hidden'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>Append sort dropdown
If this isn't the first call, the elements are already on the page and need to be detached</p>             </td>             <td class="code">               <div class="highlight"><pre>          $resetBtn = isFirst ? self.$compareReset : self.$compareReset.detach();
          $sorter = isFirst ? $sortOpts : $sortOpts.detach();
          $header.append( $resetBtn, $sorter );

          self.$compareTool.find(<span class="string">'.modal-subheader'</span>).remove();

          snap = <span class="literal">true</span>;

</pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>Snap to pages on 'desktop'</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( self.innerScroller ) {
            self.innerScroller.options.snap = snap;
          }
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>This is where you get off, first guy</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( isFirst ) {
        self.compareState.snap = snap;
        <span class="keyword">return</span> self;
      }

      self
        .setCompareRowHeights()
        .setCompareDimensions()
        .setStickyHeaderPos();

      self.innerScroller.refresh();

      <span class="keyword">return</span> self;
    },

    onCompareScroll : <span class="keyword">function</span>( offsetTop, iscroll ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          scrollTop = iscroll.y * -<span class="number">1</span>;

      <span class="keyword">if</span> ( offsetTop === <span class="string">'inner'</span> ) {
        <span class="keyword">if</span> ( iscroll.x &lt; -<span class="number">3</span> &amp;&amp; !self.$detailLabelsWrap.hasClass(<span class="string">'overflowing'</span>) ) {
          self.$detailLabelsWrap.addClass(<span class="string">'overflowing'</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> ( iscroll.x &gt;= -<span class="number">3</span> &amp;&amp; self.$detailLabelsWrap.hasClass(<span class="string">'overflowing'</span>) ) {
          self.$detailLabelsWrap.removeClass(<span class="string">'overflowing'</span>);
        }
        <span class="keyword">return</span>;
      }

      <span class="keyword">if</span> ( scrollTop &gt;= offsetTop ) {
        <span class="keyword">if</span> ( !self.$stickyHeaders.hasClass(<span class="string">'open'</span>) ) {
          self.$takeoverStickyHeader.addClass(<span class="string">'open'</span>);
          self.$stickyHeaders.addClass(<span class="string">'open'</span>);
        }
        self.setStickyHeaderPos();

      } <span class="keyword">else</span> {
        <span class="keyword">if</span> ( self.$stickyHeaders.hasClass(<span class="string">'open'</span>) ) {
          self.$takeoverStickyHeader.removeClass(<span class="string">'open'</span>);
          self.$stickyHeaders.removeClass(<span class="string">'open'</span>);
        }
      }
    },

    getCompareItems : <span class="keyword">function</span>( $items ) {
      <span class="keyword">var</span> $newItems = $();

</pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Build / manipulate compare items from the gallery items</p>             </td>             <td class="code">               <div class="highlight"><pre>      $items.each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
            $swatches,
            $div = $(<span class="string">'&lt;div/&gt;'</span>),
            $stickyHeader;

</pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>Create remove button, show detail group, remove label, remove product-meta,
wrap name and model in a container (to set the height on), create fixed header clones</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item
          .removeClass()
          .addClass(<span class="string">'span4 compare-item'</span>)
          .removeAttr(<span class="string">'style'</span>)
          .append(<span class="string">'&lt;span class="box-close box-close-small compare-item-remove"&gt;&lt;i class="fonticon-10-x"&gt;&lt;/i&gt;&lt;/span&gt;'</span>)
          .find(<span class="string">'.detail-group'</span>)
            .removeClass(<span class="string">'hidden'</span>)
            .end()
          .find(<span class="string">'.label, .product-meta, .js-favorite'</span>)
            .remove()
            .end()
          .find(<span class="string">'.product-name-wrap'</span>)
            .css(<span class="string">'height'</span>, <span class="string">''</span>)
            .end()
          .prepend(<span class="string">'&lt;div class="span4 compare-sticky-header"&gt;'</span>)
          .find(<span class="string">'.compare-sticky-header'</span>)
            .append(<span class="string">'&lt;div class="media"&gt;'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Remove and reattach the swatches to after the price</p>             </td>             <td class="code">               <div class="highlight"><pre>        $swatches = $item.find(<span class="string">'.product-img .color-swatches'</span>).detach();
        $item.find(<span class="string">'.product-price'</span>).after($swatches);

        $stickyHeader = $item.find(<span class="string">'.compare-sticky-header'</span>);
</pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>Needed to detach swatches before cloning!</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Compare X</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item
          .find(<span class="string">'.compare-item-remove'</span>)
          .clone(<span class="literal">true</span>) <span class="comment">// true for compare item remove's functionality</span>
          .appendTo( $stickyHeader );

</pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>Product image to media object</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item
          .find(<span class="string">'.product-img .js-product-img-main'</span>)
          .clone()
          .addClass(<span class="string">'media-object'</span>)
          .appendTo( $stickyHeader.find(<span class="string">'.media'</span>) )
          .wrap(<span class="string">'&lt;div class="pull-left"&gt;'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>Product name wrap to media object</p>             </td>             <td class="code">               <div class="highlight"><pre>        $item
          .find(<span class="string">'.product-name-wrap'</span>)
          .clone()
          .addClass(<span class="string">'media-body'</span>)
          .appendTo( $stickyHeader.find(<span class="string">'.media'</span>) );

</pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>Swap .p2 for .p3</p>             </td>             <td class="code">               <div class="highlight"><pre>        $stickyHeader
          .find(<span class="string">'.product-name'</span>)
          .addClass(<span class="string">'p3'</span>)
          .removeClass(<span class="string">'p2'</span>);


</pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>Create a new div with the same attributes as the anchor tag
We no longer want the entire thing to be clickable</p>             </td>             <td class="code">               <div class="highlight"><pre>        $div.attr({
            <span class="string">'class'</span> : $item.attr(<span class="string">'class'</span>),
            <span class="string">'data-filter-set'</span> : $item.attr(<span class="string">'data-filter-set'</span>)
        });

        $div.append( $item.children().detach() );
        $newItems = $newItems.add( $div );
      });

      <span class="keyword">return</span> $newItems;
    },

    addCompareNav : <span class="keyword">function</span>( $parent ) {
      <span class="keyword">var</span> $navContainer = $(<span class="string">'&lt;nav class="compare-nav"&gt;'</span>),
          $prevPaddle = $(<span class="string">'&lt;button class="nav-paddle nav-prev"&gt;&lt;i class="icon-ui2-chevron-18-white-left"&gt;&lt;/i&gt;&lt;/button&gt;'</span>),
          $nextPaddle = $(<span class="string">'&lt;button class="nav-paddle nav-next"&gt;&lt;i class="icon-ui2-chevron-18-white-right"&gt;&lt;/i&gt;&lt;/button&gt;'</span>);

      $navContainer.append( $prevPaddle, $nextPaddle );
      $parent.append( $navContainer );
    },

    addCompareNavEvents : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          iscroll = self.innerScroller,
          $prev = self.$compareTool.find(<span class="string">'.nav-prev'</span>),
          $next = self.$compareTool.find(<span class="string">'.nav-next'</span>);

      $prev.on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
        iscroll.scrollToPage(<span class="string">'prev'</span>);
      });

      $next.on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
        iscroll.scrollToPage(<span class="string">'next'</span>);
      });
    },

    afterCompareScrolled : <span class="keyword">function</span>( iscroll ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $prev = self.$compareTool.find(<span class="string">'.nav-prev'</span>),
          $next = self.$compareTool.find(<span class="string">'.nav-next'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>Hide show prev button depending on where we are</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( iscroll.currPageX === <span class="number">0</span> ) {
        $prev.addClass(<span class="string">'hide'</span>);
      } <span class="keyword">else</span> {
        $prev.removeClass(<span class="string">'hide'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>Hide show next button depending on where we are</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( iscroll.currPageX === iscroll.pagesX.length - <span class="number">1</span> ) {
        $next.addClass(<span class="string">'hide'</span>);
      } <span class="keyword">else</span> {
        $next.removeClass(<span class="string">'hide'</span>);
      }
    },

    removeCompareNavEvents : <span class="keyword">function</span>() {
      <span class="keyword">this</span>.$compareTool.find(<span class="string">'.compare-nav'</span>).children().off(<span class="string">'click'</span>);
    },

    setTakeoverStickyHeader : <span class="keyword">function</span>( title ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.$takeoverStickyHeader = self.$compareTool.find(<span class="string">'.takeover-sticky-header'</span>);
      self.$takeoverStickyHeader.find(<span class="string">'.sticky-nav-title'</span>).text( title );
      self.takeoverHeaderHeight = self.$takeoverStickyHeader.outerHeight();
    },

    getY : <span class="keyword">function</span>( y ) {
      <span class="keyword">return</span> [ <span class="keyword">this</span>.valStart, y, <span class="keyword">this</span>.valEnd, <span class="keyword">this</span>.translateZ ].join(<span class="string">''</span>);
    },

</pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>Elements here cannot use <code>fixed</code> positioning because of a webkit bug.
Fixed positions don't work inside an element which has <code>transform</code> on it.
https://code.google.com/p/chromium/issues/detail?id=20574</p>             </td>             <td class="code">               <div class="highlight"><pre>    setStickyHeaderPos : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          offset = self.$compareItems.not(<span class="string">'.hide'</span>).first().offset().top * -<span class="number">1</span>,
          compareOffset = offset + self.takeoverHeaderHeight,
          takeoverValue = self.getY( self.outerScroller.y * -<span class="number">1</span> ),
          compareValue = self.getY( compareOffset );

</pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>Position the sticky headers. These are relative to .compare-item</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$stickyHeaders.css( self.prop, compareValue );

</pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>Position takeover header. This is relative to .modal-inner,
so we can take the outer scroller's y offset</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$takeoverStickyHeader.css( self.prop, takeoverValue );


      <span class="keyword">return</span> self;
    },

    setColumnMode : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.mode !== <span class="string">'detailed'</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>Make this a 5 column grid. Added to parent because grid must be a descendant of grid5</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$grid.addClass(<span class="string">'slimgrid5'</span>);


        self.shuffleColumns = <span class="keyword">function</span>( containerWidth ) {
          <span class="keyword">var</span> column;

</pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 75em)'</span>) ) {
            column = Exports.COLUMN_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( !Modernizr.mediaqueries || Modernizr.mq(<span class="string">'(min-width: 61.25em)'</span>) ) {
            column = Exports.COLUMN_WIDTH_SLIM_5 * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>Portrait Tablet ( 4 columns )
} else if ( Modernizr.mq('(min-width: 48em)') ) {
  column = Exports.COLUMN<em>WIDTH</em>768 * containerWidth;</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )
568px+</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 35.5em)'</span>) ) {
            column = Exports.COLUMN_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>Phone ( 2 columns )
&lt; 568px</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> {
            column = Exports.COLUMN_WIDTH_320 * containerWidth;
          }


          <span class="keyword">return</span> column;
        };

        self.shuffleGutters = <span class="keyword">function</span>( containerWidth ) {
          <span class="keyword">var</span> gutter,
              numColumns = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 75em)'</span>) ) {
            gutter = Exports.GUTTER_WIDTH_SLIM * containerWidth;
            numColumns = <span class="number">6</span>;

</pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( !Modernizr.mediaqueries || Modernizr.mq(<span class="string">'(min-width: 61.25em)'</span>) ) {
            gutter = Exports.GUTTER_WIDTH_SLIM_5 * containerWidth;
            numColumns = <span class="number">5</span>;

</pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>// Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 48em)'</span>) ) {
            numColumns = <span class="number">4</span>;
            gutter = Exports.GUTTER_WIDTH_SLIM * containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 35.5em)'</span>) ) {
            gutter = Exports.GUTTER_WIDTH_SLIM * containerWidth;
            numColumns = <span class="number">3</span>;


</pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>Phone ( 2 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>          } <span class="keyword">else</span> {
            gutter = Exports.GUTTER_WIDTH_320 * containerWidth; <span class="comment">// 2% of container width</span>
            numColumns = <span class="number">2</span>;
          }

          self.setColumns(numColumns);

          <span class="keyword">return</span> gutter;
        };


</pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>Use the default 12 column slim grid.</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        self.shuffleColumns = Exports.masonryColumns;
        self.shuffleGutters = Exports.masonryGutters;
      }

      <span class="keyword">return</span> self;
    },

    setColumns : <span class="keyword">function</span>( numColumns ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          allSpans = <span class="string">'span1 span2 span3 span4 span6 m-span3'</span>,
          shuffleDash = <span class="string">'shuffle-'</span>,
          grid = <span class="string">'slimgrid'</span>,
          grid5 = grid+<span class="number">5</span>,
          gridClasses = [ shuffleDash+<span class="number">2</span>, shuffleDash+<span class="number">3</span>, shuffleDash+<span class="number">4</span>, shuffleDash+<span class="number">5</span>, shuffleDash+<span class="number">6</span>, grid, grid5 ].join(<span class="string">' '</span>),
          itemSelector = <span class="string">'.gallery-item'</span>,
          span = <span class="string">'span'</span>,
          mspan = <span class="string">'m-'</span> + span,
          large = <span class="string">'.large'</span>,
          promo = <span class="string">'.promo'</span>,
          normal = <span class="string">'.normal'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>Large desktop ( 6 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( numColumns === <span class="number">6</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">6</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>add .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">6</span> + <span class="string">' '</span> + grid)
            .parent()
            .removeClass(grid5);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
              .filter(large) <span class="comment">// Select large tiles</span>
              .addClass(span+<span class="number">6</span>) <span class="comment">// Make them 6/12 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">4</span>) <span class="comment">// Make them 4/12 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(normal) <span class="comment">// Select tiles not large nor promo</span>
              .addClass(span+<span class="number">2</span>); <span class="comment">// Make them 2/12 width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>Landscape tablet + desktop ( 5 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">5</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">5</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>add .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">5</span> + <span class="string">' '</span> + grid5);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
            .filter(large) <span class="comment">// Select large tiles</span>
              .addClass(span+<span class="number">3</span>) <span class="comment">// Make them 3/5 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">2</span>) <span class="comment">// Make them 2/5 width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(normal) <span class="comment">// Select tiles not large nor promo</span>
              .addClass(span+<span class="number">1</span>); <span class="comment">// Make them 1/5 width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>Portrait Tablet ( 4 columns ) - masonry</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">4</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">4</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>Remove .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">4</span> + <span class="string">' '</span> + grid);


          self.$grid.children(itemSelector)
            .removeClass(allSpans) <span class="comment">// Remove current grid span</span>
            .filter(promo) <span class="comment">// Select promo tiles</span>
              .addClass(span+<span class="number">6</span>) <span class="comment">// Make them half width</span>
              .end() <span class="comment">// Go back to all items</span>
            .filter(large + <span class="string">','</span> + normal) <span class="comment">// Select tiles not promo</span>
              .addClass(span+<span class="number">3</span>); <span class="comment">// Make them quarter width</span>
        }

</pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>Between Portrait tablet and phone ( 3 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">3</span> ) {
        <span class="keyword">if</span> ( !self.$grid.hasClass(shuffleDash+<span class="number">3</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>Remove .slimgrid5, add .grid-small</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">3</span> + <span class="string">' '</span> + grid);

</pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>Remove current grid span</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid.children(itemSelector)
            .removeClass(allSpans)
            .addClass(span+<span class="number">4</span>);
        }


</pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>Phone ( 2 columns )</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> <span class="keyword">if</span> ( numColumns === <span class="number">2</span> ) {
        <span class="keyword">if</span> ( !self.$grid.parent().hasClass(shuffleDash+<span class="number">2</span>) ) {

</pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>remove .slimgrid5</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid
            .removeClass(gridClasses)
            .addClass(shuffleDash+<span class="number">2</span> + <span class="string">' '</span> + grid);

</pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>Remove current grid span</p>             </td>             <td class="code">               <div class="highlight"><pre>          self.$grid.children(itemSelector)
            .removeClass(allSpans)
            .addClass(mspan+<span class="number">3</span>);
        }
      }
      <span class="keyword">return</span> self;
    },

    setCompareDimensions : <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>
        .setCompareHeight()
        .setCompareWidth();
    },

    setCompareHeight : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          windowHeight = self.isIphone ? window.innerHeight : self.$window.height(); <span class="comment">// document.documentElement.clientHeight also wrong</span>

      console.log(<span class="string">'window height'</span>, windowHeight);

      self.$compareTool.find(<span class="string">'.compare-container'</span>).height( self.$compareItems.first().height() );
      self.$compareTool.height( windowHeight );

      <span class="keyword">return</span> self;
    },

    setCompareWidth : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          contentWidth = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>Count it</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareItems.not(<span class="string">'.hide'</span>).each(<span class="keyword">function</span>() {
        contentWidth += $(<span class="keyword">this</span>).outerWidth(<span class="literal">true</span>);
      });

</pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>Add the labels column (only if they should be visible)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( Modernizr.mq(<span class="string">'(min-width: 48em)'</span>) ) {
        contentWidth += self.$compareTool.find(<span class="string">'.detail-labels-wrap'</span>).outerWidth(<span class="literal">true</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>Set it</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool.find(<span class="string">'.compare-items-container'</span>).width( contentWidth );

      <span class="keyword">return</span> self;
    },

    setCompareRowHeights : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $detailGroup = self.$compareItems.not(<span class="string">'.hide'</span>).find(<span class="string">'.detail-group'</span>).first(),
          offset = <span class="number">0</span>;

      self.$compareTool.find(<span class="string">'.compare-sticky-header'</span>).evenHeights();

</pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>Set the height of the product name + model because the text can wrap and make it taller</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareProductNameWraps.evenHeights();

</pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>Set detail rows to even heights</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$compareTool.find(<span class="string">'.detail-label'</span>).each(<span class="keyword">function</span>(i) {
        <span class="keyword">var</span> $detailLabel = $(<span class="keyword">this</span>),
</pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>maxHeight = parseFloat( $detailLabel.css('height') ) + parseFloat( $detailLabel.css('paddingTop') ),</p>             </td>             <td class="code">               <div class="highlight"><pre>            $detail = self.$compareItems.find(<span class="string">'.detail:nth-child('</span> + (i + <span class="number">1</span>) + <span class="string">')'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>Find all detail lines that have this "name"</p>             </td>             <td class="code">               <div class="highlight"><pre>        $detail.add($detailLabel).evenHeights();
      });

</pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>Set the top offset for the labels</p>             </td>             <td class="code">               <div class="highlight"><pre>      offset = $detailGroup.position().top;
      offset += parseFloat( $detailGroup.css(<span class="string">'marginTop'</span>) );
      self.$compareTool.find(<span class="string">'.detail-label-group'</span>).css(<span class="string">'top'</span>, offset);

</pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>Refresh outer iScroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.outerScroller ) {
        self.outerScroller.refresh();
      }

      <span class="keyword">return</span> self;
    }

  };

</pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery = <span class="keyword">function</span>( options ) {
    <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
          gallery = self.data(<span class="string">'gallery'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>If we don't have a stored gallery, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !gallery ) {
        gallery = <span class="keyword">new</span> Gallery( self, options );
        self.data( <span class="string">'gallery'</span>, gallery );
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> options === <span class="string">'string'</span> ) {
        gallery[ options ].apply( gallery, args );
      }
    });
  };


</pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>Overrideable options</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery.options = {
    mode: <span class="string">'editorial'</span>,
    shuffleSpeed: <span class="number">250</span>,
    shuffleEasing: <span class="string">'ease-out'</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>Not overrideable</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.gallery.settings = {
    enabled: <span class="literal">true</span>,
    MIN_PRICE: <span class="literal">undefined</span>,
    MAX_PRICE: <span class="literal">undefined</span>,
    price: {},
    isInitialized: <span class="literal">false</span>,
    sorted: <span class="literal">false</span>,
    isTouch: !!( <span class="string">'ontouchstart'</span> <span class="keyword">in</span> window ),
    isiPhone: (<span class="regexp">/iphone|ipod/gi</span>).test(navigator.appVersion),
    loadingGif: <span class="string">'img/loader.gif'</span>,
    prop: Modernizr.csstransforms ? <span class="string">'transform'</span> : <span class="string">'top'</span>,
    valStart : Modernizr.csstransforms ? <span class="string">'translate(0,'</span> : <span class="string">''</span>,
    valEnd : Modernizr.csstransforms ? <span class="string">'px)'</span> : <span class="string">'px'</span>,
    translateZ : Modernizr.csstransforms3d ? <span class="string">' translateZ(0)'</span> : <span class="string">''</span>
  };


</pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>Event triggered when this tab is about to be shown</p>             </td>             <td class="code">               <div class="highlight"><pre>  window.Exports.onGalleryTabShow = <span class="keyword">function</span>( evt ) {
    <span class="keyword">var</span> $prevPane = evt.prevPane ? evt.prevPane :
          evt.originalEvent.prevPane ? evt.originalEvent.prevPane :
          <span class="literal">false</span>;


    <span class="keyword">if</span> ( $prevPane ) {
</pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>Loop through each gallery in the tab (there could be more than 1)
Disable the gallery (which disableds shuffle and pauses infinite scrolling) for galleries being hidden</p>             </td>             <td class="code">               <div class="highlight"><pre>      $prevPane.find(<span class="string">'.gallery'</span>).each(<span class="keyword">function</span>() {
        <span class="keyword">var</span> gallery = $(<span class="keyword">this</span>).data(<span class="string">'gallery'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>If there are active filters, remove them.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( gallery.hasActiveFilters ) {
          gallery.removeActiveFilters();
        }

        gallery.disable();
      });
    }

  };

</pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>Event triggered when tab pane is finished being shown</p>             </td>             <td class="code">               <div class="highlight"><pre>  window.Exports.onGalleryTabShown = <span class="keyword">function</span>( evt ) {

</pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>Only continue if this is a tab shown event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="keyword">if</span> ( !evt.pane ) {
      <span class="keyword">return</span>;
    }

</pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>Enable all galleries in this tab</p>             </td>             <td class="code">               <div class="highlight"><pre>    evt.pane.find(<span class="string">'.gallery'</span>).gallery(<span class="string">'enable'</span>);

  };

})(jQuery, Modernizr, window);



$(document).ready(<span class="keyword">function</span>() {

  <span class="keyword">if</span> ( $(<span class="string">'.gallery'</span>).length &gt; <span class="number">0</span> ) {

</pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>Initialize galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(<span class="string">'.gallery'</span>).each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);

      $<span class="keyword">this</span>.gallery( $<span class="keyword">this</span>.data() );
    });

</pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>Register for tab show(n) events here because not all tabs are galleries</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(<span class="string">'[data-tab]'</span>)
      .on(<span class="string">'show'</span>, window.Exports.onGalleryTabShow )
      .on(<span class="string">'shown'</span>, window.Exports.onGalleryTabShown );

</pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>Initialize sticky tabs</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(<span class="string">'.tab-strip'</span>).stickyTabs();

</pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>Hide other tabs</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(<span class="string">'.tab-pane:not(.active)'</span>).addClass(<span class="string">'off-screen'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>Should be called after everything is initialized</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(window).trigger(<span class="string">'hashchange'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>Disable hidden galleries.
Using a timeout here because the tab shown event is triggered at the end of the transition,
which depends on how long the page takes to load (and if the browser has transitions)</p>             </td>             <td class="code">               <div class="highlight"><pre>    setTimeout(<span class="keyword">function</span>() {
      $(<span class="string">'.tab-pane:not(.active) .gallery'</span>).gallery(<span class="string">'disable'</span>);
    }, <span class="number">500</span>);
  }
});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 