<!DOCTYPE html>  <html> <head>   <title>sony-fade.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="sony-carousel-fade.html">                 sony-carousel-fade.js               </a>                                           <a class="source" href="sony-carousel.html">                 sony-carousel.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-fade.html">                 sony-fade.js               </a>                                           <a class="source" href="sony-favorites.html">                 sony-favorites.js               </a>                                           <a class="source" href="sony-img-sequence.html">                 sony-img-sequence.js               </a>                                           <a class="source" href="sony-modal.html">                 sony-modal.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-scrolltotop.html">                 sony-scrolltotop.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickyheaders.html">                 sony-stickyheaders.js               </a>                                           <a class="source" href="sony-stickynav.html">                 sony-stickynav.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                                           <a class="source" href="sony-video.html">                 sony-video.js               </a>                                           <a class="source" href="sony-viewport.html">                 sony-viewport.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sony-fade.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Sony Fade</h2>

<ul>
<li><strong>Class:</strong> SonyFade</li>
<li><strong>Version:</strong> 0.1</li>
<li><strong>Modified:</strong> 07/02/2013</li>
<li><strong>Author:</strong> Glen Cheney</li>
<li><strong>Dependencies:</strong> jQuery 1.7+</li>
</ul>

<p>This plugin is used to create flexible fades. Given that <em>#foo</em> is an element containing a
number of slides, hidden by <em>#foo-fade-wrapper</em>'s <code>overflow: hidden;</code> property, #foo will
become draggable with each slide being a snap-point for progression between the slides.
Additionally, your CSS should be such that the fade can have slides added to it
on either end without breaking; this allows for "infinite" fades.</p>

<p>Refer to this Jade structure:</p>

<p><em>Example Usage:</em></p>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require) {

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
      Modernizr = require(<span class="string">'modernizr'</span>),
      iQ = require(<span class="string">'iQ'</span>),
      Settings = require(<span class="string">'require/sony-global-settings'</span>),
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Utilities = require('require/sony-global-utilities'),</p>             </td>             <td class="code">               <div class="highlight"><pre>      Environment = require(<span class="string">'require/sony-global-environment'</span>),
      hammer = require(<span class="string">'plugins/index'</span>).hammer,
      sonyPaddles = require(<span class="string">'secondary/sony-paddles'</span>),
      sonyNavigationDots = require(<span class="string">'secondary/sony-navigationdots'</span>);

  <span class="keyword">var</span> _id = <span class="number">0</span>;

  <span class="keyword">var</span> Fade = <span class="keyword">function</span>( $element, options ) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $.extend( self, Fade.options, options, Fade.settings );

    self.currentSlide = <span class="number">0</span>;
    self.id = _id++;
    self.$el = $element;

    self.init();
  };

  Fade.prototype = {

    init: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.setVars();
      self.resetSlides( <span class="literal">true</span> );

      <span class="keyword">if</span> ( self.totalSlides &lt;= <span class="number">1</span> ) {
        self.destroy();
        <span class="keyword">return</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Opacity has to be set to zero in old ie with filter</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !self.hasTransitions ) {
        self.$slides.css(<span class="string">'opacity'</span>, <span class="number">0</span>);
      }

      self.setupGestures();

      Environment.on(<span class="string">'global:resizeDebounced-200ms.SonyFade-'</span> + self.id, <span class="keyword">function</span>() {
        <span class="keyword">var</span> slide = Math.min.apply( Math, [self.currentSlide, self.totalSlides - <span class="number">1</span>] );
        self.gotoSlide( slide );
      });

      self.gotoSlide( <span class="number">0</span>, <span class="literal">true</span> );

      self.$el.addClass(<span class="string">'sony-fade-active'</span>);
    },

    setVars : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$wrapper = self.$el.parent();
      self.updateSlides();
      self.crossfadeTimeout = self.animationSpeed - (self.animationSpeed * self.crossfade);
    },

    updateSlides : <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.$slides = self.getSlides();
      self.totalSlides = self.$slides.length;
      <span class="keyword">return</span> self;
    },

    getSlides : <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.slides ? <span class="keyword">this</span>.$el.find( <span class="keyword">this</span>.slides ) : <span class="keyword">this</span>.$el.children();
    },

    getSlideIndex : <span class="keyword">function</span>( index ) {
      <span class="keyword">return</span> index &lt; <span class="number">0</span> ?
        <span class="keyword">this</span>.totalSlides - <span class="number">1</span> :
        index &gt;= <span class="keyword">this</span>.totalSlides ?
          <span class="number">0</span> :
          index;
    },

    setupGestures: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$el.hammer();
      self.$el.on(<span class="string">'swipeleft.sonyfade'</span>, $.proxy( self.prev, self ));
      self.$el.on(<span class="string">'swiperight.sonyfade'</span>, $.proxy( self.next, self ));
    },

    next: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.gotoSlide( <span class="keyword">this</span>.getSlideIndex( <span class="keyword">this</span>.currentSlide + <span class="number">1</span> ) );
    },

    prev: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.gotoSlide( <span class="keyword">this</span>.getSlideIndex( <span class="keyword">this</span>.currentSlide - <span class="number">1</span> ) );
    },

    gotoSlide: <span class="keyword">function</span>( which, noAnim ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          speed = ( noAnim ? <span class="number">0</span> : self.animationSpeed ),
          $prevSlide,
          $nextSlide;

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Next slide faded in</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">complete</span><span class="params">()</span> {</span>
        iQ.update();
        self.$el.trigger(<span class="string">'SonyFade:AnimationComplete'</span>);

        <span class="keyword">if</span> ( $prevSlide ) {
          $prevSlide.removeClass(<span class="string">'behind'</span>);

          <span class="keyword">if</span> ( !self.hasTransitions ) {
            $prevSlide.animate( { opacity: <span class="number">0</span> }, speed );
          }
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Called after the crossfade timeout length</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="function"><span class="keyword">function</span> <span class="title">fadeOutPrevious</span><span class="params">()</span> {</span>
        <span class="keyword">if</span> ( $prevSlide ) {
          $prevSlide.removeClass(<span class="string">'on'</span>);

          <span class="keyword">if</span> ( !self.hasTransitions ) {
            $prevSlide.animate( { opacity: <span class="number">0</span> }, speed );
          }
        }
      }


</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Get current slide</p>             </td>             <td class="code">               <div class="highlight"><pre>      $nextSlide = self.$slides.eq( which );

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Get a previous slide if there is one</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( which !== self.currentSlide ) {
        $prevSlide = self.$slides.eq( self.currentSlide );
        $prevSlide.addClass(<span class="string">'behind'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Show this slide</p>             </td>             <td class="code">               <div class="highlight"><pre>      $nextSlide.addClass(<span class="string">'on'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Use transitions if available</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasTransitions ) {
        $nextSlide.one( Settings.transEndEventName, complete );

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Fallback to jQuery animate</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        $nextSlide.animate( { opacity: <span class="number">1</span> }, speed, complete );
      }

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Delay the previous slide fading out by a little so
the background isn't visible for a split second</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout( fadeOutPrevious, self.crossfadeTimeout );

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Update current slide index</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.currentSlide = which;

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Trigger event</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$el.trigger(<span class="string">'SonyFade:gotoSlide'</span>, self.currentSlide);
    },

    createPagination: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( self.totalSlides &lt;= <span class="number">1</span> ) {
        <span class="keyword">return</span>;
      }

      <span class="keyword">if</span> ( self.$dotnav ) {
        self.$dotnav.sonyNavDots(<span class="string">'reset'</span>, {
          buttonCount: self.totalSlides
        });
        <span class="keyword">return</span>;
      }

      <span class="keyword">var</span> $dotnavWrapper = $(<span class="string">'&lt;div class="sony-dot-nav" /&gt;'</span>);

      <span class="keyword">if</span> ( self.$dotNavWrapper ) {
        $dotnavWrapper.appendTo(self.$dotNavWrapper);
      } <span class="keyword">else</span> {
        $dotnavWrapper.insertAfter(self.$wrapper);
      }

      self.$dotnav = $dotnavWrapper.sonyNavDots({
        buttonCount: self.totalSlides,
        theme: self.paginationTheme
      });

      self.$dotnav.on(<span class="string">'SonyNavDots:clicked'</span>, <span class="keyword">function</span>(e, which) {
        self.gotoSlide(which);
      });

      self.$el.on(<span class="string">'SonyFade:gotoSlide'</span>, <span class="keyword">function</span>(e, which) {
        self.$dotnav.sonyNavDots(<span class="string">'reset'</span>, {
          activeButton: which
        });
      });
    },

    createPaddles: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $wrapper = self.$paddleWrapper || self.$wrapper;

      <span class="keyword">if</span> ( Modernizr.touch || self.paddlesInit ) {
        <span class="keyword">return</span>;
      }

      self.paddlesInit = <span class="literal">true</span>;

      $wrapper.sonyPaddles({
        useSmallPaddles: self.useSmallPaddles,
        paddlePosition: self.paddlePosition
      });

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Show paddles by default</p>             </td>             <td class="code">               <div class="highlight"><pre>      $wrapper.sonyPaddles(<span class="string">'showPaddle'</span>, <span class="string">'both'</span>);

      $wrapper.on(<span class="string">'sonyPaddles:clickLeft'</span>, <span class="keyword">function</span>(e) {
        e.stopPropagation();
        self.prev();
      });

      $wrapper.on(<span class="string">'sonyPaddles:clickRight'</span>, <span class="keyword">function</span>(e) {
        e.stopPropagation();
        self.next();
      });
    },

    initSlides: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$slides.css({
        transitionDuration: self.animationSpeed
      });
    },

    resetSlides: <span class="keyword">function</span>( isInit ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span> ( !isInit ) {
</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Remove the event because we're going to subscribe to it again</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$slides.off(<span class="string">'click.sonyfade'</span>);
        self.updateSlides();
      }

      <span class="keyword">if</span> ( self.paddles ) {
        self.createPaddles();
      }

      <span class="keyword">if</span> ( self.pagination ) {
        self.createPagination();
      }

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>I don't know what this does...</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$el.find(<span class="string">'a'</span>).on(<span class="string">'focus'</span>, <span class="keyword">function</span>() {
        self.gotoSlide(self.$slides.index($(<span class="keyword">this</span>).closest(self.$slides)));
      });
    },

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Reset the style attribute for the properties we might have manipulated.
Destroy the plugins we've initialized as part of the fade.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    destroy: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $paddleWrapper = self.$paddleWrapper || self.$wrapper,
          slideStyles;

      slideStyles.opacity = <span class="string">''</span>;
      slideStyles.transitionDuration = <span class="string">''</span>;

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Reset styles.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$slides.css( slideStyles );

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Unbind</p>             </td>             <td class="code">               <div class="highlight"><pre>      Environment.off(<span class="string">'global:resizeDebounced-200ms.SonyFade-'</span> + self.id);
      self.$el.off(<span class="string">'.sonyfade SonyFade:gotoSlide'</span>);
      self.$slides.off(<span class="string">'click.sonyfade'</span>);

      <span class="keyword">if</span> ( self.paddles ) {
        $paddleWrapper.sonyPaddles(<span class="string">'destroy'</span>);
        $paddleWrapper.off(<span class="string">'sonyPaddles:clickLeft'</span>);
        $paddleWrapper.off(<span class="string">'sonyPaddles:clickRight'</span>);
      }

      <span class="keyword">if</span> ( self.$dotnav ) {
        self.$dotnav.sonyNavDots(<span class="string">'destroy'</span>);
        self.$dotnav.remove();
        self.$dotnav = <span class="literal">null</span>;
      }

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Remove data from element, allowing for later reinit.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$el.removeData(<span class="string">'sonyFade'</span>);
      self.$el.removeClass(<span class="string">'sony-fade-active'</span>);
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Defaults</h2>             </td>             <td class="code">               <div class="highlight"><pre>
  Fade.options = {

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Selector for the individual slides within the fade. If undefined, it will be all the children</p>             </td>             <td class="code">               <div class="highlight"><pre>    slides: <span class="literal">undefined</span>,

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Speed of slide animation, in ms.</p>             </td>             <td class="code">               <div class="highlight"><pre>    animationSpeed: <span class="number">500</span>,

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Percentage to crossfade the two slides</p>             </td>             <td class="code">               <div class="highlight"><pre>    crossfade: <span class="number">0.875</span>,

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Create paddles.</p>             </td>             <td class="code">               <div class="highlight"><pre>    paddles: <span class="literal">true</span>,

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Set to <code>outset</code> to allow grid-based positioning of paddles above 1400px screen width.</p>             </td>             <td class="code">               <div class="highlight"><pre>    paddlePosition: <span class="string">'inset'</span>,

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Will use <code>.nav-paddle</code> instead of <code>.pagination-paddle</code> for the paddle class</p>             </td>             <td class="code">               <div class="highlight"><pre>    useSmallPaddles: <span class="literal">false</span>,

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If element is specified, insert pagination into that element instead of using the default position.</p>             </td>             <td class="code">               <div class="highlight"><pre>    $dotNavWrapper: <span class="literal">undefined</span>,

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>If element is specified, insert paddles into that element instead of using the default position.</p>             </td>             <td class="code">               <div class="highlight"><pre>    $paddleWrapper: <span class="literal">undefined</span>,

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Create dot pagination, which is inserted after self.$el.</p>             </td>             <td class="code">               <div class="highlight"><pre>    pagination: <span class="literal">true</span>,

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Use <code>light</code> or <code>dark</code> bullets for pagination.</p>             </td>             <td class="code">               <div class="highlight"><pre>    paginationTheme: <span class="string">'dark'</span>
  };

  Fade.settings = {
    hasTransitions: Modernizr.csstransitions
  };

  <span class="keyword">return</span> Fade;
});
</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 