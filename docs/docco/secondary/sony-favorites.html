<!DOCTYPE html>  <html> <head>   <title>sony-favorites.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="sony-carousel-fade.html">                 sony-carousel-fade.js               </a>                                           <a class="source" href="sony-carousel.html">                 sony-carousel.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-favorites.html">                 sony-favorites.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-scrolltotop.html">                 sony-scrolltotop.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickyheaders.html">                 sony-stickyheaders.js               </a>                                           <a class="source" href="sony-stickynav.html">                 sony-stickynav.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                                           <a class="source" href="sony-video.html">                 sony-video.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sony-favorites.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Favorites Helper</h2>

<ul>
<li><strong>Class:</strong> Favorites</li>
<li><strong>Version:</strong> 1.0</li>
<li><strong>Modified:</strong> 05/01/2013</li>
<li><strong>Author:</strong> Glen Cheney</li>
<li><strong>Dependencies:</strong> jQuery 1.7+, SONY Settings, bootstrap tooltip</li>
</ul>

<p><em>Notes:</em></p>

<p><em>Example Usage:</em></p>

<pre><code> new Favorites( $container )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require) {

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
      bootstrap = require(<span class="string">'bootstrap'</span>),
      Settings = require(<span class="string">'require/sony-global-settings'</span>);

  <span class="keyword">var</span> Favorites = <span class="keyword">function</span>( $parent, options ) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    options = options || {};

    $.extend( self, Favorites.options, options, Favorites.settings );

    self.$parent = $parent;
    self.$favorites = self.$parent.find(<span class="string">'.js-favorite'</span>);
    self.initTooltips();
  };

  Favorites.prototype = {

    constructor: Favorites,

    initTooltips : <span class="keyword">function</span>( $favorites ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $favorites = $favorites || self.$favorites;

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Favorite the gallery item immediately on touch devices</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.hasTouch ) {

        $favorites
          .on(<span class="string">'touchend'</span>, $.proxy( self.onFavorite, self ))
          .on(<span class="string">'click'</span>, <span class="literal">false</span>);

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Show a tooltip on hover before favoriting on desktop devices</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {
        $favorites.on(<span class="string">'click'</span>, $.proxy( self.onFavorite, self ));

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Optionally give a tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( self.tooltip ) {
          $favorites.tooltip({
            placement: <span class="string">'offsettop'</span>,
            title: <span class="keyword">function</span>() {
              <span class="keyword">var</span> $jsFavorite = $(<span class="keyword">this</span>);
              <span class="keyword">return</span> self.getFavoriteContent( $jsFavorite, $jsFavorite.hasClass(<span class="string">'active'</span>) );
            },
            template: <span class="string">'&lt;div class="tooltip gallery-tooltip"&gt;&lt;div class="tooltip-arrow"&gt;&lt;/div&gt;&lt;div class="tooltip-inner"&gt;&lt;/div&gt;&lt;/div&gt;'</span>
          });
        }
      }

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Update our favorites</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$favorites = self.$parent.find(<span class="string">'.js-favorite'</span>);

      <span class="keyword">return</span> self;
    },

    onFavorite : <span class="keyword">function</span>( e ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $jsFavorite = $(e.delegateTarget),
          isAdding = !$jsFavorite.hasClass(<span class="string">'active'</span>),
          content = self.hasTouch || !self.tooltip ? <span class="string">''</span> : self.getFavoriteContent( $jsFavorite, isAdding, <span class="literal">true</span> );

      $jsFavorite.toggleClass(<span class="string">'active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Show the tooltip if it isn't a touch device</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( self.tooltip &amp;&amp; !self.hasTouch ) {
        $(<span class="string">'.gallery-tooltip .tooltip-inner'</span>)
          .html( content )
          .tooltip(<span class="string">'show'</span>);
      }

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Stop event from bubbling to <a> tag</p>             </td>             <td class="code">               <div class="highlight"><pre>      e.preventDefault();
      e.stopPropagation();

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Pass off the gallery item and a boolean indicating that favorited state</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.handleFavorite( $jsFavorite.closest( self.itemSelector ), isAdding );
    },

    getFavoriteContent : <span class="keyword">function</span>( $jsFavorite, isActive, isClicked ) {
      <span class="keyword">var</span> titles = $jsFavorite.data(),
          title;

      <span class="keyword">if</span> ( isActive ) {
        title = isClicked ? titles.defaultClickedTitle : titles.favoritedTitle;
      } <span class="keyword">else</span> {
        title = isClicked ? titles.favoritedClickedTitle : titles.defaultTitle;
      }

      <span class="keyword">return</span> title;
    },

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>possibly https://github.com/ScottHamper/Cookies ?</p>             </td>             <td class="code">               <div class="highlight"><pre>    handleFavorite : <span class="keyword">function</span>( $item, isAdded ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          favs = [];

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Save data</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( isAdded ) {

        self.favoriteAdded( $item, Settings.isLoggedIn );

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Fire event saying this has been added</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$parent.trigger( <span class="string">'favoriteadded'</span>, [ $item, self ] );

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Remove data</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {

        self.favoriteRemoved( $item, Settings.isLoggedIn );

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Fire event saying this has been removed</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$parent.trigger( <span class="string">'favoriteremoved'</span>, [ $item, self ] );
      }

      <span class="keyword">return</span> self;
    },

    favoriteAdded : <span class="keyword">function</span>( $item, isLoggedIn ) {
      <span class="keyword">var</span> favs = [];

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Save to account with ajax?</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( isLoggedIn ) {
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>TODO</p>             </td>             <td class="code">               <div class="highlight"><pre>        $.getJSON( <span class="string">'path/to/server'</span>, { add: <span class="literal">true</span> } );

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Store in cookie</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Check to make sure the browser can parse JSON ( IE7 )</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( window.JSON ) {
</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Browser support JSON parsing</p>             </td>             <td class="code">               <div class="highlight"><pre>        }

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>TODO
Get the cookies (string) and convert it to an array
favs = JSON.parse( Cookies.get( 'favorites' ) );
Add this one to it
favs.push( $item.attr('data-id') );
Make it a string again
favs = JSON.stringify( favs );
Save it
Cookies.set( 'favorites', favs );</p>             </td>             <td class="code">               <div class="highlight"><pre>      }

    },

    favoriteRemoved : <span class="keyword">function</span>( $item, isLoggedIn ) {
      <span class="keyword">var</span> favs = [];

      <span class="keyword">if</span> ( isLoggedIn ) {
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>TODO</p>             </td>             <td class="code">               <div class="highlight"><pre>        $.getJSON( <span class="string">'path/to/server'</span>, { add: <span class="literal">false</span> } );

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Remove from stored cookie</p>             </td>             <td class="code">               <div class="highlight"><pre>      } <span class="keyword">else</span> {

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Check to make sure the browser can parse JSON ( IE7 )</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( window.JSON ) {
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Browser support JSON parsing</p>             </td>             <td class="code">               <div class="highlight"><pre>        }

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>TODO
Remove the id from the cookie</p>             </td>             <td class="code">               <div class="highlight"><pre>      }
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Options that could be customized per module instance</p>             </td>             <td class="code">               <div class="highlight"><pre>  Favorites.options = {
    itemSelector: <span class="string">'.gallery-item'</span>,
    tooltip: <span class="literal">true</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>These are not overridable when instantiating the module</p>             </td>             <td class="code">               <div class="highlight"><pre>  Favorites.settings = {
    hasTouch: Settings.hasTouchEvents
  };

  <span class="keyword">return</span> Favorites;
});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 