<!DOCTYPE html>  <html> <head>   <title>form-actions.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="sony-carousel-fade.html">                 sony-carousel-fade.js               </a>                                           <a class="source" href="sony-carousel.html">                 sony-carousel.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-favorites.html">                 sony-favorites.js               </a>                                           <a class="source" href="sony-img-sequence.html">                 sony-img-sequence.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-scrolltotop.html">                 sony-scrolltotop.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickyheaders.html">                 sony-stickyheaders.js               </a>                                           <a class="source" href="sony-stickynav.html">                 sony-stickynav.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                                           <a class="source" href="sony-video.html">                 sony-video.js               </a>                                           <a class="source" href="sony-viewport.html">                 sony-viewport.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               form-actions.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>------------ FormActions ------------
Module: FormActions
Version: 0.1
Modified: 01/05/2013 by Christopher J Mischler
Modified: 06/05/2013 by Glen Cheney
Dependencies: jQuery 1.7+, Modernizr</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require) {

  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Modernizr = require('modernizr'),</p>             </td>             <td class="code">               <div class="highlight"><pre>      Settings = require(<span class="string">'require/sony-global-settings'</span>),
      Environment = require(<span class="string">'require/sony-global-environment'</span>);

  <span class="keyword">var</span> module = {
    init: <span class="keyword">function</span>() {
      <span class="keyword">var</span> $formActionsInit = $(<span class="string">'body'</span>).formActions(),

      $formActions = $formActionsInit.data(<span class="string">'formActions'</span>);
      $formActions.initInput( $(<span class="string">'#nav-search-input'</span>) );
      $formActions.initInput( $(<span class="string">'#store-locator-search-input'</span>) );
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>$formActions.initTouchToggles($('.touch-toggle, .dropdown-toggle, .dropdown-hover-toggle'));</p>             </td>             <td class="code">               <div class="highlight"><pre>      $formActions.initTouchToggles( $(<span class="string">'.dropdown-hover-toggle'</span>) );
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Start module</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> FormActions = <span class="keyword">function</span>() {
  };

  FormActions.prototype = {
    constructor: FormActions,

    initInput : <span class="keyword">function</span>( $input ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">var</span> inputObj = self.makeInputObj( $input );
      inputObj.watermarkText = $input.val();

      $input.data(<span class="string">'formActions'</span>, self);

      self.listenForEvents( inputObj );
    },

    listenForEvents : <span class="keyword">function</span>( inputObj ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      inputObj.$input
        .on( <span class="string">'focus'</span>, inputObj, $.proxy( self.onInputFocus, self ) )
        .on( <span class="string">'blur'</span>, inputObj, $.proxy( self.onInputBlur, self ) )
        .on( <span class="string">'mouseup keyup change cut paste'</span>, module.onSearchInputChange );

      inputObj.$inputIcon
        .on( <span class="string">'click'</span>,<span class="keyword">function</span>() {
          inputObj.$input.focus();
        });

      inputObj.$inputClearBtn
        .on( <span class="string">'click'</span>, inputObj, $.proxy( self.onClearButton, self ) );
    },

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>clear watermarkText on focus</p>             </td>             <td class="code">               <div class="highlight"><pre>    onInputFocus : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $input = $( evt.delegateTarget ),
          inputObj = evt.data;

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If the input is focused and its value is
the initial watermark text, hide the watermark</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( $input.val() === inputObj.watermarkText ) {
        self.hideWatermark( inputObj );
      }
    },

    onInputBlur : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $input = $( evt.delegateTarget ),
          inputObj = evt.data;

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>If the input loses focus and is empty, show the watermark</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( $input.val() === <span class="string">''</span> ) {
        self.showWatermark( inputObj );
      }
    },

    onClearButton : <span class="keyword">function</span>( evt ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          inputObj = evt.data;

      evt.preventDefault();

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Shows the watermark and removes <code>searching</code> class</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.clearSearchResults( inputObj );

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>If not a touch device and not at the mobile breakpoint, focus on the input again</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !Settings.hasTouchEvents &amp;&amp; !$(<span class="string">'html'</span>).hasClass(<span class="string">'bp-nav-mobile'</span>) ) {
        inputObj.$input.focus();
      }
    },

    showWatermark : <span class="keyword">function</span>( inputObj ) {
      inputObj.$input.val( inputObj.watermarkText );
      inputObj.$inputIcon.show();
      inputObj.$input.parent().removeClass(<span class="string">'child-input-active'</span>);
    },

    hideWatermark : <span class="keyword">function</span>( inputObj ) {
      inputObj.$input.val(<span class="string">''</span>);
      inputObj.$input.parent().addClass(<span class="string">'child-input-active'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>don't hide search icon on mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> (!($(<span class="string">'html'</span>).hasClass(<span class="string">'bp-nav-mobile'</span>) &amp;&amp; inputObj.$inputGroup.hasClass(<span class="string">'navmenu-search-section-input'</span>))) {
        inputObj.$inputIcon.hide();
      }
    },

    makeInputObj: <span class="keyword">function</span>($input) {
      <span class="keyword">var</span> iObj = {};
      iObj.$input = $input;
      iObj.$inputGroup = $input.closest(<span class="string">'.input-group'</span>);
      iObj.$inputWrapper = $input.closest(<span class="string">'.input-outer-wrapper'</span>);
      iObj.$inputIcon = iObj.$inputGroup.find(<span class="string">'.input-icon'</span>);
      iObj.$inputBtn = iObj.$inputGroup.find(<span class="string">'.input-btn'</span>);
      iObj.$inputClearBtn = iObj.$inputGroup.find(<span class="string">'.input-clear-btn'</span>);
      <span class="keyword">return</span> iObj;
    },

    doSearch: <span class="keyword">function</span>( inputObj ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">var</span> queryStr = inputObj.$input.val();

      <span class="keyword">switch</span> ( inputObj.$input.attr(<span class="string">'id'</span>) ) {

        <span class="keyword">case</span> <span class="string">'store-locator-search-input'</span>:
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>need to call this after the search results have been returned &amp; are displayed (because that'll change the height of the iscroll).
if (!$('html').hasClass('bp-nav-mobile')) {
  Environment.trigger('SONY:Navigation:initMobileNavIScroll');
}</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">break</span>;

        <span class="keyword">case</span> <span class="string">'nav-search-input'</span>:
          <span class="keyword">break</span>;

        <span class="keyword">default</span>:
        <span class="keyword">break</span>;

      }
    },

    clearSearchResults: <span class="keyword">function</span>( inputObj ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Devices with touch events fire the blur event before the clear
button receives the click event. The keyboard will disappear,
so the input can't be focused. Instead, the input should have the watermark shown.</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.showWatermark( inputObj );
      inputObj.$inputWrapper.removeClass(<span class="string">'searching'</span>);
    },

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>this just resets the actual results without clearing the input, for instance when the search term had been deleted &amp; is blank.</p>             </td>             <td class="code">               <div class="highlight"><pre>    resetSearchResults: <span class="keyword">function</span>( inputObj ) {
      inputObj.$inputWrapper.removeClass(<span class="string">'searching'</span>);
    },

    initTouchToggles: <span class="keyword">function</span>( $touchToggles ) {
      $touchToggles.each(<span class="keyword">function</span>() {
        $(<span class="keyword">this</span>).on(<span class="string">'click'</span>,<span class="keyword">function</span>(e) {
          e.preventDefault();
          e.stopPropagation();
          $(<span class="keyword">this</span>).parent().toggleClass(<span class="string">'active'</span>);
        });
      });
    }
  };




</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>  $.fn.formActions = <span class="keyword">function</span>( options ) {
    <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
      <span class="keyword">var</span> self = $(<span class="keyword">this</span>),
        formActions = self.data(<span class="string">'formActions'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>If we don't have a stored formActions, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> ( !formActions ) {
          formActions = <span class="keyword">new</span> FormActions( self, options );
          self.data( <span class="string">'formActions'</span>, formActions );
      }

      <span class="keyword">if</span> ( <span class="keyword">typeof</span> options === <span class="string">'string'</span> ) {
        formActions[ options ].apply( formActions, args );
      }
    });
  };

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Event triggered when this tab is about to be shown</p>             </td>             <td class="code">               <div class="highlight"><pre>  module.onSearchInputChange = <span class="keyword">function</span>( evt ) {
    <span class="keyword">if</span> ($(<span class="string">'html'</span>).hasClass(<span class="string">'bp-nav-mobile'</span>)) {
      Environment.trigger(<span class="string">'SONY:Navigation:initMobileNavIScroll'</span>);
    }
    <span class="keyword">var</span> $input = $(evt.target),
      formActions = $input.data(<span class="string">'formActions'</span>),
      inputObj = formActions.makeInputObj($input);


    <span class="keyword">if</span> (!inputObj.$inputWrapper.hasClass(<span class="string">'searching'</span>)) {
      <span class="keyword">if</span> (!($input.val() === <span class="string">''</span> || $input.val() === inputObj.watermarkText)) {
        inputObj.$inputWrapper.addClass(<span class="string">'searching'</span>);
        formActions.doSearch( inputObj );
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> ($input.val() === <span class="string">''</span>) {
      formActions.resetSearchResults( inputObj );
    } <span class="keyword">else</span> {
      formActions.doSearch( inputObj );
    }

  };

  module.init();

  <span class="keyword">return</span> module;
});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 