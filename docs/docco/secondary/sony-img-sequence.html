<!DOCTYPE html>  <html> <head>   <title>sony-img-sequence.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="sony-audio.html">                 sony-audio.js               </a>                                           <a class="source" href="sony-carousel-fade.html">                 sony-carousel-fade.js               </a>                                           <a class="source" href="sony-carousel.html">                 sony-carousel.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-fade.html">                 sony-fade.js               </a>                                           <a class="source" href="sony-favorites.html">                 sony-favorites.js               </a>                                           <a class="source" href="sony-img-sequence.html">                 sony-img-sequence.js               </a>                                           <a class="source" href="sony-modal.html">                 sony-modal.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-scrolltotop.html">                 sony-scrolltotop.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickyheaders.html">                 sony-stickyheaders.js               </a>                                           <a class="source" href="sony-stickynav.html">                 sony-stickynav.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                                           <a class="source" href="sony-timer.html">                 sony-timer.js               </a>                                           <a class="source" href="sony-video.html">                 sony-video.js               </a>                                           <a class="source" href="sony-viewport.html">                 sony-viewport.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sony-img-sequence.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*jshint debug:false */</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------ Sony Image Sequencer ------------
* <strong>Module:</strong> Cloned from the E360 jQuery plugin
* <strong>Version:</strong> 0.0.1
* <strong>Modified:</strong> 04/19/2013
* <strong>Author:</strong> Kaleb White, Brian Kenny
* <strong>Dependencies:</strong> jQuery 1.7+, Boostrap, Modernizr, Enquire, hammerJS, viewport</p>

<p><em>Example Usage:</em></p>

<pre><code> require('path/to/global/module') // self instantiation
</code></pre>

<p><em>Refacting/improvement/performance Notes:</em></p>

<ul>
<li>pluck() would be faster if the image IDs were cached in an object instead of iterated through each time</li>
<li>loadSequence() needs to be slightly refactored so as not to cause so many style recalcs.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>
define(<span class="keyword">function</span>(require){

  <span class="string">'use strict'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>provisions</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> $ = require( <span class="string">'jquery'</span> ),
      iQ = require( <span class="string">'iQ'</span> ),
      Settings     = require( <span class="string">'require/sony-global-settings'</span> ),
      hammer       = require( <span class="string">'plugins/index'</span> ).hammer;


  <span class="keyword">var</span> SonySequence = <span class="keyword">function</span>( element, options ) {

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $.extend( self, SonySequence.options, options, SonySequence.settings );
    self.options = options || {};

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>defaults</p>             </td>             <td class="code">               <div class="highlight"><pre>    self.$container     = $( element );
    self.$sequence      = self.$container.find(<span class="string">'[data-sequence-id]'</span>);
    self.sequenceLength = self.$sequence.length;
    self.curLoaded      = <span class="number">0</span>;
    self.$controls      = self.$container.find( <span class="string">'.controls'</span> );
    self.$controlCenter = self.$controls.find( <span class="string">'.instructions'</span> );
    self.$leftArrow     = self.$controls.find( <span class="string">'.left-arrow'</span> );
    self.$rightArrow    = self.$controls.find( <span class="string">'.right-arrow'</span> );
    self.isImage        = $( self.$sequence[<span class="number">0</span>] ).is( <span class="string">'img'</span> ) ? <span class="literal">true</span> : <span class="literal">false</span>;
    self.dynamicBuffer  = Math.floor( ( self.$container.width() / self.$sequence.length ) / <span class="number">3</span> );
    self.curIndex       = <span class="number">0</span>;
    self.movingLeft     = <span class="literal">false</span>;
    self.movingRight    = <span class="literal">false</span>;
    self.clicked        = <span class="literal">false</span>;
    self.lastX          = <span class="literal">null</span>;
    self.lastTriggerX   = <span class="literal">null</span>;
    self.inMotion       = <span class="literal">false</span>;
    self.throttle       = <span class="number">3</span>;
    self.inViewport     = <span class="literal">false</span>;
    self.moves          = <span class="number">0</span>;
    self.touchEvents    = <span class="number">0</span>;
    self.$win           = Settings.$window;
    self.$body          = Settings.$body;

    self.init();
  };

  SonySequence.prototype = {
    constructor: SonySequence,

    init : <span class="keyword">function</span>( param ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>lets start by hiding the controllers until things are loaded and fading down the image
to give users a nicer set of visual queues</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$controls.addClass( <span class="string">'hidden'</span> );
      self.$container.addClass( <span class="string">'dim-the-lights'</span> );
      self.viewport = require( <span class="string">'secondary/index'</span> ).sonyViewport;

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>console.log('initializing SonySequence', self.$container);</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if not, manage the payload by exposing a loader
since IE and iQ are not getting along we need to delay this a bit
heres the idea, we show the loading screen and then one by one with a
setTimeout and a $win.resize() we can fire iQ. ?? seems legit?</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.loadSequence();

      log(<span class="string">'SONY : Editorial SonySequence Module : Initialized'</span>);
    },

    lockAndLoaded: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.syncControlLayout();
      self.curLoaded++;
      self.checkLoaded();
    },

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>checks the payload against the loaded image</p>             </td>             <td class="code">               <div class="highlight"><pre>    checkLoaded: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span>( self.sequenceLength == self.curLoaded ) {
        log( <span class="string">'all 360 assets loaded'</span> );
        self.$container.removeClass( <span class="string">'dim-the-lights'</span> ).addClass( <span class="string">'light-em-up'</span> );
        self.$container.find( <span class="string">'.load-indicator'</span> ).addClass( <span class="string">'hidden'</span> );
        self.syncControlLayout();

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>if we have setup to autoplay</p>             </td>             <td class="code">               <div class="highlight"><pre>        (self.options.autoplay) ? self.startAnimation(<span class="string">'left'</span>) : self.initBehaviors();
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>if the user wants bar controls we need to populate the dom</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> (self.options.barcontrols &amp;&amp; !self.options.loop &amp;&amp; !self.options.autoplay) {
          self.createBarControl(<span class="keyword">function</span>(){
            $.proxy(self.initSliderBindings(), self);
          });
        }

      }
    },

    syncControlLayout: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">var</span> _assetWidth = $( self.$sequence[self.curIndex] ).width();
      self.$controls.find( <span class="string">'.table-center'</span> ).css( <span class="string">'width'</span>, _assetWidth );
    },


    getSliderRange: <span class="keyword">function</span>(){
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          range = {};

      range.min = <span class="number">0</span>;
      range.max = <span class="number">1</span>;

      <span class="keyword">return</span> range;
    },

    sliderNearestValidValue: <span class="keyword">function</span>(rawValue) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          closest,
          maxSteps,
          range,
          steps;

      range = self.getSliderRange();
      rawValue = Math.min(range.max, rawValue);
      rawValue = Math.max(range.min, rawValue);

      <span class="keyword">if</span> (self.options.steps) {
        <span class="keyword">return</span>;
      } <span class="keyword">else</span> {
        <span class="keyword">return</span> rawValue;
      }
    },

    sliderGotoFrame: <span class="keyword">function</span>(positon) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          minWidth = <span class="number">0</span>,
          maxWidth = self.sliderControlWidth,
          sequenceLength = self.sequenceLength,
          sequenceDepth = <span class="number">0</span>,
          lastIndex = self.currIndex;

      sequenceDepth = ( positon / maxWidth );
      self.currIndex = (Math.floor(sequenceLength * sequenceDepth) !== sequenceLength) ? Math.floor(sequenceLength * sequenceDepth) : <span class="number">0</span>;

      <span class="keyword">if</span> (self.currIndex &lt; <span class="number">0</span>) { self.currIndex = <span class="number">0</span>; }
      <span class="keyword">if</span> (!self.pluck( lastIndex )) { <span class="keyword">return</span>; }

      self.$sequence.addClass( <span class="string">'visuallyhidden'</span> );
      self.pluck( self.currIndex ).removeClass( <span class="string">'visuallyhidden'</span> );
    },

    sliderRatioToValue: <span class="keyword">function</span>(ratio) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          idx,
          range,
          rawValue,
          step,
          steps;

        range = self.getSliderRange();
        rawValue = ratio * (range.max - range.min) + range.min;

        <span class="keyword">return</span> self.sliderNearestValidValue(rawValue);
    },

    setSliderPosition: <span class="keyword">function</span>(position, isMin) {
       <span class="keyword">var</span> self = <span class="keyword">this</span>;

       self.$slideHandle.css({
          left: position
       });
    },

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>get the demensions, will need to recalculate on resize</p>             </td>             <td class="code">               <div class="highlight"><pre>    sliderGetDimensions: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.sliderControlWidth = (self.$sliderControl.width() - <span class="number">20</span>);
      <span class="keyword">return</span> (self.sliderControlWidth);
    },

    dragSlider: <span class="keyword">function</span>(event, position) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          pagePos,
          ratio,
          value,
          data = {},
          page = event.gesture.center,
          direction = event.gesture.direction ? event.gesture.direction : <span class="string">'left'</span>,
          eventX = page.pageX ? page.pageX : <span class="number">0</span>;


</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>get the sldie value positions</p>             </td>             <td class="code">               <div class="highlight"><pre>      pagePos = eventX - self.$sliderControl.offset().left;
      pagePos = Math.min(self.sliderControlWidth, pagePos);
      pagePos = Math.max(-<span class="number">20</span>, pagePos);

      <span class="keyword">if</span> (self.pagePos !== pagePos) {
        self.pagePos = pagePos;
        ratio = pagePos / self.sliderControlWidth;
        value = self.sliderRatioToValue(ratio);

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>set the slider positon</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.setSliderPosition(pagePos);

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>if ( pagePos &lt;= 0 ) { pagePos = 0; }</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.sliderGotoFrame(pagePos);
      }

      self.dragged = <span class="literal">true</span>;

    },

    setupBarBindings: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          $slideHandle;

      self.pagePos = <span class="number">0</span>;
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>find the handle so we can setup bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$slideHandle = self.$sliderControl.find(<span class="string">'.handle'</span>);
      self.$slideHandle.hammer();

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>get slider dimensions</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.sliderGetDimensions();

      self.$slideHandle.on({
        touch : <span class="keyword">function</span>( event ) {
          self.touchDown( event );
        },
        release : <span class="keyword">function</span>( event ) {
          self.touchUp( event );
        },
        drag : <span class="keyword">function</span>( event ) {
          <span class="keyword">var</span> direction = event.gesture.direction;

          <span class="keyword">if</span>( <span class="string">'left'</span> == direction || <span class="string">'right'</span> == direction ) {
            self.dragSlider( event );
          }
        },
        tap : <span class="keyword">function</span>( event ) {
          self.touchMove( event );
        }
      });


    },

    createBarControl: <span class="keyword">function</span>( cb ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          controlTmpl,
          $sliderControl;

      controlTmpl = {};

      controlTmpl.slider = [
        <span class="string">"&lt;div class='control-bar-container'&gt;"</span>,
          <span class="string">"&lt;div class='control-bar slider range-control'&gt;"</span>,
            <span class="string">"&lt;div class='handle'&gt;"</span>,
              <span class="string">"&lt;span class='inner'&gt;"</span>,
                <span class="string">"&lt;span class='icons'&gt;"</span>,
                  <span class="string">"&lt;i class='fonticon-10-chevron-reverse'/&gt;"</span>,
                  <span class="string">"&lt;i class='fonticon-10-chevron'/&gt;"</span>,
                <span class="string">"&lt;/span&gt;"</span>,
              <span class="string">"&lt;/span&gt;"</span>,
            <span class="string">"&lt;/div&gt;"</span>,
          <span class="string">"&lt;/div&gt;"</span>,
        <span class="string">"&lt;/div&gt;"</span>
      ].join(<span class="string">'\n'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>add our new controls to the container</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$container.append(controlTmpl.slider);
      self.$sliderControlContainer = self.$container.find(<span class="string">'.control-bar-container'</span>);
      self.$sliderControl = self.$container.find(<span class="string">'.range-control'</span>);

      <span class="keyword">if</span> (self.options.labelLeft &amp;&amp; self.labelRight) {
        <span class="keyword">var</span> label = {};

        label.left = <span class="string">"&lt;span class='slider-label label-left l3' data-direction='right'&gt;"</span>+self.options.labelLeft+<span class="string">"&lt;/span&gt;"</span>;
        label.right = <span class="string">"&lt;span class='slider-label label-right l3' data-direction='left'&gt;"</span>+self.options.labelRight+<span class="string">"&lt;/span&gt;"</span>;

        self.$sliderControlContainer.append(label.right)
          .prepend(label.left);
      }

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>setup the bindings for the control slider</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.setupBarBindings();
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>we should get rid of the other controls</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$controls.remove();

      cb();
    },

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>this will load the sequence of images</p>             </td>             <td class="code">               <div class="highlight"><pre>    loadSequence: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.$sequence.addClass(<span class="string">'visuallyhidden'</span>);

      self.$sequence.each(<span class="keyword">function</span>( index ) {
        <span class="keyword">var</span> el = $(<span class="keyword">this</span>);

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>remove the hidden class</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$sequence.eq(index).removeClass(<span class="string">'visuallyhidden'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>so iQ can catch on
self.$win.trigger('resize');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>now we can hide the element again?</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$sequence.eq(index).addClass(<span class="string">'visuallyhidden'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>is the BG image loaded?</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(  el.data(<span class="string">'hasLoaded'</span>) ) {
          self.syncControlLayout();
          self.curLoaded++;
          self.checkLoaded();
        } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>its not a preloaded background</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span>( el.is( <span class="string">'div'</span> ) ) {
            el.on( <span class="string">'iQ:imageLoaded'</span>, $.proxy(self.lockAndLoaded, self) );
          } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>check if the inline images are cached</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span>( <span class="literal">false</span> === <span class="keyword">this</span>.complete ) {
</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>not cached, listen for load event</p>             </td>             <td class="code">               <div class="highlight"><pre>              el.onload = self.lockAndLoaded;
            } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>cached, count it against the payload</p>             </td>             <td class="code">               <div class="highlight"><pre>              self.syncControlLayout();
              self.curLoaded++;
              self.checkLoaded();
            }
          }
        }
      });

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>now show the first sequence again</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sequence.eq(<span class="number">0</span>).removeClass(<span class="string">'visuallyhidden'</span>);
    },

    startAnimation: <span class="keyword">function</span>(direction) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      self.animationInterval = setInterval(<span class="keyword">function</span>() {
        self.move( direction );
      }, self.options.animationspeed);

    },

    initBehaviors: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">if</span>( <span class="literal">false</span> === Modernizr.touch ) {
</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>extend with touch controls</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$controls.hammer();
        <span class="keyword">var</span> $viewportel = self.$container;

        self.viewport.add({
          element : $viewportel,
          threshold : <span class="string">'50%'</span>,
          callback : <span class="keyword">function</span>($viewportel) {
            <span class="keyword">if</span>( !self.inViewport ) {
              self.inMotion = <span class="literal">true</span>;
              self.animateDragger();
              self.inViewport = <span class="literal">true</span>;
            } <span class="keyword">else</span> {
              self.inViewport = <span class="literal">false</span>;
            }
          }
        });

        <span class="keyword">if</span> (self.options.viewcontrols) {

          self.$controls.on({
            touch : <span class="keyword">function</span>( event ) {
              self.touchDown( event );
            },
            release : <span class="keyword">function</span>( event ) {
              self.touchUp( event );
            },
            drag : <span class="keyword">function</span>( event ) {
              <span class="keyword">var</span> direction = event.gesture.direction;

              <span class="keyword">if</span>( <span class="string">'left'</span> == direction || <span class="string">'right'</span> == direction ) {
                self.touchMove( event );
              }
            },
            tap : <span class="keyword">function</span>( event ) {
              self.touchMove( event );
            }
          });

        } <span class="keyword">else</span> <span class="keyword">if</span> (self.options.barcontrols) {


        }
      } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>trigger UI indication (Desktop)</p>             </td>             <td class="code">               <div class="highlight"><pre>        $( window ).bind( <span class="string">'scroll'</span>, <span class="keyword">function</span>( event ) {
          self.onScroll( event );
        });

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>setup controller interactions</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$controls.bind( <span class="string">'mousedown'</span>, <span class="keyword">function</span>( event ) {
          self.mouseDown( event );
        });

        self.$controls.bind( <span class="string">'mouseup'</span>, <span class="keyword">function</span>( event ) {
          self.mouseUp( event );
        });

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>track mousemove</p>             </td>             <td class="code">               <div class="highlight"><pre>        $( self.$controls ).bind( <span class="string">'mousemove'</span>, <span class="keyword">function</span>( event ) {
          self.mouseMove( event );
        });
      }

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>bind scroll event to fire animation on the dragger
1. movement on desktop and 2. viewport on mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>initial animation, hey why not.</p>             </td>             <td class="code">               <div class="highlight"><pre>      setTimeout(<span class="keyword">function</span>() {
        self.animateDragger();
      }, <span class="number">500</span>);

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>reset the step buffer when the window changes size</p>             </td>             <td class="code">               <div class="highlight"><pre>      $( window ).bind( <span class="string">'resize'</span>, <span class="keyword">function</span>( event ) {
        self.onResize( event );
      });

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>adjust controls to center if type is image</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( <span class="literal">true</span> === self.isImage ) {
        self.syncControlLayout();
      }

      <span class="keyword">if</span> (self.options.viewcontrols) {
</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>finally show controlls</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.$controls.removeClass( <span class="string">'hidden'</span> );
      }

    },

    easeSwipe: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>is the swipe greater than one movement
where  (container.width / sequence.length-1) / 3 = one step</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> assetWidth      = $( self.$sequence[self.curIndex] ).width(),
          swipeDistance   = event.gesture.distance,
          sequenceLength  = sequence.length - <span class="number">1</span>,
          stepSize        = ( assetWidth / sequenceLength ) / self.throttle,
          shouldEase      = ( <span class="number">0</span> &lt; ( swipeDistance - stepSize ) ) ? ( swipeDistance - stepSize ) : <span class="literal">false</span>;
    },

    onResize: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.dynamicBuffer = Math.floor( ( self.$container.width() / self.$sequence.length ) / self.throttle );
      self.syncControlLayout();
      <span class="keyword">if</span>( <span class="literal">true</span> === self.isImage ) {

      }
    },

    onScroll: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">if</span>( <span class="literal">false</span> === self.inMotion) {
        self.inMotion = <span class="literal">true</span>;
        self.animateDragger();
      }
      <span class="keyword">if</span>( <span class="literal">true</span> === self.isImage ) {
        self.syncControlLayout();
      }
    },

    touchDown: <span class="keyword">function</span>( event ) {
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Montana to Rice!</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.$body.addClass(<span class="string">'unselectable'</span>);
      self.clicked = <span class="literal">true</span>;
    },

    touchUp: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      self.$body.removeClass(<span class="string">'unselectable'</span>);
      self.clicked = <span class="literal">false</span>;
    },

    touchMove: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self      = <span class="keyword">this</span>,
          pageX     = event.gesture.distance,
          direction = event.gesture.direction ? event.gesture.direction : <span class="string">'left'</span>,
          doMove    = <span class="literal">false</span>;

      event.preventDefault();
      event.gesture.preventDefault();

      self.mobileLog( <span class="string">'direction '</span> + direction + <span class="string">'\n'</span> + <span class="string">'events fired: '</span>+ self.touchEvents++ + <span class="string">'\n'</span> + <span class="string">'direction: '</span> + pageX );

      <span class="keyword">if</span>( Settings.isIOS ) {
        <span class="keyword">if</span>( <span class="number">0</span> === self.moves % <span class="number">2</span> ) {
          self.move( direction );
        }
      } <span class="keyword">else</span> <span class="keyword">if</span>( Settings.isAndroid ) {
        <span class="keyword">if</span>( <span class="number">0</span> === self.moves % <span class="number">5</span> ) {
          self.move( direction );
        }
      } <span class="keyword">else</span> {
        self.move( direction );
      }

      self.moves++;
    },

    mouseDown: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      event.preventDefault();
      $( self.$controls ).addClass( <span class="string">'is-dragging'</span> );
      self.$body.addClass(<span class="string">'unselectable'</span>);
      self.clicked = <span class="literal">true</span>;
    },

    mouseUp: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      event.preventDefault();
      $( self.$controls ).removeClass( <span class="string">'is-dragging'</span> );
      self.$body.removeClass(<span class="string">'unselectable'</span>);
      self.clicked = <span class="literal">false</span>;
    },

    mouseMove: <span class="keyword">function</span>( event ) {
      <span class="keyword">var</span> self    = <span class="keyword">this</span>,
          doMove  = <span class="literal">false</span>;

      event.preventDefault();

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>set a default if not already set</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( <span class="literal">null</span> === self.lastTriggerX ) {
        self.lastTriggerX = self.lastX = event.pageX;
      }

      <span class="keyword">if</span>( event.pageX &gt; ( self.lastTriggerX + self.dynamicBuffer ) ) {
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>moving right</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.movingLeft   = <span class="literal">true</span>;
        self.movingRight  = <span class="literal">false</span>;
        doMove = <span class="literal">true</span>;
        self.lastTriggerX = event.pageX;
      } <span class="keyword">else</span> <span class="keyword">if</span>( event.pageX &lt; ( self.lastTriggerX - self.dynamicBuffer ) ) {
</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>moving left</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.movingLeft   = <span class="literal">false</span>;
        self.movingRight  = <span class="literal">true</span>;
        doMove = <span class="literal">true</span>;
        self.lastTriggerX = event.pageX;
      }

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>shall we?</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span>( self.clicked &amp;&amp; doMove ) {
        <span class="keyword">var</span> direction = self.movingLeft ? <span class="string">"left"</span> : <span class="string">"right"</span>;
        self.move( direction );
      }

      self.lastX = event.pageX;
    },

    mobileLog: <span class="keyword">function</span>( data, append ) {
</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>$( '.e360debug' ).html( data.toString() + '\n' );</p>             </td>             <td class="code">               <div class="highlight"><pre>    },

    animateDragger: <span class="keyword">function</span>( cycles ) {
      <span class="keyword">if</span>(Settings.isLTIE8){
        <span class="keyword">return</span>;
      }
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $( self.$leftArrow ).animate({
        opacity: <span class="number">0</span>
      });

      $( self.$rightArrow ).animate({
        opacity: <span class="number">0</span>
      });

      $( self.$controlCenter ).animate({
        marginLeft: <span class="string">"+26px"</span>,
        marginRight: <span class="string">"+26px"</span>
      }, <span class="number">499</span>, <span class="keyword">function</span>(event) {
        self.resetAnimation();
      });

    },

    resetAnimation: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      $( self.$leftArrow ).css( {
        opacity: <span class="number">1</span>
      });

      $( self.$rightArrow ).css( {
        opacity: <span class="number">1</span>
      });

      $( self.$controlCenter ).css( {
        marginLeft : <span class="string">"18px"</span>,
        marginRight : <span class="string">"18px"</span>
      });

      self.inMotion = <span class="literal">false</span>;
    },

    initSliderBindings: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>bind our click event handlers for labels</p>             </td>             <td class="code">               <div class="highlight"><pre>      self.$sliderControlContainer.on(<span class="string">'click.label-click'</span>, <span class="string">".slider-label"</span>, <span class="keyword">function</span>(e){
        <span class="keyword">var</span> $el = $(e.target),
            data = $el.data(),
            direction = data.direction;

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>if its autoplaying we dont want to reset everything -- crazy</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span>(self.options.autoplay) {
          <span class="keyword">return</span> <span class="literal">false</span>;
        }

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>set it back to autoplay</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.options.autoplay = <span class="literal">true</span>;
        self.animationLooped = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>start the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>        self.startAnimation(direction);
      });

      self.sliderLabelInitialized = <span class="literal">true</span>;
    },

    move: <span class="keyword">function</span>( direction ) {
      <span class="keyword">var</span> self      = <span class="keyword">this</span>,
          lastIndex = self.curIndex,
          pagePos;

      pagePos = (self.sliderControlWidth/self.curIndex);
      <span class="keyword">switch</span>( direction ) {
        <span class="keyword">case</span> <span class="string">"left"</span>:
          console.log(<span class="string">'moving left'</span>, self.options.autoplay);
          <span class="keyword">if</span>( self.curIndex === <span class="number">0</span> ) {

            <span class="keyword">if</span> (self.options.autoplay &amp;&amp; self.animationLooped &amp;&amp; !self.options.loop) {
              self.initBehaviors();
              clearInterval(self.animationInterval);

              <span class="keyword">if</span> (!self.sliderLabelInitialized) {
                self.createBarControl(<span class="keyword">function</span>(){
                  <span class="keyword">if</span>(self.sliderLabelInitialized) { $.proxy(self.initSliderBindings(), self); }
                });
              }

              self.options.autoplay = <span class="literal">false</span>;
              <span class="keyword">return</span>;
            }

            self.curIndex = self.sequenceLength-<span class="number">1</span>;
          } <span class="keyword">else</span> {
            self.curIndex--;

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>if were animating we need to get the current slide index and compare it to the slider width, to get the position.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.setSliderPosition(pagePos);

</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>we can assume we've done a loop</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> (self.curIndex === <span class="number">1</span>) { self.animationLooped = <span class="literal">true</span>; }
          }
        <span class="keyword">break</span>;

        <span class="keyword">case</span> <span class="string">"right"</span>:
</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>we can assume we've done a loop</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="keyword">if</span>( self.curIndex == self.sequenceLength-<span class="number">1</span> ) {
            self.curIndex = self.sequenceLength;
            pagePos = (self.sliderControlWidth/self.curIndex);

            self.animationLooped = <span class="literal">true</span>;

            <span class="keyword">if</span> (self.options.autoplay &amp;&amp; self.animationLooped &amp;&amp; !self.options.loop) {
              clearInterval(self.animationInterval);
            }

            self.animationLooped = <span class="literal">true</span>;
            self.options.autoplay = <span class="literal">false</span>;

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>jank</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.setSliderPosition(-<span class="number">20</span>);
            self.curIndex = <span class="number">0</span>;

          } <span class="keyword">else</span> {
            self.curIndex++;

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>if were animating we need to get the current slide index and compare it to the slider width, to get the position.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.setSliderPosition(pagePos);
          }
        <span class="keyword">break</span>;
      }

      self.$sequence.addClass( <span class="string">'visuallyhidden'</span> );
      self.pluck( self.curIndex ).removeClass( <span class="string">'visuallyhidden'</span> );
    },

    pluck: <span class="keyword">function</span>( lastIndex ) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>find by data index</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.$sequence.length; i++ ) {
        <span class="keyword">if</span>( lastIndex == self.$sequence.eq(i).data( <span class="string">'sequence-id'</span> ) ) {
          <span class="keyword">return</span> self.$sequence.eq(i);
        }
      }
</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>not found</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">return</span> <span class="literal">false</span>;
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h2>jQuery Plugin Definition</h2>

<p>$.extend({
inspect: function (obj, n) {
n = n || "this";
for (var p in obj) {
if ($.isPlainObject(obj[p])) {
$.inspect(obj[p], n + "." + p);
return;
}
}
}
});</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>$.fn.editorial360Viewer = function( options ) {
var args = Array.prototype.slice.call( arguments, 1 );
return this.each(function() {
var self = $(this),
editorial360Viewer = self.data('editorial360Viewer');</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>// If we don't have a stored moduleName, make a new one and save it.
if ( !editorial360Viewer ) {
editorial360Viewer = new SonySequence( self, options );
self.data( 'editorial360Viewer', editorial360Viewer );
}</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>if ( typeof options === 'string' ) {
editorial360Viewer[ options ].apply( editorial360Viewer, args );
}
});
};</p>             </td>             <td class="code">               <div class="highlight"><pre>
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h2>Defaults</h2>             </td>             <td class="code">               <div class="highlight"><pre>  SonySequence.defaults = {
    autoplay: <span class="literal">false</span>,
    viewcontrols: <span class="literal">true</span>,
    barcontrols: <span class="literal">false</span>,
    loop: <span class="literal">false</span>,
    speed: <span class="number">100</span>,
    labelLeft: <span class="string">'Left'</span>,
    labelRight: <span class="string">'Right'</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h2>Non override-able settings</h2>             </td>             <td class="code">               <div class="highlight"><pre>  SonySequence.settings = {
    isTouch: !!( <span class="string">'ontouchstart'</span> <span class="keyword">in</span> window ),
    isInitialized: <span class="literal">false</span>
  };

  <span class="keyword">return</span> SonySequence;

});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 