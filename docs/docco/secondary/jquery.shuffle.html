<!DOCTYPE html>  <html> <head>   <title>jquery.shuffle.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="debug_toggle.html">                 debug_toggle.js               </a>                                           <a class="source" href="form-actions.html">                 form-actions.js               </a>                                           <a class="source" href="jodo.rangecontrol.1.4.html">                 jodo.rangecontrol.1.4.js               </a>                                           <a class="source" href="jquery.shuffle.html">                 jquery.shuffle.js               </a>                                           <a class="source" href="jquery.simpleknob.html">                 jquery.simpleknob.js               </a>                                           <a class="source" href="jquery.simplescroll.html">                 jquery.simplescroll.js               </a>                                           <a class="source" href="jquery.viewport.html">                 jquery.viewport.js               </a>                                           <a class="source" href="sony-carousel.html">                 sony-carousel.js               </a>                                           <a class="source" href="sony-chapters.html">                 sony-chapters.js               </a>                                           <a class="source" href="sony-draggable.html">                 sony-draggable.js               </a>                                           <a class="source" href="sony-evenheights.html">                 sony-evenheights.js               </a>                                           <a class="source" href="sony-navigationdots.html">                 sony-navigationdots.js               </a>                                           <a class="source" href="sony-paddles.html">                 sony-paddles.js               </a>                                           <a class="source" href="sony-scroller.html">                 sony-scroller.js               </a>                                           <a class="source" href="sony-sequencer.html">                 sony-sequencer.js               </a>                                           <a class="source" href="sony-stickynav.html">                 sony-stickynav.js               </a>                                           <a class="source" href="sony-stickytabs.html">                 sony-stickytabs.js               </a>                                           <a class="source" href="sony-tab.html">                 sony-tab.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jquery.shuffle.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="comment">/*!
 * jQuery Shuffle Plugin
 * Uses CSS Transforms to filter down a grid of items (degrades to jQuery's animate).
 * Inspired by Isotope http://isotope.metafizzy.co/
 * Use it for whatever you want! Requires jQuery 1.9+
 * @author Glen Cheney (http://glencheney.com)
 * @version 1.6.1
 * @date 03/14/13
 */</span>

define(<span class="keyword">function</span>(require){

    <span class="string">'use strict'</span>;

    <span class="keyword">var</span> $ = require(<span class="string">'jquery'</span>),
        Modernizr = require(<span class="string">'modernizr'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>You can return <code>undefined</code> from the <code>by</code> function to revert to DOM order
This plugin does NOT return a jQuery object. It returns a plain array because
jQuery sorts everything in DOM order.</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.sorted = <span class="keyword">function</span>(options) {
        <span class="keyword">var</span> opts = $.extend({}, $.fn.sorted.defaults, options),
            arr = <span class="keyword">this</span>.get(),
            revert = <span class="literal">false</span>;

        <span class="keyword">if</span> ( !arr.length ) {
            <span class="keyword">return</span> [];
        }

        <span class="keyword">if</span> ( opts.randomize ) {
            <span class="keyword">return</span> $.fn.sorted.randomize( arr );
        }

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Sort the elements by the opts.by function.
If we don't have opts.by, default to DOM order</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> (opts.by !== $.noop &amp;&amp; opts.by !== <span class="literal">null</span> &amp;&amp; opts.by !== <span class="literal">undefined</span>) {
            arr.sort(<span class="keyword">function</span>(a, b) {

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Exit early if we already know we want to revert</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( revert ) {
                    <span class="keyword">return</span> <span class="number">0</span>;
                }

                <span class="keyword">var</span> valA = opts.by($(a)),
                    valB = opts.by($(b));

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>If both values are undefined, use the DOM order</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( valA === <span class="literal">undefined</span> &amp;&amp; valB === <span class="literal">undefined</span> ) {
                    revert = <span class="literal">true</span>;
                    <span class="keyword">return</span> <span class="number">0</span>;
                }

                <span class="keyword">if</span> ( valA === <span class="string">'sortFirst'</span> || valB === <span class="string">'sortLast'</span> ) {
                    <span class="keyword">return</span> -<span class="number">1</span>;
                }

                <span class="keyword">if</span> ( valA === <span class="string">'sortLast'</span> || valB === <span class="string">'sortFirst'</span> ) {
                    <span class="keyword">return</span> <span class="number">1</span>;
                }

                <span class="keyword">return</span> (valA &lt; valB) ? -<span class="number">1</span> :
                    (valA &gt; valB) ? <span class="number">1</span> : <span class="number">0</span>;
            });
        }

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Revert to the original array if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="keyword">if</span> ( revert ) {
            <span class="keyword">return</span> <span class="keyword">this</span>.get();
        }

        <span class="keyword">if</span> ( opts.reverse ) {
            arr.reverse();
        }

        <span class="keyword">return</span> arr;

    };

    $.fn.sorted.defaults = {
        reverse: <span class="literal">false</span>, <span class="comment">// Use array.reverse() to reverse the results</span>
        by: <span class="literal">null</span>, <span class="comment">// Sorting function</span>
        randomize: <span class="literal">false</span> <span class="comment">// If true, this will skip the sorting and return a randomized order in the array</span>
    };


</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>http://stackoverflow.com/a/962890/373422</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.sorted.randomize = <span class="keyword">function</span>( array ) {
        <span class="keyword">var</span> top = array.length,
            tmp, current;

        <span class="keyword">if</span> ( !top ) {
            <span class="keyword">return</span> array;
        }

        <span class="keyword">while</span> ( --top ) {
            current = Math.floor( Math.random() * (top + <span class="number">1</span>) );
            tmp = array[ current ];
            array[ current ] = array[ top ];
            array[ top ] = tmp;
        }

        <span class="keyword">return</span> array;
    };



    <span class="keyword">var</span> Shuffle = <span class="keyword">function</span>( $container, options ) {
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        $.extend(self, $.fn.shuffle.options, options, $.fn.shuffle.settings);

        self.$container = $container.addClass(<span class="string">'shuffle'</span>);
        self.$window = $(window);
        self.unique = <span class="string">'shuffle_'</span> + $.now();

        self.fire(<span class="string">'loading'</span>);
        self._init();
        self.fire(<span class="string">'done'</span>);
    };

    Shuffle.prototype = {

        constructor: Shuffle,

        _init : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                containerCSS,
                transEndEventNames,
                afterResizeFunc,
                debouncedAfterResize,
                beforeResizeFunc,
                debouncedBeforeResize;

            self.$items = self._getItems().addClass(<span class="string">'shuffle-item filtered'</span>);
            self.transitionName = self.prefixed(<span class="string">'transition'</span>),
            self.transitionDelayName = self.prefixed(<span class="string">'transitionDelay'</span>);
            self.transitionDuration = self.prefixed(<span class="string">'transitionDuration'</span>);
            self.transform = self.getPrefixed(<span class="string">'transform'</span>);

            self.isFluid = self.columnWidth &amp;&amp; <span class="keyword">typeof</span> self.columnWidth === <span class="string">'function'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Get transitionend event name</p>             </td>             <td class="code">               <div class="highlight"><pre>            transEndEventNames = {
                <span class="string">'WebkitTransition'</span> : <span class="string">'webkitTransitionEnd'</span>,
                <span class="string">'MozTransition'</span>    : <span class="string">'transitionend'</span>,
                <span class="string">'OTransition'</span>      : <span class="string">'oTransitionEnd'</span>,
                <span class="string">'msTransition'</span>     : <span class="string">'MSTransitionEnd'</span>,
                <span class="string">'transition'</span>       : <span class="string">'transitionend'</span>
            };
            self.transitionend = transEndEventNames[ self.transitionName ];

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Set up css for transitions</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.$container[<span class="number">0</span>].style[ self.transitionName ] = <span class="string">'height '</span> + self.speed + <span class="string">'ms '</span> + self.easing;
            self._initItems( self.showInitialTransition );

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Bind resize events (http://stackoverflow.com/questions/1852751/window-resize-event-firing-in-internet-explorer)
Get debounced versions of our resize methods</p>             </td>             <td class="code">               <div class="highlight"><pre>            afterResizeFunc = $.proxy( self._afterResize, self );
            debouncedAfterResize = self.throttle ? self.throttle( self.throttleTime, afterResizeFunc ) : afterResizeFunc;
            self.$window.on(<span class="string">'resize.'</span> + self.unique, debouncedAfterResize);

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If we need to hide layouts with a fade instead, we need another event on window resize
which is only fired the first time window resize is triggered</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.hideLayoutWithFade ) {
                beforeResizeFunc = $.proxy( self._beforeResize, self );
                debouncedBeforeResize = self.throttle ? self.throttle( self.throttleTime, <span class="literal">true</span>, beforeResizeFunc ) : beforeResizeFunc;
                self.$window.on(<span class="string">'resize.shuffle'</span>, debouncedBeforeResize);
            }

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Position cannot be static</p>             </td>             <td class="code">               <div class="highlight"><pre>            containerCSS = self.$container.css([<span class="string">'paddingLeft'</span>, <span class="string">'paddingRight'</span>, <span class="string">'position'</span>, <span class="string">'width'</span>]);
            <span class="keyword">if</span> ( containerCSS.position === <span class="string">'static'</span> ) {
                self.$container.css(<span class="string">'position'</span>, <span class="string">'relative'</span>);
            }

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Get offset from container</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.offset = {
                left: parseInt( containerCSS.paddingLeft, <span class="number">10</span> ) || <span class="number">0</span>,
                top: parseInt( containerCSS.paddingTop, <span class="number">10</span> ) || <span class="number">0</span>
            };
            self._resetCols();
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>We already got the container's width above, no need to cause another reflow getting it again...</p>             </td>             <td class="code">               <div class="highlight"><pre>            self._setColumns( parseInt( containerCSS.width, <span class="number">10</span> ) );
            self.shuffle( self.group );

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>If we've hidden the initial layout, we need to now add the transition to the elements</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !self.showInitialTransition &amp;&amp; self.supported &amp;&amp; self.useTransition ) {
                setTimeout(<span class="keyword">function</span>() {
                    self._setTransitions();
                }, <span class="number">0</span>);
            }
        },

        filter : <span class="keyword">function</span>( category, $collection ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                isPartialSet = $collection !== <span class="literal">undefined</span>,
                $items = isPartialSet ? $collection : self.$items,
                $filtered = $();

            category = category || self.lastFilter;

            self.fire(<span class="string">'filter'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Loop through each item and use provided function to determine
whether to hide it or not.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( $.isFunction(category) ) {
                $items.each(<span class="keyword">function</span>() {
                    <span class="keyword">var</span> $item = $(<span class="keyword">this</span>),
                    passes = category.call($item[<span class="number">0</span>], $item, self);

                    <span class="keyword">if</span> ( passes ) {
                        $filtered = $filtered.add( $item );
                    }
                });
            }

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Otherwise we've been passed a category to filter by</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">else</span> {
                self.group = category;
                <span class="keyword">if</span> (category !== <span class="string">'all'</span>) {
                    $items.each(<span class="keyword">function</span>() {
                        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
                        groups = $<span class="keyword">this</span>.data(<span class="string">'groups'</span>),
                        keys = self.delimeter &amp;&amp; !$.isArray( groups ) ? groups.split( self.delimeter ) : groups,
                        passes = $.inArray(category, keys) &gt; -<span class="number">1</span>;

                        <span class="keyword">if</span> ( passes ) {
                            $filtered = $filtered.add( $<span class="keyword">this</span> );
                        }
                    });
                }

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>category === 'all', add filtered class to everything</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">else</span> {
                    $filtered = $items;
                }
            }

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Individually add/remove concealed/filtered classes</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> concealed = <span class="string">'concealed'</span>,
                filtered = <span class="string">'filtered'</span>;
            $items.filter( $filtered ).each(<span class="keyword">function</span>() {
                <span class="keyword">var</span> $filteredItem = $(<span class="keyword">this</span>);
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Remove concealed if it's there</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( $filteredItem.hasClass( concealed ) ) {
                    $filteredItem.removeClass( concealed );
                }
</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Add filtered class if it's not there</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( !$filteredItem.hasClass( filtered ) ) {
                    $filteredItem.addClass( filtered );
                }
            });
            $items.not( $filtered ).each(<span class="keyword">function</span>() {
                <span class="keyword">var</span> $filteredItem = $(<span class="keyword">this</span>);
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Add concealed if it's not there</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( !$filteredItem.hasClass( concealed ) ) {
                    $filteredItem.addClass( concealed );
                }
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Remove filtered class if it's there</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( $filteredItem.hasClass( filtered ) ) {
                    $filteredItem.removeClass( filtered );
                }
            });

            $items = <span class="literal">null</span>;
            $collection = <span class="literal">null</span>;

            <span class="keyword">return</span> $filtered;
        },

        _initItems : <span class="keyword">function</span>( withTransition, $items ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Default to true if unspecified</p>             </td>             <td class="code">               <div class="highlight"><pre>            withTransition = withTransition === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;
            $items = $items || self.$items;

            $items.each(<span class="keyword">function</span>() {
                $(<span class="keyword">this</span>).css(self.itemCss);

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Set CSS transition for transforms and opacity</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( self.supported &amp;&amp; self.useTransition &amp;&amp; withTransition ) {
                    self._setTransition(<span class="keyword">this</span>);
                }
            });
        },

        _setTransition : <span class="keyword">function</span>( element ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;
            element.style[self.transitionName] = self.transform + <span class="string">' '</span> + self.speed + <span class="string">'ms '</span> + self.easing + <span class="string">', opacity '</span> + self.speed + <span class="string">'ms '</span> + self.easing;
        },

        _setTransitions : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;
            self.$items.each(<span class="keyword">function</span>() {
                self._setTransition( <span class="keyword">this</span> );
            });
        },


        _setSequentialDelay : <span class="keyword">function</span>( $collection ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            <span class="keyword">if</span> ( !self.supported ) {
                <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>$collection can be an array of dom elements or jquery object</p>             </td>             <td class="code">               <div class="highlight"><pre>            $.each( $collection, <span class="keyword">function</span>(i) {
</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>This works because the transition-property: transform, opacity;</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">this</span>.style[ self.transitionDelayName ] = <span class="string">'0ms,'</span> + ((i + <span class="number">1</span>) * self.sequentialFadeDelay) + <span class="string">'ms'</span>;

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Set the delay back to zero after one transition</p>             </td>             <td class="code">               <div class="highlight"><pre>                $(<span class="keyword">this</span>).one(self.transitionend, <span class="keyword">function</span>() {
                    <span class="keyword">this</span>.style[ self.transitionDelayName ] = <span class="string">'0ms'</span>;
                });
            });
        },

        _resetDelay : <span class="keyword">function</span>( $collection ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            <span class="keyword">if</span> ( !self.supported ) {
                <span class="keyword">return</span>;
            }

            $.each( $collection, <span class="keyword">function</span>() {
                $(<span class="keyword">this</span>).off( self.transitionend );
                <span class="keyword">this</span>.style[ self.transitionDelayName ] = <span class="string">'0ms'</span>;
            });
        },

        _orderItemsByDelay : <span class="keyword">function</span>( $items ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                $ordered = $(),
                $randomized = $(),
                ordered, randomized, merged,

            by = <span class="keyword">function</span>( $el ) {
                <span class="keyword">return</span> $el.data(<span class="string">'delayOrder'</span>);
            };

            <span class="keyword">if</span> ( !self.$ordered ) {

                $items.each(<span class="keyword">function</span>() {
                    <span class="keyword">var</span> delayOrder = $(<span class="keyword">this</span>).data(<span class="string">'delayOrder'</span>);

                    <span class="keyword">if</span> ( delayOrder ) {
                        $ordered = $ordered.add( <span class="keyword">this</span> );
                    } <span class="keyword">else</span> {
                        $randomized = $randomized.add( <span class="keyword">this</span> );
                    }
                });

                ordered = $ordered.sorted({ by: by });

            } <span class="keyword">else</span> {
                $ordered = self.$ordered;
                ordered = self.ordered;
                $randomized = $items.not( $ordered );
            }

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Sort randomly</p>             </td>             <td class="code">               <div class="highlight"><pre>            randomized = $randomized.sorted({ randomize: <span class="literal">true</span> });

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Merge with the ordered array</p>             </td>             <td class="code">               <div class="highlight"><pre>            merged = ordered.concat( randomized );

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Save values</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.$ordered = $ordered;
            self.ordered = ordered;
            self.itemsOrderedByDelay = merged;
        },

        _getItems : <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>.$container.children( <span class="keyword">this</span>.itemSelector );
        },

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>calculates number of columns
i.e. this.colWidth = 200</p>             </td>             <td class="code">               <div class="highlight"><pre>        _setColumns : <span class="keyword">function</span>( theContainerWidth ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                containerWidth = theContainerWidth || self.$container.width(),
                gutter = <span class="keyword">typeof</span> self.gutterWidth === <span class="string">'function'</span> ? self.gutterWidth( containerWidth ) : self.gutterWidth;

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>use fluid columnWidth function if there</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.colWidth = self.isFluid ? self.columnWidth( containerWidth ) :
</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>if not, how about the explicitly set option?</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.columnWidth ||
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>or use the size of the first item</p>             </td>             <td class="code">               <div class="highlight"><pre>                self.$items.outerWidth(<span class="literal">true</span>) ||
</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>if there's no items, use size of container</p>             </td>             <td class="code">               <div class="highlight"><pre>                containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Don't let them set a column width of zero.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.colWidth = self.colWidth || containerWidth;

            self.colWidth += gutter;

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Was flooring 4.999999999999999 to 4 :(</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.cols = Math.floor( ( containerWidth + gutter + <span class="number">0.000000000001</span> ) / self.colWidth );
            self.cols = Math.max( self.cols, <span class="number">1</span> );

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>This can happen when .shuffle is called on something hidden (e.g. display:none for tabs)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !self.colWidth || isNaN( self.cols ) || !containerWidth ) {
                self.needsUpdate = <span class="literal">true</span>;
            } <span class="keyword">else</span> {
                self.needsUpdate = <span class="literal">false</span>;
            }

            self.containerWidth = containerWidth;
        },

        <span class="comment">/**
         * Adjust the height of the grid
         */</span>
        setContainerSize : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
            gridHeight = Math.max.apply( Math, self.colYs );
            self.$container.css( <span class="string">'height'</span>, gridHeight + <span class="string">'px'</span> );
        },

        <span class="comment">/**
         * Fire events with .shuffle namespace
         */</span>
        fire : <span class="keyword">function</span>( name ) {
            <span class="keyword">this</span>.$container.trigger(name + <span class="string">'.shuffle'</span>, [<span class="keyword">this</span>]);
        },


        <span class="comment">/**
         * Loops through each item that should be shown
         * Calculates the x and y position and then transitions it
         * @param {array} items - array of items that will be shown/layed out in order in their array.
         *     Because jQuery collection are always ordered in DOM order, we can't pass a jq collection
         * @param {function} complete callback function
         * @param {boolean} isOnlyPosition set this to true to only trigger positioning of the items
         */</span>
        _layout: <span class="keyword">function</span>( items, fn, isOnlyPosition, isHide ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            fn = fn || self.filterEnd;

            self.layoutTransitionEnded = <span class="literal">false</span>;
            $.each(items, <span class="keyword">function</span>(index) {
                <span class="keyword">var</span> $<span class="keyword">this</span> = $(items[index]),
</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>how many columns does this brick span</p>             </td>             <td class="code">               <div class="highlight"><pre>                colSpan = Math.ceil( $<span class="keyword">this</span>.outerWidth(<span class="literal">true</span>) / self.colWidth );
                colSpan = Math.min( colSpan, self.cols );

                <span class="keyword">if</span> ( colSpan === <span class="number">1</span> ) {
</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>if brick spans only one column, just like singleMode</p>             </td>             <td class="code">               <div class="highlight"><pre>                    self._placeItem( $<span class="keyword">this</span>, self.colYs, fn, isOnlyPosition, isHide );
                } <span class="keyword">else</span> {
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>brick spans more than one column
how many different places could this brick fit horizontally</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="keyword">var</span> groupCount = self.cols + <span class="number">1</span> - colSpan,
                        groupY = [],
                        groupColY,
                        i;

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>for each group potential horizontal position</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; groupCount; i++ ) {
</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>make an array of colY values for that one group</p>             </td>             <td class="code">               <div class="highlight"><pre>                        groupColY = self.colYs.slice( i, i + colSpan );
</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>and get the max value of the array</p>             </td>             <td class="code">               <div class="highlight"><pre>                        groupY[i] = Math.max.apply( Math, groupColY );
                    }

                    self._placeItem( $<span class="keyword">this</span>, groupY, fn, isOnlyPosition, isHide );
                }
            });

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><code>_layout</code> always happens after <code>shrink</code>, so it's safe to process the style
queue here with styles from the shrink method</p>             </td>             <td class="code">               <div class="highlight"><pre>            self._processStyleQueue();

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Adjust the height of the container</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.setContainerSize();
        },

        _resetCols : <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>reset columns</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> i = <span class="keyword">this</span>.cols;
            <span class="keyword">this</span>.colYs = [];
            <span class="keyword">while</span> (i--) {
                <span class="keyword">this</span>.colYs.push( <span class="number">0</span> );
            }
        },

        _reLayout : <span class="keyword">function</span>( callback, isOnlyPosition ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;
            callback = callback || self.filterEnd;
            self._resetCols();

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>If we've already sorted the elements, keep them sorted</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.keepSorted &amp;&amp; self.lastSort ) {
                self.sort( self.lastSort, <span class="literal">true</span>, isOnlyPosition );
            } <span class="keyword">else</span> {
                self._layout( self.$items.filter(<span class="string">'.filtered'</span>).get(), self.filterEnd, isOnlyPosition );
            }
        },

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>worker method that places brick in the columnSet with the the minY</p>             </td>             <td class="code">               <div class="highlight"><pre>        _placeItem : <span class="keyword">function</span>( $item, setY, callback, isOnlyPosition, isHide ) {
</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>get the minimum Y value from the columns</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                minimumY = Math.min.apply( Math, setY ),
                shortCol = <span class="number">0</span>;

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Find index of short column, the first from the left where this item will go
if ( setY[i] === minimumY ) requires items' height to be exact every time.
The buffer value is very useful when the height is a percentage of the width</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = setY.length; i &lt; len; i++) {
                <span class="keyword">if</span> ( setY[i] &gt;= minimumY - self.buffer &amp;&amp; setY[i] &lt;= minimumY + self.buffer ) {
                    shortCol = i;
                    <span class="keyword">break</span>;
                }
            }

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Position the item</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> x = self.colWidth * shortCol,
            y = minimumY;
            x = Math.round( x + self.offset.left );
            y = Math.round( y + self.offset.top );

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Save data for shrink</p>             </td>             <td class="code">               <div class="highlight"><pre>            $item.data( {x: x, y: y} );

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Apply setHeight to necessary columns</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">var</span> setHeight = minimumY + $item.outerHeight(<span class="literal">true</span>),
            setSpan = self.cols + <span class="number">1</span> - len;
            <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; setSpan; i++ ) {
                self.colYs[ shortCol + i ] = setHeight;
            }

            <span class="keyword">var</span> transitionObj = {
                from: <span class="string">'layout'</span>,
                $<span class="keyword">this</span>: $item,
                x: x,
                y: y,
                scale: <span class="number">1</span>
            };

            <span class="keyword">if</span> ( !isOnlyPosition ) {
                transitionObj.opacity = <span class="number">1</span>;
                transitionObj.callback = callback;
            } <span class="keyword">else</span> {
                transitionObj.skipTransition = <span class="literal">true</span>;
            }

            <span class="keyword">if</span> ( isHide ) {
                transitionObj.opacity = <span class="number">0</span>;
            }

            self.styleQueue.push( transitionObj );
        },

        <span class="comment">/**
         * Hides the elements that don't match our filter
         */</span>
        shrink : <span class="keyword">function</span>( $collection, fn ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                $concealed = $collection || self.$items.filter(<span class="string">'.concealed'</span>),
                transitionObj = {},
                callback = fn || self.shrinkEnd;

</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Abort if no items</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ($concealed.length === <span class="number">0</span>) {
                <span class="keyword">return</span>;
            }

            self.fire(<span class="string">'shrink'</span>);

            self.shrinkTransitionEnded = <span class="literal">false</span>;
            $concealed.each(<span class="keyword">function</span>() {
                <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
                    data = $<span class="keyword">this</span>.data(),
                    x = parseInt( data.x, <span class="number">10</span> ),
                    y = parseInt( data.y, <span class="number">10</span> );

                <span class="keyword">if</span> (!x) { x = <span class="number">0</span>; }
                <span class="keyword">if</span> (!y) { y = <span class="number">0</span>; }

                transitionObj = {
                    from: <span class="string">'shrink'</span>,
                    $<span class="keyword">this</span>: $<span class="keyword">this</span>,
                    x: x,
                    y: y,
                    scale : <span class="number">0.001</span>,
                    opacity: <span class="number">0</span>,
                    callback: callback
                };

                self.styleQueue.push( transitionObj );
            });
        },

        _afterResize : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>If shuffle is disabled, destroyed, don't do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !self.enabled || self.destroyed ) {
                <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Will need to check height in the future if it's layed out horizontaly</p>             </td>             <td class="code">               <div class="highlight"><pre>            containerWidth = self.$container.width();

</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>containerWidth hasn't changed, don't do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( containerWidth === self.containerWidth ) {
                <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>If we're hiding the layout with a fade,</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.hideLayoutWithFade &amp;&amp; self.supported ) {
</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>recaculate column and gutter values</p>             </td>             <td class="code">               <div class="highlight"><pre>                self._setColumns( containerWidth );
</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Layout the items with only a position</p>             </td>             <td class="code">               <div class="highlight"><pre>                self._reLayout( <span class="literal">false</span>, <span class="literal">true</span> );
</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Change the transition-delay value accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>                self._setSequentialDelay( self.itemsOrderedByDelay || self.$items.get() );
                self.fire(<span class="string">'done'</span>);
                self.$items.css(<span class="string">'opacity'</span>, <span class="number">1</span>);
            } <span class="keyword">else</span> {
                self.resized();
            }
        },

        _beforeResize : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                containerWidth;

</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>If shuffle is disabled, destroyed, don't do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !self.hideLayoutWithFade || !self.supported || !self.enabled || self.destroyed ) {
                <span class="keyword">return</span>;
            }

</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Will need to check height in the future if it's layed out horizontaly</p>             </td>             <td class="code">               <div class="highlight"><pre>            containerWidth = self.$container.width();

</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>containerWidth hasn't changed, don't do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( containerWidth === self.containerWidth ) {
                <span class="keyword">return</span>;
            }

            self.$items.css(<span class="string">'opacity'</span>, <span class="number">0</span>);

            self.fire(<span class="string">'loading'</span>);
            self._resetDelay( self.$items );
            self._orderItemsByDelay( self.$items );
        },

        <span class="comment">/**
         * Uses Modernizr's prefixed() to get the correct vendor property name and sets it using jQuery .css()
         *
         * @param {jq} $el the jquery object to set the css on
         * @param {string} prop the property to set (e.g. 'transition')
         * @param {string} value the value of the prop
         */</span>
        setPrefixedCss : <span class="keyword">function</span>($el, prop, value) {
            $el.css(<span class="keyword">this</span>.prefixed(prop), value);
        },


        <span class="comment">/**
         * Returns things like `-webkit-transition` or `box-sizing` from `transition` or `boxSizing`, respectively
         *
         * @param {string} property to be prefixed.
         * @return {string} the prefixed css property
         */</span>
        getPrefixed : <span class="keyword">function</span>(prop) {
            <span class="keyword">var</span> styleName = <span class="keyword">this</span>.prefixed(prop);
            <span class="keyword">return</span> styleName ? styleName.replace(<span class="regexp">/([A-Z])/g</span>, <span class="keyword">function</span>(str,m1){ <span class="keyword">return</span> <span class="string">'-'</span> + m1.toLowerCase(); }).replace(<span class="regexp">/^ms-/</span>,<span class="string">'-ms-'</span>) : styleName;
        },

        <span class="comment">/**
         * Transitions an item in the grid
         *
         * @param {object}  opts options
         * @param {jQuery}  opts.$this jQuery object representing the current item
         * @param {int}     opts.x translate's x
         * @param {int}     opts.y translate's y
         * @param {String}  opts.left left position (used when no transforms available)
         * @param {String}  opts.top top position (used when no transforms available)
         * @param {float}   opts.scale amount to scale the item
         * @param {float}   opts.opacity opacity of the item
         * @param {String}  opts.height the height of the item (used when no transforms available)
         * @param {String}  opts.width the width of the item (used when no transforms available)
         * @param {function} opts.callback complete function for the animation
         */</span>
        transition: <span class="keyword">function</span>(opts) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
            transform,
</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Only fire callback once per collection's transition</p>             </td>             <td class="code">               <div class="highlight"><pre>            complete = <span class="keyword">function</span>() {
                <span class="keyword">if</span> (!self.layoutTransitionEnded &amp;&amp; opts.from === <span class="string">'layout'</span>) {
                    self.fire(<span class="string">'layout'</span>);
                    opts.callback.call(self);
                    self.layoutTransitionEnded = <span class="literal">true</span>;
                } <span class="keyword">else</span> <span class="keyword">if</span> (!self.shrinkTransitionEnded &amp;&amp; opts.from === <span class="string">'shrink'</span>) {
                    opts.callback.call(self);
                    self.shrinkTransitionEnded = <span class="literal">true</span>;
                }
            };

            opts.callback = opts.callback || $.noop;

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Use CSS Transforms if we have them</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( self.supported ) {

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Make scale one if it's not preset</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">if</span> ( opts.scale === <span class="literal">undefined</span> ) {
                    opts.scale = <span class="number">1</span>;
                }

                <span class="keyword">if</span> (self.threeD) {
                    transform = <span class="string">'translate3d('</span> + opts.x + <span class="string">'px, '</span> + opts.y + <span class="string">'px, 0) scale3d('</span> + opts.scale + <span class="string">', '</span> + opts.scale + <span class="string">', 1)'</span>;
                } <span class="keyword">else</span> {
                    transform = <span class="string">'translate('</span> + opts.x + <span class="string">'px, '</span> + opts.y + <span class="string">'px) scale('</span> + opts.scale + <span class="string">', '</span> + opts.scale + <span class="string">')'</span>;
                }

                <span class="keyword">if</span> ( opts.x !== <span class="literal">undefined</span> ) {
                    self.setPrefixedCss(opts.$<span class="keyword">this</span>, <span class="string">'transform'</span>, transform);
                }

                <span class="keyword">if</span> ( opts.opacity !== <span class="literal">undefined</span> &amp;&amp; self.useTransition ) {
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Update css to trigger CSS Animation</p>             </td>             <td class="code">               <div class="highlight"><pre>                    opts.$<span class="keyword">this</span>.css(<span class="string">'opacity'</span> , opts.opacity);
                }

                <span class="keyword">if</span> ( self.useTransition ) {
                    opts.$<span class="keyword">this</span>.one(self.transitionend, complete);
                } <span class="keyword">else</span> {
                    complete();
                }
            } <span class="keyword">else</span> {

                <span class="keyword">var</span> cssObj = {
                    left: opts.x,
                    top: opts.y,
                    opacity: opts.opacity
                };

                <span class="keyword">if</span> ( self.useTransition ) {
</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Use jQuery to animate left/top</p>             </td>             <td class="code">               <div class="highlight"><pre>                    opts.$<span class="keyword">this</span>.stop(<span class="literal">true</span>, <span class="literal">true</span>).animate( cssObj, self.speed, <span class="string">'swing'</span>, complete);
                } <span class="keyword">else</span> {
                    opts.$<span class="keyword">this</span>.css( cssObj );
                    complete();
                }
            }
        },

        _processStyleQueue : <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                queue = self.styleQueue;

            $.each( queue, <span class="keyword">function</span>(i, transitionObj) {

                <span class="keyword">if</span> ( transitionObj.skipTransition ) {
                    self._skipTransition( transitionObj.$<span class="keyword">this</span>[<span class="number">0</span>], <span class="keyword">function</span>() {
                        self.transition( transitionObj );
                    });
                } <span class="keyword">else</span> {
                    self.transition( transitionObj );
                }
            });

</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Remove everything in the style queue</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.styleQueue.length = <span class="number">0</span>;
        },

        shrinkEnd: <span class="keyword">function</span>() {
            <span class="keyword">this</span>.fire(<span class="string">'shrunk'</span>);
        },

        filterEnd: <span class="keyword">function</span>() {
            <span class="keyword">this</span>.fire(<span class="string">'filtered'</span>);
        },

        sortEnd: <span class="keyword">function</span>() {
            <span class="keyword">this</span>.fire(<span class="string">'sorted'</span>);
        },

        <span class="comment">/**
         * Change a property or execute a function which will not have a transition
         * @param  {Element}         element    DOM element that won't be transitioned
         * @param  {string|function} property   the new style property which will be set or a function which will be called
         * @param  {string}          [value]    the value that `property` should be.
         */</span>
        _skipTransition : <span class="keyword">function</span>( element, property, value ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                reflow,
                durationName = self.transitionDuration,
                duration = element.style[ durationName ];

</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Set the duration to zero so it happens immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>            element.style[ durationName ] = <span class="string">'0ms'</span>; <span class="comment">// ms needed for firefox!</span>

            <span class="keyword">if</span> ( $.isFunction( property ) ) {
                property();
            } <span class="keyword">else</span> {
                element.style[ property ] = value;
            }

</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Force reflow</p>             </td>             <td class="code">               <div class="highlight"><pre>            reflow = element.offsetWidth;

</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Put the duration back</p>             </td>             <td class="code">               <div class="highlight"><pre>            element.style[ durationName ] = duration;
        },

        _addItems : <span class="keyword">function</span>( $newItems, animateIn, isSequential ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                $passed,
                passed;

            <span class="keyword">if</span> ( !self.supported ) {
                animateIn = <span class="literal">false</span>;
            }

            $newItems.addClass(<span class="string">'shuffle-item'</span>);
            self._initItems( <span class="literal">undefined</span>, $newItems );
            self.$items = self._getItems();
            $newItems.not($passed).css(<span class="string">'opacity'</span>, <span class="number">0</span>);

            $passed = self.filter( <span class="literal">undefined</span>, $newItems );
            passed = $passed.get();

</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>How many filtered elements?</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.visibleItems = self.$items.filter(<span class="string">'.filtered'</span>).length;

            <span class="keyword">if</span> ( animateIn ) {
                self._layout( passed, <span class="literal">null</span>, <span class="literal">true</span>, <span class="literal">true</span> );

                <span class="keyword">if</span> ( isSequential ) {
                    self._setSequentialDelay( $passed );
                }

                self._revealAppended( $passed );
            } <span class="keyword">else</span> {
                self._layout( passed );
            }
        },

        _revealAppended : <span class="keyword">function</span>( $newFilteredItems ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            setTimeout(<span class="keyword">function</span>() {
                $newFilteredItems.each(<span class="keyword">function</span>(i, el) {
                    self.transition({
                        from: <span class="string">'reveal'</span>,
                        $<span class="keyword">this</span>: $(el),
                        opacity: <span class="number">1</span>
                    });
                });
            }, self.revealAppendedDelay);
        },

        <span class="comment">/**
         * Public Methods
         */</span>

        <span class="comment">/**
         * The magic. This is what makes the plugin 'shuffle'
         * @param  {String|Function} category category to filter by. Can be a function
         */</span>
        shuffle : <span class="keyword">function</span>( category ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            <span class="keyword">if</span> ( !self.enabled ) {
                <span class="keyword">return</span>;
            }

            <span class="keyword">if</span> ( !category ) {
                category = <span class="string">'all'</span>;
            }

            self.filter( category );
</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Save the last filter in case elements are appended.</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.lastFilter = category;

</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>How many filtered elements?</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.visibleItems = self.$items.filter(<span class="string">'.filtered'</span>).length;

            self._resetCols();

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Shrink each concealed item</p>             </td>             <td class="code">               <div class="highlight"><pre>            self.shrink();

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Update transforms on .filtered elements so they will animate to their new positions</p>             </td>             <td class="code">               <div class="highlight"><pre>            self._reLayout();
        },

        <span class="comment">/**
         * Gets the .filtered elements, sorts them, and passes them to layout
         *
         * @param {object} opts the options object for the sorted plugin
         * @param {Boolean} [fromFilter] was called from Shuffle.filter method.
         */</span>
        sort: <span class="keyword">function</span>( opts, fromFilter, isOnlyPosition ) {
            <span class="keyword">var</span> self = <span class="keyword">this</span>,
                items = self.$items.filter(<span class="string">'.filtered'</span>).sorted(opts);

            <span class="keyword">if</span> ( !fromFilter ) {
                self._resetCols();
            }

            self._layout(items, <span class="keyword">function</span>() {
                <span class="keyword">if</span> (fromFilter) {
                    self.filterEnd();
                }
                self.sortEnd();
            }, isOnlyPosition);

            self.lastSort = opts;
        },

        <span class="comment">/**
         * Relayout everything
         */</span>
        resized: <span class="keyword">function</span>( isOnlyLayout ) {
            <span class="keyword">if</span> ( <span class="keyword">this</span>.enabled ) {

                <span class="keyword">if</span> ( !isOnlyLayout ) {
</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Get updated colCount</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="keyword">this</span>._setColumns();
                }

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Layout items</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="keyword">this</span>._reLayout();
            }
        },

        <span class="comment">/**
         * Use this instead of `update()` if you don't need the columns and gutters updated
         * Maybe an image inside `shuffle` loaded (and now has a height), which means calculations
         * could be off.
         */</span>
        layout : <span class="keyword">function</span>() {
            <span class="keyword">this</span>.update( <span class="literal">true</span> );
        },

        update : <span class="keyword">function</span>( isOnlyLayout ) {
            <span class="keyword">this</span>.resized( isOnlyLayout );
        },

        <span class="comment">/**
         * New items have been appended to shuffle. Fade them in sequentially
         * @param  {jQuery}  $newItems    jQuery collection of new items
         * @param  {Boolean}  [animateIn]    If false, the new items won't animate in
         * @param  {Boolean} [isSequential] If false, new items won't sequentially fade in
         */</span>
        appended : <span class="keyword">function</span>( $newItems, animateIn, isSequential ) {
</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>True if undefined</p>             </td>             <td class="code">               <div class="highlight"><pre>            animateIn = animateIn === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;
            isSequential = isSequential === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;

            <span class="keyword">this</span>._addItems( $newItems, animateIn, isSequential );
        },

        disable : <span class="keyword">function</span>() {
            <span class="keyword">this</span>.enabled = <span class="literal">false</span>;
        },

        enable : <span class="keyword">function</span>( isUpdateLayout ) {
            <span class="keyword">this</span>.enabled = <span class="literal">true</span>;
            <span class="keyword">if</span> ( isUpdateLayout !== <span class="literal">false</span> ) {
                <span class="keyword">this</span>.update();
            }
        },

        remove : <span class="keyword">function</span>( $collection ) {

</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>If this isn't a jquery object, exit</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !$collection.length || !$collection.jquery ) {
                <span class="keyword">return</span>;
            }

            <span class="keyword">var</span> self = <span class="keyword">this</span>,
            remove = <span class="keyword">function</span>() {
                <span class="keyword">var</span> shuffle = <span class="keyword">this</span>;
                $collection.remove();
                $collection = <span class="literal">null</span>;
                setTimeout(<span class="keyword">function</span>() {
                    shuffle.$items = shuffle._getItems();
                    shuffle.layout();
                }, <span class="number">0</span>);
            };

            self.shrink( $collection, remove );
            self._processStyleQueue();
        },

        destroy: <span class="keyword">function</span>() {
            <span class="keyword">var</span> self = <span class="keyword">this</span>;

            self.$window.off(<span class="string">'.'</span> + self.unique);
            self.$container
                .removeClass(<span class="string">'shuffle'</span>)
                .removeAttr(<span class="string">'style'</span>)
                .removeData(<span class="string">'shuffle'</span>);
            self.$items
                .removeAttr(<span class="string">'style'</span>)
                .removeClass(<span class="string">'concealed filtered shuffle-item'</span>);
            self.destroyed = <span class="literal">true</span>;
        }

    };


</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Plugin definition</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.shuffle = <span class="keyword">function</span>(opts, sortObj) {
        <span class="keyword">var</span> args = Array.prototype.slice.call( arguments, <span class="number">1</span> );
        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
            <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),
                shuffle = $<span class="keyword">this</span>.data(<span class="string">'shuffle'</span>);

</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>If we don't have a stored shuffle, make a new one and save it</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( !shuffle ) {
                shuffle = <span class="keyword">new</span> Shuffle($<span class="keyword">this</span>, opts);
                $<span class="keyword">this</span>.data(<span class="string">'shuffle'</span>, shuffle);
            }

</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>If passed a string, lets decide what to do with it. Or they've provided a function to filter by</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="keyword">if</span> ( $.isFunction(opts) ) {
                shuffle.shuffle( opts );

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Key should be an object with propreties reversed and by.</p>             </td>             <td class="code">               <div class="highlight"><pre>            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> opts === <span class="string">'string'</span>) {
                <span class="keyword">switch</span>( opts ) {
                    <span class="keyword">case</span> <span class="string">'sort'</span>:
                        shuffle.sort(sortObj);
                        <span class="keyword">break</span>;
                    <span class="keyword">case</span> <span class="string">'destroy'</span>:
                    <span class="keyword">case</span> <span class="string">'update'</span>:
                    <span class="keyword">case</span> <span class="string">'appended'</span>:
                    <span class="keyword">case</span> <span class="string">'enable'</span>:
                    <span class="keyword">case</span> <span class="string">'disable'</span>:
                    <span class="keyword">case</span> <span class="string">'layout'</span>:
                    <span class="keyword">case</span> <span class="string">'remove'</span>:
                        shuffle[ opts ].apply( shuffle, args );
                        <span class="keyword">break</span>;
                    <span class="keyword">default</span>:
                        shuffle.shuffle( opts );
                        <span class="keyword">break</span>;
                }
            }
        });
    };

</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Overrideable options</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.shuffle.options = {
        group : <span class="string">'all'</span>, <span class="comment">// Filter group</span>
        speed : <span class="number">400</span>, <span class="comment">// Transition/animation speed (milliseconds)</span>
        easing : <span class="string">'ease-out'</span>, <span class="comment">// css easing function to use</span>
        itemSelector: <span class="string">''</span>, <span class="comment">// e.g. '.gallery-item'</span>
        gutterWidth : <span class="number">0</span>, <span class="comment">// a static number or function that tells the plugin how wide the gutters between columns are (in pixels)</span>
        columnWidth : <span class="number">0</span>,<span class="comment">// a static number or function that returns a number which tells the plugin how wide the columns are (in pixels)</span>
        showInitialTransition : <span class="literal">true</span>, <span class="comment">// If set to false, the shuffle-items will only have a transition applied to them after the first layout</span>
        delimeter : <span class="literal">null</span>, <span class="comment">// if your group is not json, and is comma delimeted, you could set delimeter to ','</span>
        buffer: <span class="number">0</span>, <span class="comment">// useful for percentage based heights when they might not always be exactly the same (in pixels)</span>
        throttle: $.debounce || <span class="literal">null</span>,
        throttleTime: <span class="number">300</span>,
        keepSorted : <span class="literal">true</span>, <span class="comment">// Keep sorted when shuffling/layout</span>
        hideLayoutWithFade: <span class="literal">false</span>,
        sequentialFadeDelay: <span class="number">150</span>,
        useTransition: <span class="literal">true</span> <span class="comment">// You don't want transitions on shuffle items? Fine, but you're weird</span>
    };

</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Not overrideable</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.fn.shuffle.settings = {
        itemCss : { <span class="comment">// default CSS for each item</span>
            position: <span class="string">'absolute'</span>,
            top: <span class="number">0</span>,
            left: <span class="number">0</span>
        },
        revealAppendedDelay: <span class="number">300</span>,
        enabled: <span class="literal">true</span>,
        destroyed: <span class="literal">false</span>,
        styleQueue: [],
        supported: Modernizr.csstransforms &amp;&amp; Modernizr.csstransitions, <span class="comment">// supports transitions and transforms</span>
        prefixed: Modernizr.prefixed,
        threeD: Modernizr.csstransforms3d <span class="comment">// supports 3d transforms</span>
    };

});
</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 